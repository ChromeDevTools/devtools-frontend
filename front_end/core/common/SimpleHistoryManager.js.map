{
  "version": 3,
  "sources": ["../../../../../../front_end/core/common/SimpleHistoryManager.ts"],
  "sourcesContent": ["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nexport interface HistoryEntry {\n  valid(): boolean;\n\n  reveal(): void;\n}\n\nexport class SimpleHistoryManager {\n  #entries: HistoryEntry[];\n  #activeEntryIndex: number;\n  #coalescingReadonly: number;\n  readonly #historyDepth: number;\n  constructor(historyDepth: number) {\n    this.#entries = [];\n    this.#activeEntryIndex = -1;\n\n    // Lock is used to make sure that reveal() does not\n    // make any changes to the history while we are\n    // rolling back or rolling over.\n    this.#coalescingReadonly = 0;\n    this.#historyDepth = historyDepth;\n  }\n\n  private readOnlyLock(): void {\n    ++this.#coalescingReadonly;\n  }\n\n  private releaseReadOnlyLock(): void {\n    --this.#coalescingReadonly;\n  }\n\n  private getPreviousValidIndex(): number {\n    if (this.empty()) {\n      return -1;\n    }\n\n    let revealIndex = this.#activeEntryIndex - 1;\n    while (revealIndex >= 0 && !this.#entries[revealIndex].valid()) {\n      --revealIndex;\n    }\n    if (revealIndex < 0) {\n      return -1;\n    }\n\n    return revealIndex;\n  }\n\n  private getNextValidIndex(): number {\n    let revealIndex = this.#activeEntryIndex + 1;\n\n    while (revealIndex < this.#entries.length && !this.#entries[revealIndex].valid()) {\n      ++revealIndex;\n    }\n    if (revealIndex >= this.#entries.length) {\n      return -1;\n    }\n\n    return revealIndex;\n  }\n\n  private readOnly(): boolean {\n    return Boolean(this.#coalescingReadonly);\n  }\n\n  empty(): boolean {\n    return !this.#entries.length;\n  }\n\n  active(): HistoryEntry|null {\n    return this.empty() ? null : this.#entries[this.#activeEntryIndex];\n  }\n\n  push(entry: HistoryEntry): void {\n    if (this.readOnly()) {\n      return;\n    }\n    if (!this.empty()) {\n      this.#entries.splice(this.#activeEntryIndex + 1);\n    }\n    this.#entries.push(entry);\n    if (this.#entries.length > this.#historyDepth) {\n      this.#entries.shift();\n    }\n    this.#activeEntryIndex = this.#entries.length - 1;\n  }\n\n  canRollback(): boolean {\n    return this.getPreviousValidIndex() >= 0;\n  }\n\n  canRollover(): boolean {\n    return this.getNextValidIndex() >= 0;\n  }\n\n  rollback(): boolean {\n    const revealIndex = this.getPreviousValidIndex();\n    if (revealIndex === -1) {\n      return false;\n    }\n    this.readOnlyLock();\n    this.#activeEntryIndex = revealIndex;\n    this.#entries[revealIndex].reveal();\n    this.releaseReadOnlyLock();\n\n    return true;\n  }\n\n  rollover(): boolean {\n    const revealIndex = this.getNextValidIndex();\n    if (revealIndex === -1) {\n      return false;\n    }\n\n    this.readOnlyLock();\n    this.#activeEntryIndex = revealIndex;\n    this.#entries[revealIndex].reveal();\n    this.releaseReadOnlyLock();\n\n    return true;\n  }\n}\n"],
  "mappings": ";AAUO,aAAM,qBAAqB;AAAA,EAChC;AAAA,EACA;AAAA,EACA;AAAA,EACS;AAAA,EACT,YAAY,cAAsB;AAChC,SAAK,WAAW,CAAC;AACjB,SAAK,oBAAoB;AAKzB,SAAK,sBAAsB;AAC3B,SAAK,gBAAgB;AAAA,EACvB;AAAA,EAEQ,eAAqB;AAC3B,MAAE,KAAK;AAAA,EACT;AAAA,EAEQ,sBAA4B;AAClC,MAAE,KAAK;AAAA,EACT;AAAA,EAEQ,wBAAgC;AACtC,QAAI,KAAK,MAAM,GAAG;AAChB,aAAO;AAAA,IACT;AAEA,QAAI,cAAc,KAAK,oBAAoB;AAC3C,WAAO,eAAe,KAAK,CAAC,KAAK,SAAS,WAAW,EAAE,MAAM,GAAG;AAC9D,QAAE;AAAA,IACJ;AACA,QAAI,cAAc,GAAG;AACnB,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,oBAA4B;AAClC,QAAI,cAAc,KAAK,oBAAoB;AAE3C,WAAO,cAAc,KAAK,SAAS,UAAU,CAAC,KAAK,SAAS,WAAW,EAAE,MAAM,GAAG;AAChF,QAAE;AAAA,IACJ;AACA,QAAI,eAAe,KAAK,SAAS,QAAQ;AACvC,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,WAAoB;AAC1B,WAAO,QAAQ,KAAK,mBAAmB;AAAA,EACzC;AAAA,EAEA,QAAiB;AACf,WAAO,CAAC,KAAK,SAAS;AAAA,EACxB;AAAA,EAEA,SAA4B;AAC1B,WAAO,KAAK,MAAM,IAAI,OAAO,KAAK,SAAS,KAAK,iBAAiB;AAAA,EACnE;AAAA,EAEA,KAAK,OAA2B;AAC9B,QAAI,KAAK,SAAS,GAAG;AACnB;AAAA,IACF;AACA,QAAI,CAAC,KAAK,MAAM,GAAG;AACjB,WAAK,SAAS,OAAO,KAAK,oBAAoB,CAAC;AAAA,IACjD;AACA,SAAK,SAAS,KAAK,KAAK;AACxB,QAAI,KAAK,SAAS,SAAS,KAAK,eAAe;AAC7C,WAAK,SAAS,MAAM;AAAA,IACtB;AACA,SAAK,oBAAoB,KAAK,SAAS,SAAS;AAAA,EAClD;AAAA,EAEA,cAAuB;AACrB,WAAO,KAAK,sBAAsB,KAAK;AAAA,EACzC;AAAA,EAEA,cAAuB;AACrB,WAAO,KAAK,kBAAkB,KAAK;AAAA,EACrC;AAAA,EAEA,WAAoB;AAClB,UAAM,cAAc,KAAK,sBAAsB;AAC/C,QAAI,gBAAgB,IAAI;AACtB,aAAO;AAAA,IACT;AACA,SAAK,aAAa;AAClB,SAAK,oBAAoB;AACzB,SAAK,SAAS,WAAW,EAAE,OAAO;AAClC,SAAK,oBAAoB;AAEzB,WAAO;AAAA,EACT;AAAA,EAEA,WAAoB;AAClB,UAAM,cAAc,KAAK,kBAAkB;AAC3C,QAAI,gBAAgB,IAAI;AACtB,aAAO;AAAA,IACT;AAEA,SAAK,aAAa;AAClB,SAAK,oBAAoB;AACzB,SAAK,SAAS,WAAW,EAAE,OAAO;AAClC,SAAK,oBAAoB;AAEzB,WAAO;AAAA,EACT;AACF;",
  "names": []
}
