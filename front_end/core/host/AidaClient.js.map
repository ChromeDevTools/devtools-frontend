{"version":3,"file":"AidaClient.js","sourceRoot":"","sources":["../../../../../../front_end/core/host/AidaClient.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Root from '../root/root.js';\n\nimport * as DispatchHttpRequestClient from './DispatchHttpRequestClient.js';\nimport {InspectorFrontendHostInstance} from './InspectorFrontendHost.js';\nimport type {AidaClientResult, AidaCodeCompleteResult, SyncInformation} from './InspectorFrontendHostAPI.js';\nimport {bindOutputStream} from './ResourceLoader.js';\n\nexport enum Role {\n  /** Provide this role when giving a function call response  */\n  ROLE_UNSPECIFIED = 0,\n  /** Tags the content came from the user */\n  USER = 1,\n  /** Tags the content came from the LLM */\n  MODEL = 2,\n}\n\nexport const enum Rating {\n  // Resets the vote to null in the logs\n  SENTIMENT_UNSPECIFIED = 'SENTIMENT_UNSPECIFIED',\n  POSITIVE = 'POSITIVE',\n  NEGATIVE = 'NEGATIVE',\n}\n\n/**\n * A `Content` represents a single turn message.\n */\nexport interface Content {\n  parts: Part[];\n  /** The producer of the content. */\n  role: Role;\n}\n\nexport type Part = {\n  text: string,\n}|{\n  functionCall: {\n    name: string,\n    args: Record<string, unknown>,\n  },\n}|{\n  functionResponse: {\n    name: string,\n    response: Record<string, unknown>,\n  },\n}|{\n  /** Inline media bytes. */\n  inlineData: MediaBlob,\n};\n\nexport const enum ParametersTypes {\n  STRING = 1,\n  NUMBER = 2,\n  INTEGER = 3,\n  BOOLEAN = 4,\n  ARRAY = 5,\n  OBJECT = 6,\n}\n\ninterface BaseFunctionParam {\n  description: string;\n  nullable?: boolean;\n}\n\nexport interface FunctionPrimitiveParams extends BaseFunctionParam {\n  type: ParametersTypes.BOOLEAN|ParametersTypes.INTEGER|ParametersTypes.STRING|ParametersTypes.BOOLEAN;\n}\n\ninterface FunctionArrayParam extends BaseFunctionParam {\n  type: ParametersTypes.ARRAY;\n  items: FunctionPrimitiveParams;\n}\n\nexport interface FunctionObjectParam<T extends string|number|symbol = string> extends BaseFunctionParam {\n  type: ParametersTypes.OBJECT;\n  // TODO: this can be also be ObjectParams\n  properties: Record<T, FunctionPrimitiveParams|FunctionArrayParam>;\n}\n\n/**\n * More about function declaration can be read at\n * https://ai.google.dev/gemini-api/docs/function-calling\n */\nexport interface FunctionDeclaration<T extends string|number|symbol = string> {\n  name: string;\n  /**\n   * A description for the LLM to understand what the specific function will do once called.\n   */\n  description: string;\n  parameters: FunctionObjectParam<T>;\n}\n\n/** Raw media bytes. **/\nexport interface MediaBlob {\n  // The IANA standard MIME type of the source data.\n  // Currently supported types are: image/png, image/jpeg.\n  // Format: base64-encoded\n  // For reference: google3/google/x/pitchfork/aida/v1/content.proto\n  mimeType: string;\n  data: string;\n}\n\nexport enum FunctionalityType {\n  // Unspecified functionality type.\n  FUNCTIONALITY_TYPE_UNSPECIFIED = 0,\n  // The generic AI chatbot functionality.\n  CHAT = 1,\n  // The explain error functionality.\n  EXPLAIN_ERROR = 2,\n  AGENTIC_CHAT = 5,\n}\n\n/** See: cs/aida.proto (google3). **/\nexport enum ClientFeature {\n  // Unspecified client feature.\n  CLIENT_FEATURE_UNSPECIFIED = 0,\n  // Chrome console insights feature.\n  CHROME_CONSOLE_INSIGHTS = 1,\n  // Chrome AI Assistance Styling Agent.\n  CHROME_STYLING_AGENT = 2,\n  // Chrome AI Assistance Network Agent.\n  CHROME_NETWORK_AGENT = 7,\n  // Chrome AI Annotations Performance Agent\n  CHROME_PERFORMANCE_ANNOTATIONS_AGENT = 20,\n  // Chrome AI Assistance File Agent.\n  CHROME_FILE_AGENT = 9,\n  // Chrome AI Patch Agent.\n  CHROME_PATCH_AGENT = 12,\n  // Chrome AI Assistance Performance Agent.\n  CHROME_PERFORMANCE_FULL_AGENT = 24,\n\n  // Removed features (for reference).\n  // Chrome AI Assistance Performance Insights Agent.\n  // CHROME_PERFORMANCE_INSIGHTS_AGENT = 13,\n  // Chrome AI Assistance Performance Agent (call trees).\n  // CHROME_PERFORMANCE_AGENT = 8,\n}\n\nexport enum UserTier {\n  // Unspecified user tier.\n  USER_TIER_UNSPECIFIED = 0,\n  // Users who are internal testers.\n  TESTERS = 1,\n  // Users who are early adopters.\n  BETA = 2,\n  // Users in the general public.\n  PUBLIC = 3,\n}\n\n/** Googlers: see the Aida `retrieval` proto; this type is based on that. **/\nexport interface RequestFactMetadata {\n  /**\n   * A description of where the fact comes from.\n   */\n  source: string;\n  /**\n   * Optional: a score to give this fact. Used because\n   * if there are more facts than space in the context window,\n   * higher scoring facts will be prioritized.\n   */\n  score?: number;\n}\nexport interface RequestFact {\n  /**\n   * Content of the fact.\n   */\n  text: string;\n  metadata: RequestFactMetadata;\n}\n\nexport type RpcGlobalId = string|number;\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface RequestMetadata {\n  string_session_id?: string;\n  user_tier?: UserTier;\n  disable_user_content_logging: boolean;\n  client_version: string;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface ConversationOptions {\n  temperature?: number;\n  model_id?: string;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface DoConversationRequest {\n  client: string;\n  current_message: Content;\n  preamble?: string;\n  historical_contexts?: Content[];\n  function_declarations?: FunctionDeclaration[];\n  facts?: RequestFact[];\n  options?: ConversationOptions;\n  metadata: RequestMetadata;\n  functionality_type?: FunctionalityType;\n  client_feature?: ClientFeature;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface CompleteCodeOptions {\n  temperature?: number;\n  model_id?: string;\n  inference_language?: AidaInferenceLanguage;\n  stop_sequences?: string[];\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface GenerateCodeOptions {\n  temperature?: number;\n  model_id?: string;\n  inference_language?: AidaInferenceLanguage;\n  expect_code_output?: boolean;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface ContextFile {\n  path: string;\n  full_content: string;\n  selected_content?: string;\n  programming_language: AidaInferenceLanguage;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\nexport enum EditType {\n  // Unknown edit type\n  EDIT_TYPE_UNSPECIFIED = 0,\n  // User typed code/text into file\n  ADD = 1,\n  // User deleted code/text from file\n  DELETE = 2,\n  // User pasted into file (this includes smart paste)\n  PASTE = 3,\n  // User performs an undo action\n  UNDO = 4,\n  // User performs a redo action\n  REDO = 5,\n  // User accepted a completion from AIDA\n  ACCEPT_COMPLETION = 6,\n}\n\nexport enum Reason {\n  // Unknown reason.\n  UNKNOWN = 0,\n\n  // The file is currently open.\n  CURRENTLY_OPEN = 1,\n\n  // The file is opened recently.\n  RECENTLY_OPENED = 2,\n\n  // The file is edited recently.\n  RECENTLY_EDITED = 3,\n\n  // The file is located within the same directory.\n  COLOCATED = 4,\n\n  // Included based on relation to code around the cursor (e.g: could be\n  // provided by local IDE analysis)\n  RELATED_FILE = 5,\n}\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface AdditionalFile {\n  path: string;\n  content: string;\n  included_reason: Reason;\n}\n\nexport interface CompletionRequest {\n  client: string;\n  prefix: string;\n  suffix?: string;\n  options?: CompleteCodeOptions;\n  metadata: RequestMetadata;\n  last_user_action?: EditType;\n  additional_files?: AdditionalFile[];\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\nexport enum UseCase {\n  // Unspecified usecase.\n  USE_CASE_UNSPECIFIED = 0,\n\n  // Code generation use case is expected to generate code from scratch\n  CODE_GENERATION = 1,\n}\n\n/* eslint-disable @typescript-eslint/naming-convention */\nexport interface GenerateCodeRequest {\n  client: string;\n  preamble: string;\n  current_message: Content;\n  options?: GenerateCodeOptions;\n  context_files?: ContextFile[];\n  use_case: UseCase;\n  metadata: RequestMetadata;\n  client_feature?: ClientFeature;\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\n/* eslint-disable @typescript-eslint/naming-convention  */\nexport interface DoConversationClientEvent {\n  user_feedback: {\n    sentiment?: Rating,\n    user_input?: {\n      comment?: string,\n    },\n  };\n}\n\nexport interface UserImpression {\n  sample: {\n    sample_id?: number,\n  };\n  latency: {\n    duration: {\n      seconds: number,\n      nanos: number,\n    },\n  };\n}\n\nexport interface UserAcceptance {\n  sample: {\n    sample_id?: number,\n  };\n}\n\nexport interface AidaRegisterClientEvent {\n  corresponding_aida_rpc_global_id: RpcGlobalId;\n  disable_user_content_logging: boolean;\n  do_conversation_client_event?: DoConversationClientEvent;\n  complete_code_client_event?: {user_acceptance: UserAcceptance}|{user_impression: UserImpression};\n  generate_code_client_event?: {user_acceptance: UserAcceptance}|{user_impression: UserImpression};\n}\n/* eslint-enable @typescript-eslint/naming-convention */\n\nexport enum RecitationAction {\n  ACTION_UNSPECIFIED = 'ACTION_UNSPECIFIED',\n  CITE = 'CITE',\n  BLOCK = 'BLOCK',\n  NO_ACTION = 'NO_ACTION',\n  EXEMPT_FOUND_IN_PROMPT = 'EXEMPT_FOUND_IN_PROMPT',\n}\n\nexport enum CitationSourceType {\n  CITATION_SOURCE_TYPE_UNSPECIFIED = 'CITATION_SOURCE_TYPE_UNSPECIFIED',\n  TRAINING_DATA = 'TRAINING_DATA',\n  WORLD_FACTS = 'WORLD_FACTS',\n  LOCAL_FACTS = 'LOCAL_FACTS',\n  INDIRECT = 'INDIRECT',\n}\n\nexport interface Citation {\n  startIndex?: number;\n  endIndex?: number;\n  uri?: string;\n  sourceType?: CitationSourceType;\n  repository?: string;\n}\n\nexport interface AttributionMetadata {\n  attributionAction: RecitationAction;\n  citations: Citation[];\n}\n\nexport interface AidaFunctionCallResponse {\n  name: string;\n  args: Record<string, unknown>;\n}\n\nexport interface FactualityFact {\n  sourceUri?: string;\n}\n\nexport interface FactualityMetadata {\n  facts: FactualityFact[];\n}\n\nexport interface ResponseMetadata {\n  rpcGlobalId?: RpcGlobalId;\n  attributionMetadata?: AttributionMetadata;\n  factualityMetadata?: FactualityMetadata;\n}\n\nexport interface DoConversationResponse {\n  explanation: string;\n  metadata: ResponseMetadata;\n  functionCalls?: [AidaFunctionCallResponse, ...AidaFunctionCallResponse[]];\n  completed: boolean;\n}\n\nexport interface CompletionResponse {\n  generatedSamples: GenerationSample[];\n  metadata: ResponseMetadata;\n}\n\nexport interface GenerateCodeResponse {\n  samples: GenerationSample[];\n  metadata: ResponseMetadata;\n}\n\nexport interface GenerationSample {\n  generationString: string;\n  score: number;\n  sampleId?: number;\n  attributionMetadata?: AttributionMetadata;\n}\n\nexport const enum AidaAccessPreconditions {\n  AVAILABLE = 'available',\n  NO_ACCOUNT_EMAIL = 'no-account-email',\n  NO_INTERNET = 'no-internet',\n  // This is the state (mostly enterprise) users are in, when they are automatically logged out from\n  // Chrome after a certain time period. For making AIDA requests, they need to log in again.\n  SYNC_IS_PAUSED = 'sync-is-paused',\n}\n\nexport const enum AidaInferenceLanguage {\n  CPP = 'CPP',\n  PYTHON = 'PYTHON',\n  KOTLIN = 'KOTLIN',\n  JAVA = 'JAVA',\n  JAVASCRIPT = 'JAVASCRIPT',\n  GO = 'GO',\n  TYPESCRIPT = 'TYPESCRIPT',\n  HTML = 'HTML',\n  BASH = 'BASH',\n  CSS = 'CSS',\n  DART = 'DART',\n  JSON = 'JSON',\n  MARKDOWN = 'MARKDOWN',\n  VUE = 'VUE',\n  XML = 'XML',\n}\n\nconst AidaLanguageToMarkdown: Record<AidaInferenceLanguage, string> = {\n  CPP: 'cpp',\n  PYTHON: 'py',\n  KOTLIN: 'kt',\n  JAVA: 'java',\n  JAVASCRIPT: 'js',\n  GO: 'go',\n  TYPESCRIPT: 'ts',\n  HTML: 'html',\n  BASH: 'sh',\n  CSS: 'css',\n  DART: 'dart',\n  JSON: 'json',\n  MARKDOWN: 'md',\n  VUE: 'vue',\n  XML: 'xml',\n};\n\nexport const CLIENT_NAME = 'CHROME_DEVTOOLS';\nexport const SERVICE_NAME = 'aidaService';\n\nconst CODE_CHUNK_SEPARATOR = (lang = ''): string => ('\\n`````' + lang + '\\n');\n\nexport class AidaAbortError extends Error {}\nexport class AidaBlockError extends Error {}\n\nexport class AidaClient {\n  static buildConsoleInsightsRequest(input: string): DoConversationRequest {\n    const disallowLogging = Root.Runtime.hostConfig.aidaAvailability?.disallowLogging ?? true;\n    const chromeVersion = Root.Runtime.getChromeVersion();\n    if (!chromeVersion) {\n      throw new Error('Cannot determine Chrome version');\n    }\n    const request: DoConversationRequest = {\n      current_message: {parts: [{text: input}], role: Role.USER},\n      client: CLIENT_NAME,\n      functionality_type: FunctionalityType.EXPLAIN_ERROR,\n      client_feature: ClientFeature.CHROME_CONSOLE_INSIGHTS,\n      metadata: {\n        disable_user_content_logging: disallowLogging,\n        client_version: chromeVersion,\n      },\n    };\n\n    let temperature = -1;\n    let modelId;\n    if (Root.Runtime.hostConfig.devToolsConsoleInsights?.enabled) {\n      temperature = Root.Runtime.hostConfig.devToolsConsoleInsights.temperature ?? -1;\n      modelId = Root.Runtime.hostConfig.devToolsConsoleInsights.modelId;\n    }\n    if (temperature >= 0) {\n      request.options ??= {};\n      request.options.temperature = temperature;\n    }\n    if (modelId) {\n      request.options ??= {};\n      request.options.model_id = modelId;\n    }\n    return request;\n  }\n\n  static async checkAccessPreconditions(): Promise<AidaAccessPreconditions> {\n    if (!navigator.onLine) {\n      return AidaAccessPreconditions.NO_INTERNET;\n    }\n\n    const syncInfo = await new Promise<SyncInformation>(\n        resolve => InspectorFrontendHostInstance.getSyncInformation(syncInfo => resolve(syncInfo)));\n    if (!syncInfo.accountEmail) {\n      return AidaAccessPreconditions.NO_ACCOUNT_EMAIL;\n    }\n\n    if (syncInfo.isSyncPaused) {\n      return AidaAccessPreconditions.SYNC_IS_PAUSED;\n    }\n\n    return AidaAccessPreconditions.AVAILABLE;\n  }\n\n  async *\n      doConversation(request: DoConversationRequest, options?: {signal?: AbortSignal}):\n          AsyncGenerator<DoConversationResponse, void, void> {\n    if (!InspectorFrontendHostInstance.doAidaConversation) {\n      throw new Error('doAidaConversation is not available');\n    }\n    const stream = (() => {\n      let {promise, resolve, reject} = Promise.withResolvers<string|null>();\n      options?.signal?.addEventListener('abort', () => {\n        reject(new AidaAbortError());\n      }, {once: true});\n      return {\n        write: async(data: string): Promise<void> => {\n          resolve(data);\n          ({promise, resolve, reject} = Promise.withResolvers<string|null>());\n        },\n        close: async(): Promise<void> => {\n          resolve(null);\n        },\n        read: (): Promise<string|null> => {\n          return promise;\n        },\n        fail: (e: Error) => reject(e),\n      };\n    })();\n    const streamId = bindOutputStream(stream);\n    InspectorFrontendHostInstance.doAidaConversation(JSON.stringify(request), streamId, result => {\n      if (result.statusCode === 403) {\n        stream.fail(new Error('Server responded: permission denied'));\n      } else if (result.error) {\n        stream.fail(new Error(`Cannot send request: ${result.error} ${result.detail || ''}`));\n      } else if (result.netErrorName === 'net::ERR_TIMED_OUT') {\n        stream.fail(new Error('doAidaConversation timed out'));\n      } else if (result.statusCode !== 200) {\n        stream.fail(new Error(`Request failed: ${JSON.stringify(result)}`));\n      } else {\n        void stream.close();\n      }\n    });\n    let chunk;\n    const text = [];\n    let inCodeChunk = false;\n    const functionCalls: AidaFunctionCallResponse[] = [];\n    let metadata: ResponseMetadata = {rpcGlobalId: 0};\n    while ((chunk = await stream.read())) {\n      let textUpdated = false;\n      // The AIDA response is a JSON array of objects, split at the object\n      // boundary. Therefore each chunk may start with `[` or `,` and possibly\n      // followed by `]`. Each chunk may include one or more objects, so we\n      // make sure that each chunk becomes a well-formed JSON array when we\n      // parse it by adding `[` and `]` and removing `,` where appropriate.\n      if (!chunk.length) {\n        continue;\n      }\n      if (chunk.startsWith(',')) {\n        chunk = chunk.slice(1);\n      }\n      if (!chunk.startsWith('[')) {\n        chunk = '[' + chunk;\n      }\n      if (!chunk.endsWith(']')) {\n        chunk = chunk + ']';\n      }\n      let results;\n      try {\n        results = JSON.parse(chunk);\n      } catch (error) {\n        throw new Error('Cannot parse chunk: ' + chunk, {cause: error});\n      }\n\n      for (const result of results) {\n        if ('metadata' in result) {\n          metadata = result.metadata;\n          if (metadata?.attributionMetadata?.attributionAction === RecitationAction.BLOCK) {\n            throw new AidaBlockError();\n          }\n        }\n        if ('textChunk' in result) {\n          if (inCodeChunk) {\n            text.push(CODE_CHUNK_SEPARATOR());\n            inCodeChunk = false;\n          }\n\n          text.push(result.textChunk.text);\n          textUpdated = true;\n        } else if ('codeChunk' in result) {\n          if (!inCodeChunk) {\n            const language = AidaLanguageToMarkdown[result.codeChunk.inferenceLanguage as AidaInferenceLanguage] ?? '';\n            text.push(CODE_CHUNK_SEPARATOR(language));\n            inCodeChunk = true;\n          }\n\n          text.push(result.codeChunk.code);\n          textUpdated = true;\n        } else if ('functionCallChunk' in result) {\n          functionCalls.push({\n            name: result.functionCallChunk.functionCall.name,\n            args: result.functionCallChunk.functionCall.args,\n          });\n        } else if ('error' in result) {\n          throw new Error(`Server responded: ${JSON.stringify(result)}`);\n        } else {\n          throw new Error('Unknown chunk result');\n        }\n      }\n      if (textUpdated) {\n        yield {\n          explanation: text.join('') + (inCodeChunk ? CODE_CHUNK_SEPARATOR() : ''),\n          metadata,\n          completed: false,\n        };\n      }\n    }\n    yield {\n      explanation: text.join('') + (inCodeChunk ? CODE_CHUNK_SEPARATOR() : ''),\n      metadata,\n      functionCalls: functionCalls.length ? functionCalls as [AidaFunctionCallResponse, ...AidaFunctionCallResponse[]] :\n                                            undefined,\n      completed: true,\n    };\n  }\n\n  registerClientEvent(clientEvent: AidaRegisterClientEvent): Promise<AidaClientResult> {\n    const {promise, resolve} = Promise.withResolvers<AidaClientResult>();\n    InspectorFrontendHostInstance.registerAidaClientEvent(\n        JSON.stringify({\n          client: CLIENT_NAME,\n          event_time: new Date().toISOString(),\n          ...clientEvent,\n        }),\n        resolve,\n    );\n\n    return promise;\n  }\n\n  async completeCode(request: CompletionRequest): Promise<CompletionResponse|null> {\n    if (!InspectorFrontendHostInstance.aidaCodeComplete) {\n      throw new Error('aidaCodeComplete is not available');\n    }\n    const {promise, resolve} = Promise.withResolvers<AidaCodeCompleteResult>();\n    InspectorFrontendHostInstance.aidaCodeComplete(JSON.stringify(request), resolve);\n    const completeCodeResult = await promise;\n\n    if (completeCodeResult.error) {\n      throw new Error(`Cannot send request: ${completeCodeResult.error} ${completeCodeResult.detail || ''}`);\n    }\n    const response = completeCodeResult.response;\n    if (!response?.length) {\n      throw new Error('Empty response');\n    }\n    let parsedResponse;\n    try {\n      parsedResponse = JSON.parse(response);\n    } catch (error) {\n      throw new Error('Cannot parse response: ' + response, {cause: error});\n    }\n\n    const generatedSamples: GenerationSample[] = [];\n    let metadata: ResponseMetadata = {rpcGlobalId: 0};\n    if ('metadata' in parsedResponse) {\n      metadata = parsedResponse.metadata;\n    }\n\n    if ('generatedSamples' in parsedResponse) {\n      for (const generatedSample of parsedResponse.generatedSamples) {\n        const sample: GenerationSample = {\n          generationString: generatedSample.generationString,\n          score: generatedSample.score,\n          sampleId: generatedSample.sampleId,\n        };\n        if ('metadata' in generatedSample && 'attributionMetadata' in generatedSample.metadata) {\n          sample.attributionMetadata = generatedSample.metadata.attributionMetadata;\n        }\n        generatedSamples.push(sample);\n      }\n    } else {\n      return null;\n    }\n\n    return {generatedSamples, metadata};\n  }\n\n  async generateCode(request: GenerateCodeRequest, options?: {signal?: AbortSignal}):\n      Promise<GenerateCodeResponse|null> {\n    const response = await DispatchHttpRequestClient.makeHttpRequest<GenerateCodeResponse>(\n        {\n          service: SERVICE_NAME,\n          path: '/v1/aida:generateCode',\n          method: 'POST',\n          body: JSON.stringify(request),\n        },\n        options);\n\n    return response;\n  }\n}\n\nexport function convertToUserTierEnum(userTier: string|undefined): UserTier {\n  if (userTier) {\n    switch (userTier) {\n      case 'TESTERS':\n        return UserTier.TESTERS;\n      case 'BETA':\n        return UserTier.BETA;\n      case 'PUBLIC':\n        return UserTier.PUBLIC;\n    }\n  }\n  return UserTier.PUBLIC;\n}\n\nlet hostConfigTrackerInstance: HostConfigTracker|undefined;\n\nexport class HostConfigTracker extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  #pollTimer?: number;\n  #aidaAvailability?: AidaAccessPreconditions;\n\n  private constructor() {\n    super();\n  }\n\n  static instance(): HostConfigTracker {\n    if (!hostConfigTrackerInstance) {\n      hostConfigTrackerInstance = new HostConfigTracker();\n    }\n    return hostConfigTrackerInstance;\n  }\n\n  override addEventListener(eventType: Events, listener: Common.EventTarget.EventListener<EventTypes, Events>):\n      Common.EventTarget.EventDescriptor<EventTypes> {\n    const isFirst = !this.hasEventListeners(eventType);\n    const eventDescriptor = super.addEventListener(eventType, listener);\n    if (isFirst) {\n      window.clearTimeout(this.#pollTimer);\n      void this.pollAidaAvailability();\n    }\n    return eventDescriptor;\n  }\n\n  override removeEventListener(eventType: Events, listener: Common.EventTarget.EventListener<EventTypes, Events>):\n      void {\n    super.removeEventListener(eventType, listener);\n    if (!this.hasEventListeners(eventType)) {\n      window.clearTimeout(this.#pollTimer);\n    }\n  }\n\n  async pollAidaAvailability(): Promise<void> {\n    this.#pollTimer = window.setTimeout(() => this.pollAidaAvailability(), 2000);\n    const currentAidaAvailability = await AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaAvailability) {\n      this.#aidaAvailability = currentAidaAvailability;\n      const config =\n          await new Promise<Root.Runtime.HostConfig>(resolve => InspectorFrontendHostInstance.getHostConfig(resolve));\n      Object.assign(Root.Runtime.hostConfig, config);\n      // TODO(crbug.com/442545623): Send `currentAidaAvailability` to the listeners as part of the event so that\n      // `await AidaClient.checkAccessPreconditions()` does not need to be called again in the event handlers.\n      this.dispatchEventToListeners(Events.AIDA_AVAILABILITY_CHANGED);\n    }\n  }\n}\n\nexport const enum Events {\n  AIDA_AVAILABILITY_CHANGED = 'aidaAvailabilityChanged',\n}\n\nexport interface EventTypes {\n  [Events.AIDA_AVAILABILITY_CHANGED]: void;\n}\n"]}