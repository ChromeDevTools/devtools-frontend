{"version":3,"file":"InspectorFrontendHost.js","sourceRoot":"","sources":["../../../../../../front_end/core/host/InspectorFrontendHost.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2009 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Root from '../root/root.js';\n\nimport {\n  EventDescriptors,\n  type Events,\n  type InspectorFrontendHostAPI,\n} from './InspectorFrontendHostAPI.js';\nimport {InspectorFrontendHostStub} from './InspectorFrontendHostStub.js';\nimport {streamWrite as resourceLoaderStreamWrite} from './ResourceLoader.js';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport let InspectorFrontendHostInstance: InspectorFrontendHostAPI;\n\ndeclare global {\n  // Installed by `devtools_compatibility.js` in non-hosted mode, or set to the stub/custom implementation.\n  var InspectorFrontendHost: InspectorFrontendHostAPI;  // eslint-disable-line @typescript-eslint/naming-convention\n  var InspectorFrontendAPI: InspectorFrontendAPIImpl;   // eslint-disable-line @typescript-eslint/naming-convention\n}\n\nclass InspectorFrontendAPIImpl {\n  constructor() {\n    for (const descriptor of EventDescriptors) {\n      // @ts-expect-error Dispatcher magic\n      this[descriptor[0]] = this.dispatch.bind(this, descriptor[0], descriptor[1], descriptor[2]);\n    }\n  }\n\n  private dispatch(name: Events, signature: string[], _runOnceLoaded: boolean, ...params: string[]): void {\n    // Single argument methods get dispatched with the param.\n    if (signature.length < 2) {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        InspectorFrontendHostInstance.events.dispatchEventToListeners<any>(name, params[0]);\n      } catch (error) {\n        console.error(error + ' ' + error.stack);\n      }\n      return;\n    }\n    const data: Record<string, string> = {};\n    for (let i = 0; i < signature.length; ++i) {\n      data[signature[i]] = params[i];\n    }\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      InspectorFrontendHostInstance.events.dispatchEventToListeners<any>(name, data);\n    } catch (error) {\n      console.error(error + ' ' + error.stack);\n    }\n  }\n\n  streamWrite(id: number, chunk: string): void {\n    resourceLoaderStreamWrite(id, chunk);\n  }\n}\n\n/**\n * Used in `front_end/devtools_compatibility.js` to verify that calls from there\n * are valid.\n */\nexport type InspectorFrontendAPIImplMethods = keyof InspectorFrontendAPIImpl;\n\n/**\n * Installs the provided host bindings implementation as the globally used one by DevTools.\n *\n *   - In non-hosted mode this is provided by `devtools_compatibility.js`.\n *   - In hosted mode this tends to be the {@link InspectorFrontendHostStub}.\n *   - For the MCP server this is a custom node.js specific implementation.\n *\n * Note that missing methods will be copied over from the stub.\n */\nexport function installInspectorFrontendHost(instance: InspectorFrontendHostAPI): void {\n  globalThis.InspectorFrontendHost = InspectorFrontendHostInstance = instance;\n\n  if (!(instance instanceof InspectorFrontendHostStub)) {\n    // Add stubs for missing methods.\n    const proto = InspectorFrontendHostStub.prototype;\n    for (const name of (Object.getOwnPropertyNames(proto) as Array<keyof InspectorFrontendHostAPI>)) {\n      const stub = proto[name];\n      if (typeof stub !== 'function' || InspectorFrontendHostInstance[name]) {\n        continue;\n      }\n\n      console.error(`Incompatible embedder: method Host.InspectorFrontendHost.${name} is missing. Using stub instead.`);\n      // @ts-expect-error Global injected by devtools_compatibility.js\n      InspectorFrontendHostInstance[name] = stub;\n    }\n  }\n\n  // Attach the events object.\n  InspectorFrontendHostInstance.events = new Common.ObjectWrapper.ObjectWrapper();\n}\n\n(function(): void {\n// FIXME: This file is included into both apps, since the devtools_app needs the InspectorFrontendHostAPI only,\n// so the host instance should not be initialized there.\ninstallInspectorFrontendHost(globalThis.InspectorFrontendHost ?? new InspectorFrontendHostStub());\nglobalThis.InspectorFrontendAPI = new InspectorFrontendAPIImpl();\n})();\n\nexport function isUnderTest(prefs?: Record<string, string>): boolean {\n  // Integration tests rely on test queryParam.\n  if (Root.Runtime.Runtime.queryParam('test')) {\n    return true;\n  }\n  // Browser tests rely on prefs.\n  if (prefs) {\n    return prefs['isUnderTest'] === 'true';\n  }\n  return Common.Settings.Settings.hasInstance() &&\n      Common.Settings.Settings.instance().createSetting('isUnderTest', false).get();\n}\n\n// The stub class used to be declared here so for backwards compatibility we re-export it from here.\nexport {InspectorFrontendHostStub};\n"]}