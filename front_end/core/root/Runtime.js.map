{"version":3,"file":"Runtime.js","sourceRoot":"","sources":["../../../../../../front_end/core/root/Runtime.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,QAAQ,MAAM,yBAAyB,CAAC;AAEpD,IAAI,eAAe,GAAG,EAAE,CAAC;AAEzB,IAAI,eAAkC,CAAC;AACvC,IAAI,MAAyB,CAAC;AAC9B,IAAI,eAAkC,CAAC;AAEvC;;;;GAIG;AACH,MAAM,UAAU,aAAa,CAAC,WAAmB,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;IAIvE,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC9B,MAAM,UAAU,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;IACtD,IAAI,CAAC,UAAU,EAAE,CAAC;QAChB,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,OAAO,GAAG,mCAAmC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACrE,IAAI,CAAC,OAAO,EAAE,CAAC;QACb,OAAO,IAAI,CAAC;IACd,CAAC;IAED,OAAO,EAAC,IAAI,EAAE,yCAAyC,OAAO,CAAC,CAAC,CAAC,GAAG,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC,CAAC,EAAC,CAAC;AAC7F,CAAC;AAED,MAAM,UAAU,WAAW;IACzB,OAAO,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;AAClC,CAAC;AAED,MAAM,UAAU,WAAW,CAAC,QAAgB;IAC1C,MAAM,eAAe,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;IAC/C,OAAO,eAAe,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;AACzE,CAAC;AAED,MAAM,CAAC,MAAM,gBAAgB,GAAG,GAAW,EAAE;IAC3C,MAAM,WAAW,GAAG,0CAA0C,CAAC;IAC/D,MAAM,WAAW,GAAG,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAC3D,IAAI,WAAW,IAAI,WAAW,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;QAC1C,OAAO,WAAW,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC;IACD,OAAO,EAAE,CAAC;AACZ,CAAC,CAAC;AAEF,MAAM,OAAO,OAAO;IAClB;IACA,CAAC;IAED,MAAM,CAAC,QAAQ,CAAC,OAEF,EAAC,QAAQ,EAAE,IAAI,EAAC;QAC5B,MAAM,EAAC,QAAQ,EAAC,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,eAAe,IAAI,QAAQ,EAAE,CAAC;YACjC,eAAe,GAAG,IAAI,OAAO,EAAE,CAAC;QAClC,CAAC;QAED,OAAO,eAAe,CAAC;IACzB,CAAC;IAED,MAAM,CAAC,cAAc;QACnB,eAAe,GAAG,SAAS,CAAC;IAC9B,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAkB;IAE1C,MAAM,CAAC,eAAe;QACpB,IAAI,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC;YAC/B,OAAO,CAAC,iBAAiB,GAAG,IAAI,eAAe,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QACnE,CAAC;QACD,OAAO,OAAO,CAAC,iBAAiB,CAAC;IACnC,CAAC;IAED,MAAM,CAAC,UAAU,CAAC,IAAY;QAC5B,OAAO,OAAO,CAAC,eAAe,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAC7C,CAAC;IAED,MAAM,CAAC,uBAAuB,CAAC,IAAY,EAAE,KAAa;QACxD,OAAO,CAAC,eAAe,EAAE,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IAC7C,CAAC;IAED,MAAM,CAAC,MAAM;QACX,IAAI,MAAM,KAAK,SAAS,EAAE,CAAC;YACzB,MAAM,GAAG,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC;QACtC,CAAC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED;;;OAGG;IACH,MAAM,CAAC,UAAU;QACf,IAAI,eAAe,KAAK,SAAS,EAAE,CAAC;YAClC,eAAe,GAAG,WAAW,EAAE,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;QACxD,CAAC;QACD,OAAO,eAAe,CAAC;IACzB,CAAC;IAED,MAAM,CAAC,WAAW,CAAC,QAAgB;QACjC,eAAe,GAAG,QAAQ,CAAC;IAC7B,CAAC;IAED,MAAM,CAAC,QAAQ;QACb,OAAO,eAAe,CAAC;IACzB,CAAC;IAED,MAAM,CAAC,mBAAmB,CAAC,UAA6D;QACtF,MAAM,EAAC,UAAU,EAAC,GAAG,UAAU,CAAC;QAChC,IAAI,UAAU,KAAK,GAAG,EAAE,CAAC;YACvB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,IAAI,UAAU,IAAI,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAC/F,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,UAAU,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,CAAC;YACpF,OAAO,KAAK,CAAC;QACf,CAAC;QACD,MAAM,EAAC,SAAS,EAAC,GAAG,UAAU,CAAC;QAC/B,OAAO,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IAClD,CAAC;IAED,gBAAgB,CAAC,UAAkB;QACjC,sCAAsC;QACtC,OAAO,CAAC,GAAG,CAAC,yBAAyB,GAAG,UAAU,CAAC,CAAC;QACpD,MAAM,UAAU,GACZ,SAAS,UAAU,EAAE,CAAC,CAAE,+EAA+E;QAC3G,OAAO,MAAM,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;YACjC,sCAAsC;YACtC,OAAO,CAAC,GAAG,CAAC,wBAAwB,GAAG,UAAU,CAAC,CAAC;YACnD,OAAO,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AASD,MAAM,OAAO,kBAAkB;IAC7B,YAAY,GAAiB,EAAE,CAAC;IACvB,gBAAgB,GAAG,IAAI,GAAG,EAAU,CAAC;IACrC,mBAAmB,GAAG,IAAI,GAAG,EAAU,CAAC;IACxC,iBAAiB,GAAG,IAAI,GAAG,EAAU,CAAC;IACtC,cAAc,GAAG,IAAI,GAAG,EAAU,CAAC;IACnC,QAAQ,GAAG,IAAI,iBAAiB,EAAE,CAAC;IAE5C,0BAA0B;QACxB,MAAM,MAAM,GAAG,EAAE,CAAC;QAClB,KAAK,MAAM,UAAU,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YAC3C,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;gBACnD,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC1B,CAAC;QACH,CAAC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,QAAQ,CACJ,cAAsB,EAAE,eAAuB,EAAE,QAAkB,EAAE,OAAgB,EACrF,YAAqB;QACvB,IAAI,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CAAC;YAC9C,MAAM,IAAI,KAAK,CAAC,yCAAyC,cAAc,GAAG,CAAC,CAAC;QAC9E,CAAC;QACD,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC1C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,UAAU,CACjC,IAAI,EAAE,cAAc,EAAE,eAAe,EAAE,OAAO,CAAC,QAAQ,CAAC,EACxD,OAA0C,IAAI,QAAQ,CAAC,YAAY,CAAC,cAAc,EAClF,YAA+C,IAAI,QAAQ,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC,CAAC;IAChG,CAAC;IAED,SAAS,CAAC,cAAsB;QAC9B,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACrC,oHAAoH;QACpH,yCAAyC;QACzC,IAAI,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,KAAK,KAAK,EAAE,CAAC;YAChD,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CAAC;YAC/F,OAAO,IAAI,CAAC;QACd,CAAC;QACD,IAAI,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CAAC;YAC5C,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;IACpD,CAAC;IAED,UAAU,CAAC,cAAsB,EAAE,OAAgB;QACjD,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACrC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;IAC7C,CAAC;IAED,4BAA4B,CAAC,eAAyB;QACpD,KAAK,MAAM,cAAc,IAAI,eAAe,EAAE,CAAC;YAC7C,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;YACrC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC/C,CAAC;IACH,CAAC;IAED,0BAA0B,CAAC,eAAyB;QAClD,KAAK,MAAM,cAAc,IAAI,eAAe,EAAE,CAAC;YAC7C,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;YACrC,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAC7C,CAAC;IACH,CAAC;IAED,2BAA2B,CAAC,eAAyB;QACnD,KAAK,MAAM,UAAU,IAAI,eAAe,EAAE,CAAC;YACzC,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;YACjC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACtC,CAAC;IACH,CAAC;IAED,aAAa,CAAC,cAAsB;QAClC,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACrC,IAAI,CAAC,mBAAmB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;IAC/C,CAAC;IAED,cAAc,CAAC,cAAsB;QACnC,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,CAAC;QACrC,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;IAClD,CAAC;IAED,YAAY;QACV,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;QAC9B,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;IAC9B,CAAC;IAED,uBAAuB;QACrB,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;IAC/D,CAAC;IAEO,eAAe,CAAC,cAAsB;QAC5C,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CAAC;YAC/C,MAAM,IAAI,KAAK,CAAC,uBAAuB,cAAc,GAAG,CAAC,CAAC;QAC5D,CAAC;IACH,CAAC;CACF;AAED,gEAAgE;AAChE,MAAM,iBAAiB;IACZ,YAAY,GAAsC,EAAE,CAAC;IAE9D;QACE,IAAI,CAAC;YACH,MAAM,iBAAiB,GAAG,IAAI,CAAC,YAAY,EAAE,OAAO,CAAC,aAAa,CAAC,CAAC;YACpE,IAAI,iBAAiB,EAAE,CAAC;gBACtB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;YACpD,CAAC;QACH,CAAC;QAAC,MAAM,CAAC;YACP,OAAO,CAAC,KAAK,CAAC,+CAA+C,CAAC,CAAC;QACjE,CAAC;IACH,CAAC;IAED;;;;;OAKG;IACH,GAAG,CAAC,cAAsB;QACxB,OAAO,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;IAC3C,CAAC;IAED,GAAG,CAAC,cAAsB,EAAE,OAAgB;QAC1C,IAAI,CAAC,YAAY,CAAC,cAAc,CAAC,GAAG,OAAO,CAAC;QAC5C,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,uBAAuB,CAAC,gBAA6B;QACnD,KAAK,MAAM,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC;YACtD,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC;gBAC/B,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;YAChC,CAAC;QACH,CAAC;QACD,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,mBAAmB;QACjB,IAAI,CAAC,YAAY,EAAE,OAAO,CAAC,aAAa,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;IAC/E,CAAC;CACF;AAED,MAAM,OAAO,UAAU;IACrB,IAAI,CAAS;IACb,KAAK,CAAS;IACd,QAAQ,CAAU;IAClB,OAAO,CAAmC;IACjC,YAAY,CAAmC;IAC/C,YAAY,CAAqB;IAC1C,YACI,WAA+B,EAAE,IAAY,EAAE,KAAa,EAAE,QAAiB,EAC/E,OAAwC,EAAE,YAA6C;QACzF,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACvB,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;IAClC,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAChD,CAAC;IAED,UAAU,CAAC,OAAgB;QACzB,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;IACnD,CAAC;CACF;AAED,6EAA6E;AAC7E,MAAM,CAAC,MAAM,WAAW,GAAG,IAAI,kBAAkB,EAAE,CAAC;AA0BpD,MAAM,CAAN,IAAY,0BAIX;AAJD,WAAY,0BAA0B;IACpC,6EAAS,CAAA;IACT,6GAAyB,CAAA;IACzB,iFAAW,CAAA;AACb,CAAC,EAJW,0BAA0B,KAA1B,0BAA0B,QAIrC;AAmBD,MAAM,CAAN,IAAY,iCAIX;AAJD,WAAY,iCAAiC;IAC3C,gEAA2B,CAAA;IAC3B,oGAA+D,CAAA;IAC/D,8DAAyB,CAAA;AAC3B,CAAC,EAJW,iCAAiC,KAAjC,iCAAiC,QAI5C;AA8HD,MAAM,CAAN,IAAY,gCAIX;AAJD,WAAY,gCAAgC;IAC1C,6FAAW,CAAA;IACX,2HAA0B,CAAA;IAC1B,+FAAY,CAAA;AACd,CAAC,EAJW,gCAAgC,KAAhC,gCAAgC,QAI3C;AAqFD;;;;;;;;;;;;;GAaG;AACH,MAAM,CAAC,MAAM,UAAU,GAA+D,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAQ1G,MAAM,CAAC,MAAM,UAAU,GAAG;IACxB,OAAO,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;CACvD,CAAC","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../platform/platform.js';\n\nlet runtimePlatform = '';\n\nlet runtimeInstance: Runtime|undefined;\nlet isNode: boolean|undefined;\nlet isTraceAppEntry: boolean|undefined;\n\n/**\n * Returns the base URL (similar to `<base>`).\n * Used to resolve the relative URLs of any additional DevTools files (locale strings, etc) needed.\n * See: https://cs.chromium.org/remoteBase+f:devtools_window\n */\nexport function getRemoteBase(location: string = self.location.toString()): {\n  base: string,\n  version: string,\n}|null {\n  const url = new URL(location);\n  const remoteBase = url.searchParams.get('remoteBase');\n  if (!remoteBase) {\n    return null;\n  }\n\n  const version = /\\/serve_file\\/(@[0-9a-zA-Z]+)\\/?$/.exec(remoteBase);\n  if (!version) {\n    return null;\n  }\n\n  return {base: `devtools://devtools/remote/serve_file/${version[1]}/`, version: version[1]};\n}\n\nexport function getPathName(): string {\n  return window.location.pathname;\n}\n\nexport function isNodeEntry(pathname: string): boolean {\n  const nodeEntryPoints = ['node_app', 'js_app'];\n  return nodeEntryPoints.some(component => pathname.includes(component));\n}\n\nexport const getChromeVersion = (): string => {\n  const chromeRegex = /(?:^|\\W)(?:Chrome|HeadlessChrome)\\/(\\S+)/;\n  const chromeMatch = navigator.userAgent.match(chromeRegex);\n  if (chromeMatch && chromeMatch.length > 1) {\n    return chromeMatch[1];\n  }\n  return '';\n};\n\nexport class Runtime {\n  private constructor() {\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  }|undefined = {forceNew: null}): Runtime {\n    const {forceNew} = opts;\n    if (!runtimeInstance || forceNew) {\n      runtimeInstance = new Runtime();\n    }\n\n    return runtimeInstance;\n  }\n\n  static removeInstance(): void {\n    runtimeInstance = undefined;\n  }\n\n  static queryParamsObject: URLSearchParams;\n\n  static getSearchParams(): URLSearchParams {\n    if (!Runtime.queryParamsObject) {\n      Runtime.queryParamsObject = new URLSearchParams(location.search);\n    }\n    return Runtime.queryParamsObject;\n  }\n\n  static queryParam(name: string): string|null {\n    return Runtime.getSearchParams().get(name);\n  }\n\n  static setQueryParamForTesting(name: string, value: string): void {\n    Runtime.getSearchParams().set(name, value);\n  }\n\n  static isNode(): boolean {\n    if (isNode === undefined) {\n      isNode = isNodeEntry(getPathName());\n    }\n    return isNode;\n  }\n\n  /**\n   * Returns true if viewing the slimmed-down devtools meant for just viewing a\n   * performance trace, e.g. devtools://devtools/bundled/trace_app.html?traceURL=http://...\n   */\n  static isTraceApp(): boolean {\n    if (isTraceAppEntry === undefined) {\n      isTraceAppEntry = getPathName().includes('trace_app');\n    }\n    return isTraceAppEntry;\n  }\n\n  static setPlatform(platform: string): void {\n    runtimePlatform = platform;\n  }\n\n  static platform(): string {\n    return runtimePlatform;\n  }\n\n  static isDescriptorEnabled(descriptor: {experiment?: string|null, condition?: Condition}): boolean {\n    const {experiment} = descriptor;\n    if (experiment === '*') {\n      return true;\n    }\n    if (experiment && experiment.startsWith('!') && experiments.isEnabled(experiment.substring(1))) {\n      return false;\n    }\n    if (experiment && !experiment.startsWith('!') && !experiments.isEnabled(experiment)) {\n      return false;\n    }\n    const {condition} = descriptor;\n    return condition ? condition(hostConfig) : true;\n  }\n\n  loadLegacyModule(modulePath: string): Promise<unknown> {\n    // eslint-disable-next-line no-console\n    console.log('Loading legacy module: ' + modulePath);\n    const importPath =\n        `../../${modulePath}`;  // Extracted as a variable so esbuild doesn't attempt to bundle all the things.\n    return import(importPath).then(m => {\n      // eslint-disable-next-line no-console\n      console.log('Loaded legacy module: ' + modulePath);\n      return m;\n    });\n  }\n}\n\nexport interface Option {\n  title: string;\n  value: string|boolean;\n  raw?: boolean;\n  text?: string;\n}\n\nexport class ExperimentsSupport {\n  #experiments: Experiment[] = [];\n  readonly #experimentNames = new Set<string>();\n  readonly #enabledTransiently = new Set<string>();\n  readonly #enabledByDefault = new Set<string>();\n  readonly #serverEnabled = new Set<string>();\n  readonly #storage = new ExperimentStorage();\n\n  allConfigurableExperiments(): Experiment[] {\n    const result = [];\n    for (const experiment of this.#experiments) {\n      if (!this.#enabledTransiently.has(experiment.name)) {\n        result.push(experiment);\n      }\n    }\n    return result;\n  }\n\n  register(\n      experimentName: string, experimentTitle: string, unstable?: boolean, docLink?: string,\n      feedbackLink?: string): void {\n    if (this.#experimentNames.has(experimentName)) {\n      throw new Error(`Duplicate registration of experiment '${experimentName}'`);\n    }\n    this.#experimentNames.add(experimentName);\n    this.#experiments.push(new Experiment(\n        this, experimentName, experimentTitle, Boolean(unstable),\n        docLink as Platform.DevToolsPath.UrlString ?? Platform.DevToolsPath.EmptyUrlString,\n        feedbackLink as Platform.DevToolsPath.UrlString ?? Platform.DevToolsPath.EmptyUrlString));\n  }\n\n  isEnabled(experimentName: string): boolean {\n    this.checkExperiment(experimentName);\n    // Check for explicitly disabled #experiments first - the code could call setEnable(false) on the experiment enabled\n    // by default and we should respect that.\n    if (this.#storage.get(experimentName) === false) {\n      return false;\n    }\n    if (this.#enabledTransiently.has(experimentName) || this.#enabledByDefault.has(experimentName)) {\n      return true;\n    }\n    if (this.#serverEnabled.has(experimentName)) {\n      return true;\n    }\n\n    return Boolean(this.#storage.get(experimentName));\n  }\n\n  setEnabled(experimentName: string, enabled: boolean): void {\n    this.checkExperiment(experimentName);\n    this.#storage.set(experimentName, enabled);\n  }\n\n  enableExperimentsTransiently(experimentNames: string[]): void {\n    for (const experimentName of experimentNames) {\n      this.checkExperiment(experimentName);\n      this.#enabledTransiently.add(experimentName);\n    }\n  }\n\n  enableExperimentsByDefault(experimentNames: string[]): void {\n    for (const experimentName of experimentNames) {\n      this.checkExperiment(experimentName);\n      this.#enabledByDefault.add(experimentName);\n    }\n  }\n\n  setServerEnabledExperiments(experimentNames: string[]): void {\n    for (const experiment of experimentNames) {\n      this.checkExperiment(experiment);\n      this.#serverEnabled.add(experiment);\n    }\n  }\n\n  enableForTest(experimentName: string): void {\n    this.checkExperiment(experimentName);\n    this.#enabledTransiently.add(experimentName);\n  }\n\n  disableForTest(experimentName: string): void {\n    this.checkExperiment(experimentName);\n    this.#enabledTransiently.delete(experimentName);\n  }\n\n  clearForTest(): void {\n    this.#experiments = [];\n    this.#experimentNames.clear();\n    this.#enabledTransiently.clear();\n    this.#enabledByDefault.clear();\n    this.#serverEnabled.clear();\n  }\n\n  cleanUpStaleExperiments(): void {\n    this.#storage.cleanUpStaleExperiments(this.#experimentNames);\n  }\n\n  private checkExperiment(experimentName: string): void {\n    if (!this.#experimentNames.has(experimentName)) {\n      throw new Error(`Unknown experiment '${experimentName}'`);\n    }\n  }\n}\n\n/** Manages the 'experiments' dictionary in self.localStorage */\nclass ExperimentStorage {\n  readonly #experiments: Record<string, boolean|undefined> = {};\n\n  constructor() {\n    try {\n      const storedExperiments = self.localStorage?.getItem('experiments');\n      if (storedExperiments) {\n        this.#experiments = JSON.parse(storedExperiments);\n      }\n    } catch {\n      console.error('Failed to parse localStorage[\\'experiments\\']');\n    }\n  }\n\n  /**\n   * Experiments are stored with a tri-state:\n   *   - true: Explicitly enabled.\n   *   - false: Explicitly disabled.\n   *   - undefined: Disabled.\n   */\n  get(experimentName: string): boolean|undefined {\n    return this.#experiments[experimentName];\n  }\n\n  set(experimentName: string, enabled: boolean): void {\n    this.#experiments[experimentName] = enabled;\n    this.#syncToLocalStorage();\n  }\n\n  cleanUpStaleExperiments(validExperiments: Set<string>): void {\n    for (const [key] of Object.entries(this.#experiments)) {\n      if (!validExperiments.has(key)) {\n        delete this.#experiments[key];\n      }\n    }\n    this.#syncToLocalStorage();\n  }\n\n  #syncToLocalStorage(): void {\n    self.localStorage?.setItem('experiments', JSON.stringify(this.#experiments));\n  }\n}\n\nexport class Experiment {\n  name: string;\n  title: string;\n  unstable: boolean;\n  docLink?: Platform.DevToolsPath.UrlString;\n  readonly feedbackLink?: Platform.DevToolsPath.UrlString;\n  readonly #experiments: ExperimentsSupport;\n  constructor(\n      experiments: ExperimentsSupport, name: string, title: string, unstable: boolean,\n      docLink: Platform.DevToolsPath.UrlString, feedbackLink: Platform.DevToolsPath.UrlString) {\n    this.name = name;\n    this.title = title;\n    this.unstable = unstable;\n    this.docLink = docLink;\n    this.feedbackLink = feedbackLink;\n    this.#experiments = experiments;\n  }\n\n  isEnabled(): boolean {\n    return this.#experiments.isEnabled(this.name);\n  }\n\n  setEnabled(enabled: boolean): void {\n    this.#experiments.setEnabled(this.name, enabled);\n  }\n}\n\n/** This must be constructed after the query parameters have been parsed. **/\nexport const experiments = new ExperimentsSupport();\n\n/**\n * @deprecated Experiments should not be used anymore, instead use base::Feature.\n * See docs/contributing/settings-experiments-features.md\n */\nexport const enum ExperimentName {\n  CAPTURE_NODE_CREATION_STACKS = 'capture-node-creation-stacks',\n  CSS_OVERVIEW = 'css-overview',\n  LIVE_HEAP_PROFILE = 'live-heap-profile',\n  ALL = '*',\n  PROTOCOL_MONITOR = 'protocol-monitor',\n  FULL_ACCESSIBILITY_TREE = 'full-accessibility-tree',\n  HEADER_OVERRIDES = 'header-overrides',\n  INSTRUMENTATION_BREAKPOINTS = 'instrumentation-breakpoints',\n  AUTHORED_DEPLOYED_GROUPING = 'authored-deployed-grouping',\n  JUST_MY_CODE = 'just-my-code',\n  USE_SOURCE_MAP_SCOPES = 'use-source-map-scopes',\n  TIMELINE_SHOW_POST_MESSAGE_EVENTS = 'timeline-show-postmessage-events',\n  TIMELINE_DEBUG_MODE = 'timeline-debug-mode',\n  // Adding or removing an entry from this enum?\n  // You will need to update:\n  // 1. REGISTERED_EXPERIMENTS in EnvironmentHelpers.ts (to create this experiment in the test env)\n  // 2. DevToolsExperiments enum in host/UserMetrics.ts\n}\n\nexport enum GenAiEnterprisePolicyValue {\n  ALLOW = 0,\n  ALLOW_WITHOUT_LOGGING = 1,\n  DISABLE = 2,\n}\n\nexport interface AidaAvailability {\n  enabled: boolean;\n  blockedByAge: boolean;\n  blockedByEnterprisePolicy: boolean;\n  blockedByGeo: boolean;\n  disallowLogging: boolean;\n  enterprisePolicyValue: number;\n}\n\ntype Channel = 'stable'|'beta'|'dev'|'canary';\n\nexport interface HostConfigConsoleInsights {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n}\n\nexport enum HostConfigFreestylerExecutionMode {\n  ALL_SCRIPTS = 'ALL_SCRIPTS',\n  SIDE_EFFECT_FREE_SCRIPTS_ONLY = 'SIDE_EFFECT_FREE_SCRIPTS_ONLY',\n  NO_SCRIPTS = 'NO_SCRIPTS',\n}\n\nexport interface HostConfigFreestyler {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n  executionMode?: HostConfigFreestylerExecutionMode;\n  patching?: boolean;\n  multimodal?: boolean;\n  multimodalUploadInput?: boolean;\n  functionCalling?: boolean;\n  featureName?: string;\n}\n\nexport interface HostConfigAiAssistanceNetworkAgent {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n  featureName?: string;\n}\n\nexport interface HostConfigAiAssistancePerformanceAgent {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n  featureName?: string;\n}\n\nexport interface HostConfigAiAssistanceFileAgent {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n  featureName?: string;\n}\n\nexport interface HostConfigAiCodeCompletion {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n}\n\nexport interface HostConfigAiCodeGeneration {\n  modelId: string;\n  temperature: number;\n  enabled: boolean;\n  userTier: string;\n}\n\nexport interface HostConfigDeepLinksViaExtensibilityApi {\n  enabled: boolean;\n}\n\nexport interface HostConfigVeLogging {\n  enabled: boolean;\n  testing: boolean;\n}\n\n/**\n * @see https://goo.gle/devtools-json-design\n */\nexport interface HostConfigWellKnown {\n  enabled: boolean;\n}\n\nexport interface HostConfigPrivacyUI {\n  enabled: boolean;\n}\n\nexport interface HostConfigEnableOriginBoundCookies {\n  portBindingEnabled: boolean;\n  schemeBindingEnabled: boolean;\n}\n\nexport interface HostConfigAnimationStylesInStylesTab {\n  enabled: boolean;\n}\n\nexport interface HostConfigThirdPartyCookieControls {\n  thirdPartyCookieRestrictionEnabled: boolean;\n  thirdPartyCookieMetadataEnabled: boolean;\n  thirdPartyCookieHeuristicsEnabled: boolean;\n  managedBlockThirdPartyCookies: string|boolean;\n}\n\nexport interface HostConfigIPProtection {\n  enabled: boolean;\n}\n\ninterface AiGeneratedTimelineLabels {\n  enabled: boolean;\n}\n\ninterface AllowPopoverForcing {\n  enabled: boolean;\n}\n\ninterface AiSubmenuPrompts {\n  enabled: boolean;\n  featureName?: string;\n}\n\ninterface IpProtectionInDevTools {\n  enabled: boolean;\n}\n\ninterface AiDebugWithAi {\n  enabled: boolean;\n  featureName?: string;\n}\n\ninterface GlobalAiButton {\n  enabled: boolean;\n  promotionEnabled: boolean;\n}\n\ninterface GdpProfiles {\n  enabled: boolean;\n  badgesEnabled: boolean;\n  starterBadgeEnabled: boolean;\n}\n\nexport enum GdpProfilesEnterprisePolicyValue {\n  ENABLED = 0,\n  ENABLED_WITHOUT_BADGES = 1,\n  DISABLED = 2,\n}\n\ninterface GdpProfilesAvailability {\n  // Whether GDP profiles can be enabled on this host (only possible on branded builds).\n  enabled: boolean;\n  enterprisePolicyValue: GdpProfilesEnterprisePolicyValue;\n}\n\ninterface LiveEdit {\n  enabled: boolean;\n}\n\ninterface DevToolsFlexibleLayout {\n  verticalDrawerEnabled: boolean;\n}\n\ninterface DevToolsStartingStyleDebugging {\n  enabled: boolean;\n}\n\ninterface AiPromptApi {\n  enabled: boolean;\n  allowWithoutGpu: boolean;\n}\n\ninterface DevToolsIndividualRequestThrottling {\n  enabled: boolean;\n}\n\nexport interface DevToolsEnableDurableMessages {\n  enabled: boolean;\n}\n\n/**\n * The host configuration that we expect from the DevTools back-end.\n *\n * We use `RecursivePartial` here to enforce that DevTools code is able to\n * handle `HostConfig` objects of an unexpected shape. This can happen if\n * the implementation in the Chromium backend is changed without correctly\n * updating the DevTools frontend. Or if remote debugging a different version\n * of Chrome, resulting in the local browser window and the local DevTools\n * window being of different versions, and consequently potentially having\n * differently shaped `HostConfig`s.\n *\n * @see hostConfig\n */\nexport type HostConfig = Platform.TypeScriptUtilities.RecursivePartial<{\n  aidaAvailability: AidaAvailability,\n  channel: Channel,\n  devToolsConsoleInsights: HostConfigConsoleInsights,\n  devToolsDeepLinksViaExtensibilityApi: HostConfigDeepLinksViaExtensibilityApi,\n  devToolsFreestyler: HostConfigFreestyler,\n  devToolsAiAssistanceNetworkAgent: HostConfigAiAssistanceNetworkAgent,\n  devToolsAiDebugWithAi: AiDebugWithAi,\n  devToolsAiAssistanceFileAgent: HostConfigAiAssistanceFileAgent,\n  devToolsAiAssistancePerformanceAgent: HostConfigAiAssistancePerformanceAgent,\n  devToolsAiCodeCompletion: HostConfigAiCodeCompletion,\n  devToolsAiCodeGeneration: HostConfigAiCodeGeneration,\n  devToolsVeLogging: HostConfigVeLogging,\n  devToolsWellKnown: HostConfigWellKnown,\n  devToolsPrivacyUI: HostConfigPrivacyUI,\n  devToolsIndividualRequestThrottling: DevToolsIndividualRequestThrottling,\n  devToolsIpProtectionPanelInDevTools: HostConfigIPProtection,\n  /**\n   * OffTheRecord here indicates that the user's profile is either incognito,\n   * or guest mode, rather than a \"normal\" profile.\n   */\n  isOffTheRecord: boolean,\n  devToolsEnableOriginBoundCookies: HostConfigEnableOriginBoundCookies,\n  devToolsAnimationStylesInStylesTab: HostConfigAnimationStylesInStylesTab,\n  thirdPartyCookieControls: HostConfigThirdPartyCookieControls,\n  devToolsAiGeneratedTimelineLabels: AiGeneratedTimelineLabels,\n  devToolsAllowPopoverForcing: AllowPopoverForcing,\n  devToolsAiSubmenuPrompts: AiSubmenuPrompts,\n  devToolsIpProtectionInDevTools: IpProtectionInDevTools,\n  devToolsGlobalAiButton: GlobalAiButton,\n  devToolsGdpProfiles: GdpProfiles,\n  devToolsGdpProfilesAvailability: GdpProfilesAvailability,\n  devToolsLiveEdit: LiveEdit,\n  devToolsFlexibleLayout: DevToolsFlexibleLayout,\n  devToolsStartingStyleDebugging: DevToolsStartingStyleDebugging,\n  devToolsAiPromptApi: AiPromptApi,\n  devToolsEnableDurableMessages: DevToolsEnableDurableMessages,\n}>;\n\n/**\n * The host configuration for this DevTools instance.\n *\n * This is initialized early during app startup and should not be modified\n * afterwards. In some cases it can be necessary to re-request the host\n * configuration from Chrome while DevTools is already running. In these\n * cases, the new host configuration should be reflected here, e.g.:\n *\n * ```js\n * const config = await new Promise<Root.Runtime.HostConfig>(\n *   resolve => InspectorFrontendHostInstance.getHostConfig(resolve));\n * Object.assign(Root.runtime.hostConfig, config);\n * ```\n */\nexport const hostConfig: Platform.TypeScriptUtilities.RecursiveReadonly<HostConfig> = Object.create(null);\n\n/**\n * When defining conditions make sure that objects used by the function have\n * been instantiated.\n */\nexport type Condition = (config?: HostConfig) => boolean;\n\nexport const conditions = {\n  canDock: () => Boolean(Runtime.queryParam('can_dock')),\n};\n"]}