{"version":3,"file":"AccessibilityModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/AccessibilityModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport {DeferredDOMNode, type DOMNode} from './DOMModel.js';\nimport {SDKModel} from './SDKModel.js';\nimport {Capability, type Target} from './Target.js';\n\nexport const enum CoreAxPropertyName {\n  NAME = 'name',\n  DESCRIPTION = 'description',\n  VALUE = 'value',\n  ROLE = 'role',\n}\n\nexport interface CoreOrProtocolAxProperty {\n  name: CoreAxPropertyName|Protocol.Accessibility.AXPropertyName;\n  value: Protocol.Accessibility.AXValue;\n}\n\nexport class AccessibilityNode {\n  readonly #accessibilityModel: AccessibilityModel;\n  readonly #id: Protocol.Accessibility.AXNodeId;\n  readonly #backendDOMNodeId: Protocol.DOM.BackendNodeId|null;\n  readonly #deferredDOMNode: DeferredDOMNode|null;\n  readonly #ignored: boolean;\n  readonly #ignoredReasons: Protocol.Accessibility.AXProperty[]|undefined;\n  readonly #role: Protocol.Accessibility.AXValue|null;\n  readonly #name: Protocol.Accessibility.AXValue|null;\n  readonly #description: Protocol.Accessibility.AXValue|null;\n  readonly #value: Protocol.Accessibility.AXValue|null;\n  readonly #properties: Protocol.Accessibility.AXProperty[]|null;\n  readonly #parentId: Protocol.Accessibility.AXNodeId|null;\n  readonly #frameId: Protocol.Page.FrameId|null;\n  readonly #childIds: Protocol.Accessibility.AXNodeId[]|null;\n\n  constructor(accessibilityModel: AccessibilityModel, payload: Protocol.Accessibility.AXNode) {\n    this.#accessibilityModel = accessibilityModel;\n\n    this.#id = payload.nodeId;\n    accessibilityModel.setAXNodeForAXId(this.#id, this);\n    if (payload.backendDOMNodeId) {\n      accessibilityModel.setAXNodeForBackendDOMNodeId(payload.backendDOMNodeId, this);\n      this.#backendDOMNodeId = payload.backendDOMNodeId;\n      this.#deferredDOMNode = new DeferredDOMNode(accessibilityModel.target(), payload.backendDOMNodeId);\n    } else {\n      this.#backendDOMNodeId = null;\n      this.#deferredDOMNode = null;\n    }\n    this.#ignored = payload.ignored;\n    if (this.#ignored && 'ignoredReasons' in payload) {\n      this.#ignoredReasons = payload.ignoredReasons;\n    }\n\n    this.#role = payload.role || null;\n    this.#name = payload.name || null;\n    this.#description = payload.description || null;\n    this.#value = payload.value || null;\n    this.#properties = payload.properties || null;\n    this.#childIds = [...new Set(payload.childIds)];\n    this.#parentId = payload.parentId || null;\n    if (payload.frameId && !payload.parentId) {\n      this.#frameId = payload.frameId;\n      accessibilityModel.setRootAXNodeForFrameId(payload.frameId, this);\n    } else {\n      this.#frameId = null;\n    }\n  }\n\n  id(): Protocol.Accessibility.AXNodeId {\n    return this.#id;\n  }\n\n  accessibilityModel(): AccessibilityModel {\n    return this.#accessibilityModel;\n  }\n\n  ignored(): boolean {\n    return this.#ignored;\n  }\n\n  ignoredReasons(): Protocol.Accessibility.AXProperty[]|null {\n    return this.#ignoredReasons || null;\n  }\n\n  role(): Protocol.Accessibility.AXValue|null {\n    return this.#role || null;\n  }\n\n  coreProperties(): CoreOrProtocolAxProperty[] {\n    const properties: CoreOrProtocolAxProperty[] = [];\n\n    if (this.#name) {\n      properties.push({name: CoreAxPropertyName.NAME, value: this.#name});\n    }\n    if (this.#description) {\n      properties.push({name: CoreAxPropertyName.DESCRIPTION, value: this.#description});\n    }\n    if (this.#value) {\n      properties.push({name: CoreAxPropertyName.VALUE, value: this.#value});\n    }\n\n    return properties;\n  }\n\n  name(): Protocol.Accessibility.AXValue|null {\n    return this.#name || null;\n  }\n\n  description(): Protocol.Accessibility.AXValue|null {\n    return this.#description || null;\n  }\n\n  value(): Protocol.Accessibility.AXValue|null {\n    return this.#value || null;\n  }\n\n  properties(): Protocol.Accessibility.AXProperty[]|null {\n    return this.#properties || null;\n  }\n\n  parentNode(): AccessibilityNode|null {\n    if (this.#parentId) {\n      return this.#accessibilityModel.axNodeForId(this.#parentId);\n    }\n    return null;\n  }\n\n  isDOMNode(): boolean {\n    return Boolean(this.#backendDOMNodeId);\n  }\n\n  backendDOMNodeId(): Protocol.DOM.BackendNodeId|null {\n    return this.#backendDOMNodeId;\n  }\n\n  deferredDOMNode(): DeferredDOMNode|null {\n    return this.#deferredDOMNode;\n  }\n\n  highlightDOMNode(): void {\n    const deferredNode = this.deferredDOMNode();\n    if (!deferredNode) {\n      return;\n    }\n    // Highlight node in page.\n    deferredNode.highlight();\n  }\n\n  children(): AccessibilityNode[] {\n    if (!this.#childIds) {\n      return [];\n    }\n\n    const children = [];\n    for (const childId of this.#childIds) {\n      const child = this.#accessibilityModel.axNodeForId(childId);\n      if (child) {\n        children.push(child);\n      }\n    }\n\n    return children;\n  }\n\n  numChildren(): number {\n    if (!this.#childIds) {\n      return 0;\n    }\n    return this.#childIds.length;\n  }\n\n  hasOnlyUnloadedChildren(): boolean {\n    if (!this.#childIds || !this.#childIds.length) {\n      return false;\n    }\n    return this.#childIds.every(id => this.#accessibilityModel.axNodeForId(id) === null);\n  }\n\n  hasUnloadedChildren(): boolean {\n    if (!this.#childIds || !this.#childIds.length) {\n      return false;\n    }\n    return this.#childIds.some(id => this.#accessibilityModel.axNodeForId(id) === null);\n  }\n  // Only the root node gets a frameId, so nodes have to walk up the tree to find their frameId.\n  getFrameId(): Protocol.Page.FrameId|null {\n    return this.#frameId || this.parentNode()?.getFrameId() || null;\n  }\n}\n\nexport const enum Events {\n  TREE_UPDATED = 'TreeUpdated',\n}\n\nexport interface EventTypes {\n  [Events.TREE_UPDATED]: {root?: AccessibilityNode};\n}\n\nexport class AccessibilityModel extends SDKModel<EventTypes> implements ProtocolProxyApi.AccessibilityDispatcher {\n  agent: ProtocolProxyApi.AccessibilityApi;\n  #axIdToAXNode = new Map<string, AccessibilityNode>();\n  #backendDOMNodeIdToAXNode = new Map<Protocol.DOM.BackendNodeId, AccessibilityNode>();\n  #frameIdToAXNode = new Map<Protocol.Page.FrameId, AccessibilityNode>();\n  #pendingChildRequests = new Map<string, Promise<Protocol.Accessibility.GetChildAXNodesResponse>>();\n  #root: AccessibilityNode|null = null;\n\n  constructor(target: Target) {\n    super(target);\n    target.registerAccessibilityDispatcher(this);\n    this.agent = target.accessibilityAgent();\n    void this.resumeModel();\n  }\n\n  clear(): void {\n    this.#root = null;\n    this.#axIdToAXNode.clear();\n    this.#backendDOMNodeIdToAXNode.clear();\n    this.#frameIdToAXNode.clear();\n  }\n\n  override async resumeModel(): Promise<void> {\n    await this.agent.invoke_enable();\n  }\n\n  override async suspendModel(): Promise<void> {\n    await this.agent.invoke_disable();\n  }\n\n  async requestPartialAXTree(node: DOMNode): Promise<void> {\n    const {nodes} = await this.agent.invoke_getPartialAXTree({nodeId: node.id, fetchRelatives: true});\n    if (!nodes) {\n      return;\n    }\n    const axNodes = [];\n    for (const payload of nodes) {\n      axNodes.push(new AccessibilityNode(this, payload));\n    }\n  }\n\n  loadComplete({root}: Protocol.Accessibility.LoadCompleteEvent): void {\n    this.clear();\n    this.#root = new AccessibilityNode(this, root);\n    this.dispatchEventToListeners(Events.TREE_UPDATED, {root: this.#root});\n  }\n\n  nodesUpdated({nodes}: Protocol.Accessibility.NodesUpdatedEvent): void {\n    this.createNodesFromPayload(nodes);\n    this.dispatchEventToListeners(Events.TREE_UPDATED, {});\n    return;\n  }\n\n  private createNodesFromPayload(payloadNodes: Protocol.Accessibility.AXNode[]): AccessibilityNode[] {\n    const accessibilityNodes = payloadNodes.map(node => {\n      const sdkNode = new AccessibilityNode(this, node);\n      return sdkNode;\n    });\n\n    return accessibilityNodes;\n  }\n\n  async requestRootNode(frameId?: Protocol.Page.FrameId): Promise<AccessibilityNode|undefined> {\n    if (frameId && this.#frameIdToAXNode.has(frameId)) {\n      return this.#frameIdToAXNode.get(frameId);\n    }\n    if (!frameId && this.#root) {\n      return this.#root;\n    }\n    const {node} = await this.agent.invoke_getRootAXNode({frameId});\n    if (!node) {\n      return;\n    }\n    return this.createNodesFromPayload([node])[0];\n  }\n\n  async requestAXChildren(nodeId: Protocol.Accessibility.AXNodeId, frameId?: Protocol.Page.FrameId):\n      Promise<AccessibilityNode[]> {\n    const parent = this.#axIdToAXNode.get(nodeId);\n    if (!parent) {\n      throw new Error('Cannot request children before parent');\n    }\n    if (!parent.hasUnloadedChildren()) {\n      return parent.children();\n    }\n\n    const request = this.#pendingChildRequests.get(nodeId);\n    if (request) {\n      await request;\n    } else {\n      const request = this.agent.invoke_getChildAXNodes({id: nodeId, frameId});\n      this.#pendingChildRequests.set(nodeId, request);\n      const result = await request;\n      if (!result.getError()) {\n        this.createNodesFromPayload(result.nodes);\n        this.#pendingChildRequests.delete(nodeId);\n      }\n    }\n    return parent.children();\n  }\n\n  async requestAndLoadSubTreeToNode(node: DOMNode): Promise<AccessibilityNode[]|null> {\n    // Node may have already been loaded, so don't bother requesting it again.\n    const result = [];\n    let ancestor = this.axNodeForDOMNode(node);\n    while (ancestor) {\n      result.push(ancestor);\n      const parent = ancestor.parentNode();\n      if (!parent) {\n        return result;\n      }\n      ancestor = parent;\n    }\n    const {nodes} = await this.agent.invoke_getAXNodeAndAncestors({backendNodeId: node.backendNodeId()});\n    if (!nodes) {\n      return null;\n    }\n    const ancestors = this.createNodesFromPayload(nodes);\n\n    return ancestors;\n  }\n\n  axNodeForId(axId: Protocol.Accessibility.AXNodeId): AccessibilityNode|null {\n    return this.#axIdToAXNode.get(axId) || null;\n  }\n\n  setRootAXNodeForFrameId(frameId: Protocol.Page.FrameId, axNode: AccessibilityNode): void {\n    this.#frameIdToAXNode.set(frameId, axNode);\n  }\n\n  setAXNodeForAXId(axId: string, axNode: AccessibilityNode): void {\n    this.#axIdToAXNode.set(axId, axNode);\n  }\n\n  axNodeForDOMNode(domNode: DOMNode|null): AccessibilityNode|null {\n    if (!domNode) {\n      return null;\n    }\n    return this.#backendDOMNodeIdToAXNode.get(domNode.backendNodeId()) ?? null;\n  }\n\n  setAXNodeForBackendDOMNodeId(backendDOMNodeId: Protocol.DOM.BackendNodeId, axNode: AccessibilityNode): void {\n    this.#backendDOMNodeIdToAXNode.set(backendDOMNodeId, axNode);\n  }\n\n  getAgent(): ProtocolProxyApi.AccessibilityApi {\n    return this.agent;\n  }\n}\n\nSDKModel.register(AccessibilityModel, {capabilities: Capability.DOM, autostart: false});\n"]}