{"version":3,"file":"AnimationModel.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/AnimationModel.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,6BAA6B,CAAC;AAItD,OAAO,EAAC,eAAe,EAAe,MAAM,eAAe,CAAC;AAC5D,OAAO,EAAC,YAAY,EAAC,MAAM,mBAAmB,CAAC;AAC/C,OAAO,EAAC,MAAM,IAAI,uBAAuB,EAAE,iBAAiB,EAAC,MAAM,wBAAwB,CAAC;AAC5F,OAAO,EAAC,MAAM,IAAI,kBAAkB,EAA6C,YAAY,EAAC,MAAM,mBAAmB,CAAC;AACxH,OAAO,EAAC,QAAQ,EAAC,MAAM,eAAe,CAAC;AAGvC,MAAM,8BAA8B,GAAG,qBAAqB,CAAC;AAC7D,MAAM,mCAAmC,GAAG,qCAAqC,CAAC;AAElF,MAAM,2BAA2B,GAAG,CAAC,EAAU,EAAU,EAAE,CAAC,8BAA8B,EAAE,IAAI,CAAC;AAMjG,KAAK,UAAU,sBAAsB,CAAC,OAAgB,EAAE,SAAiB;IACvE,MAAM,iBAAiB,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,iBAAiB,CAAsB,CAAC;IACpG,MAAM,SAAS,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,CAAC,SAAS,EAAE,CAAC;IAC1D,KAAK,MAAM,KAAK,IAAI,iBAAiB,CAAC,MAAM,EAAE,EAAE,CAAC;QAC/C,oEAAoE;QACpE,MAAM,EAAC,kBAAkB,EAAC,GAAG,MAAM,SAAS,CAAC,0BAA0B,CAAC,EAAC,OAAO,EAAE,KAAK,CAAC,EAAE,EAAE,SAAS,EAAC,CAAC,CAAC;QACxG,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,eAAe,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC;QAC5E,IAAI,MAAM,EAAE,CAAC;YACX,OAAO,MAAM,CAAC;QAChB,CAAC;IACH,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;;;;;;;;;;;;GAcG;AACH,MAAM,OAAO,gBAAgB;IAC3B,QAAQ,CAAU;IAClB,oBAAoB,GAAG,IAAI,GAAG,EAA0B,CAAC;IACzD,sBAAsB,CAAmB;IAEzC,MAAM,CAAC,mBAAmB,GAAG,CAAC,CAAC;IAE/B,YAAY,OAAgB;QAC1B,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;IAC1B,CAAC;IAED,KAAK,CAAC,+BAA+B;QACnC,iEAAiE;QACjE,IAAI,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAChC,OAAO;QACT,CAAC;QAED,IAAI,CAAC,sBAAsB,GAAG,EAAE,CAAC,EAAE;YACjC,MAAM,EAAC,IAAI,EAAE,OAAO,EAAC,GAAG,EAAE,CAAC,IAAI,CAAC;YAChC,IAAI,IAAI,KAAK,mCAAmC,EAAE,CAAC;gBACjD,OAAO;YACT,CAAC;YAED,MAAM,EAAC,SAAS,EAAE,UAAU,EAAE,EAAE,EAAC,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAwD,CAAC;YAC/G,MAAM,cAAc,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YACzD,IAAI,CAAC,cAAc,EAAE,CAAC;gBACpB,OAAO;YACT,CAAC;YAED,cAAc,CAAC,EAAC,SAAS,EAAE,UAAU,EAAC,CAAC,CAAC;QAC1C,CAAC,CAAC;QAEF,MAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,YAAY,CAAiB,CAAC;QAC3F,MAAM,YAAY,CAAC,UAAU,CAAC;YAC5B,IAAI,EAAE,mCAAmC;YACzC,oBAAoB,EAAE,8BAA8B;SACrD,CAAC,CAAC;QACH,YAAY,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,aAAa,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;IAC/F,CAAC;IAED,KAAK,CAAC,kCAAkC;QACtC,qCAAqC;QACrC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;YACjC,OAAO;QACT,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,YAAY,CAAiB,CAAC;QAC3F,MAAM,YAAY,CAAC,aAAa,CAAC;YAC/B,IAAI,EAAE,mCAAmC;SAC1C,CAAC,CAAC;QACH,YAAY,CAAC,mBAAmB,CAAC,kBAAkB,CAAC,aAAa,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;QAChG,IAAI,CAAC,sBAAsB,GAAG,SAAS,CAAC;IAC1C,CAAC;IAED,KAAK,CAAC,sBAAsB,CAAC,QAAoF;QAE/G,gBAAgB,CAAC,mBAAmB,EAAE,CAAC;QACvC,MAAM,EAAE,GAAG,gBAAgB,CAAC,mBAAmB,CAAC;QAChD,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;QAC5C,iFAAiF;QACjF,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;YACjC,MAAM,IAAI,CAAC,+BAA+B,EAAE,CAAC;QAC/C,CAAC;QAED,MAAM,MAAM,GAAG,MAAM,sBAAsB,CAAC,IAAI,CAAC,QAAQ,EAAE,8BAA8B,CAAC,CAAC;QAC3F,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,MAAM,CAAC,YAAY,CAAC,oBAAoB,EAAE;YAC9C,EAAE;YACF,mCAAmC;YACnC,2BAA2B,CAAC,EAAE,CAAC;SAChC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChD,MAAM,CAAC,OAAO,EAAE,CAAC;QACjB,OAAO,EAAE,CAAC;QAEV,SAAS,oBAAoB,CACG,EAAU,EAAE,+BAAuC,EAC/E,wBAAgC;YAClC,IAAI,kBAAkB,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACzD,OAAO;YACT,CAAC;YAED,MAAM,gBAAgB,GAAG,CAAC,kBAAkB,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAgB,CAAC;YACpG,mHAAmH;YACnH,IAAI,CAAC,wBAAwB,CAAC,GAAG,GAAG,EAAE;gBACpC,uGAAuG;gBACvG,UAAU,CAAC,+BAA+B,CAAC,CACvC,IAAI,CAAC,SAAS,CAAC,EAAC,SAAS,EAAE,gBAAgB,CAAC,SAAS,EAAE,UAAU,EAAE,gBAAgB,CAAC,UAAU,EAAE,EAAE,EAAC,CAAC,CAAC,CAAC;YAC5G,CAAC,CAAC;YAEF,kEAAkE;YAClE,IAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,wBAAwB,CAAC,EAAE,IAAI,CAAC,CAAC;QACxE,CAAC;IACH,CAAC;IAED,KAAK,CAAC,yBAAyB,CAAC,EAAU;QACxC,MAAM,MAAM,GAAG,MAAM,sBAAsB,CAAC,IAAI,CAAC,QAAQ,EAAE,8BAA8B,CAAC,CAAC;QAC3F,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO;QACT,CAAC;QAED,MAAM,MAAM,CAAC,YAAY,CACrB,0BAA0B,EAAE,CAAC,2BAA2B,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QAChH,MAAM,CAAC,OAAO,EAAE,CAAC;QAEjB,IAAI,CAAC,oBAAoB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACrC,yDAAyD;QACzD,4BAA4B;QAC5B,IAAI,IAAI,CAAC,oBAAoB,CAAC,IAAI,KAAK,CAAC,EAAE,CAAC;YACzC,MAAM,IAAI,CAAC,kCAAkC,EAAE,CAAC;QAClD,CAAC;QAED,SAAS,0BAA0B,CAA6B,wBAAgC;YAC9F,qFAAqF;YACrF,IAAI,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC;YACnE,qFAAqF;YACrF,OAAO,IAAI,CAAC,wBAAwB,CAAC,CAAC;QACxC,CAAC;IACH,CAAC;IAED,KAAK,CAAC,SAAS;QACb,OAAO,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,KAAK,IAAI,IAAI,CAAC,CAAC;QAEzF,SAAS,eAAe;YACtB,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO,CAAC,CAAC;gBACX,CAAC;gBAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC;YACzC,CAAC;YACD,OAAO,IAAI,CAAC,SAAS,CAAC;QACxB,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU;QACd,OAAO,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,KAAK,IAAI,IAAI,CAAC,CAAC;QAE1F,SAAS,gBAAgB;YACvB,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO,CAAC,CAAC;gBACX,CAAC;gBAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,UAAU,CAAC;YAC1C,CAAC;YACD,OAAO,IAAI,CAAC,UAAU,CAAC;QACzB,CAAC;IACH,CAAC;IAED,KAAK,CAAC,YAAY,CAAC,MAAc;QAC/B,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,kBAAkB,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;QAE/D,SAAS,kBAAkB,CAAyB,YAAoB;YACtE,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO;gBACT,CAAC;gBAED,IAAI,CAAC,gBAAgB,CAAC,SAAS,GAAG,YAAY,CAAC;YACjD,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,SAAS,GAAG,YAAY,CAAC;YAChC,CAAC;QACH,CAAC;IACH,CAAC;IAED,KAAK,CAAC,aAAa,CAAC,MAAc;QAChC,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,mBAAmB,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC;QAEhE,SAAS,mBAAmB,CAAyB,YAAoB;YACvE,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO;gBACT,CAAC;gBAED,IAAI,CAAC,gBAAgB,CAAC,UAAU,GAAG,YAAY,CAAC;YAClD,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,UAAU,GAAG,YAAY,CAAC;YACjC,CAAC;QACH,CAAC;IACH,CAAC;IAED,KAAK,CAAC,mBAAmB;QACvB,OAAO,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,yBAAyB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,KAAK,IAAI,IAAI,CAAC,CAAC;QAEnG,SAAS,yBAAyB;YAChC,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO,CAAC,CAAC;gBACX,CAAC;gBAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,YAAY,GAAG,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC;YACjF,CAAC;YAED,OAAO,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QAC/C,CAAC;IACH,CAAC;IAED,KAAK,CAAC,qBAAqB;QACzB,OAAO,MAAM,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,2BAA2B,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,KAAK,IAAI,IAAI,CAAC,CAAC;QAErG,SAAS,2BAA2B;YAClC,IAAI,kBAAkB,IAAI,IAAI,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;oBAC3B,OAAO,CAAC,CAAC;gBACX,CAAC;gBAED,OAAO,IAAI,CAAC,gBAAgB,CAAC,WAAW,GAAG,IAAI,CAAC,gBAAgB,CAAC,WAAW,CAAC;YAC/E,CAAC;YAED,OAAO,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,WAAW,CAAC;QAC7C,CAAC;IACH,CAAC;;AAGH,SAAS,qBAAqB,CAAC,cAA6B,EAAE,IAAmB;IAC/E,MAAM,sBAAsB,GAAG,cAAc,CAAC,oBAAoB,EAAE,CAAC;IACrE,MAAM,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;IACtD,IAAI,sBAAsB,EAAE,CAAC;QAC3B,uDAAuD;QACvD,yEAAyE;QACzE,OAAO,OAAO,CACV,iBAAiB,IAAI,sBAAsB,CAAC,YAAY,KAAK,iBAAiB,CAAC,YAAY;YAC3F,sBAAsB,CAAC,IAAI,KAAK,iBAAiB,CAAC,IAAI,CAAC,CAAC;IAC9D,CAAC;IACD,gEAAgE;IAChE,gEAAgE;IAChE,OAAO,CAAC,iBAAiB,IAAI,cAAc,CAAC,SAAS,EAAE,KAAK,IAAI,CAAC,SAAS,EAAE,CAAC;AAC/E,CAAC;AAED,MAAM,OAAO,cAAe,SAAQ,QAAoB;IAC7C,YAAY,CAAe;IAC3B,KAAK,CAAgC;IAC9C,eAAe,GAAG,IAAI,GAAG,EAAyB,CAAC;IAC1C,eAAe,GAAG,IAAI,GAAG,EAA0B,CAAC;IAC7D,kBAAkB,GAAG,IAAI,GAAG,EAAU,CAAC;IACvC,YAAY,GAAG,CAAC,CAAC;IACjB,uBAAuB,CAAa;IAEpC,YAAY,MAAc;QACxB,KAAK,CAAC,MAAM,CAAC,CAAC;QACd,IAAI,CAAC,YAAY,GAAI,MAAM,CAAC,KAAK,CAAC,YAAY,CAAkB,CAAC;QACjE,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,cAAc,EAAE,CAAC;QACrC,MAAM,CAAC,2BAA2B,CAAC,IAAI,mBAAmB,CAAC,IAAI,CAAC,CAAC,CAAC;QAElE,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,EAAE,CAAC;YACxB,KAAK,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;QAClC,CAAC;QAED,MAAM,iBAAiB,GAAI,MAAM,CAAC,KAAK,CAAC,iBAAiB,CAAuB,CAAC;QACjF,iBAAiB,CAAC,gBAAgB,CAAC,uBAAuB,CAAC,kBAAkB,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;QAEjG,IAAI,CAAC,uBAAuB,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,EAAE;YAC5D,OAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,EAAE,CAAC;gBACpC,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,gCAAgC,EAAE,CAAC,CAAC;YACpE,CAAC;QACH,CAAC,EAAE,GAAG,CAAC,CAAC;IACV,CAAC;IAEO,KAAK;QACX,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAC7B,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAC7B,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,CAAC;QAChC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;IACnD,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,MAAM,EAAE,CAAC,YAAY,EAAE,CAAC,eAAe,CAAC,EAAC,UAAU,EAAE,yBAAyB,EAAC,CAAC,CAAC;QACnH,IAAI,cAAc,EAAE,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE,CAAC;YAC7C,OAAO,cAAc,EAAE,MAAM,CAAC,KAAe,IAAI,CAAC,CAAC;QACrD,CAAC;QAED,OAAO,CAAC,CAAC;IACX,CAAC;IAED,KAAK,CAAC,6BAA6B,CAAC,IAAY,EAAE,MAA2B;QAC3E,KAAK,MAAM,cAAc,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC;YAC3D,KAAK,MAAM,SAAS,IAAI,cAAc,CAAC,UAAU,EAAE,EAAE,CAAC;gBACpD,IAAI,SAAS,CAAC,IAAI,EAAE,KAAK,IAAI,EAAE,CAAC;oBAC9B,MAAM,aAAa,GAAG,MAAM,SAAS,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC;oBACtD,IAAI,aAAa,EAAE,EAAE,KAAK,MAAM,EAAE,CAAC;wBACjC,OAAO,cAAc,CAAC;oBACxB,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED,iBAAiB,CAAC,EAAU;QAC1B,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACrC,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,OAAqC;QAC1D,IAAI,mBAA6C,CAAC;QAClD,IAAI,cAAuC,CAAC;QAC5C,KAAK,MAAM,cAAc,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC;YAC3D,cAAc,GAAG,cAAc,CAAC,UAAU,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,EAAE,EAAE,KAAK,OAAO,CAAC,EAAE,CAAC,CAAC;YAC9F,IAAI,cAAc,EAAE,CAAC;gBACnB,mBAAmB,GAAG,cAAc,CAAC;gBACrC,MAAM;YACR,CAAC;QACH,CAAC;QAED,IAAI,CAAC,cAAc,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC5C,OAAO;QACT,CAAC;QAED,MAAM,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACzC,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,qBAAqB,EAAE,mBAAmB,CAAC,CAAC;IACnF,CAAC;IAED,KAAK,CAAC,gBAAgB,CAAC,OAAqC;QAC1D,gEAAgE;QAChE,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,aAAa,EAAE,CAAC;YACnC,OAAO;QACT,CAAC;QAED,MAAM,SAAS,GAAG,MAAM,aAAa,CAAC,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAClE,iDAAiD;QACjD,MAAM,aAAa,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,aAAa,EAAE,CAAC;QACzD,IAAI,SAAS,CAAC,IAAI,EAAE,KAAK,cAAc,IAAI,aAAa,IAAI,aAAa,CAAC,SAAS,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACnG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC;QACjD,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC;YACpD,IAAI,CAAC,kBAAkB,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC;QAC9C,CAAC;QAED,IAAI,CAAC,uBAAuB,EAAE,CAAC;IACjC,CAAC;IAEO,mBAAmB,CAAC,aAA6B;QACvD,IAAI,YAAY,GAAwB,IAAI,CAAC;QAC7C,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,CAAC;YAClD,IAAI,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC,EAAE,CAAC;gBACjC,YAAY,GAAG,KAAK,CAAC;gBACrB,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAC;gBAC9B,MAAM;YACR,CAAC;YAED,IAAI,KAAK,CAAC,aAAa,CAAC,aAAa,CAAC,EAAE,CAAC;gBACvC,YAAY,GAAG,KAAK,CAAC;gBACrB,KAAK,CAAC,gBAAgB,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC,CAAC;gBACnD,MAAM;YACR,CAAC;QACH,CAAC;QAED,IAAI,CAAC,YAAY,EAAE,CAAC;YAClB,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE,EAAE,EAAE,aAAa,CAAC,CAAC;YAC5D,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,qBAAqB,EAAE,aAAa,CAAC,CAAC;QAC7E,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,wBAAwB,CAAC,MAAM,CAAC,qBAAqB,EAAE,YAAY,CAAC,CAAC;QAC5E,CAAC;QACD,OAAO,OAAO,CAAC,YAAY,CAAC,CAAC;IAC/B,CAAC;IAEO,gCAAgC;QACtC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC;QACjD,MAAM,gBAAgB,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,KAAe,CAAC;QACjF,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;QAEjD,MAAM,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAClE,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;QACtD,CAAC;QAED,MAAM,iBAAiB,GAAG,CAAC,cAAc,CAAC,CAAC;QAC3C,MAAM,mBAAmB,GAAG,IAAI,GAAG,EAAU,CAAC;QAE9C,KAAK,MAAM,EAAE,IAAI,IAAI,CAAC,kBAAkB,EAAE,CAAC;YACzC,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,EAAE,CAAkB,CAAC;YAC3D,IAAI,qBAAqB,CAAC,cAAc,EAAE,IAAI,CAAC,EAAE,CAAC;gBAChD,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC/B,CAAC;iBAAM,CAAC;gBACN,mBAAmB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YAC9B,CAAC;QACH,CAAC;QAED,IAAI,CAAC,kBAAkB,GAAG,mBAAmB,CAAC;QAC9C,yFAAyF;QACzF,iBAAiB,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,GAAG,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;QAChF,OAAO,IAAI,cAAc,CAAC,IAAI,EAAE,gBAAgB,EAAE,iBAAiB,CAAC,CAAC;IACvE,CAAC;IAED,eAAe,CAAC,YAAoB;QAClC,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;QACjC,KAAK,IAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,EAAC,YAAY,EAAC,CAAC,CAAC;IACzD,CAAC;IAED,KAAK,CAAC,oBAAoB;QACxB,MAAM,YAAY,GAAG,CAAC,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC,CAAC,OAAO,CAC3D,cAAc,CAAC,EAAE,CAAC,cAAc,CAAC,UAAU,EAAE,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QACpF,MAAM,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,EAAC,UAAU,EAAE,YAAY,EAAC,CAAC,CAAC;IACxE,CAAC;IAED,iBAAiB,CAAC,UAAoB;QACpC,KAAK,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,EAAC,UAAU,EAAC,CAAC,CAAC;IACzD,CAAC;IAEQ,KAAK,CAAC,YAAY;QACzB,MAAM,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;IAC7D,CAAC;IAEQ,KAAK,CAAC,WAAW;QACxB,MAAM,IAAI,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;IACnC,CAAC;CACF;AAED,MAAM,CAAN,IAAY,MAMX;AAND,WAAY,MAAM;IAChB,+EAA+E;IAC/E,yDAA+C,CAAA;IAC/C,yDAA+C,CAAA;IAC/C,mCAAyB,CAAA;IACzB,wDAAwD;AAC1D,CAAC,EANW,MAAM,KAAN,MAAM,QAMjB;AAQD,MAAM,OAAO,aAAa;IACf,eAAe,CAAiB;IACzC,QAAQ,CACO,CAAE,qIAAqI;IACtJ,OAAO,CACa,CAAE,qIAAqI;IAC3J,UAAU,CAAU;IAEpB,YAAoB,cAA8B;QAChD,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;IACxC,CAAC;IAED,MAAM,CAAC,KAAK,CAAC,YAAY,CAAC,cAA8B,EAAE,OAAqC;QAE7F,MAAM,SAAS,GAAG,IAAI,aAAa,CAAC,cAAc,CAAC,CAAC;QACpD,MAAM,SAAS,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACpC,OAAO,SAAS,CAAC;IACnB,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,OAAqC;QACpD,+FAA+F;QAC/F,IAAI,OAAO,CAAC,oBAAoB,EAAE,CAAC;YACjC,MAAM,gBAAgB,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,gBAAgB,EAAE,CAAC;YACvE,IAAI,OAAO,CAAC,oBAAoB,CAAC,WAAW,EAAE,CAAC;gBAC7C,OAAO,CAAC,oBAAoB,CAAC,WAAW,IAAI,gBAAgB,CAAC;YAC/D,CAAC;YAED,IAAI,OAAO,CAAC,oBAAoB,CAAC,SAAS,EAAE,CAAC;gBAC3C,OAAO,CAAC,oBAAoB,CAAC,SAAS,IAAI,gBAAgB,CAAC;YAC7D,CAAC;QACH,CAAC;QAED,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;YACnC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC1C,CAAC;aAAM,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;YAC3C,IAAI,CAAC,OAAO,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,eAAe,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;QAC3E,CAAC;IACH,CAAC;IAED,mDAAmD;IACnD,uEAAuE;IACvE,+EAA+E;IAC/E,yEAAyE;IACzE,4DAA4D;IACpD,kBAAkB,CAAC,UAAkB,EAAE,oBAA6D;QAE1G,MAAM,EAAC,WAAW,EAAE,SAAS,EAAC,GAAG,oBAAoB,CAAC;QACtD,IAAI,WAAW,KAAK,SAAS,IAAI,SAAS,KAAK,SAAS,EAAE,CAAC;YACzD,8EAA8E;YAC9E,uFAAuF;YACvF,mGAAmG;YACnG,kCAAkC;YAClC,MAAM,IAAI,KAAK,CAAC,iEAAiE,CAAC,CAAC;QACrF,CAAC;QAED,OAAO,CAAC,SAAS,GAAG,WAAW,CAAC,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,CAAC;IACxD,CAAC;IAED,oBAAoB;QAClB,OAAO,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC;IAC5C,CAAC;IAED,EAAE;QACA,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC;IAC1B,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC;IACnC,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;IACpD,CAAC;IAED,YAAY;QACV,OAAO,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC;IACpC,CAAC;IAED,oFAAoF;IACpF,gDAAgD;IAChD,SAAS;QACP,MAAM,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACzD,IAAI,oBAAoB,EAAE,CAAC;YACzB,OAAO,IAAI,CAAC,kBAAkB,CACnB,IAAI,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,EACjF,oBAAoB,CAAC;gBAC5B,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,WAAW,IAAI,CAAC,CAAC,CAAC;QACtD,CAAC;QAED,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;IACjC,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,iBAAiB;QACf,MAAM,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACzD,IAAI,oBAAoB,EAAE,CAAC;YACzB,OAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,EAAE,oBAAoB,CAAC,CAAC;QACjF,CAAC;QAED,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,CAAC;IAClC,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,OAAO;QACL,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE,CAAC;YAC9B,OAAO,QAAQ,CAAC;QAClB,CAAC;QAED,IAAI,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC;YAChC,OAAO,IAAI,CAAC,SAAS,EAAE,GAAG,IAAI,CAAC,iBAAiB,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE,CAAC;QAClF,CAAC;QAED,OAAO,IAAI,CAAC,SAAS,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE;YACnG,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,CAAC;IAC/B,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,cAAc;QACZ,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,CAAC;QAC3D,IAAI,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC;YAChC,OAAO,IAAI,CAAC,iBAAiB,EAAE,GAAG,UAAU,CAAC;QAC/C,CAAC;QAED,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE,GAAG,UAAU,CAAC;IACvE,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,WAAW;QACT,MAAM,oBAAoB,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QACzD,IAAI,oBAAoB,EAAE,CAAC;YACzB,OAAO,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAE,oBAAoB,CAAC,CAAC;QAClF,CAAC;QAED,OAAO,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC;IACnC,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,QAAQ,CAAC,SAAwB;QAC/B,sBAAsB;QACtB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC;YACpE,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,EAAE,GAAG,SAAS,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC;QACnF,MAAM,eAAe,GAAG,cAAc,KAAK,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC;QACnE,OAAO,cAAc,CAAC,OAAO,EAAE,IAAI,eAAe,CAAC,SAAS,EAAE,CAAC;IACjE,CAAC;IAED,iEAAiE;IACjE,wEAAwE;IACxE,qEAAqE;IACrE,gBAAgB;QACd,IAAI,IAAI,CAAC,oBAAoB,EAAE,EAAE,CAAC;YAChC,OAAO,IAAI,CAAC,SAAS,EAAE,CAAC;QAC1B,CAAC;QAED,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC,KAAK,EAAE,CAAC;IAC/B,CAAC;IAED,SAAS,CAAC,QAAgB,EAAE,KAAa;QACvC,KAAK,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YACnC,IAAI,CAAC,IAAI,EAAE,CAAC;gBACV,MAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;YACzC,CAAC;YACD,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC9C,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,gBAAgB,GAAG,QAAQ,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,aAAa,GAAG,KAAK,CAAC;QACnC,KAAK,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAC,WAAW,EAAE,IAAI,CAAC,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK,EAAC,CAAC,CAAC;IAC9F,CAAC;IAEO,eAAe,CAAC,QAAgB,EAAE,KAAa,EAAE,IAAa;QACpE,IAAI,eAAe,CAAC;QACpB,IAAI,IAAI,CAAC,IAAI,EAAE,yEAAmD,EAAE,CAAC;YACnE,eAAe,GAAG,aAAa,CAAC;QAClC,CAAC;aAAM,IAAI,IAAI,CAAC,IAAI,EAAE,uEAAkD,EAAE,CAAC;YACzE,eAAe,GAAG,YAAY,CAAC;QACjC,CAAC;aAAM,CAAC;YACN,OAAO;QACT,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;QACpC,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC,QAAQ,EAAE,CAAC;QAC5C,QAAQ,CAAC,gCAAgC,CAAC,IAAI,CAAC,EAAE,EAAE,eAAe,GAAG,UAAU,EAAE,QAAQ,GAAG,IAAI,CAAC,CAAC;QAClG,QAAQ,CAAC,gCAAgC,CAAC,IAAI,CAAC,EAAE,EAAE,eAAe,GAAG,OAAO,EAAE,KAAK,GAAG,IAAI,CAAC,CAAC;IAC9F,CAAC;IAED,KAAK,CAAC,mBAAmB;QACvB,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,uBAAuB,CAAC,EAAC,WAAW,EAAE,IAAI,CAAC,EAAE,EAAE,EAAC,CAAC,CAAC;QACnG,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,YAAY,CAAC,kBAAkB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;IACpF,CAAC;IAED,KAAK;QACH,OAAO,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,EAAE,CAAC;IACnC,CAAC;CACF;AAED,MAAM,OAAO,eAAe;IAC1B,eAAe,CAAiB;IAChC,QAAQ,CACa,CAAO,+EAA+E;IAC3G,aAAa,CAAU,CAAK,+EAA+E;IAC3G,gBAAgB,CAAU,CAAE,+EAA+E;IAC3G,cAAc,CAA0B;IACxC,aAAa,CAAmB;IAChC,YAAY,cAA8B,EAAE,OAA2C;QACrF,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;QACtC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IAC3B,CAAC;IAED,UAAU,CAAC,OAA2C;QACpD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,IAAI,CAAC,cAAc,IAAI,OAAO,CAAC,aAAa,EAAE,CAAC;YAClD,IAAI,CAAC,cAAc,GAAG,IAAI,aAAa,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACjE,CAAC;aAAM,IAAI,IAAI,CAAC,cAAc,IAAI,OAAO,CAAC,aAAa,EAAE,CAAC;YACxD,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACxD,CAAC;QAED,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC,KAAK,CAAC;QACnC,IAAI,CAAC,gBAAgB,GAAG,OAAO,CAAC,QAAQ,CAAC;IAC3C,CAAC;IAED,KAAK;QACH,OAAO,IAAI,CAAC,aAAa,CAAC;IAC5B,CAAC;IAED,QAAQ;QACN,OAAO,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC;IAChC,CAAC;IAED,UAAU;QACR,qFAAqF;QACrF,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC;YAC1D,OAAO,CAAC,CAAC;QACX,CAAC;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,IAAI,QAAQ,CAAC;IAC9C,CAAC;IAED,QAAQ;QACN,OAAO,IAAI,CAAC,gBAAgB,CAAC;IAC/B,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC;IACjC,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,IAAI;QACF,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YACxB,IAAI,CAAC,aAAa,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;QAChG,CAAC;QACD,OAAO,IAAI,CAAC,aAAa,CAAC,cAAc,EAAE,CAAC;IAC7C,CAAC;IAED,YAAY;QACV,OAAO,IAAI,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC;IAClF,CAAC;IAED,aAAa;QACX,OAAO,IAAI,CAAC,QAAQ,CAAC,aAA2C,CAAC;IACnE,CAAC;IAED,aAAa;QACX,OAAO,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC;IACrC,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;IAC9B,CAAC;CACF;AAED,MAAM,OAAO,aAAa;IACxB,QAAQ,CACW,CAAY,gFAAgF;IAC/G,UAAU,CAAmB,CAAE,gFAAgF;IAC/G,YAAY,OAAyC;QACnD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IAC3B,CAAC;IAED,UAAU,CAAC,OAAyC;QAClD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;YACrB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,IAAI,aAAa,CAAC,aAAa,CAAC,CAAC,CAAC;QACnG,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,aAAa,EAAE,KAAK,EAAE,EAAE;gBACvD,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE,UAAU,CAAC,aAAa,CAAC,CAAC;YACpD,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAED,IAAI;QACF,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;IAC5B,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;CACF;AAED,MAAM,OAAO,aAAa;IACxB,QAAQ,CAC6B,CAAE,+EAA+E;IACtH,OAAO,CAAU,CAAsB,+EAA+E;IACtH,YAAY,OAAyC;QACnD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IAC3B,CAAC;IAED,UAAU,CAAC,OAAyC;QAClD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC;IAChC,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,SAAS,CAAC,MAAc;QACtB,IAAI,CAAC,OAAO,GAAG,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC;IACpC,CAAC;IAED,cAAc;QACZ,OAAO,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC;IACxC,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;IAC9B,CAAC;CACF;AAED,MAAM,OAAO,cAAc;IAChB,eAAe,CAAiB;IAChC,GAAG,CAAS;IACrB,WAAW,CAA6B;IACxC,WAAW,CAAkB;IAC7B,OAAO,GAAG,KAAK,CAAC;IAChB,YAAY,cAA8B,EAAE,EAAU,EAAE,UAA2B;QACjF,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;QACtC,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;IAChC,CAAC;IAED,cAAc;QACZ,OAAO,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,oBAAoB,EAAE,CAAC,CAAC;IAC9D,CAAC;IAED,EAAE;QACA,OAAO,IAAI,CAAC,GAAG,CAAC;IAClB,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;IAED,OAAO;QACL,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;QACvD,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;IAC9D,CAAC;IAEO,YAAY;QAClB,SAAS,SAAS,CAAC,SAAwB;YACzC,OAAO,SAAS,CAAC,EAAE,EAAE,CAAC;QACxB,CAAC;QAED,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IACzC,CAAC;IAED,SAAS;QACP,OAAO,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;IACzC,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,aAAa;QACX,IAAI,QAAQ,GAAG,CAAC,CAAC;QACjB,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YACpC,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,IAAI,CAAC,gBAAgB,EAAE,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC,CAAC;QACpF,CAAC;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;IAED,uIAAuI;IACvI,gDAAgD;IAChD,cAAc;QACZ,IAAI,WAAW,GAAG,CAAC,CAAC;QACpB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YACjD,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,cAAc,EAAE,CAAC,CAAC;QAC5E,CAAC;QACD,OAAO,WAAW,CAAC;IACrB,CAAC;IAED,iBAAiB;QACf,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,oBAAoB,EAAE,CAAC;QAC7D,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,QAAQ,CAAC,IAAI,CAAC;IACvB,CAAC;IAED,KAAK,CAAC,UAAU;QACd,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YACrB,OAAO,IAAI,CAAC,WAAW,CAAC;QAC1B,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC;YAC3B,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,oBAAoB,EAAE,EAAE,YAAY,CAAC;QAC/E,IAAI,CAAC,YAAY,EAAE,CAAC;YAClB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,kBAAkB,GAAG,IAAI,eAAe,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,YAAY,CAAC,CAAC;QAC5F,MAAM,UAAU,GAAG,MAAM,kBAAkB,CAAC,cAAc,EAAE,CAAC;QAC7D,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,IAAI,gBAAgB,CAAC,UAAU,CAAC,CAAC;QACpD,OAAO,IAAI,CAAC,WAAW,CAAC;IAC1B,CAAC;IAED,MAAM,CAAC,WAAmB;QACxB,KAAK,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,qBAAqB,CAAC,EAAC,UAAU,EAAE,IAAI,CAAC,YAAY,EAAE,EAAE,WAAW,EAAC,CAAC,CAAC;IACxG,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB,CAAC;IAED,WAAW,CAAC,MAAe;QACzB,IAAI,MAAM,KAAK,IAAI,CAAC,OAAO,EAAE,CAAC;YAC5B,OAAO;QACT,CAAC;QACD,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,KAAK,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,gBAAgB,CAAC,EAAC,UAAU,EAAE,IAAI,CAAC,YAAY,EAAE,EAAE,MAAM,EAAC,CAAC,CAAC;IAC9F,CAAC;IAED,kBAAkB;QAChB,IAAI,WAAW,GAAuB,IAAI,CAAC;QAC3C,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YACpC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,EAAE,GAAG,WAAW,CAAC,OAAO,EAAE,EAAE,CAAC;gBAC3D,WAAW,GAAG,IAAI,CAAC;YACrB,CAAC;QACH,CAAC;QACD,IAAI,CAAC,WAAW,EAAE,CAAC;YACjB,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;QAChD,CAAC;QAED,OAAO,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,qBAAqB,CAAC,EAAC,EAAE,EAAE,WAAW,CAAC,EAAE,EAAE,EAAC,CAAC;aAC1E,IAAI,CAAC,CAAC,EAAC,WAAW,EAAC,EAAE,EAAE,CAAC,WAAW,IAAI,CAAC,CAAC,CAAC;IACjD,CAAC;IAED,OAAO,CAAC,KAAqB;QAC3B,SAAS,SAAS,CAAC,IAAmB;YACpC,MAAM,UAAU,GAAG,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,YAAY,IAAI,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,oBAAoB,EAAE,EAAE,IAAI,IAAI,EAAE,CAAC,CAAC;YACjH,MAAM,SAAS,GACX,IAAI,CAAC,IAAI,EAAE,uEAAkD,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YAE3G,OAAO,SAAS,GAAG,UAAU,CAAC;QAChC,CAAC;QAED,IAAI,IAAI,CAAC,WAAW,CAAC,MAAM,KAAK,KAAK,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;YACzD,OAAO,KAAK,CAAC;QACf,CAAC;QACD,MAAM,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,CAAC;QACpD,MAAM,KAAK,GAAG,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,CAAC;QACtD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACrC,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;gBACzB,OAAO,KAAK,CAAC;YACf,CAAC;QACH,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,aAAa,CAAC,KAAqB;QACjC,mEAAmE;QACnE,oFAAoF;QACpF,MAAM,CAAC,sBAAsB,CAAC,GAAG,KAAK,CAAC,WAAW,CAAC;QACnD,MAAM,CAAC,cAAc,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC;QAC1C,OAAO,qBAAqB,CAAC,cAAc,EAAE,sBAAsB,CAAC,CAAC;IACvE,CAAC;IAED,gBAAgB,CAAC,UAA2B;QAC1C,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,UAAU,CAAC,CAAC;IACvC,CAAC;IAED,QAAQ,CAAC,KAAqB;QAC5B,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;QAC5D,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,WAAW,CAAC;QACrC,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;IAC/B,CAAC;CACF;AAED,MAAM,OAAO,mBAAmB;IACrB,eAAe,CAAiB;IACzC,YAAY,cAA8B;QACxC,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;IACxC,CAAC;IAED,gBAAgB,CAAC,MAAgD;QAC/D,qEAAqE;QACrE,iEAAiE;QACjE,oEAAoE;QACpE,oEAAoE;QACpE,yEAAyE;QACzE,8BAA8B;QAC9B,uEAAuE;QACvE,sEAAsE;QACtE,kBAAkB;QAClB,+EAA+E;QAC/E,8EAA8E;QAC9E,+EAA+E;QAC/E,sFAAsF;QACtF,gFAAgF;QAChF,6BAA6B;IAC/B,CAAC;IAED,iBAAiB,CAAC,EAAC,EAAE,EAA4C;QAC/D,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC;IAC7C,CAAC;IAED,gBAAgB,CAAC,EAAC,SAAS,EAA2C;QACpE,KAAK,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;IACxD,CAAC;IAED,gBAAgB,CAAC,EAAC,SAAS,EAA2C;QACpE,KAAK,IAAI,CAAC,eAAe,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;IACxD,CAAC;CACF;AAED,QAAQ,CAAC,QAAQ,CAAC,cAAc,EAAE,EAAC,YAAY,wBAAgB,EAAE,SAAS,EAAE,IAAI,EAAC,CAAC,CAAC","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {DeferredDOMNode, type DOMNode} from './DOMModel.js';\nimport {RemoteObject} from './RemoteObject.js';\nimport {Events as ResourceTreeModelEvents, ResourceTreeModel} from './ResourceTreeModel.js';\nimport {Events as RuntimeModelEvents, type EventTypes as RuntimeModelEventTypes, RuntimeModel} from './RuntimeModel.js';\nimport {SDKModel} from './SDKModel.js';\nimport {Capability, type Target} from './Target.js';\n\nconst DEVTOOLS_ANIMATIONS_WORLD_NAME = 'devtools_animations';\nconst REPORT_SCROLL_POSITION_BINDING_NAME = '__devtools_report_scroll_position__';\n\nconst getScrollListenerNameInPage = (id: number): string => `__devtools_scroll_listener_${id}__`;\n\ntype ScrollListener = (param: {scrollLeft: number, scrollTop: number}) => void;\ntype BindingListener =\n    (ev: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent, RuntimeModelEventTypes>) => void;\n\nasync function resolveToObjectInWorld(domNode: DOMNode, worldName: string): Promise<RemoteObject|null> {\n  const resourceTreeModel = domNode.domModel().target().model(ResourceTreeModel) as ResourceTreeModel;\n  const pageAgent = domNode.domModel().target().pageAgent();\n  for (const frame of resourceTreeModel.frames()) {\n    // This returns previously created world if it exists for the frame.\n    const {executionContextId} = await pageAgent.invoke_createIsolatedWorld({frameId: frame.id, worldName});\n    const object = await domNode.resolveToObject(undefined, executionContextId);\n    if (object) {\n      return object;\n    }\n  }\n  return null;\n}\n\n/**\n * Provides an extension over `DOMNode` that gives it additional\n * capabilities for animation debugging, mainly:\n * - getting a node's scroll information (scroll offsets and scroll range).\n * - updating a node's scroll offset.\n * - tracking the node's scroll offsets with event listeners.\n *\n * It works by running functions on the target page, see `DOMNode`s `callFunction` method\n * for more details on how a function is called on the target page.\n *\n * For listening to events on the target page and getting notified on the devtools frontend\n * side, we're adding a binding to the page `__devtools_report_scroll_position__` in a world `devtools_animation`\n * we've created. Then, we're setting scroll listeners of the `node` in the same world which calls the binding\n * itself with the scroll offsets.\n */\nexport class AnimationDOMNode {\n  #domNode: DOMNode;\n  #scrollListenersById = new Map<number, ScrollListener>();\n  #scrollBindingListener?: BindingListener;\n\n  static lastAddedListenerId = 0;\n\n  constructor(domNode: DOMNode) {\n    this.#domNode = domNode;\n  }\n\n  async #addReportScrollPositionBinding(): Promise<void> {\n    // The binding is already added so we don't need to add it again.\n    if (this.#scrollBindingListener) {\n      return;\n    }\n\n    this.#scrollBindingListener = ev => {\n      const {name, payload} = ev.data;\n      if (name !== REPORT_SCROLL_POSITION_BINDING_NAME) {\n        return;\n      }\n\n      const {scrollTop, scrollLeft, id} = JSON.parse(payload) as {scrollTop: number, scrollLeft: number, id: number};\n      const scrollListener = this.#scrollListenersById.get(id);\n      if (!scrollListener) {\n        return;\n      }\n\n      scrollListener({scrollTop, scrollLeft});\n    };\n\n    const runtimeModel = this.#domNode.domModel().target().model(RuntimeModel) as RuntimeModel;\n    await runtimeModel.addBinding({\n      name: REPORT_SCROLL_POSITION_BINDING_NAME,\n      executionContextName: DEVTOOLS_ANIMATIONS_WORLD_NAME,\n    });\n    runtimeModel.addEventListener(RuntimeModelEvents.BindingCalled, this.#scrollBindingListener);\n  }\n\n  async #removeReportScrollPositionBinding(): Promise<void> {\n    // There isn't any binding added yet.\n    if (!this.#scrollBindingListener) {\n      return;\n    }\n\n    const runtimeModel = this.#domNode.domModel().target().model(RuntimeModel) as RuntimeModel;\n    await runtimeModel.removeBinding({\n      name: REPORT_SCROLL_POSITION_BINDING_NAME,\n    });\n    runtimeModel.removeEventListener(RuntimeModelEvents.BindingCalled, this.#scrollBindingListener);\n    this.#scrollBindingListener = undefined;\n  }\n\n  async addScrollEventListener(onScroll: ({scrollLeft, scrollTop}: {scrollLeft: number, scrollTop: number}) => void):\n      Promise<number|null> {\n    AnimationDOMNode.lastAddedListenerId++;\n    const id = AnimationDOMNode.lastAddedListenerId;\n    this.#scrollListenersById.set(id, onScroll);\n    // Add the binding for reporting scroll events from the page if it doesn't exist.\n    if (!this.#scrollBindingListener) {\n      await this.#addReportScrollPositionBinding();\n    }\n\n    const object = await resolveToObjectInWorld(this.#domNode, DEVTOOLS_ANIMATIONS_WORLD_NAME);\n    if (!object) {\n      return null;\n    }\n\n    await object.callFunction(scrollListenerInPage, [\n      id,\n      REPORT_SCROLL_POSITION_BINDING_NAME,\n      getScrollListenerNameInPage(id),\n    ].map(arg => RemoteObject.toCallArgument(arg)));\n    object.release();\n    return id;\n\n    function scrollListenerInPage(\n        this: HTMLElement|Document, id: number, reportScrollPositionBindingName: string,\n        scrollListenerNameInPage: string): void {\n      if ('scrollingElement' in this && !this.scrollingElement) {\n        return;\n      }\n\n      const scrollingElement = ('scrollingElement' in this ? this.scrollingElement : this) as HTMLElement;\n      // @ts-expect-error We're setting a custom field on `Element` or `Document` for retaining the function on the page.\n      this[scrollListenerNameInPage] = () => {\n        // @ts-expect-error `reportScrollPosition` binding is injected to the page before calling the function.\n        globalThis[reportScrollPositionBindingName](\n            JSON.stringify({scrollTop: scrollingElement.scrollTop, scrollLeft: scrollingElement.scrollLeft, id}));\n      };\n\n      // @ts-expect-error We've already defined the function used below.\n      this.addEventListener('scroll', this[scrollListenerNameInPage], true);\n    }\n  }\n\n  async removeScrollEventListener(id: number): Promise<void> {\n    const object = await resolveToObjectInWorld(this.#domNode, DEVTOOLS_ANIMATIONS_WORLD_NAME);\n    if (!object) {\n      return;\n    }\n\n    await object.callFunction(\n        removeScrollListenerInPage, [getScrollListenerNameInPage(id)].map(arg => RemoteObject.toCallArgument(arg)));\n    object.release();\n\n    this.#scrollListenersById.delete(id);\n    // There aren't any scroll listeners remained on the page\n    // so we remove the binding.\n    if (this.#scrollListenersById.size === 0) {\n      await this.#removeReportScrollPositionBinding();\n    }\n\n    function removeScrollListenerInPage(this: HTMLElement|Document, scrollListenerNameInPage: string): void {\n      // @ts-expect-error We've already set this custom field while adding scroll listener.\n      this.removeEventListener('scroll', this[scrollListenerNameInPage]);\n      // @ts-expect-error We've already set this custom field while adding scroll listener.\n      delete this[scrollListenerNameInPage];\n    }\n  }\n\n  async scrollTop(): Promise<number|null> {\n    return await this.#domNode.callFunction(scrollTopInPage).then(res => res?.value ?? null);\n\n    function scrollTopInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollTop;\n      }\n      return this.scrollTop;\n    }\n  }\n\n  async scrollLeft(): Promise<number|null> {\n    return await this.#domNode.callFunction(scrollLeftInPage).then(res => res?.value ?? null);\n\n    function scrollLeftInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollLeft;\n      }\n      return this.scrollLeft;\n    }\n  }\n\n  async setScrollTop(offset: number): Promise<void> {\n    await this.#domNode.callFunction(setScrollTopInPage, [offset]);\n\n    function setScrollTopInPage(this: Element|Document, offsetInPage: number): void {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return;\n        }\n\n        this.scrollingElement.scrollTop = offsetInPage;\n      } else {\n        this.scrollTop = offsetInPage;\n      }\n    }\n  }\n\n  async setScrollLeft(offset: number): Promise<void> {\n    await this.#domNode.callFunction(setScrollLeftInPage, [offset]);\n\n    function setScrollLeftInPage(this: Element|Document, offsetInPage: number): void {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return;\n        }\n\n        this.scrollingElement.scrollLeft = offsetInPage;\n      } else {\n        this.scrollLeft = offsetInPage;\n      }\n    }\n  }\n\n  async verticalScrollRange(): Promise<number|null> {\n    return await this.#domNode.callFunction(verticalScrollRangeInPage).then(res => res?.value ?? null);\n\n    function verticalScrollRangeInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollHeight - this.scrollingElement.clientHeight;\n      }\n\n      return this.scrollHeight - this.clientHeight;\n    }\n  }\n\n  async horizontalScrollRange(): Promise<number|null> {\n    return await this.#domNode.callFunction(horizontalScrollRangeInPage).then(res => res?.value ?? null);\n\n    function horizontalScrollRangeInPage(this: Element|Document): number {\n      if ('scrollingElement' in this) {\n        if (!this.scrollingElement) {\n          return 0;\n        }\n\n        return this.scrollingElement.scrollWidth - this.scrollingElement.clientWidth;\n      }\n\n      return this.scrollWidth - this.clientWidth;\n    }\n  }\n}\n\nfunction shouldGroupAnimations(firstAnimation: AnimationImpl, anim: AnimationImpl): boolean {\n  const firstAnimationTimeline = firstAnimation.viewOrScrollTimeline();\n  const animationTimeline = anim.viewOrScrollTimeline();\n  if (firstAnimationTimeline) {\n    // This is a SDA group so check whether the animation's\n    // scroll container and scroll axis is the same with the first animation.\n    return Boolean(\n        animationTimeline && firstAnimationTimeline.sourceNodeId === animationTimeline.sourceNodeId &&\n        firstAnimationTimeline.axis === animationTimeline.axis);\n  }\n  // This is a non-SDA group so check whether the coming animation\n  // is a time based one too and if so, compare their start times.\n  return !animationTimeline && firstAnimation.startTime() === anim.startTime();\n}\n\nexport class AnimationModel extends SDKModel<EventTypes> {\n  readonly runtimeModel: RuntimeModel;\n  readonly agent: ProtocolProxyApi.AnimationApi;\n  #animationsById = new Map<string, AnimationImpl>();\n  readonly animationGroups = new Map<string, AnimationGroup>();\n  #pendingAnimations = new Set<string>();\n  playbackRate = 1;\n  #flushPendingAnimations: () => void;\n\n  constructor(target: Target) {\n    super(target);\n    this.runtimeModel = (target.model(RuntimeModel) as RuntimeModel);\n    this.agent = target.animationAgent();\n    target.registerAnimationDispatcher(new AnimationDispatcher(this));\n\n    if (!target.suspended()) {\n      void this.agent.invoke_enable();\n    }\n\n    const resourceTreeModel = (target.model(ResourceTreeModel) as ResourceTreeModel);\n    resourceTreeModel.addEventListener(ResourceTreeModelEvents.PrimaryPageChanged, this.reset, this);\n\n    this.#flushPendingAnimations = Common.Debouncer.debounce(() => {\n      while (this.#pendingAnimations.size) {\n        this.matchExistingGroups(this.createGroupFromPendingAnimations());\n      }\n    }, 100);\n  }\n\n  private reset(): void {\n    this.#animationsById.clear();\n    this.animationGroups.clear();\n    this.#pendingAnimations.clear();\n    this.dispatchEventToListeners(Events.ModelReset);\n  }\n\n  async devicePixelRatio(): Promise<number> {\n    const evaluateResult = await this.target().runtimeAgent().invoke_evaluate({expression: 'window.devicePixelRatio'});\n    if (evaluateResult?.result.type === 'number') {\n      return evaluateResult?.result.value as number ?? 1;\n    }\n\n    return 1;\n  }\n\n  async getAnimationGroupForAnimation(name: string, nodeId: Protocol.DOM.NodeId): Promise<AnimationGroup|null> {\n    for (const animationGroup of this.animationGroups.values()) {\n      for (const animation of animationGroup.animations()) {\n        if (animation.name() === name) {\n          const animationNode = await animation.source().node();\n          if (animationNode?.id === nodeId) {\n            return animationGroup;\n          }\n        }\n      }\n    }\n\n    return null;\n  }\n\n  animationCanceled(id: string): void {\n    this.#pendingAnimations.delete(id);\n  }\n\n  async animationUpdated(payload: Protocol.Animation.Animation): Promise<void> {\n    let foundAnimationGroup: AnimationGroup|undefined;\n    let foundAnimation: AnimationImpl|undefined;\n    for (const animationGroup of this.animationGroups.values()) {\n      foundAnimation = animationGroup.animations().find(animation => animation.id() === payload.id);\n      if (foundAnimation) {\n        foundAnimationGroup = animationGroup;\n        break;\n      }\n    }\n\n    if (!foundAnimation || !foundAnimationGroup) {\n      return;\n    }\n\n    await foundAnimation.setPayload(payload);\n    this.dispatchEventToListeners(Events.AnimationGroupUpdated, foundAnimationGroup);\n  }\n\n  async animationStarted(payload: Protocol.Animation.Animation): Promise<void> {\n    // We are not interested in animations without effect or target.\n    if (!payload.source?.backendNodeId) {\n      return;\n    }\n\n    const animation = await AnimationImpl.parsePayload(this, payload);\n    // Ignore Web Animations custom effects & groups.\n    const keyframesRule = animation.source().keyframesRule();\n    if (animation.type() === 'WebAnimation' && keyframesRule && keyframesRule.keyframes().length === 0) {\n      this.#pendingAnimations.delete(animation.id());\n    } else {\n      this.#animationsById.set(animation.id(), animation);\n      this.#pendingAnimations.add(animation.id());\n    }\n\n    this.#flushPendingAnimations();\n  }\n\n  private matchExistingGroups(incomingGroup: AnimationGroup): boolean {\n    let matchedGroup: AnimationGroup|null = null;\n    for (const group of this.animationGroups.values()) {\n      if (group.matches(incomingGroup)) {\n        matchedGroup = group;\n        group.rebaseTo(incomingGroup);\n        break;\n      }\n\n      if (group.shouldInclude(incomingGroup)) {\n        matchedGroup = group;\n        group.appendAnimations(incomingGroup.animations());\n        break;\n      }\n    }\n\n    if (!matchedGroup) {\n      this.animationGroups.set(incomingGroup.id(), incomingGroup);\n      this.dispatchEventToListeners(Events.AnimationGroupStarted, incomingGroup);\n    } else {\n      this.dispatchEventToListeners(Events.AnimationGroupUpdated, matchedGroup);\n    }\n    return Boolean(matchedGroup);\n  }\n\n  private createGroupFromPendingAnimations(): AnimationGroup {\n    console.assert(this.#pendingAnimations.size > 0);\n    const firstAnimationId = this.#pendingAnimations.values().next().value as string;\n    this.#pendingAnimations.delete(firstAnimationId);\n\n    const firstAnimation = this.#animationsById.get(firstAnimationId);\n    if (!firstAnimation) {\n      throw new Error('Unable to locate first animation');\n    }\n\n    const groupedAnimations = [firstAnimation];\n    const remainingAnimations = new Set<string>();\n\n    for (const id of this.#pendingAnimations) {\n      const anim = this.#animationsById.get(id) as AnimationImpl;\n      if (shouldGroupAnimations(firstAnimation, anim)) {\n        groupedAnimations.push(anim);\n      } else {\n        remainingAnimations.add(id);\n      }\n    }\n\n    this.#pendingAnimations = remainingAnimations;\n    // Show the first starting animation at the top of the animations of the animation group.\n    groupedAnimations.sort((anim1, anim2) => anim1.startTime() - anim2.startTime());\n    return new AnimationGroup(this, firstAnimationId, groupedAnimations);\n  }\n\n  setPlaybackRate(playbackRate: number): void {\n    this.playbackRate = playbackRate;\n    void this.agent.invoke_setPlaybackRate({playbackRate});\n  }\n\n  async releaseAllAnimations(): Promise<void> {\n    const animationIds = [...this.animationGroups.values()].flatMap(\n        animationGroup => animationGroup.animations().map(animation => animation.id()));\n    await this.agent.invoke_releaseAnimations({animations: animationIds});\n  }\n\n  releaseAnimations(animations: string[]): void {\n    void this.agent.invoke_releaseAnimations({animations});\n  }\n\n  override async suspendModel(): Promise<void> {\n    await this.agent.invoke_disable().then(() => this.reset());\n  }\n\n  override async resumeModel(): Promise<void> {\n    await this.agent.invoke_enable();\n  }\n}\n\nexport enum Events {\n  /* eslint-disable @typescript-eslint/naming-convention -- Used by web_tests. */\n  AnimationGroupStarted = 'AnimationGroupStarted',\n  AnimationGroupUpdated = 'AnimationGroupUpdated',\n  ModelReset = 'ModelReset',\n  /* eslint-enable @typescript-eslint/naming-convention */\n}\n\nexport interface EventTypes {\n  [Events.AnimationGroupStarted]: AnimationGroup;\n  [Events.AnimationGroupUpdated]: AnimationGroup;\n  [Events.ModelReset]: void;\n}\n\nexport class AnimationImpl {\n  readonly #animationModel: AnimationModel;\n  #payload!: Protocol.Animation\n      .Animation;  // Assertion is safe because only way to create `AnimationImpl` is to use `parsePayload` which calls `setPayload` and sets the value.\n  #source!:\n      AnimationEffect;  // Assertion is safe because only way to create `AnimationImpl` is to use `parsePayload` which calls `setPayload` and sets the value.\n  #playState?: string;\n\n  private constructor(animationModel: AnimationModel) {\n    this.#animationModel = animationModel;\n  }\n\n  static async parsePayload(animationModel: AnimationModel, payload: Protocol.Animation.Animation):\n      Promise<AnimationImpl> {\n    const animation = new AnimationImpl(animationModel);\n    await animation.setPayload(payload);\n    return animation;\n  }\n\n  async setPayload(payload: Protocol.Animation.Animation): Promise<void> {\n    // TODO(b/40929569): Remove normalizing by devicePixelRatio after the attached bug is resolved.\n    if (payload.viewOrScrollTimeline) {\n      const devicePixelRatio = await this.#animationModel.devicePixelRatio();\n      if (payload.viewOrScrollTimeline.startOffset) {\n        payload.viewOrScrollTimeline.startOffset /= devicePixelRatio;\n      }\n\n      if (payload.viewOrScrollTimeline.endOffset) {\n        payload.viewOrScrollTimeline.endOffset /= devicePixelRatio;\n      }\n    }\n\n    this.#payload = payload;\n    if (this.#source && payload.source) {\n      this.#source.setPayload(payload.source);\n    } else if (!this.#source && payload.source) {\n      this.#source = new AnimationEffect(this.#animationModel, payload.source);\n    }\n  }\n\n  // `startTime` and `duration` is represented as the\n  // percentage of the view timeline range that starts at `startOffset`px\n  // from the scroll container and ends at `endOffset`px of the scroll container.\n  // This takes a percentage of the timeline range and returns the absolute\n  // pixels values as a scroll offset of the scroll container.\n  private percentageToPixels(percentage: number, viewOrScrollTimeline: Protocol.Animation.ViewOrScrollTimeline):\n      number {\n    const {startOffset, endOffset} = viewOrScrollTimeline;\n    if (startOffset === undefined || endOffset === undefined) {\n      // We don't expect this situation to occur since after an animation is started\n      // we expect the scroll offsets to be resolved and provided correctly. If `startOffset`\n      // or `endOffset` is not provided in a viewOrScrollTimeline; we can assume that there is a bug here\n      // so it's fine to throw an error.\n      throw new Error('startOffset or endOffset does not exist in viewOrScrollTimeline');\n    }\n\n    return (endOffset - startOffset) * (percentage / 100);\n  }\n\n  viewOrScrollTimeline(): Protocol.Animation.ViewOrScrollTimeline|undefined {\n    return this.#payload.viewOrScrollTimeline;\n  }\n\n  id(): string {\n    return this.#payload.id;\n  }\n\n  name(): string {\n    return this.#payload.name;\n  }\n\n  paused(): boolean {\n    return this.#payload.pausedState;\n  }\n\n  playState(): string {\n    return this.#playState || this.#payload.playState;\n  }\n\n  playbackRate(): number {\n    return this.#payload.playbackRate;\n  }\n\n  // For scroll driven animations, it returns the pixel offset in the scroll container\n  // For time animations, it returns milliseconds.\n  startTime(): number {\n    const viewOrScrollTimeline = this.viewOrScrollTimeline();\n    if (viewOrScrollTimeline) {\n      return this.percentageToPixels(\n                 this.playbackRate() > 0 ? this.#payload.startTime : 100 - this.#payload.startTime,\n                 viewOrScrollTimeline) +\n          (this.viewOrScrollTimeline()?.startOffset ?? 0);\n    }\n\n    return this.#payload.startTime;\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  iterationDuration(): number {\n    const viewOrScrollTimeline = this.viewOrScrollTimeline();\n    if (viewOrScrollTimeline) {\n      return this.percentageToPixels(this.source().duration(), viewOrScrollTimeline);\n    }\n\n    return this.source().duration();\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  endTime(): number {\n    if (!this.source().iterations) {\n      return Infinity;\n    }\n\n    if (this.viewOrScrollTimeline()) {\n      return this.startTime() + this.iterationDuration() * this.source().iterations();\n    }\n\n    return this.startTime() + this.source().delay() + this.source().duration() * this.source().iterations() +\n        this.source().endDelay();\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  finiteDuration(): number {\n    const iterations = Math.min(this.source().iterations(), 3);\n    if (this.viewOrScrollTimeline()) {\n      return this.iterationDuration() * iterations;\n    }\n\n    return this.source().delay() + this.source().duration() * iterations;\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  currentTime(): number {\n    const viewOrScrollTimeline = this.viewOrScrollTimeline();\n    if (viewOrScrollTimeline) {\n      return this.percentageToPixels(this.#payload.currentTime, viewOrScrollTimeline);\n    }\n\n    return this.#payload.currentTime;\n  }\n\n  source(): AnimationEffect {\n    return this.#source;\n  }\n\n  type(): Protocol.Animation.AnimationType {\n    return this.#payload.type;\n  }\n\n  overlaps(animation: AnimationImpl): boolean {\n    // Infinite animations\n    if (!this.source().iterations() || !animation.source().iterations()) {\n      return true;\n    }\n\n    const firstAnimation = this.startTime() < animation.startTime() ? this : animation;\n    const secondAnimation = firstAnimation === this ? animation : this;\n    return firstAnimation.endTime() >= secondAnimation.startTime();\n  }\n\n  // Utility method for returning `delay` for time based animations\n  // and `startTime` in pixels for scroll driven animations. It is used to\n  // find the exact starting time of the first keyframe for both cases.\n  delayOrStartTime(): number {\n    if (this.viewOrScrollTimeline()) {\n      return this.startTime();\n    }\n\n    return this.source().delay();\n  }\n\n  setTiming(duration: number, delay: number): void {\n    void this.#source.node().then(node => {\n      if (!node) {\n        throw new Error('Unable to find node');\n      }\n      this.updateNodeStyle(duration, delay, node);\n    });\n    this.#source.durationInternal = duration;\n    this.#source.delayInternal = delay;\n    void this.#animationModel.agent.invoke_setTiming({animationId: this.id(), duration, delay});\n  }\n\n  private updateNodeStyle(duration: number, delay: number, node: DOMNode): void {\n    let animationPrefix;\n    if (this.type() === Protocol.Animation.AnimationType.CSSTransition) {\n      animationPrefix = 'transition-';\n    } else if (this.type() === Protocol.Animation.AnimationType.CSSAnimation) {\n      animationPrefix = 'animation-';\n    } else {\n      return;\n    }\n\n    if (!node.id) {\n      throw new Error('Node has no id');\n    }\n\n    const cssModel = node.domModel().cssModel();\n    cssModel.setEffectivePropertyValueForNode(node.id, animationPrefix + 'duration', duration + 'ms');\n    cssModel.setEffectivePropertyValueForNode(node.id, animationPrefix + 'delay', delay + 'ms');\n  }\n\n  async remoteObjectPromise(): Promise<RemoteObject|null> {\n    const payload = await this.#animationModel.agent.invoke_resolveAnimation({animationId: this.id()});\n    if (!payload) {\n      return null;\n    }\n\n    return this.#animationModel.runtimeModel.createRemoteObject(payload.remoteObject);\n  }\n\n  cssId(): string {\n    return this.#payload.cssId || '';\n  }\n}\n\nexport class AnimationEffect {\n  #animationModel: AnimationModel;\n  #payload!: Protocol.Animation\n      .AnimationEffect;       // Assertion is safe because `setPayload` call in `constructor` sets the value.\n  delayInternal!: number;     // Assertion is safe because `setPayload` call in `constructor` sets the value.\n  durationInternal!: number;  // Assertion is safe because `setPayload` call in `constructor` sets the value.\n  #keyframesRule: KeyframesRule|undefined;\n  #deferredNode?: DeferredDOMNode;\n  constructor(animationModel: AnimationModel, payload: Protocol.Animation.AnimationEffect) {\n    this.#animationModel = animationModel;\n    this.setPayload(payload);\n  }\n\n  setPayload(payload: Protocol.Animation.AnimationEffect): void {\n    this.#payload = payload;\n    if (!this.#keyframesRule && payload.keyframesRule) {\n      this.#keyframesRule = new KeyframesRule(payload.keyframesRule);\n    } else if (this.#keyframesRule && payload.keyframesRule) {\n      this.#keyframesRule.setPayload(payload.keyframesRule);\n    }\n\n    this.delayInternal = payload.delay;\n    this.durationInternal = payload.duration;\n  }\n\n  delay(): number {\n    return this.delayInternal;\n  }\n\n  endDelay(): number {\n    return this.#payload.endDelay;\n  }\n\n  iterations(): number {\n    // Animations with zero duration, zero delays and infinite iterations can't be shown.\n    if (!this.delay() && !this.endDelay() && !this.duration()) {\n      return 0;\n    }\n    return this.#payload.iterations || Infinity;\n  }\n\n  duration(): number {\n    return this.durationInternal;\n  }\n\n  direction(): string {\n    return this.#payload.direction;\n  }\n\n  fill(): string {\n    return this.#payload.fill;\n  }\n\n  node(): Promise<DOMNode|null> {\n    if (!this.#deferredNode) {\n      this.#deferredNode = new DeferredDOMNode(this.#animationModel.target(), this.backendNodeId());\n    }\n    return this.#deferredNode.resolvePromise();\n  }\n\n  deferredNode(): DeferredDOMNode {\n    return new DeferredDOMNode(this.#animationModel.target(), this.backendNodeId());\n  }\n\n  backendNodeId(): Protocol.DOM.BackendNodeId {\n    return this.#payload.backendNodeId as Protocol.DOM.BackendNodeId;\n  }\n\n  keyframesRule(): KeyframesRule|null {\n    return this.#keyframesRule || null;\n  }\n\n  easing(): string {\n    return this.#payload.easing;\n  }\n}\n\nexport class KeyframesRule {\n  #payload!: Protocol.Animation\n      .KeyframesRule;            // Assertion is safe because `setPayload` call in `constructor` sets the value.;\n  #keyframes!: KeyframeStyle[];  // Assertion is safe because `setPayload` call in `constructor` sets the value.;\n  constructor(payload: Protocol.Animation.KeyframesRule) {\n    this.setPayload(payload);\n  }\n\n  setPayload(payload: Protocol.Animation.KeyframesRule): void {\n    this.#payload = payload;\n    if (!this.#keyframes) {\n      this.#keyframes = this.#payload.keyframes.map(keyframeStyle => new KeyframeStyle(keyframeStyle));\n    } else {\n      this.#payload.keyframes.forEach((keyframeStyle, index) => {\n        this.#keyframes[index]?.setPayload(keyframeStyle);\n      });\n    }\n  }\n\n  name(): string|undefined {\n    return this.#payload.name;\n  }\n\n  keyframes(): KeyframeStyle[] {\n    return this.#keyframes;\n  }\n}\n\nexport class KeyframeStyle {\n  #payload!:\n      Protocol.Animation.KeyframeStyle;  // Assertion is safe because `setPayload` call in `constructor` sets the value.\n  #offset!: string;                      // Assertion is safe because `setPayload` call in `constructor` sets the value.\n  constructor(payload: Protocol.Animation.KeyframeStyle) {\n    this.setPayload(payload);\n  }\n\n  setPayload(payload: Protocol.Animation.KeyframeStyle): void {\n    this.#payload = payload;\n    this.#offset = payload.offset;\n  }\n\n  offset(): string {\n    return this.#offset;\n  }\n\n  setOffset(offset: number): void {\n    this.#offset = offset * 100 + '%';\n  }\n\n  offsetAsNumber(): number {\n    return parseFloat(this.#offset) / 100;\n  }\n\n  easing(): string {\n    return this.#payload.easing;\n  }\n}\n\nexport class AnimationGroup {\n  readonly #animationModel: AnimationModel;\n  readonly #id: string;\n  #scrollNode: AnimationDOMNode|undefined;\n  #animations: AnimationImpl[];\n  #paused = false;\n  constructor(animationModel: AnimationModel, id: string, animations: AnimationImpl[]) {\n    this.#animationModel = animationModel;\n    this.#id = id;\n    this.#animations = animations;\n  }\n\n  isScrollDriven(): boolean {\n    return Boolean(this.#animations[0]?.viewOrScrollTimeline());\n  }\n\n  id(): string {\n    return this.#id;\n  }\n\n  animations(): AnimationImpl[] {\n    return this.#animations;\n  }\n\n  release(): void {\n    this.#animationModel.animationGroups.delete(this.id());\n    this.#animationModel.releaseAnimations(this.animationIds());\n  }\n\n  private animationIds(): string[] {\n    function extractId(animation: AnimationImpl): string {\n      return animation.id();\n    }\n\n    return this.#animations.map(extractId);\n  }\n\n  startTime(): number {\n    return this.#animations[0].startTime();\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  groupDuration(): number {\n    let duration = 0;\n    for (const anim of this.#animations) {\n      duration = Math.max(duration, anim.delayOrStartTime() + anim.iterationDuration());\n    }\n    return duration;\n  }\n\n  // For scroll driven animations, it returns the duration in pixels (i.e. after how many pixels of scroll the animation is going to end)\n  // For time animations, it returns milliseconds.\n  finiteDuration(): number {\n    let maxDuration = 0;\n    for (let i = 0; i < this.#animations.length; ++i) {\n      maxDuration = Math.max(maxDuration, this.#animations[i].finiteDuration());\n    }\n    return maxDuration;\n  }\n\n  scrollOrientation(): Protocol.DOM.ScrollOrientation|null {\n    const timeline = this.#animations[0]?.viewOrScrollTimeline();\n    if (!timeline) {\n      return null;\n    }\n\n    return timeline.axis;\n  }\n\n  async scrollNode(): Promise<AnimationDOMNode|null> {\n    if (this.#scrollNode) {\n      return this.#scrollNode;\n    }\n\n    if (!this.isScrollDriven()) {\n      return null;\n    }\n\n    const sourceNodeId = this.#animations[0]?.viewOrScrollTimeline()?.sourceNodeId;\n    if (!sourceNodeId) {\n      return null;\n    }\n\n    const deferredScrollNode = new DeferredDOMNode(this.#animationModel.target(), sourceNodeId);\n    const scrollNode = await deferredScrollNode.resolvePromise();\n    if (!scrollNode) {\n      return null;\n    }\n\n    this.#scrollNode = new AnimationDOMNode(scrollNode);\n    return this.#scrollNode;\n  }\n\n  seekTo(currentTime: number): void {\n    void this.#animationModel.agent.invoke_seekAnimations({animations: this.animationIds(), currentTime});\n  }\n\n  paused(): boolean {\n    return this.#paused;\n  }\n\n  togglePause(paused: boolean): void {\n    if (paused === this.#paused) {\n      return;\n    }\n    this.#paused = paused;\n    void this.#animationModel.agent.invoke_setPaused({animations: this.animationIds(), paused});\n  }\n\n  currentTimePromise(): Promise<number> {\n    let longestAnim: AnimationImpl|null = null;\n    for (const anim of this.#animations) {\n      if (!longestAnim || anim.endTime() > longestAnim.endTime()) {\n        longestAnim = anim;\n      }\n    }\n    if (!longestAnim) {\n      throw new Error('No longest animation found');\n    }\n\n    return this.#animationModel.agent.invoke_getCurrentTime({id: longestAnim.id()})\n        .then(({currentTime}) => currentTime || 0);\n  }\n\n  matches(group: AnimationGroup): boolean {\n    function extractId(anim: AnimationImpl): string {\n      const timelineId = (anim.viewOrScrollTimeline()?.sourceNodeId ?? '') + (anim.viewOrScrollTimeline()?.axis ?? '');\n      const regularId =\n          anim.type() === Protocol.Animation.AnimationType.WebAnimation ? anim.type() + anim.id() : anim.cssId();\n\n      return regularId + timelineId;\n    }\n\n    if (this.#animations.length !== group.#animations.length) {\n      return false;\n    }\n    const left = this.#animations.map(extractId).sort();\n    const right = group.#animations.map(extractId).sort();\n    for (let i = 0; i < left.length; i++) {\n      if (left[i] !== right[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  shouldInclude(group: AnimationGroup): boolean {\n    // We want to include the animations coming from the incoming group\n    // inside this group if they were to be grouped if the events came at the same time.\n    const [firstIncomingAnimation] = group.#animations;\n    const [firstAnimation] = this.#animations;\n    return shouldGroupAnimations(firstAnimation, firstIncomingAnimation);\n  }\n\n  appendAnimations(animations: AnimationImpl[]): void {\n    this.#animations.push(...animations);\n  }\n\n  rebaseTo(group: AnimationGroup): void {\n    this.#animationModel.releaseAnimations(this.animationIds());\n    this.#animations = group.#animations;\n    this.#scrollNode = undefined;\n  }\n}\n\nexport class AnimationDispatcher implements ProtocolProxyApi.AnimationDispatcher {\n  readonly #animationModel: AnimationModel;\n  constructor(animationModel: AnimationModel) {\n    this.#animationModel = animationModel;\n  }\n\n  animationCreated(_event: Protocol.Animation.AnimationCreatedEvent): void {\n    // Previously this event was used to batch the animations into groups\n    // and we were waiting for animationStarted events to be sent for\n    // all the created animations and until then we weren't creating any\n    // groups. This was allowing us to not miss any animations that were\n    // going to be in the same group. However, now we're not using this event\n    // to do batching and instead:\n    // * We debounce the flush calls so that if the animationStarted events\n    // for the same animation group come in different times; we create one\n    // group for them.\n    // * Even though an animation group is created and rendered for some animations\n    // that have the same startTime (or same timeline & scroll axis for SDAs), now\n    // whenever an `animationStarted` event comes we check whether there is a group\n    // we can add the related animation. If so, we add it and emit `animationGroupUpdated`\n    // event. So that, all the animations that were supposed to be in the same group\n    // will be in the same group.\n  }\n\n  animationCanceled({id}: Protocol.Animation.AnimationCanceledEvent): void {\n    this.#animationModel.animationCanceled(id);\n  }\n\n  animationStarted({animation}: Protocol.Animation.AnimationStartedEvent): void {\n    void this.#animationModel.animationStarted(animation);\n  }\n\n  animationUpdated({animation}: Protocol.Animation.AnimationUpdatedEvent): void {\n    void this.#animationModel.animationUpdated(animation);\n  }\n}\n\nSDKModel.register(AnimationModel, {capabilities: Capability.DOM, autostart: true});\nexport interface Request {\n  endTime: number;\n}\n"]}