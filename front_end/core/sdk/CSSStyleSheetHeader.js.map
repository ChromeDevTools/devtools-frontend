{"version":3,"file":"CSSStyleSheetHeader.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/CSSStyleSheetHeader.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Common from '../common/common.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as Platform from '../platform/platform.js';\n\nimport type {CSSModel} from './CSSModel.js';\nimport {DeferredDOMNode} from './DOMModel.js';\nimport type {FrameAssociated} from './FrameAssociated.js';\nimport type {PageResourceLoadInitiator} from './PageResourceLoader.js';\nimport {ResourceTreeModel} from './ResourceTreeModel.js';\nimport type {DebugId} from './SourceMap.js';\n\nconst UIStrings = {\n  /**\n   * @description Error message for when a CSS file can't be loaded\n   */\n  couldNotFindTheOriginalStyle: 'Could not find the original style sheet.',\n  /**\n   * @description Error message to display when a source CSS file could not be retrieved.\n   */\n  thereWasAnErrorRetrievingThe: 'There was an error retrieving the source styles.',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('core/sdk/CSSStyleSheetHeader.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class CSSStyleSheetHeader implements TextUtils.ContentProvider.ContentProvider, FrameAssociated {\n  #cssModel: CSSModel;\n  id: Protocol.DOM.StyleSheetId;\n  frameId: Protocol.Page.FrameId;\n  sourceURL: Platform.DevToolsPath.UrlString;\n  hasSourceURL: boolean;\n  origin: Protocol.CSS.StyleSheetOrigin;\n  title: string;\n  disabled: boolean;\n  isInline: boolean;\n  isMutable: boolean;\n  isConstructed: boolean;\n  startLine: number;\n  startColumn: number;\n  endLine: number;\n  endColumn: number;\n  contentLength: number;\n  ownerNode: DeferredDOMNode|undefined;\n  sourceMapURL: Platform.DevToolsPath.UrlString|undefined;\n  readonly loadingFailed: boolean;\n  #originalContentProvider: TextUtils.StaticContentProvider.StaticContentProvider|null;\n\n  constructor(cssModel: CSSModel, payload: Protocol.CSS.CSSStyleSheetHeader) {\n    this.#cssModel = cssModel;\n    this.id = payload.styleSheetId;\n    this.frameId = payload.frameId;\n    this.sourceURL = payload.sourceURL as Platform.DevToolsPath.UrlString;\n    this.hasSourceURL = Boolean(payload.hasSourceURL);\n    this.origin = payload.origin;\n    this.title = payload.title;\n    this.disabled = payload.disabled;\n    this.isInline = payload.isInline;\n    this.isMutable = payload.isMutable;\n    this.isConstructed = payload.isConstructed;\n    this.startLine = payload.startLine;\n    this.startColumn = payload.startColumn;\n    this.endLine = payload.endLine;\n    this.endColumn = payload.endColumn;\n    this.contentLength = payload.length;\n    if (payload.ownerNode) {\n      this.ownerNode = new DeferredDOMNode(cssModel.target(), payload.ownerNode);\n    }\n    this.sourceMapURL = payload.sourceMapURL as Platform.DevToolsPath.UrlString;\n    this.loadingFailed = payload.loadingFailed ?? false;\n    this.#originalContentProvider = null;\n  }\n\n  originalContentProvider(): TextUtils.ContentProvider.ContentProvider {\n    if (!this.#originalContentProvider) {\n      const lazyContent = (async(): Promise<TextUtils.ContentData.ContentDataOrError> => {\n        const originalText = await this.#cssModel.originalStyleSheetText(this);\n        if (originalText === null) {\n          return {error: i18nString(UIStrings.couldNotFindTheOriginalStyle)};\n        }\n        return new TextUtils.ContentData.ContentData(originalText, /* isBase64=*/ false, 'text/css');\n      });\n      this.#originalContentProvider =\n          new TextUtils.StaticContentProvider.StaticContentProvider(this.contentURL(), this.contentType(), lazyContent);\n    }\n    return this.#originalContentProvider;\n  }\n\n  setSourceMapURL(sourceMapURL?: Platform.DevToolsPath.UrlString): void {\n    this.sourceMapURL = sourceMapURL;\n  }\n\n  cssModel(): CSSModel {\n    return this.#cssModel;\n  }\n\n  isAnonymousInlineStyleSheet(): boolean {\n    return !this.resourceURL() && !this.#cssModel.sourceMapManager().sourceMapForClient(this);\n  }\n\n  isConstructedByNew(): boolean {\n    return this.isConstructed && this.sourceURL.length === 0;\n  }\n\n  resourceURL(): Platform.DevToolsPath.UrlString {\n    return this.isViaInspector() ? this.viaInspectorResourceURL() : this.sourceURL;\n  }\n\n  private getFrameURLPath(): string {\n    const model = this.#cssModel.target().model(ResourceTreeModel);\n    console.assert(Boolean(model));\n    if (!model) {\n      return '';\n    }\n    const frame = model.frameForId(this.frameId);\n    if (!frame) {\n      return '';\n    }\n    console.assert(Boolean(frame));\n    const parsedURL = new Common.ParsedURL.ParsedURL(frame.url);\n    let urlPath = parsedURL.host;\n    if (parsedURL.port) {\n      urlPath += ':' + parsedURL.port;\n    }\n    urlPath += parsedURL.folderPathComponents;\n    if (!urlPath.endsWith('/')) {\n      urlPath += '/';\n    }\n    return urlPath;\n  }\n\n  private viaInspectorResourceURL(): Platform.DevToolsPath.UrlString {\n    return `inspector://${this.getFrameURLPath()}inspector-stylesheet#${this.id}` as Platform.DevToolsPath.UrlString;\n  }\n\n  lineNumberInSource(lineNumberInStyleSheet: number): number {\n    return this.startLine + lineNumberInStyleSheet;\n  }\n\n  columnNumberInSource(lineNumberInStyleSheet: number, columnNumberInStyleSheet: number): number|undefined {\n    return (lineNumberInStyleSheet ? 0 : this.startColumn) + columnNumberInStyleSheet;\n  }\n\n  /**\n   * Checks whether the position is in this style sheet. Assumes that the\n   * position's columnNumber is consistent with line endings.\n   */\n  containsLocation(lineNumber: number, columnNumber: number): boolean {\n    const afterStart =\n        (lineNumber === this.startLine && columnNumber >= this.startColumn) || lineNumber > this.startLine;\n    const beforeEnd = lineNumber < this.endLine || (lineNumber === this.endLine && columnNumber <= this.endColumn);\n    return afterStart && beforeEnd;\n  }\n\n  contentURL(): Platform.DevToolsPath.UrlString {\n    return this.resourceURL();\n  }\n\n  contentType(): Common.ResourceType.ResourceType {\n    return Common.ResourceType.resourceTypes.Stylesheet;\n  }\n\n  async requestContentData(): Promise<TextUtils.ContentData.ContentDataOrError> {\n    const cssText = await this.#cssModel.getStyleSheetText(this.id);\n    if (cssText === null) {\n      return {error: i18nString(UIStrings.thereWasAnErrorRetrievingThe)};\n    }\n    return new TextUtils.ContentData.ContentData(cssText, /* isBase64=*/ false, 'text/css');\n  }\n\n  async searchInContent(query: string, caseSensitive: boolean, isRegex: boolean):\n      Promise<TextUtils.ContentProvider.SearchMatch[]> {\n    const contentData = await this.requestContentData();\n    return TextUtils.TextUtils.performSearchInContentData(contentData, query, caseSensitive, isRegex);\n  }\n\n  isViaInspector(): boolean {\n    return this.origin === 'inspector';\n  }\n\n  createPageResourceLoadInitiator(): PageResourceLoadInitiator {\n    return {\n      target: this.#cssModel.target(),\n      frameId: this.frameId,\n      initiatorUrl: this.hasSourceURL ? Platform.DevToolsPath.EmptyUrlString : this.sourceURL,\n    };\n  }\n\n  debugId(): DebugId|null {\n    return null;\n  }\n}\n"]}