{"version":3,"file":"PaintProfiler.js","sourceRoot":"","sources":["../../../../../../front_end/core/sdk/PaintProfiler.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2013 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport {SDKModel} from './SDKModel.js';\nimport {Capability, type Target} from './Target.js';\n\nexport class PaintProfilerModel extends SDKModel<void> {\n  readonly layerTreeAgent: ProtocolProxyApi.LayerTreeApi;\n\n  constructor(target: Target) {\n    super(target);\n    this.layerTreeAgent = target.layerTreeAgent();\n  }\n\n  async loadSnapshotFromFragments(tiles: Protocol.LayerTree.PictureTile[]): Promise<PaintProfilerSnapshot|null> {\n    const {snapshotId} = await this.layerTreeAgent.invoke_loadSnapshot({tiles});\n    return snapshotId ? new PaintProfilerSnapshot(this, snapshotId) : null;\n  }\n\n  loadSnapshot(encodedPicture: Protocol.binary): Promise<PaintProfilerSnapshot|null> {\n    const fragment = {x: 0, y: 0, picture: encodedPicture};\n    return this.loadSnapshotFromFragments([fragment]);\n  }\n\n  async makeSnapshot(layerId: Protocol.LayerTree.LayerId): Promise<PaintProfilerSnapshot|null> {\n    const {snapshotId} = await this.layerTreeAgent.invoke_makeSnapshot({layerId});\n    return snapshotId ? new PaintProfilerSnapshot(this, snapshotId) : null;\n  }\n}\n\nexport class PaintProfilerSnapshot {\n  readonly #paintProfilerModel: PaintProfilerModel;\n  readonly #id: Protocol.LayerTree.SnapshotId;\n  #refCount: number;\n\n  constructor(paintProfilerModel: PaintProfilerModel, snapshotId: Protocol.LayerTree.SnapshotId) {\n    this.#paintProfilerModel = paintProfilerModel;\n    this.#id = snapshotId;\n    this.#refCount = 1;\n  }\n\n  release(): void {\n    console.assert(this.#refCount > 0, 'release is already called on the object');\n    if (!--this.#refCount) {\n      void this.#paintProfilerModel.layerTreeAgent.invoke_releaseSnapshot({snapshotId: this.#id});\n    }\n  }\n\n  addReference(): void {\n    ++this.#refCount;\n    console.assert(this.#refCount > 0, 'Referencing a dead object');\n  }\n\n  async replay(scale?: number, fromStep?: number, toStep?: number): Promise<string|null> {\n    const response = await this.#paintProfilerModel.layerTreeAgent.invoke_replaySnapshot(\n        {snapshotId: this.#id, fromStep, toStep, scale: scale || 1.0});\n    return response.dataURL;\n  }\n\n  async profile(clipRect: Protocol.DOM.Rect|null): Promise<Protocol.LayerTree.PaintProfile[]> {\n    const response = await this.#paintProfilerModel.layerTreeAgent.invoke_profileSnapshot(\n        {snapshotId: this.#id, minRepeatCount: 5, minDuration: 1, clipRect: clipRect || undefined});\n\n    return response.timings;\n  }\n\n  async commandLog(): Promise<PaintProfilerLogItem[]|null> {\n    const response = await this.#paintProfilerModel.layerTreeAgent.invoke_snapshotCommandLog({snapshotId: this.#id});\n\n    return response.commandLog ? response.commandLog.map((entry, index) => new PaintProfilerLogItem(entry, index)) :\n                                 null;\n  }\n}\n\nexport class PaintProfilerLogItem {\n  method: string;\n  params: RawPaintProfilerLogItemParams|null;\n  commandIndex: number;\n\n  constructor(rawEntry: RawPaintProfilerLogItem, commandIndex: number) {\n    this.method = rawEntry.method;\n    this.params = rawEntry.params;\n    this.commandIndex = commandIndex;\n  }\n}\n\nSDKModel.register(PaintProfilerModel, {capabilities: Capability.DOM, autostart: false});\n\nexport type RawPaintProfilerLogItemParamValue = string|{[key: string]: RawPaintProfilerLogItemParamValue};\nexport type RawPaintProfilerLogItemParams = Record<string, RawPaintProfilerLogItemParamValue>;\n\nexport interface SnapshotWithRect {\n  rect: Protocol.DOM.Rect;\n  snapshot: PaintProfilerSnapshot;\n}\n\nexport interface PictureFragment {\n  x: number;\n  y: number;\n  picture: string;\n}\n\nexport interface RawPaintProfilerLogItem {\n  method: string;\n  params: RawPaintProfilerLogItemParams|null;\n}\n"]}