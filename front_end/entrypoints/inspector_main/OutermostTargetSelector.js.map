{"version":3,"file":"OutermostTargetSelector.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/inspector_main/OutermostTargetSelector.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport type * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport outermostTargetSelectorStyles from './outermostTargetSelector.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Title of toolbar item in outermost target selector in the main toolbar\n   */\n  targetNotSelected: 'Page: Not selected',\n  /**\n   * @description Title of toolbar item in outermost target selector in the main toolbar\n   * @example {top} PH1\n   */\n  targetS: 'Page: {PH1}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('entrypoints/inspector_main/OutermostTargetSelector.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet outermostTargetSelectorInstance: OutermostTargetSelector;\n\nexport class OutermostTargetSelector implements SDK.TargetManager.Observer, UI.SoftDropDown.Delegate<SDK.Target.Target>,\n                                                UI.Toolbar.Provider {\n  readonly listItems = new UI.ListModel.ListModel<SDK.Target.Target>();\n  readonly #dropDown: UI.SoftDropDown.SoftDropDown<SDK.Target.Target>;\n  readonly #toolbarItem: UI.Toolbar.ToolbarItem;\n\n  constructor() {\n    this.#dropDown = new UI.SoftDropDown.SoftDropDown(this.listItems, this);\n    this.#dropDown.setRowHeight(36);\n    this.#toolbarItem = new UI.Toolbar.ToolbarItem(this.#dropDown.element);\n    this.#toolbarItem.setTitle(i18nString(UIStrings.targetNotSelected));\n    this.listItems.addEventListener(\n        UI.ListModel.Events.ITEMS_REPLACED, () => this.#toolbarItem.setEnabled(Boolean(this.listItems.length)));\n\n    this.#toolbarItem.element.classList.add('toolbar-has-dropdown');\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    targetManager.addModelListener(\n        SDK.ChildTargetManager.ChildTargetManager, SDK.ChildTargetManager.Events.TARGET_INFO_CHANGED,\n        this.#onTargetInfoChanged, this);\n    targetManager.addEventListener(SDK.TargetManager.Events.NAME_CHANGED, this.#onInspectedURLChanged, this);\n    targetManager.observeTargets(this);\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.Target.Target, this.#targetChanged, this);\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  } = {forceNew: null}): OutermostTargetSelector {\n    const {forceNew} = opts;\n    if (!outermostTargetSelectorInstance || forceNew) {\n      outermostTargetSelectorInstance = new OutermostTargetSelector();\n    }\n\n    return outermostTargetSelectorInstance;\n  }\n\n  item(): UI.Toolbar.ToolbarItem {\n    return this.#toolbarItem;\n  }\n\n  highlightedItemChanged(\n      _from: SDK.Target.Target|null, _to: SDK.Target.Target|null, fromElement: Element|null,\n      toElement: Element|null): void {\n    if (fromElement) {\n      fromElement.classList.remove('highlighted');\n    }\n    if (toElement) {\n      toElement.classList.add('highlighted');\n    }\n  }\n\n  titleFor(target: SDK.Target.Target): string {\n    return target.name();\n  }\n\n  targetAdded(target: SDK.Target.Target): void {\n    if (target.outermostTarget() !== target) {\n      return;\n    }\n    this.listItems.insertWithComparator(target, this.#targetComparator());\n    this.#toolbarItem.setVisible(this.listItems.length > 1);\n\n    const primaryTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (target === primaryTarget || target === UI.Context.Context.instance().flavor(SDK.Target.Target)) {\n      this.#dropDown.selectItem(target);\n    }\n  }\n\n  targetRemoved(target: SDK.Target.Target): void {\n    const index = this.listItems.indexOf(target);\n    if (index === -1) {\n      return;\n    }\n    this.listItems.remove(index);\n    this.#toolbarItem.setVisible(this.listItems.length > 1);\n  }\n\n  #targetComparator() {\n    return (a: SDK.Target.Target, b: SDK.Target.Target) => {\n      const aTargetInfo = a.targetInfo();\n      const bTargetInfo = b.targetInfo();\n      if (!aTargetInfo || !bTargetInfo) {\n        return 0;\n      }\n\n      if (!aTargetInfo.subtype?.length && bTargetInfo.subtype?.length) {\n        return -1;\n      }\n      if (aTargetInfo.subtype?.length && !bTargetInfo.subtype?.length) {\n        return 1;\n      }\n      return aTargetInfo.url.localeCompare(bTargetInfo.url);\n    };\n  }\n\n  #onTargetInfoChanged(event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetInfo>): void {\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    const target = targetManager.targetById(event.data.targetId);\n    if (!target || target.outermostTarget() !== target) {\n      return;\n    }\n    this.targetRemoved(target);\n    this.targetAdded(target);\n  }\n\n  #onInspectedURLChanged(event: Common.EventTarget.EventTargetEvent<SDK.Target.Target>): void {\n    const target = event.data;\n    if (!target || target.outermostTarget() !== target) {\n      return;\n    }\n    this.targetRemoved(target);\n    this.targetAdded(target);\n  }\n\n  #targetChanged({\n    data: target,\n  }: Common.EventTarget.EventTargetEvent<SDK.Target.Target|null>): void {\n    this.#dropDown.selectItem(target?.outermostTarget() || null);\n  }\n\n  createElementForItem(item: SDK.Target.Target): Element {\n    const element = document.createElement('div');\n    element.classList.add('target');\n    const shadowRoot = UI.UIUtils.createShadowRootWithCoreStyles(element, {cssFile: outermostTargetSelectorStyles});\n    const title = shadowRoot.createChild('div', 'title');\n    UI.UIUtils.createTextChild(title, Platform.StringUtilities.trimEndWithMaxLength(this.titleFor(item), 100));\n    const subTitle = shadowRoot.createChild('div', 'subtitle');\n    UI.UIUtils.createTextChild(subTitle, this.#subtitleFor(item));\n    return element;\n  }\n\n  #subtitleFor(target: SDK.Target.Target): string {\n    const targetInfo = target.targetInfo();\n    if (target === SDK.TargetManager.TargetManager.instance().primaryPageTarget() && targetInfo) {\n      return Bindings.ResourceUtils.displayNameForURL(targetInfo.url as Platform.DevToolsPath.UrlString);\n    }\n    return target.targetInfo()?.subtype || '';\n  }\n\n  isItemSelectable(_item: SDK.Target.Target): boolean {\n    return true;\n  }\n\n  itemSelected(item: SDK.Target.Target|null): void {\n    const title =\n        item ? i18nString(UIStrings.targetS, {PH1: this.titleFor(item)}) : i18nString(UIStrings.targetNotSelected);\n    this.#toolbarItem.setTitle(title);\n    if (item && item !== UI.Context.Context.instance().flavor(SDK.Target.Target)?.outermostTarget()) {\n      UI.Context.Context.instance().setFlavor(SDK.Target.Target, item);\n    }\n  }\n}\n"]}