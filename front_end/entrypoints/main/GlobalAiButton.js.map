{"version":3,"file":"GlobalAiButton.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/main/GlobalAiButton.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Root from '../../core/root/root.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport globalAiButtonStyles from './globalAiButton.css.js';\n\nconst {render, html, Directives: {classMap}} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Button's string in promotion state.\n   */\n  aiAssistance: 'AI assistance',\n  /**\n   * @description Button's tooltip text.\n   */\n  openAiAssistance: 'Open AI assistance panel',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('entrypoints/main/GlobalAiButton.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst DELAY_BEFORE_PROMOTION_COLLAPSE_IN_MS = 5000;\nconst PROMOTION_END_DATE = new Date('2026-09-30');\n\nfunction getClickCountSetting(): Common.Settings.Setting<number> {\n  return Common.Settings.Settings.instance().createSetting<number>(\n      'global-ai-button-click-count', 0, Common.Settings.SettingStorageType.SYNCED);\n}\n\nfunction incrementClickCountSetting(): void {\n  const setting = getClickCountSetting();\n  setting.set(setting.get() + 1);\n}\n\nexport enum GlobalAiButtonState {\n  PROMOTION = 'promotion',\n  DEFAULT = 'default',\n}\n\ninterface ViewInput {\n  state: GlobalAiButtonState;\n  onClick: () => void;\n}\n\nexport const DEFAULT_VIEW = (input: ViewInput, output: undefined, target: HTMLElement): void => {\n  const inPromotionState = input.state === GlobalAiButtonState.PROMOTION;\n  const classes = classMap({\n    'global-ai-button': true,\n    expanded: inPromotionState,\n  });\n  // clang-format off\n  render(html`\n    <style>${globalAiButtonStyles}</style>\n    <div class=\"global-ai-button-container\">\n      <button class=${classes} @click=${input.onClick} title=${i18nString(UIStrings.openAiAssistance)} jslog=${VisualLogging.action().track({click: true}).context('global-ai-button')}>\n        <devtools-icon name=\"smart-assistant\"></devtools-icon>\n        <span class=\"button-text\">${` ${i18nString(UIStrings.aiAssistance)}`}</span>\n      </button>\n    </div>\n  `, target);\n  // clang-format on\n};\n\nexport type View = typeof DEFAULT_VIEW;\nexport class GlobalAiButton extends UI.Widget.Widget {\n  #view: View;\n  #buttonState: GlobalAiButtonState = GlobalAiButtonState.DEFAULT;\n  #mouseOnMainToolbar = false;\n  #returnToDefaultStateTimeout?: number;\n\n  constructor(element?: HTMLElement, view?: View) {\n    super(element);\n    this.#view = view ?? DEFAULT_VIEW;\n    this.requestUpdate();\n\n    if (this.#shouldTriggerPromotion()) {\n      this.#triggerPromotion();\n    }\n  }\n\n  override willHide(): void {\n    super.willHide();\n    this.#removeHoverEventListeners();\n\n    if (this.#returnToDefaultStateTimeout) {\n      window.clearTimeout(this.#returnToDefaultStateTimeout);\n    }\n  }\n\n  #handleMainToolbarMouseEnter = (): void => {\n    this.#mouseOnMainToolbar = true;\n  };\n\n  #handleMainToolbarMouseLeave = (): void => {\n    this.#mouseOnMainToolbar = false;\n  };\n\n  #addHoverEventListeners(): void {\n    UI.InspectorView.InspectorView.instance().tabbedPane.headerElement().addEventListener(\n        'mouseenter', this.#handleMainToolbarMouseEnter);\n    UI.InspectorView.InspectorView.instance().tabbedPane.headerElement().addEventListener(\n        'mouseleave', this.#handleMainToolbarMouseLeave);\n  }\n\n  #removeHoverEventListeners(): void {\n    UI.InspectorView.InspectorView.instance().tabbedPane.headerElement().removeEventListener(\n        'mouseenter', this.#handleMainToolbarMouseEnter);\n    UI.InspectorView.InspectorView.instance().tabbedPane.headerElement().removeEventListener(\n        'mouseleave', this.#handleMainToolbarMouseLeave);\n  }\n\n  // We only want to enable promotion when:\n  // * The flag is enabled,\n  // * The current date is before the promotion end date,\n  // * The click count on this button is less than 2.\n  #shouldTriggerPromotion(): boolean {\n    const isFlagEnabled = Boolean(Root.Runtime.hostConfig.devToolsGlobalAiButton?.promotionEnabled);\n    const isBeforeEndDate = (new Date()) < PROMOTION_END_DATE;\n    return isFlagEnabled && isBeforeEndDate && getClickCountSetting().get() < 2;\n  }\n\n  #triggerPromotion(): void {\n    // Set up hover listeners for making sure that we don't return to default state from promotion state\n    // when the user's cursor is on the main toolbar.\n    this.#buttonState = GlobalAiButtonState.PROMOTION;\n    this.requestUpdate();\n    this.#addHoverEventListeners();\n    this.#scheduleReturnToDefaultState();\n  }\n\n  #scheduleReturnToDefaultState(): void {\n    if (this.#returnToDefaultStateTimeout) {\n      window.clearTimeout(this.#returnToDefaultStateTimeout);\n    }\n\n    this.#returnToDefaultStateTimeout = window.setTimeout(() => {\n      // If the mouse is currently on the main toolbar,\n      // we don't want to trigger the animation from promotion & to the default\n      // state to not cause a layout shift when the user is not expecting it\n      // (e.g. while they were going to click on a button on the toolbar).\n      if (this.#mouseOnMainToolbar) {\n        this.#scheduleReturnToDefaultState();\n        return;\n      }\n\n      this.#buttonState = GlobalAiButtonState.DEFAULT;\n      this.requestUpdate();\n      // Remove hover listeners once the button is in its default state.\n      this.#removeHoverEventListeners();\n    }, DELAY_BEFORE_PROMOTION_COLLAPSE_IN_MS);\n  }\n\n  #onClick(): void {\n    UI.ViewManager.ViewManager.instance().showViewInLocation('freestyler', 'drawer-view');\n    incrementClickCountSetting();\n\n    const hasExplicitUserPreference =\n        UI.InspectorView.InspectorView.instance().isUserExplicitlyUpdatedDrawerOrientation();\n    const isVerticalDrawerFeatureEnabled =\n        Boolean(Root.Runtime.hostConfig.devToolsFlexibleLayout?.verticalDrawerEnabled);\n    if (isVerticalDrawerFeatureEnabled && !hasExplicitUserPreference) {\n      // This mimics what we're doing while showing the drawer via `ESC`.\n      // There is a bug where opening the sidebar directly for the first time,\n      // and triggering a drawer rotation without calling `showDrawer({focus: true})` makes the drawer disappear.\n      UI.InspectorView.InspectorView.instance().showDrawer({\n        focus: true,\n        hasTargetDrawer: false,\n      });\n      UI.InspectorView.InspectorView.instance().toggleDrawerOrientation(\n          {force: UI.InspectorView.DrawerOrientation.VERTICAL});\n    }\n  }\n\n  override performUpdate(): Promise<void>|void {\n    this.#view(\n        {\n          state: this.#buttonState,\n          onClick: this.#onClick.bind(this),\n        },\n        undefined, this.contentElement);\n  }\n}\n\nlet globalAiButtonToolbarProviderInstance: GlobalAiButtonToolbarProvider;\nexport class GlobalAiButtonToolbarProvider implements UI.Toolbar.Provider {\n  #toolbarItem: UI.Toolbar.ToolbarItemWithCompactLayout;\n  #widgetElement: UI.Widget.WidgetElement<GlobalAiButton>;\n\n  private constructor() {\n    this.#widgetElement = document.createElement('devtools-widget') as UI.Widget.WidgetElement<GlobalAiButton>;\n    this.#widgetElement.widgetConfig = UI.Widget.widgetConfig(GlobalAiButton);\n\n    this.#toolbarItem = new UI.Toolbar.ToolbarItemWithCompactLayout(this.#widgetElement);\n    this.#toolbarItem.setVisible(false);\n  }\n\n  item(): UI.Toolbar.ToolbarItem|null {\n    return this.#toolbarItem;\n  }\n\n  static instance(opts: {forceNew: boolean|null} = {forceNew: null}): GlobalAiButtonToolbarProvider {\n    const {forceNew} = opts;\n    if (!globalAiButtonToolbarProviderInstance || forceNew) {\n      globalAiButtonToolbarProviderInstance = new GlobalAiButtonToolbarProvider();\n    }\n\n    return globalAiButtonToolbarProviderInstance;\n  }\n}\n"]}