{"version":3,"file":"PerformanceAgent.js","sourceRoot":"","sources":["../../../../../../../front_end/models/ai_assistance/agents/PerformanceAgent.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as Root from '../../../core/root/root.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as Tracing from '../../../services/tracing/tracing.js';\nimport * as Annotations from '../../annotations/annotations.js';\nimport * as Logs from '../../logs/logs.js';\nimport * as SourceMapScopes from '../../source_map_scopes/source_map_scopes.js';\nimport * as Trace from '../../trace/trace.js';\nimport {ArtifactsManager} from '../ArtifactsManager.js';\nimport {\n  PerformanceInsightFormatter,\n} from '../data_formatters/PerformanceInsightFormatter.js';\nimport {PerformanceTraceFormatter} from '../data_formatters/PerformanceTraceFormatter.js';\nimport {debugLog} from '../debug.js';\nimport {AICallTree} from '../performance/AICallTree.js';\nimport {AgentFocus} from '../performance/AIContext.js';\n\nimport {\n  AiAgent,\n  type ContextResponse,\n  ConversationContext,\n  type ConversationSuggestions,\n  type FunctionCallHandlerResult,\n  type ParsedResponse,\n  type RequestOptions,\n  type ResponseData,\n  ResponseType,\n} from './AiAgent.js';\n\nconst UIStringsNotTranslated = {\n  /**\n   *@description Shown when the agent is investigating a trace\n   */\n  analyzingTrace: 'Analyzing trace',\n  /**\n   * @description Shown when the agent is investigating network activity\n   */\n  networkActivitySummary: 'Investigating network activity…',\n  /**\n   * @description Shown when the agent is investigating main thread activity\n   */\n  mainThreadActivity: 'Investigating main thread activity…',\n} as const;\nconst lockedString = i18n.i18n.lockedString;\n\n/**\n * WARNING: preamble defined in code is only used when userTier is\n * TESTERS. Otherwise, a server-side preamble is used (see\n * chrome_preambles.gcl). Sync local changes with the server-side.\n */\n\nconst greenDevAdditionalAnnotationsFunction = `\n- CRITICAL: You also have access to functions called addElementAnnotation and addNeworkRequestAnnotation,\nwhich should be used to highlight elements and network requests (respectively).`;\n\nconst greenDevAdditionalAnnotationsGuidelines = `\n- CRITICAL: Each time an element or a network request is mentioned, you MUST ALSO call the functions\n  addElementAnnotation (for an element) or addNeworkRequestAnnotation (for a network request).\n- CRITICAL: Don't add more than one annotation per element or network request.\n- These functions should be called as soon as you identify the entity that needs to be highlighted.\n- In addition to this, the addElementAnnotation function should always be called for the LCP element, if known.\n- The annotationMessage should be descriptive and relevant to why the element or network request is being highlighted.\n`;\n\nconst getGreenDevAdditionalWidgetGuidelines = (): string => {\n  // GreenDev is experimenting with multiple ways to display widget:\n  // if widgetsFromFunctionCalls is true, then we use function calls to add widgets\n  // otherwise we use ai-insight tags\n  const widgetsFromFunctionCalls = true;\n\n  if (widgetsFromFunctionCalls) {\n    return `\n- CRITICAL: You have access to three functions for adding rich, interactive widgets to your response:\n  \\`addInsightWidget\\`, \\`addNetworkRequestWidget\\`, and \\`addFlameChartWidget\\`.\n  You MUST use these functions whenever you refer to a corresponding entity.\n\n- **\\`addInsightWidget({insightType: '...'})\\`**:\n  - **When to use**: Call this function every time you mention a specific performance insight (e.g., LCP, INP,\n    CLS culprits).\n  - **Purpose**: It embeds an interactive widget that provides a detailed breakdown and visualization of the\n    insight.\n  - **Example**: If you are explaining the causes of a poor LCP score, you MUST also call\n    \\`addInsightWidget({insightType: 'LCPBreakdown'})\\`. This provides the user with the data to explore\n    alongside your explanation.\n- **\\`addNetworkRequestWidget({eventKey: '...'})\\`**:\n  - **When to use**: Call this function whenever you discuss a specific network request.\n  - **Purpose**: It adds a widget displaying the full details of the network request, such as its timing,\n    headers, and priority.\n  - **Critical**: The eventKey should be the trace event key (only the number, no letters prefix or -) of that\n    script's network request.\n  - **Example**: If you identify a render-blocking script, you MUST also call\n    \\`addNetworkRequestWidget({eventKey: '...'})\\` with the trace event key (only the number, no letters prefix\n    or -) of that script's network request.\n- **\\`addFlameChartWidget({start: ..., end: ...})\\`**:\n  - **When to use**: Call this function to highlight a specific time range within the trace, especially when\n    discussing long tasks, specific events, or periods of high activity.\n    - **Purpose**: It embeds a focused flame chart visualization for the given time range (in microseconds).\n    - **Example**: If you find a long task that is blocking the main thread, you MUST also call\n      \\`addFlameChartWidget({start: 123456, end: 789012})\\`. This provides the user with the data to explore\n      alongside your explanation.\n- **General Rules**:\n  - You MUST call these functions as soon as you identify the entity you are discussing.\n  - Do NOT add more than one widget for the same insight, network request, or time range to avoid redundancy.\n`;\n  }\n\n  return `\n- **Visualizing Insights**: When discussing the breakdown of specific metrics or a performance problem,\nyou must render the appropriate Insight Overview component. Use these tags on a new line within your response:\n  - For LCP breakdown: <ai-insight value=\"LCPBreakdown\">\n  - For INP breakdown: <ai-insight value=\"INPBreakdown\">\n  - For CLS culprits: <ai-insight value=\"CLSCulprits\">\n  - For third parties: <ai-insight value=\"ThirdParties\">\n  - For document latency: <ai-insight value=\"DocumentLatency\">\n  - For DOM size: <ai-insight value=\"DOMSize\">\n  - For duplicate JavaScript: <ai-insight value=\"DuplicatedJavaScript\">\n  - For font display: <ai-insight value=\"FontDisplay\">\n  - For forced reflow: <ai-insight value=\"ForcedReflow\">\n  - For image delivery: <ai-insight value=\"ImageDelivery\">\n  - For LCP discovery: <ai-insight value=\"LCPDiscovery\">\n  - For legacy JavaScript: <ai-insight value=\"LegacyJavaScript\">\n  - For network dependency tree: <ai-insight value=\"NetworkDependencyTree\">\n  - For render blocking: <ai-insight value=\"RenderBlocking\">\n  - For slow CSS selector: <ai-insight value=\"SlowCSSSelector\">\n  - For viewport: <ai-insight value=\"Viewport\">\n  - For modern HTTP: <ai-insight value=\"ModernHTTP\">\n  - For cache: <ai-insight value=\"Cache\">\n- Do not place the <ai-insight> tag inside markdown code blocks (backticks). Output the tag directly as raw text.\n- **Visualizing Network Request Details**: When discussing a specific network request, represent its details in a structured widget for improved readability and focus.\n  - Use this tag on a new line within your response, replacing \\`EVENT_KEY\\` (only the number, no letters prefix or -) with the actual trace event key:\n    - For network event details: <network-request-widget value=\"EVENT_KEY\">\n- **Visualizing Flamechart**: When discussing an interesting part of the trace, represent its details in a structured widget for improved readability and focus.\n  - Use this tag on a new line within your response, replacing \"MIN_MICROSECONDS\" and \"MAX_MICROSECONDS\" with the actual start and end times in microseconds:\n    - For a flame chart of a specific time range: <flame-chart-widget start=\"MIN_MICROSECONDS\" end=\"MAX_MICROSECONDS\">\n    - CRITICAL: MIN_MICROSECONDS and MAX_MICROSECONDS must be within the flamechart bounds and in microseconds.\n  - When you mention a specific performance event like LCP, INP, or a long task, you MUST also include a flamechart widget focused on the exact time range of that event.\n    - This provides essential visual context to your explanation.\n- CRITICAL: Avoid Redundancy - When using insight or network request widgets, do not repeat details in the text response.\n  - For example, for LCP, the phases like Time to First Byte will be part of the insight widget, so you must not state them in the text. This applies to other insights and network request timings.\n- Do not display any of the same widgets more than once. For example, if you have already displayed a network request widget for a specific event, do not display it again in the same response.\n`;\n};\n\n/**\n * Preamble clocks in at ~1341 tokens.\n *   The prose is around 4.5 chars per token.\n * The data can be as bad as 1.8 chars per token\n *\n * Check token length in https://aistudio.google.com/\n */\nconst buildPreamble = (): string => {\n  const greenDevEnabled = Root.Runtime.hostConfig.devToolsGreenDevUi?.enabled;\n  const annotationsEnabled = Annotations.AnnotationRepository.annotationsEnabled();\n  return `You are an assistant, expert in web performance and highly skilled with Chrome DevTools.\n\nYour primary goal is to provide actionable advice to web developers about their web page by using the Chrome Performance Panel and analyzing a trace. You may need to diagnose problems yourself, or you may be given direction for what to focus on by the user.\n\nYou will be provided a summary of a trace: some performance metrics; the most critical network requests; a bottom-up call graph summary; and a brief overview of available insights. Each insight has information about potential performance issues with the page.\n\nDon't mention anything about an insight without first getting more data about it by calling \\`getInsightDetails\\`.\n\nYou have many functions available to learn more about the trace. Use these to confirm hypotheses, or to further explore the trace when diagnosing performance issues.\n\n${annotationsEnabled ? greenDevAdditionalAnnotationsFunction : ''}\n\nYou will be given bounds representing a time range within the trace. Bounds include a min and a max time in microseconds. max is always bigger than min in a bounds.\n\nThe 3 main performance metrics are:\n- LCP: \"Largest Contentful Paint\"\n- INP: \"Interaction to Next Paint\"\n- CLS: \"Cumulative Layout Shift\"\n\nTrace events referenced in the information given to you will be marked with an \\`eventKey\\`. For example: \\`LCP element: <img src=\"...\"> (eventKey: r-123, ts: 123456)\\`\nYou can use this key with \\`getEventByKey\\` to get more information about that trace event. For example: \\`getEventByKey('r-123')\\`\nYou can also use this key with \\`selectEventByKey\\` to show the user a specific event\n\n## Step-by-step instructions for debugging performance issues\n\nNote: if the user asks a specific question about the trace (such as \"What is my LCP?\", or \"How many requests were render-blocking?\", directly answer their question and skip starting a performance investigation. Otherwise, your task is to collaborate with the user to discover and resolve real performance issues.\n\n### Step 1: Determine a performance problem to investigate\n\n- With help from the user, determine what performance problem to focus on.\n- If the user is not specific about what problem to investigate, help them by doing a high-level investigation yourself. Present to the user a few options with 1-sentence summaries. Mention what performance metrics each option impacts. Call as many functions and confirm the data thoroughly: never present an option without being certain it is a real performance issue. Don't suggest solutions yet.\n- Rank the options from most impactful to least impactful, and present them to the user in that order.\n- Don't present more than 5 options.\n- Once a performance problem has been identified for investigation, move on to step 2.\n\n### Step 2: Suggest solutions\n\n- Suggest possible solutions to remedy the identified performance problem. Be as specific as possible, using data from the trace via the provided functions to back up everything you say. You should prefer specific solutions, but absent any specific solution you may suggest general solutions (such as from an insight's documentation links).\n- A good first step to discover solutions is to consider the insights, but you should also validate all potential advice by analyzing the trace until you are confident about the root cause of a performance issue.\n\n## Guidelines\n\n- Use the provided functions to get detailed performance data. Prioritize functions that provide context relevant to the performance issue being investigated.\n- Before finalizing your advice, look over it and validate using any relevant functions. If something seems off, refine the advice before giving it to the user.\n- Do not rely on assumptions or incomplete information. Use the provided functions to get more data when needed.\n- Use the track summary functions to get high-level detail about portions of the trace. For the \\`bounds\\` parameter, default to using the bounds of the trace. Never specifically ask the user for a bounds. You can use more narrow bounds (such as the bounds relevant to a specific insight) when appropriate. Narrow the bounds given functions when possible.\n- Use \\`getEventByKey\\` to get data on a specific trace event. This is great for root-cause analysis or validating any assumptions.\n- Provide clear, actionable recommendations. Avoid technical jargon unless necessary, and explain any technical terms used.\n- If you see a generic task like \"Task\", \"Evaluate script\" or \"(anonymous)\" in the main thread activity, try to look at its children to see what actual functions are executed and refer to those. When referencing the main thread activity, be as specific as you can. Ensure you identify to the user relevant functions and which script they were defined in. Avoid referencing \"Task\", \"Evaluate script\" and \"(anonymous)\" nodes if possible and instead focus on their children.\n- Structure your response using markdown headings and bullet points for improved readability.\n- Be direct and to the point. Avoid unnecessary introductory phrases or filler content. Focus on delivering actionable advice efficiently.\n\n${annotationsEnabled ? greenDevAdditionalAnnotationsGuidelines : ''}\n${greenDevEnabled ? getGreenDevAdditionalWidgetGuidelines() : ''}\n\n## Strict Constraints\n\nAdhere to the following critical requirements:\n\n- Never show bounds to the user.\n- Never show eventKey to the user.\n- Ensure your responses only use ms for time units.\n- Ensure numbers for time units are rounded to the nearest whole number.\n- Ensure comprehensive data retrieval through function calls to provide accurate and complete recommendations.\n- If the user asks a specific question about web performance that doesn't have anything to do with the trace, don't call any functions and be succinct in your answer.\n- Before suggesting changing the format of an image, consider what format it is already in. For example, if the mime type is image/webp, do not suggest to the user that the image is converted to WebP, as the image is already in that format.\n- Do not mention the functions you call to gather information about the trace (e.g., \\`getEventByKey\\`, \\`getMainThreadTrackSummary\\`) in your output. These are internal implementation details that should be hidden from the user.\n- Do not mention that you are an AI, or refer to yourself in the third person. You are simulating a performance expert.\n- If asked about sensitive topics (religion, race, politics, sexuality, gender, etc.), respond with: \"My expertise is limited to website performance analysis. I cannot provide information on that topic.\".\n- Do not provide answers on non-web-development topics, such as legal, financial, medical, or personal advice.\n`;\n};\n\nconst extraPreambleWhenNotExternal = `Additional notes:\n\nWhen referring to a trace event that has a corresponding \\`eventKey\\`, annotate your output using markdown link syntax. For example:\n- When referring to an event that is a long task: [Long task](#r-123)\n- When referring to a URL for which you know the eventKey of: [https://www.example.com](#s-1827)\n- Never show the eventKey (like \"eventKey: s-1852\"); instead, use a markdown link as described above.\n\nWhen asking the user to make a choice between multiple options, output a list of choices at the end of your text response. The format is \\`SUGGESTIONS: [\"suggestion1\", \"suggestion2\", \"suggestion3\"]\\`. This MUST start on a newline, and be a single line.\n`;\n\nconst buildExtraPreambleWhenFreshTrace = (): string => {\n  const annotationsEnabled = Annotations.AnnotationRepository.annotationsEnabled();\n  const greenDevAdditionalGuidelineFreshTrace = `\nWhen referring to an element for which you know the nodeId, always call the function addElementAnnotation, specifying\nthe id and an annotation reason.\nWhen referring to a network request for which you know the eventKey for, always call the function\naddNetworkRequestAnnotation, specifying the id and an annotation reason.\n- CRITICAL: Each time you add an annotating link you MUST ALSO call the function addElementAnnotation.\n- CRITICAL: Each time you describe an element or network request as being problematic you MUST call the function\naddElementAnnotation and specify an annotation reason.\n- CRITICAL: Each time you describe a network request as being problematic you MUST call the function\naddNetworkRequestAnnotation and specify an annotation reason.\n- CRITICAL: If you spot ANY of the following problems:\n  - Render blocking elements/network requests.\n  - Significant long task (especially on main thread).\n  - Layout shifts (e.g. due to unsized images).\n  ... then you MUST call addNetworkRequestAnnotation for ALL network requests and addaddElementAnnotation for all\n  elements described in your conclusion.\n`;\n\n  const extraPreambleWhenFreshTrace = `Additional notes:\n\nWhen referring to an element for which you know the nodeId, annotate your output using markdown link syntax:\n- For example, if nodeId is 23: [LCP element](#node-23)\n- This link will reveal the element in the Elements panel\n- Never mention node or nodeId when referring to the element, and especially not in the link text.\n- When referring to the LCP, it's useful to also mention what the LCP element is via its nodeId. Use the markdown link syntax to do so.\n\n${annotationsEnabled ? greenDevAdditionalGuidelineFreshTrace : ''}`;\n\n  return extraPreambleWhenFreshTrace;\n};\n\nenum ScorePriority {\n  REQUIRED = 3,\n  CRITICAL = 2,\n  DEFAULT = 1,\n}\n\nexport class PerformanceTraceContext extends ConversationContext<AgentFocus> {\n  static fromParsedTrace(parsedTrace: Trace.TraceModel.ParsedTrace): PerformanceTraceContext {\n    return new PerformanceTraceContext(AgentFocus.fromParsedTrace(parsedTrace));\n  }\n\n  static fromInsight(parsedTrace: Trace.TraceModel.ParsedTrace, insight: Trace.Insights.Types.InsightModel):\n      PerformanceTraceContext {\n    return new PerformanceTraceContext(AgentFocus.fromInsight(parsedTrace, insight));\n  }\n\n  static fromCallTree(callTree: AICallTree): PerformanceTraceContext {\n    return new PerformanceTraceContext(AgentFocus.fromCallTree(callTree));\n  }\n\n  #focus: AgentFocus;\n  external = false;\n\n  constructor(focus: AgentFocus) {\n    super();\n    this.#focus = focus;\n  }\n\n  override getOrigin(): string {\n    const {min, max} = this.#focus.parsedTrace.data.Meta.traceBounds;\n    return `trace-${min}-${max}`;\n  }\n\n  override getItem(): AgentFocus {\n    return this.#focus;\n  }\n\n  override getTitle(): string {\n    const focus = this.#focus;\n\n    let url = focus.primaryInsightSet?.url;\n    if (!url) {\n      url = new URL(focus.parsedTrace.data.Meta.mainFrameURL);\n    }\n\n    const parts = [`Trace: ${url.hostname}`];\n    if (focus.insight) {\n      parts.push(focus.insight.title);\n    }\n    if (focus.event) {\n      parts.push(Trace.Name.forEntry(focus.event));\n    }\n    if (focus.callTree) {\n      const node = focus.callTree.selectedNode ?? focus.callTree.rootNode;\n      parts.push(Trace.Name.forEntry(node.event));\n    }\n    return parts.join(' – ');\n  }\n\n  /**\n   * Presents the default suggestions that are shown when the user first clicks\n   * \"Ask AI\".\n   */\n  override async getSuggestions(): Promise<ConversationSuggestions|undefined> {\n    const focus = this.#focus;\n\n    if (focus.callTree) {\n      return [\n        {title: 'What\\'s the purpose of this work?', jslogContext: 'performance-default'},\n        {title: 'Where is time being spent?', jslogContext: 'performance-default'},\n        {title: 'How can I optimize this?', jslogContext: 'performance-default'},\n      ];\n    }\n\n    if (focus.insight) {\n      return new PerformanceInsightFormatter(focus, focus.insight).getSuggestions();\n    }\n\n    const suggestions: ConversationSuggestions =\n        [{title: 'What performance issues exist with my page?', jslogContext: 'performance-default'}];\n\n    const insightSet = focus.primaryInsightSet;\n    if (insightSet) {\n      const lcp = insightSet ? Trace.Insights.Common.getLCP(insightSet) : null;\n      const cls = insightSet ? Trace.Insights.Common.getCLS(insightSet) : null;\n      const inp = insightSet ? Trace.Insights.Common.getINP(insightSet) : null;\n\n      const ModelHandlers = Trace.Handlers.ModelHandlers;\n      const GOOD = Trace.Handlers.ModelHandlers.PageLoadMetrics.ScoreClassification.GOOD;\n\n      if (lcp && ModelHandlers.PageLoadMetrics.scoreClassificationForLargestContentfulPaint(lcp.value) !== GOOD) {\n        suggestions.push({title: 'How can I improve LCP?', jslogContext: 'performance-default'});\n      }\n      if (inp && ModelHandlers.UserInteractions.scoreClassificationForInteractionToNextPaint(inp.value) !== GOOD) {\n        suggestions.push({title: 'How can I improve INP?', jslogContext: 'performance-default'});\n      }\n      if (cls && ModelHandlers.LayoutShifts.scoreClassificationForLayoutShift(cls.value) !== GOOD) {\n        suggestions.push({title: 'How can I improve CLS?', jslogContext: 'performance-default'});\n      }\n\n      // Add up to 3 suggestions from the top failing insights.\n      const top3FailingInsightSuggestions =\n          Object.values(insightSet.model)\n              .filter(model => model.state !== 'pass')\n              .map(model => new PerformanceInsightFormatter(focus, model).getSuggestions().at(-1))\n              .filter(suggestion => !!suggestion)\n              .slice(0, 3);\n      suggestions.push(...top3FailingInsightSuggestions);\n    }\n\n    return suggestions;\n  }\n}\n\n// 16k Tokens * ~4 char per token.\nconst MAX_FUNCTION_RESULT_BYTE_LENGTH = 16384 * 4;\n\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class PerformanceAgent extends AiAgent<AgentFocus> {\n  #formatter: PerformanceTraceFormatter|null = null;\n  #lastEventForEnhancedQuery: Trace.Types.Events.Event|undefined;\n  #lastInsightForEnhancedQuery: Trace.Insights.Types.InsightModel|undefined;\n  #hasShownAnalyzeTraceContext = false;\n\n  /**\n   * Cache of all function calls made by the agent. This allows us to include (as a\n   * fact) every function call to conversation requests, allowing the AI to access\n   * all the results rather than just the most recent.\n   *\n   * TODO(b/442392194): I'm not certain this is needed. I do see past function call\n   * responses in \"historical_contexts\", though I think it isn't including any\n   * parameters in the \"functionCall\" entries.\n   *\n   * The record key is the result of a function's displayInfoFromArgs.\n   */\n  #functionCallCacheForFocus = new Map<AgentFocus, Record<string, Host.AidaClient.RequestFact>>();\n\n  #notExternalExtraPreambleFact: Host.AidaClient.RequestFact = {\n    text: extraPreambleWhenNotExternal,\n    metadata: {source: 'devtools', score: ScorePriority.CRITICAL}\n  };\n  #freshTraceExtraPreambleFact: Host.AidaClient.RequestFact = {\n    text: buildExtraPreambleWhenFreshTrace(),\n    metadata: {source: 'devtools', score: ScorePriority.CRITICAL}\n  };\n  #networkDataDescriptionFact: Host.AidaClient.RequestFact = {\n    text: PerformanceTraceFormatter.networkDataFormatDescription,\n    metadata: {source: 'devtools', score: ScorePriority.CRITICAL}\n  };\n  #callFrameDataDescriptionFact: Host.AidaClient.RequestFact = {\n    text: PerformanceTraceFormatter.callFrameDataFormatDescription,\n    metadata: {source: 'devtools', score: ScorePriority.CRITICAL}\n  };\n  #traceFacts: Host.AidaClient.RequestFact[] = [];\n\n  get preamble(): string {\n    return buildPreamble();\n  }\n\n  get clientFeature(): Host.AidaClient.ClientFeature {\n    return Host.AidaClient.ClientFeature.CHROME_PERFORMANCE_FULL_AGENT;\n  }\n  get userTier(): string|undefined {\n    return Boolean(Root.Runtime.hostConfig.devToolsGreenDevUi?.enabled) ?\n        'TESTERS' :\n        Root.Runtime.hostConfig.devToolsAiAssistancePerformanceAgent?.userTier;\n  }\n  get options(): RequestOptions {\n    const temperature = Root.Runtime.hostConfig.devToolsAiAssistancePerformanceAgent?.temperature;\n    const modelId = Root.Runtime.hostConfig.devToolsAiAssistancePerformanceAgent?.modelId;\n\n    return {\n      temperature,\n      modelId,\n    };\n  }\n\n  async *\n      handleContextDetails(context: ConversationContext<AgentFocus>|null): AsyncGenerator<ContextResponse, void, void> {\n    if (!context) {\n      return;\n    }\n\n    if (this.#hasShownAnalyzeTraceContext) {\n      return;\n    }\n\n    yield {\n      type: ResponseType.CONTEXT,\n      title: lockedString(UIStringsNotTranslated.analyzingTrace),\n      details: [\n        {\n          title: 'Trace',\n          text: this.#formatter?.formatTraceSummary() ?? '',\n        },\n      ],\n    };\n\n    this.#hasShownAnalyzeTraceContext = true;\n  }\n\n  #callTreeContextSet = new WeakSet();\n\n  #isFunctionResponseTooLarge(response: string): boolean {\n    return response.length > MAX_FUNCTION_RESULT_BYTE_LENGTH;\n  }\n\n  /**\n   * Sometimes the model will output URLs as plaintext; or a markdown link\n   * where the link is the actual URL. This function transforms such output\n   * to an eventKey link.\n   *\n   * A simple way to see when this gets utilized is:\n   *   1. go to paulirish.com, record a trace\n   *   2. say \"What performance issues exist with my page?\"\n   *   3. then say \"images\"\n   */\n  #parseForKnownUrls(response: string): string {\n    const focus = this.context?.getItem();\n    if (!focus) {\n      return response;\n    }\n\n    // Regex with two main parts, separated by | (OR):\n    // 1. (\\[(.*?)\\]\\((.*?)\\)): Captures a full markdown link.\n    //    - Group 1: The whole link, e.g., \"[text](url)\"\n    //    - Group 2: The link text, e.g., \"text\"\n    //    - Group 3: The link destination, e.g., \"url\"\n    // 2. (https?:\\/\\/[^\\s<>()]+): Captures a standalone URL.\n    //    - Group 4: The standalone URL, e.g., \"https://google.com\"\n    const urlRegex = /(\\[(.*?)\\]\\((.*?)\\))|(https?:\\/\\/[^\\s<>()]+)/g;\n\n    return response.replace(urlRegex, (match, markdownLink, linkText, linkDest, standaloneUrlText) => {\n      if (markdownLink) {\n        if (linkDest.startsWith('#')) {\n          return match;\n        }\n      }\n\n      const urlText = linkDest ?? standaloneUrlText;\n      if (!urlText) {\n        return match;\n      }\n\n      const request = focus.parsedTrace.data.NetworkRequests.byTime.find(request => request.args.data.url === urlText);\n      if (!request) {\n        return match;\n      }\n\n      const eventKey = focus.eventsSerializer.keyForEvent(request);\n      if (!eventKey) {\n        return match;\n      }\n\n      return `[${urlText}](#${eventKey})`;\n    });\n  }\n\n  #parseMarkdown(response: string): string {\n    /**\n     * Sometimes the LLM responds with code chunks that wrap a text based markdown response.\n     * If this happens, we want to remove those before continuing.\n     * See b/405054694 for more details.\n     */\n    const FIVE_BACKTICKS = '`````';\n    if (response.startsWith(FIVE_BACKTICKS) && response.endsWith(FIVE_BACKTICKS)) {\n      return response.slice(FIVE_BACKTICKS.length, -FIVE_BACKTICKS.length);\n    }\n\n    return response;\n  }\n\n  override parseTextResponse(response: string): ParsedResponse {\n    const parsedResponse = super.parseTextResponse(response);\n    parsedResponse.answer = this.#parseForKnownUrls(parsedResponse.answer);\n    parsedResponse.answer = this.#parseMarkdown(parsedResponse.answer);\n    return parsedResponse;\n  }\n\n  override async enhanceQuery(query: string, context: PerformanceTraceContext|null): Promise<string> {\n    if (!context) {\n      this.clearDeclaredFunctions();\n      return query;\n    }\n\n    this.clearDeclaredFunctions();\n    this.#declareFunctions(context);\n\n    const focus = context.getItem();\n    const selected: string[] = [];\n\n    if (focus.event) {\n      const includeEventInfo = focus.event !== this.#lastEventForEnhancedQuery;\n      this.#lastEventForEnhancedQuery = focus.event;\n      if (includeEventInfo) {\n        selected.push(`User selected an event ${this.#formatter?.serializeEvent(focus.event)}.\\n\\n`);\n      }\n    }\n\n    if (focus.callTree) {\n      // If this is a followup chat about the same call tree, don't include the call tree serialization again.\n      // We don't need to repeat it and we'd rather have more the context window space.\n      let contextString = '';\n      if (!this.#callTreeContextSet.has(focus.callTree)) {\n        contextString = focus.callTree.serialize();\n        this.#callTreeContextSet.add(focus.callTree);\n      }\n\n      if (contextString) {\n        selected.push(`User selected the following call tree:\\n\\n${contextString}\\n\\n`);\n      }\n    }\n\n    if (focus.insight) {\n      // We only need to add Insight info to a prompt when the context changes. For example:\n      // User clicks Insight A. We need to send info on Insight A with the prompt.\n      // User asks follow up question. We do not need to resend Insight A with the prompt.\n      // User clicks Insight B. We now need to send info on Insight B with the prompt.\n      // User clicks Insight A. We should resend the Insight info with the prompt.\n      const includeInsightInfo = focus.insight !== this.#lastInsightForEnhancedQuery;\n      this.#lastInsightForEnhancedQuery = focus.insight;\n\n      if (includeInsightInfo) {\n        selected.push(`User selected the ${focus.insight.insightKey} insight.\\n\\n`);\n      }\n    }\n\n    if (!selected.length) {\n      return query;\n    }\n\n    selected.push(`# User query\\n\\n${query}`);\n    return selected.join('');\n  }\n\n  override async * run(initialQuery: string, options: {\n    selected: PerformanceTraceContext|null,\n    signal?: AbortSignal,\n  }): AsyncGenerator<ResponseData, void, void> {\n    const focus = options.selected?.getItem();\n\n    // Clear any previous facts in case the user changed the active context.\n    this.clearFacts();\n    if (options.selected && focus) {\n      await this.#addFacts(options.selected);\n    }\n\n    yield* super.run(initialQuery, options);\n  }\n\n  #createFactForTraceSummary(): void {\n    if (!this.#formatter) {\n      return;\n    }\n\n    const text = this.#formatter.formatTraceSummary();\n    if (!text) {\n      return;\n    }\n\n    this.#traceFacts.push(\n        {text: `Trace summary:\\n${text}`, metadata: {source: 'devtools', score: ScorePriority.REQUIRED}});\n  }\n\n  async #createFactForCriticalRequests(): Promise<void> {\n    if (!this.#formatter) {\n      return;\n    }\n\n    const text = await this.#formatter.formatCriticalRequests();\n    if (!text) {\n      return;\n    }\n\n    this.#traceFacts.push({\n      text,\n      metadata: {source: 'devtools', score: ScorePriority.CRITICAL},\n    });\n  }\n\n  async #createFactForMainThreadBottomUpSummary(): Promise<void> {\n    if (!this.#formatter) {\n      return;\n    }\n\n    const formatter = this.#formatter;\n    const text = await formatter.formatMainThreadBottomUpSummary();\n    if (!text) {\n      return;\n    }\n\n    this.#traceFacts.push({\n      text,\n      metadata: {source: 'devtools', score: ScorePriority.CRITICAL},\n    });\n  }\n\n  async #createFactForThirdPartySummary(): Promise<void> {\n    if (!this.#formatter) {\n      return;\n    }\n\n    const text = await this.#formatter.formatThirdPartySummary();\n    if (!text) {\n      return;\n    }\n\n    this.#traceFacts.push({\n      text,\n      metadata: {source: 'devtools', score: ScorePriority.CRITICAL},\n    });\n  }\n\n  async #createFactForLongestTasks(): Promise<void> {\n    if (!this.#formatter) {\n      return;\n    }\n\n    const text = await this.#formatter.formatLongestTasks();\n    if (!text) {\n      return;\n    }\n\n    this.#traceFacts.push({\n      text,\n      metadata: {source: 'devtools', score: ScorePriority.CRITICAL},\n    });\n  }\n\n  async #addFacts(context: PerformanceTraceContext): Promise<void> {\n    const focus = context.getItem();\n\n    if (!context.external) {\n      this.addFact(this.#notExternalExtraPreambleFact);\n    }\n\n    const isFresh = Tracing.FreshRecording.Tracker.instance().recordingIsFresh(focus.parsedTrace);\n    if (isFresh) {\n      this.addFact(this.#freshTraceExtraPreambleFact);\n    }\n\n    this.addFact(this.#callFrameDataDescriptionFact);\n    this.addFact(this.#networkDataDescriptionFact);\n\n    if (!this.#traceFacts.length) {\n      const target = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n      if (!target) {\n        throw new Error('missing target');\n      }\n\n      this.#formatter = new PerformanceTraceFormatter(focus);\n      this.#formatter.resolveFunctionCode =\n          async (url: Platform.DevToolsPath.UrlString, line: number, column: number) => {\n        if (!target) {\n          return null;\n        }\n\n        return await SourceMapScopes.FunctionCodeResolver.getFunctionCodeFromLocation(\n            target, url, line, column, {contextLength: 200, contextLineLength: 5, appendProfileData: true});\n      };\n      this.#createFactForTraceSummary();\n      await this.#createFactForCriticalRequests();\n      await this.#createFactForMainThreadBottomUpSummary();\n      await this.#createFactForThirdPartySummary();\n      await this.#createFactForLongestTasks();\n    }\n\n    for (const fact of this.#traceFacts) {\n      this.addFact(fact);\n    }\n\n    const cachedFunctionCalls = this.#functionCallCacheForFocus.get(focus);\n    if (cachedFunctionCalls) {\n      for (const fact of Object.values(cachedFunctionCalls)) {\n        this.addFact(fact);\n      }\n    }\n  }\n\n  #cacheFunctionResult(focus: AgentFocus, key: string, result: string): void {\n    const fact: Host.AidaClient.RequestFact = {\n      text: `This is the result of calling ${key}:\\n${result}`,\n      metadata: {source: key, score: ScorePriority.DEFAULT},\n    };\n    const cache = this.#functionCallCacheForFocus.get(focus) ?? {};\n    cache[key] = fact;\n    this.#functionCallCacheForFocus.set(focus, cache);\n  }\n\n  #declareFunctions(context: PerformanceTraceContext): void {\n    const focus = context.getItem();\n    const {parsedTrace} = focus;\n\n    this.declareFunction<{insightSetId: string, insightName: string}, {details: string}>('getInsightDetails', {\n      description:\n          'Returns detailed information about a specific insight of an insight set. Use this before commenting on any specific issue to get more information.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          insightSetId: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description:\n                'The id for the specific insight set. Only use the ids given in the \"Available insight sets\" list.',\n            nullable: false,\n          },\n          insightName: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description: 'The name of the insight. Only use the insight names given in the \"Available insights\" list.',\n            nullable: false,\n          }\n        },\n      },\n      displayInfoFromArgs: params => {\n        return {\n          title: lockedString(`Investigating insight ${params.insightName}…`),\n          action: `getInsightDetails('${params.insightSetId}', '${params.insightName}')`\n        };\n      },\n      handler: async params => {\n        debugLog('Function call: getInsightDetails', params);\n        const insightSet = parsedTrace.insights?.get(params.insightSetId);\n        if (!insightSet) {\n          const valid = ([...parsedTrace.insights?.values() ?? []])\n                            .map(\n                                insightSet => `id: ${insightSet.id}, url: ${insightSet.url}, bounds: ${\n                                    this.#formatter?.serializeBounds(insightSet.bounds)}`)\n                            .join('; ');\n          return {error: `Invalid insight set id. Valid insight set ids are: ${valid}`};\n        }\n\n        const insight = insightSet.model[params.insightName as keyof Trace.Insights.Types.InsightModels];\n        if (!insight) {\n          const valid = Object.keys(insightSet.model).join(', ');\n          return {error: `No insight available. Valid insight names are: ${valid}`};\n        }\n\n        const details = new PerformanceInsightFormatter(focus, insight).formatInsight();\n\n        const key = `getInsightDetails('${params.insightSetId}', '${params.insightName}')`;\n        this.#cacheFunctionResult(focus, key, details);\n        return {result: {details}};\n      },\n    });\n\n    this.declareFunction<{eventKey: string}, {details: string}>('getEventByKey', {\n      description:\n          'Returns detailed information about a specific event. Use the detail returned to validate performance issues, but do not tell the user about irrelevant raw data from a trace event.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          eventKey: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description: 'The key for the event.',\n            nullable: false,\n          }\n        },\n      },\n      displayInfoFromArgs: params => {\n        return {title: lockedString('Looking at trace event…'), action: `getEventByKey('${params.eventKey}')`};\n      },\n      handler: async params => {\n        debugLog('Function call: getEventByKey', params);\n        const event = focus.lookupEvent(params.eventKey as Trace.Types.File.SerializableKey);\n        if (!event) {\n          return {error: 'Invalid eventKey'};\n        }\n\n        // TODO(b/425270067): Format in the same way that \"Summary\" detail tab does.\n        const details = JSON.stringify(event);\n\n        const key = `getEventByKey('${params.eventKey}')`;\n        this.#cacheFunctionResult(focus, key, details);\n        return {result: {details}};\n      },\n    });\n\n    const createBounds =\n        (min: Trace.Types.Timing.Micro, max: Trace.Types.Timing.Micro): Trace.Types.Timing.TraceWindowMicro|null => {\n          if (min > max) {\n            return null;\n          }\n\n          const clampedMin = Math.max(min ?? 0, parsedTrace.data.Meta.traceBounds.min);\n          const clampedMax = Math.min(max ?? Number.POSITIVE_INFINITY, parsedTrace.data.Meta.traceBounds.max);\n          if (clampedMin > clampedMax) {\n            return null;\n          }\n\n          return Trace.Helpers.Timing.traceWindowFromMicroSeconds(\n              clampedMin as Trace.Types.Timing.Micro, clampedMax as Trace.Types.Timing.Micro);\n        };\n\n    this.declareFunction<{min: Trace.Types.Timing.Micro, max: Trace.Types.Timing.Micro}, {\n      summary: string,\n    }>('getMainThreadTrackSummary', {\n      description:\n          'Returns a summary of the main thread for the given bounds. The result includes a top-down summary, bottom-up summary, third-parties summary, and a list of related insights for the events within the given bounds.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          min: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The minimum time of the bounds, in microseconds',\n            nullable: false,\n          },\n          max: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The maximum time of the bounds, in microseconds',\n            nullable: false,\n          },\n        },\n      },\n      displayInfoFromArgs: args => {\n        return {\n          title: lockedString(UIStringsNotTranslated.mainThreadActivity),\n          action: `getMainThreadTrackSummary({min: ${args.min}, max: ${args.max}})`\n        };\n      },\n      handler: async args => {\n        debugLog('Function call: getMainThreadTrackSummary');\n\n        if (!this.#formatter) {\n          throw new Error('missing formatter');\n        }\n\n        const bounds = createBounds(args.min, args.max);\n        if (!bounds) {\n          return {error: 'invalid bounds'};\n        }\n\n        const formatter = this.#formatter;\n        const summary = await formatter.formatMainThreadTrackSummary(bounds);\n        if (this.#isFunctionResponseTooLarge(summary)) {\n          return {\n            error:\n                'getMainThreadTrackSummary response is too large. Try investigating using other functions, or a more narrow bounds',\n          };\n        }\n\n        const byteCount = Platform.StringUtilities.countWtf8Bytes(summary);\n        Host.userMetrics.performanceAIMainThreadActivityResponseSize(byteCount);\n\n        const key = `getMainThreadTrackSummary({min: ${bounds.min}, max: ${bounds.max}})`;\n        this.#cacheFunctionResult(focus, key, summary);\n        return {result: {summary}};\n      },\n\n    });\n\n    this.declareFunction<\n        {min: Trace.Types.Timing.Micro, max: Trace.Types.Timing.Micro}, {summary: string}>('getNetworkTrackSummary', {\n      description: 'Returns a summary of the network for the given bounds.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          min: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The minimum time of the bounds, in microseconds',\n            nullable: false,\n          },\n          max: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The maximum time of the bounds, in microseconds',\n            nullable: false,\n          },\n        },\n      },\n      displayInfoFromArgs: args => {\n        return {\n          title: lockedString(UIStringsNotTranslated.networkActivitySummary),\n          action: `getNetworkTrackSummary({min: ${args.min}, max: ${args.max}})`\n        };\n      },\n      handler: async args => {\n        debugLog('Function call: getNetworkTrackSummary');\n\n        if (!this.#formatter) {\n          throw new Error('missing formatter');\n        }\n\n        const bounds = createBounds(args.min, args.max);\n        if (!bounds) {\n          return {error: 'invalid bounds'};\n        }\n\n        const summary = this.#formatter.formatNetworkTrackSummary(bounds);\n        if (this.#isFunctionResponseTooLarge(summary)) {\n          return {\n            error:\n                'getNetworkTrackSummary response is too large. Try investigating using other functions, or a more narrow bounds',\n          };\n        }\n\n        const byteCount = Platform.StringUtilities.countWtf8Bytes(summary);\n        Host.userMetrics.performanceAINetworkSummaryResponseSize(byteCount);\n\n        const key = `getNetworkTrackSummary({min: ${bounds.min}, max: ${bounds.max}})`;\n        this.#cacheFunctionResult(focus, key, summary);\n        return {result: {summary}};\n      },\n\n    });\n\n    this.declareFunction<{eventKey: string}, {callTree: string}>('getDetailedCallTree', {\n      description: 'Returns a detailed call tree for the given main thread event.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          eventKey: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description: 'The key for the event.',\n            nullable: false,\n          },\n        },\n      },\n      displayInfoFromArgs: args => {\n        return {title: lockedString('Looking at call tree…'), action: `getDetailedCallTree('${args.eventKey}')`};\n      },\n      handler: async args => {\n        debugLog('Function call: getDetailedCallTree');\n\n        if (!this.#formatter) {\n          throw new Error('missing formatter');\n        }\n\n        const event = focus.lookupEvent(args.eventKey as Trace.Types.File.SerializableKey);\n        if (!event) {\n          return {error: 'Invalid eventKey'};\n        }\n\n        const tree = AICallTree.fromEvent(event, parsedTrace);\n        if (!tree) {\n          return {error: 'No call tree found'};\n        }\n\n        const formatter = this.#formatter;\n        const callTree = await formatter.formatCallTree(tree);\n\n        const key = `getDetailedCallTree(${args.eventKey})`;\n        this.#cacheFunctionResult(focus, key, callTree);\n        return {result: {callTree}};\n      },\n\n    });\n\n    if (Annotations.AnnotationRepository.annotationsEnabled()) {\n      this.declareFunction<{\n        elementId: string,\n        annotationMessage: string,\n      }>('addElementAnnotation', {\n        description:\n            'Adds a visual annotation in the Elements panel, attached to a node with the specific UID provided. Use it to highlight nodes in the Elements panel and provide contextual suggestions to the user related to their queries.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            elementId: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The UID of the element to annotate.',\n              nullable: false,\n            },\n            annotationMessage: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The message the annotation should show to the user.',\n              nullable: false,\n            },\n          },\n        },\n        handler: async params => {\n          return await this.addElementAnnotation(params.elementId, params.annotationMessage);\n        },\n      });\n\n      this.declareFunction<{\n        eventKey: string,\n        annotationMessage: string,\n      }>('addNetworkRequestAnnotation', {\n        description:\n            'Adds a visual annotation in the Network panel, attached to the request with the specific UID provided. ' +\n            'Use it to highlight requests in the Network panel and provide contextual suggestions to the user ' +\n            'related to their queries.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            eventKey: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The event key of the network request to annotate.',\n              nullable: false,\n            },\n            annotationMessage: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The message the annotation should show to the user.',\n              nullable: false,\n            },\n          },\n        },\n        handler: async params => {\n          return await this.addNetworkRequestAnnotation(params.eventKey, params.annotationMessage);\n        },\n      });\n    }\n\n    this.declareFunction<{scriptUrl: string, line: number, column: number}, {result: string}>('getFunctionCode', {\n      description:\n          'Returns the code for a function defined at the given location. The result is annotated with the runtime performance of each line of code.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          scriptUrl: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description: 'The url of the function.',\n            nullable: false,\n          },\n          line: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The line number where the function is defined.',\n            nullable: false,\n          },\n          column: {\n            type: Host.AidaClient.ParametersTypes.INTEGER,\n            description: 'The column number where the function is defined.',\n            nullable: false,\n          },\n        },\n      },\n      displayInfoFromArgs: args => {\n        return {\n          title: lockedString('Looking up function code…'),\n          action: `getFunctionCode('${args.scriptUrl}', ${args.line}, ${args.column})`\n        };\n      },\n      handler: async args => {\n        debugLog('Function call: getFunctionCode');\n\n        if (args.line === undefined) {\n          return {error: 'Missing arg: line'};\n        }\n\n        if (args.column === undefined) {\n          return {error: 'Missing arg: column'};\n        }\n\n        if (!this.#formatter) {\n          throw new Error('missing formatter');\n        }\n\n        const target = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n        if (!target) {\n          throw new Error('missing target');\n        }\n\n        const url = args.scriptUrl as Platform.DevToolsPath.UrlString;\n        const code = await this.#formatter.resolveFunctionCodeAtLocation(url, args.line, args.column);\n        if (!code) {\n          return {error: 'Could not find code'};\n        }\n\n        const result = this.#formatter.formatFunctionCode(code);\n\n        const key = `getFunctionCode('${args.scriptUrl}', ${args.line}, ${args.column})`;\n        this.#cacheFunctionResult(focus, key, result);\n        return {result: {result}};\n      },\n    });\n\n    const isFresh = Tracing.FreshRecording.Tracker.instance().recordingIsFresh(parsedTrace);\n    const isTraceApp = Root.Runtime.Runtime.isTraceApp();\n\n    this.declareFunction<{url: string}, {content: string}>('getResourceContent', {\n      description:\n          'Returns the content of the resource with the given url. Only use this for text resource types. This function is helpful for getting script contents in order to further analyze main thread activity and suggest code improvements. When analyzing the main thread activity, always call this function to get more detail. Always call this function when asked to provide specifics about what is happening in the code. Never ask permission to call this function, just do it.',\n      parameters: {\n        type: Host.AidaClient.ParametersTypes.OBJECT,\n        description: '',\n        nullable: false,\n        properties: {\n          url: {\n            type: Host.AidaClient.ParametersTypes.STRING,\n            description: 'The url for the resource.',\n            nullable: false,\n          },\n        },\n      },\n      displayInfoFromArgs: args => {\n        return {title: lockedString('Looking at resource content…'), action: `getResourceContent('${args.url}')`};\n      },\n      handler: async args => {\n        debugLog('Function call: getResourceContent');\n\n        const url = args.url as Platform.DevToolsPath.UrlString;\n        let content: string|undefined;\n\n        // First check parsedTrace.data.Scripts.\n        // Then, check ResourceTreeModel, but only when it is valid. Don't want to\n        // use if viewing a loaded trace from DevTools attached to an unrelated\n        // page.\n        const script = parsedTrace.data.Scripts.scripts.find(script => script.url === url);\n        if (script?.content !== undefined) {\n          content = script.content;\n        } else if (isFresh || isTraceApp) {\n          const resource = SDK.ResourceTreeModel.ResourceTreeModel.resourceForURL(url);\n          if (!resource) {\n            return {error: 'Resource not found'};\n          }\n\n          const data = await resource.requestContentData();\n          if ('error' in data) {\n            return {error: `Could not get resource content: ${data.error}`};\n          }\n\n          content = data.text;\n        } else {\n          return {error: 'Resource not found'};\n        }\n\n        const key = `getResourceContent(${args.url})`;\n        this.#cacheFunctionResult(focus, key, content);\n        return {result: {content}};\n      },\n    });\n\n    if (!context.external) {\n      this.declareFunction<{eventKey: string}, {success: boolean}>('selectEventByKey', {\n        description:\n            'Selects the event in the flamechart for the user. If the user asks to show them something, it\\'s likely a good idea to call this function.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            eventKey: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The key for the event.',\n              nullable: false,\n            }\n          },\n        },\n        displayInfoFromArgs: params => {\n          return {title: lockedString('Selecting event…'), action: `selectEventByKey('${params.eventKey}')`};\n        },\n        handler: async params => {\n          debugLog('Function call: selectEventByKey', params);\n          const event = focus.lookupEvent(params.eventKey as Trace.Types.File.SerializableKey);\n          if (!event) {\n            return {error: 'Invalid eventKey'};\n          }\n\n          const revealable = new SDK.TraceObject.RevealableEvent(event);\n          await Common.Revealer.reveal(revealable);\n          return {result: {success: true}};\n        },\n      });\n    }\n\n    if (Root.Runtime.hostConfig.devToolsGreenDevUi?.enabled) {\n      this.declareFunction<{insightType: Trace.Insights.Types.InsightKeys}>('addInsightWidget', {\n        description:\n            'Adds an insight widget to the response. When mentioning an insight, call this function to also display an appropriate widget.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            insightType: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description:\n                  'The name of the insight. Only use the insight names given in the \"Available insights\" list.',\n              nullable: false,\n            },\n          },\n        },\n        handler: async _params => {\n          ArtifactsManager.instance().addArtifact({type: 'insight', insightType: _params.insightType});\n          return {result: {success: true}};\n        },\n      });\n\n      this.declareFunction<{eventKey: string}, object|{error: string}>('addNetworkRequestWidget', {\n        description:\n            'Adds a network request widget to the response. When mentioning a network request, call this function with its trace event key.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            eventKey: {\n              type: Host.AidaClient.ParametersTypes.STRING,\n              description: 'The trace event key for the network request.',\n              nullable: false,\n            },\n          },\n        },\n        handler: async _params => {\n          const rawTraceEvent =\n              Trace.Helpers.SyntheticEvents.SyntheticEventsManager.getActiveManager().getRawTraceEvents().at(\n                  Number(_params.eventKey));\n          // Get the trace event object if it is available.\n          // If the trace is uploaded, we need to use the synthetic event.\n          if (rawTraceEvent && Trace.Types.Events.isSyntheticNetworkRequest(rawTraceEvent)) {\n            const rawTraceEventId = rawTraceEvent?.args?.data?.requestId;\n            const rawTraceEventUrl = rawTraceEvent?.args?.data?.url;\n            const networkRequest = rawTraceEvent ? Logs.NetworkLog.NetworkLog.instance()\n                                                       .requestsForId(rawTraceEventId)\n                                                       .find(r => r.url() === rawTraceEventUrl) :\n                                                   null;\n            if (networkRequest) {\n              ArtifactsManager.instance().addArtifact({type: 'network-request', request: networkRequest});\n              return {result: {success: true}};\n            }\n          }\n\n          const syntheticRequest =\n              Trace.Helpers.SyntheticEvents.SyntheticEventsManager.getActiveManager().syntheticEventForRawEventIndex(\n                  Number(_params.eventKey));\n\n          if (syntheticRequest && Trace.Types.Events.isSyntheticNetworkRequest(syntheticRequest)) {\n            ArtifactsManager.instance().addArtifact({\n              type: 'network-request',\n              request: syntheticRequest,\n            });\n            return {result: {success: true}};\n          }\n\n          return {result: {error: 'Could not find network request'}};\n        },\n      });\n\n      this.declareFunction<{start: number, end: number}, object|{error: string}>('addFlameChartWidget', {\n        description: 'Adds a flame chart widget to the response.',\n        parameters: {\n          type: Host.AidaClient.ParametersTypes.OBJECT,\n          description: '',\n          nullable: false,\n          properties: {\n            start: {\n              type: Host.AidaClient.ParametersTypes.INTEGER,\n              description: 'The start time of the flame chart in microseconds.',\n              nullable: false,\n            },\n            end: {\n              type: Host.AidaClient.ParametersTypes.INTEGER,\n              description: 'The end time of the flame chart in microseconds.',\n              nullable: false,\n            },\n          },\n        },\n        handler: async _params => {\n          ArtifactsManager.instance().addArtifact({\n            type: 'flamechart',\n            start: Trace.Types.Timing.Micro(_params.start),\n            end: Trace.Types.Timing.Micro(_params.end),\n          });\n          return {result: {success: true}};\n        },\n      });\n    }\n  }\n\n  async addElementAnnotation(elementId: string, annotationMessage: string):\n      Promise<FunctionCallHandlerResult<unknown>> {\n    if (!Annotations.AnnotationRepository.annotationsEnabled()) {\n      console.warn('Received agent request to add element annotation with annotations disabled');\n      return {error: 'Annotations are not currently enabled'};\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(`AI AGENT EVENT: Performance Agent adding annotation for element ${elementId}: '${annotationMessage}'`);\n    Annotations.AnnotationRepository.instance().addElementsAnnotation(annotationMessage, elementId);\n    return {result: {success: true}};\n  }\n\n  async addNetworkRequestAnnotation(eventKey: string, annotationMessage: string):\n      Promise<FunctionCallHandlerResult<unknown>> {\n    if (!Annotations.AnnotationRepository.annotationsEnabled()) {\n      console.warn('Received agent request to add network request annotation with annotations disabled');\n      return {error: 'Annotations are not currently enabled'};\n    }\n\n    // eslint-disable-next-line no-console\n    console.log(\n        `AI AGENT EVENT: Performance Agent adding annotation for network request ${eventKey}: '${annotationMessage}'`);\n\n    let requestId = undefined;\n    const focus = this.context?.getItem();\n    if (focus) {\n      const event = focus.lookupEvent(eventKey as Trace.Types.File.SerializableKey);\n      if (event && Trace.Types.Events.isSyntheticNetworkRequest(event)) {\n        requestId = event.args.data.requestId;\n      }\n    }\n\n    if (!requestId) {\n      console.warn('Unable to lookup requestId for request with event key', eventKey);\n    }\n\n    Annotations.AnnotationRepository.instance().addNetworkRequestAnnotation(annotationMessage, requestId);\n    return {result: {success: true}};\n  }\n}\n"]}