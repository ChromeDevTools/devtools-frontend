{"version":3,"file":"FileFormatter.js","sourceRoot":"","sources":["../../../../../../../front_end/models/ai_assistance/data_formatters/FileFormatter.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Bindings from '../../bindings/bindings.js';\nimport * as NetworkTimeCalculator from '../../network_time_calculator/network_time_calculator.js';\nimport type * as Workspace from '../../workspace/workspace.js';\n\nimport {NetworkRequestFormatter} from './NetworkRequestFormatter.js';\n\nconst MAX_FILE_SIZE = 10000;\n\n/**\n * File that formats a file for the LLM usage.\n */\nexport class FileFormatter {\n  static formatSourceMapDetails(\n      selectedFile: Workspace.UISourceCode.UISourceCode,\n      debuggerWorkspaceBinding: Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding): string {\n    const mappedFileUrls = [];\n    const sourceMapUrls = [];\n    if (selectedFile.contentType().isFromSourceMap()) {\n      for (const script of debuggerWorkspaceBinding.scriptsForUISourceCode(selectedFile)) {\n        const uiSourceCode = debuggerWorkspaceBinding.uiSourceCodeForScript(script);\n        if (uiSourceCode) {\n          mappedFileUrls.push(uiSourceCode.url());\n          if (script.sourceMapURL !== undefined) {\n            sourceMapUrls.push(script.sourceMapURL);\n          }\n        }\n      }\n      for (const originURL of Bindings.SASSSourceMapping.SASSSourceMapping.uiSourceOrigin(selectedFile)) {\n        mappedFileUrls.push(originURL);\n      }\n    } else if (selectedFile.contentType().isScript()) {\n      for (const script of debuggerWorkspaceBinding.scriptsForUISourceCode(selectedFile)) {\n        if (script.sourceMapURL !== undefined && script.sourceMapURL !== '') {\n          sourceMapUrls.push(script.sourceMapURL);\n        }\n      }\n    }\n    if (sourceMapUrls.length === 0) {\n      return '';\n    }\n    let sourceMapDetails = 'Source map: ' + sourceMapUrls;\n    if (mappedFileUrls.length > 0) {\n      sourceMapDetails += '\\nSource mapped from: ' + mappedFileUrls;\n    }\n    return sourceMapDetails;\n  }\n\n  #file: Workspace.UISourceCode.UISourceCode;\n  constructor(file: Workspace.UISourceCode.UISourceCode) {\n    this.#file = file;\n  }\n  formatFile(): string {\n    const debuggerWorkspaceBinding = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance();\n    const sourceMapDetails = FileFormatter.formatSourceMapDetails(this.#file, debuggerWorkspaceBinding);\n    const lines = [\n      `File name: ${this.#file.displayName()}`,\n      `URL: ${this.#file.url()}`,\n      sourceMapDetails,\n    ];\n    const resource = Bindings.ResourceUtils.resourceForURL(this.#file.url());\n    if (resource?.request) {\n      const calculator = new NetworkTimeCalculator.NetworkTransferTimeCalculator();\n      calculator.updateBoundaries(resource.request);\n      lines.push(`Request initiator chain:\n${new NetworkRequestFormatter(resource.request, calculator).formatRequestInitiatorChain()}`);\n    }\n    lines.push(`File content:\n${this.#formatFileContent()}`);\n    return lines.filter(line => line.trim() !== '').join('\\n');\n  }\n\n  #formatFileContent(): string {\n    const contentData = this.#file.workingCopyContentData();\n    const content = contentData.isTextContent ? contentData.text : '<binary data>';\n    const truncated = content.length > MAX_FILE_SIZE ? content.slice(0, MAX_FILE_SIZE) + '...' : content;\n    return `\\`\\`\\`\n${truncated}\n\\`\\`\\``;\n  }\n}\n"]}