# Copyright 2020 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("../../../scripts/build/ninja/devtools_entrypoint.gni")
import("../../../scripts/build/ninja/devtools_module.gni")
import("../../../scripts/build/ninja/devtools_pre_built.gni")
import("../../../scripts/build/typescript/typescript.gni")
import("../visibility.gni")

devtools_module("issues_manager") {
  sources = [
    "AttributionReportingIssue.ts",
    "BounceTrackingIssue.ts",
    "CheckFormsIssuesTrigger.ts",
    "ClientHintIssue.ts",
    "ContentSecurityPolicyIssue.ts",
    "ContrastCheckTrigger.ts",
    "CookieDeprecationMetadataIssue.ts",
    "CookieIssue.ts",
    "CorsIssue.ts",
    "CrossOriginEmbedderPolicyIssue.ts",
    "DeprecationIssue.ts",
    "ElementAccessibilityIssue.ts",
    "FederatedAuthRequestIssue.ts",
    "FederatedAuthUserInfoRequestIssue.ts",
    "GenericIssue.ts",
    "HeavyAdIssue.ts",
    "Issue.ts",
    "IssueAggregator.ts",
    "IssueResolver.ts",
    "IssuesManager.ts",
    "IssuesManagerEvents.ts",
    "LowTextContrastIssue.ts",
    "MarkdownIssueDescription.ts",
    "MixedContentIssue.ts",
    "PartitioningBlobURLIssue.ts",
    "PermissionElementIssue.ts",
    "PropertyRuleIssue.ts",
    "QuirksModeIssue.ts",
    "RelatedIssue.ts",
    "SRIMessageSignatureIssue.ts",
    "SharedArrayBufferIssue.ts",
    "SharedDictionaryIssue.ts",
    "SourceFrameIssuesManager.ts",
    "StylesheetLoadingIssue.ts",
    "UnencodedDigestIssue.ts",
  ]

  deps = [
    "../../core/common:bundle",
    "../../core/host:bundle",
    "../../core/i18n:bundle",
    "../../core/platform:bundle",
    "../../core/protocol_client:bundle",
    "../../core/root:bundle",
    "../../core/sdk:bundle",
    "../../generated:protocol",
    "../../models/bindings:bundle",
    "../../models/text_utils:bundle",
    "../../models/workspace:bundle",
    "../../third_party/marked:bundle",
    "../../third_party/third-party-web:bundle",
  ]

  public_deps = [ ":descriptions" ]
}

devtools_issue_description_files = [
  "arInsecureContext.md",
  "arInvalidInfoHeader.md",
  "arInvalidRegisterOsSourceHeader.md",
  "arInvalidRegisterOsTriggerHeader.md",
  "arInvalidRegisterSourceHeader.md",
  "arInvalidRegisterTriggerHeader.md",
  "arNavigationRegistrationWithoutTransientUserActivation.md",
  "arNavigationRegistrationUniqueScopeAlreadySet.md",
  "arNoRegisterOsSourceHeader.md",
  "arNoRegisterOsTriggerHeader.md",
  "arNoRegisterSourceHeader.md",
  "arNoRegisterTriggerHeader.md",
  "arNoWebOrOsSupport.md",
  "arOsSourceIgnored.md",
  "arOsTriggerIgnored.md",
  "arPermissionPolicyDisabled.md",
  "arSourceAndTriggerHeaders.md",
  "arSourceIgnored.md",
  "arTriggerIgnored.md",
  "arUntrustworthyReportingOrigin.md",
  "arWebAndOsHeaders.md",
  "bounceTrackingMitigations.md",
  "clientHintMetaTagAllowListInvalidOrigin.md",
  "clientHintMetaTagModifiedHTML.md",
  "CoepCoopSandboxedIframeCannotNavigateToCoopPage.md",
  "CoepCorpNotSameOrigin.md",
  "CoepCorpNotSameOriginAfterDefaultedToSameOriginByCoep.md",
  "CoepCorpNotSameSite.md",
  "CoepFrameResourceNeedsCoepHeader.md",
  "CompatibilityModeQuirks.md",
  "CookieAttributeValueExceedsMaxSize.md",
  "cookieExcludeBlockedWithinRelatedWebsiteSet.md",
  "cookieExcludeDomainNonAscii.md",
  "cookieWarnDomainNonAscii.md",
  "corsAllowCredentialsRequired.md",
  "corsDisabledScheme.md",
  "corsDisallowedByMode.md",
  "corsHeaderDisallowedByPreflightResponse.md",
  "corsInsecurePrivateNetwork.md",
  "corsInvalidHeaderValues.md",
  "corsLocalNetworkAccessPermissionDenied.md",
  "corsMethodDisallowedByPreflightResponse.md",
  "corsNoCorsRedirectModeNotFollow.md",
  "corsOriginMismatch.md",
  "corsPreflightAllowPrivateNetworkError.md",
  "corsPrivateNetworkPermissionDenied.md",
  "corsPreflightResponseInvalid.md",
  "corsRedirectContainsCredentials.md",
  "corsWildcardOriginNotAllowed.md",
  "cspEvalViolation.md",
  "cspInlineViolation.md",
  "cspTrustedTypesPolicyViolation.md",
  "cspTrustedTypesSinkViolation.md",
  "cspURLViolation.md",
  "deprecation.md",
  "genericFormLabelForNameError.md",
  "genericFormDuplicateIdForInputError.md",
  "genericFormInputHasWrongButWellIntendedAutocompleteValueError.md",
  "genericFormInputWithNoLabelError.md",
  "genericFormAutocompleteAttributeEmptyError.md",
  "genericFormEmptyIdAndNameAttributesForInputError.md",
  "genericFormAriaLabelledByToNonExistingIdError.md",
  "genericFormInputAssignedAutocompleteValueToIdOrNameAttributeError.md",
  "genericFormLabelHasNeitherForNorNestedInputError.md",
  "genericFormLabelForMatchesNonExistingIdError.md",
  "genericNavigationEntryMarkedSkippable.md",
  "genericResponseWasBlockedByORB.md",
  "federatedAuthRequestApprovalDeclined.md",
  "federatedAuthRequestTooManyRequests.md",
  "federatedAuthRequestManifestHttpNotFound.md",
  "federatedAuthRequestManifestNoResponse.md",
  "federatedAuthRequestManifestInvalidResponse.md",
  "federatedAuthRequestClientMetadataHttpNotFound.md",
  "federatedAuthRequestClientMetadataNoResponse.md",
  "federatedAuthRequestClientMetadataInvalidResponse.md",
  "federatedAuthRequestErrorFetchingSignin.md",
  "federatedAuthRequestInvalidSigninResponse.md",
  "federatedAuthRequestAccountsHttpNotFound.md",
  "federatedAuthRequestAccountsNoResponse.md",
  "federatedAuthRequestAccountsInvalidResponse.md",
  "federatedAuthRequestIdTokenHttpNotFound.md",
  "federatedAuthRequestIdTokenNoResponse.md",
  "federatedAuthRequestIdTokenInvalidResponse.md",
  "federatedAuthRequestIdTokenInvalidRequest.md",
  "federatedAuthRequestErrorIdToken.md",
  "federatedAuthRequestCanceled.md",
  "federatedAuthUserInfoRequestInvalidAccountsResponse.md",
  "federatedAuthUserInfoRequestInvalidConfigOrWellKnown.md",
  "federatedAuthUserInfoRequestNoAccountSharingPermission.md",
  "federatedAuthUserInfoRequestNoApiPermission.md",
  "federatedAuthUserInfoRequestNoReturningUserFromFetchedAccounts.md",
  "federatedAuthUserInfoRequestNotIframe.md",
  "federatedAuthUserInfoRequestNotPotentiallyTrustworthy.md",
  "federatedAuthUserInfoRequestNotSameOrigin.md",
  "federatedAuthUserInfoRequestNotSignedInWithIdp.md",
  "heavyAd.md",
  "LowTextContrast.md",
  "mixedContent.md",
  "permissionElementActivationDisabled.md",
  "permissionElementActivationDisabledWithOccluder.md",
  "permissionElementActivationDisabledWithOccluderParent.md",
  "permissionElementCspFrameAncestorsMissing.md",
  "permissionElementFencedFrameDisallowed.md",
  "permissionElementFontSizeTooLarge.md",
  "permissionElementFontSizeTooSmall.md",
  "permissionElementGeolocationDeprecated.md",
  "permissionElementInsetBoxShadowUnsupported.md",
  "permissionElementInvalidDisplayStyle.md",
  "permissionElementInvalidSizeValue.md",
  "permissionElementInvalidType.md",
  "permissionElementInvalidTypeActivation.md",
  "permissionElementLowContrast.md",
  "permissionElementNonOpaqueColor.md",
  "permissionElementPaddingBottomUnsupported.md",
  "permissionElementPaddingRightUnsupported.md",
  "permissionElementPermissionsPolicyBlocked.md",
  "permissionElementRegistrationFailed.md",
  "permissionElementRequestInProgress.md",
  "permissionElementSecurityChecksFailed.md",
  "permissionElementTypeNotSupported.md",
  "permissionElementUntrustedEvent.md",
  "SameSiteExcludeContextDowngradeRead.md",
  "SameSiteExcludeContextDowngradeSet.md",
  "SameSiteExcludeNavigationContextDowngrade.md",
  "SameSiteNoneInsecureErrorRead.md",
  "SameSiteNoneInsecureErrorSet.md",
  "SameSiteNoneInsecureWarnRead.md",
  "SameSiteNoneInsecureWarnSet.md",
  "SameSiteUnspecifiedLaxAllowUnsafeRead.md",
  "SameSiteUnspecifiedLaxAllowUnsafeSet.md",
  "SameSiteWarnCrossDowngradeRead.md",
  "SameSiteWarnCrossDowngradeSet.md",
  "cookieCrossSiteRedirectDowngrade.md",
  "cookieWarnThirdPartyPhaseoutSet.md",
  "cookieWarnThirdPartyPhaseoutRead.md",
  "cookieExcludeThirdPartyPhaseoutSet.md",
  "cookieExcludeThirdPartyPhaseoutRead.md",
  "cookieExcludePortMismatch.md",
  "cookieExcludeSchemeMismatch.md",
  "cookieWarnMetadataGrantRead.md",
  "cookieWarnMetadataGrantSet.md",
  "propertyRuleIssue.md",
  "propertyRuleInvalidNameIssue.md",
  "SameSiteWarnStrictLaxDowngradeStrict.md",
  "selectElementAccessibilityDisallowedOptGroupChild.md",
  "selectElementAccessibilityDisallowedSelectChild.md",
  "selectElementAccessibilityInteractiveContentAttributesSelectDescendant.md",
  "selectElementAccessibilityInteractiveContentLegendChild.md",
  "selectElementAccessibilityInteractiveContentOptionChild.md",
  "selectElementAccessibilityNonPhrasingContentOptionChild.md",
  "summaryElementAccessibilityInteractiveContentSummaryDescendant.md",
  "sharedArrayBuffer.md",
  "stylesheetLateImport.md",
  "stylesheetRequestFailed.md",
  "sharedDictionaryUseErrorCrossOriginNoCorsRequest.md",
  "sharedDictionaryUseErrorDictionaryLoadFailure.md",
  "sharedDictionaryUseErrorMatchingDictionaryNotUsed.md",
  "sharedDictionaryUseErrorUnexpectedContentDictionaryHeader.md",
  "sharedDictionaryWriteErrorCossOriginNoCorsRequest.md",
  "sharedDictionaryWriteErrorDisallowedBySettings.md",
  "sharedDictionaryWriteErrorExpiredResponse.md",
  "sharedDictionaryWriteErrorFeatureDisabled.md",
  "sharedDictionaryWriteErrorInsufficientResources.md",
  "sharedDictionaryWriteErrorInvalidMatchField.md",
  "sharedDictionaryWriteErrorInvalidStructuredHeader.md",
  "sharedDictionaryWriteErrorInvalidTTLField.md",
  "sharedDictionaryWriteErrorNavigationRequest.md",
  "sharedDictionaryWriteErrorNoMatchField.md",
  "sharedDictionaryWriteErrorNonIntegerTTLField.md",
  "sharedDictionaryWriteErrorNonListMatchDestField.md",
  "sharedDictionaryWriteErrorNonSecureContext.md",
  "sharedDictionaryWriteErrorNonStringIdField.md",
  "sharedDictionaryWriteErrorNonStringInMatchDestList.md",
  "sharedDictionaryWriteErrorNonStringMatchField.md",
  "sharedDictionaryWriteErrorNonTokenTypeField.md",
  "sharedDictionaryWriteErrorRequestAborted.md",
  "sharedDictionaryWriteErrorShuttingDown.md",
  "sharedDictionaryWriteErrorTooLongIdField.md",
  "sharedDictionaryWriteErrorUnsupportedType.md",
  "sriInvalidSignatureHeader.md",
  "sriInvalidSignatureInputHeader.md",
  "sriMissingSignatureHeader.md",
  "sriMissingSignatureInputHeader.md",
  "sriSignatureHeaderValueIsIncorrectLength.md",
  "sriSignatureHeaderValueIsNotByteSequence.md",
  "sriSignatureHeaderValueIsParameterized.md",
  "sriSignatureInputHeaderInvalidComponentName.md",
  "sriSignatureInputHeaderInvalidComponentType.md",
  "sriSignatureInputHeaderInvalidDerivedComponentParameter.md",
  "sriSignatureInputHeaderInvalidHeaderComponentParameter.md",
  "sriSignatureInputHeaderInvalidParameter.md",
  "sriSignatureInputHeaderKeyIdLength.md",
  "sriSignatureInputHeaderMissingLabel.md",
  "sriSignatureInputHeaderMissingRequiredParameters.md",
  "sriSignatureInputHeaderValueMissingComponents.md",
  "sriSignatureInputHeaderValueNotInnerList.md",
  "sriValidationFailedIntegrityMismatch.md",
  "sriValidationFailedInvalidLength.md",
  "sriValidationFailedSignatureExpired.md",
  "sriValidationFailedSignatureMismatch.md",
  "placeholderDescriptionForInvisibleIssues.md",
  "fetchingPartitionedBlobURL.md",
  "navigatingPartitionedBlobURL.md",
  "unencodedDigestIncorrectDigestLength.md",
  "unencodedDigestIncorrectDigestType.md",
  "unencodedDigestMalformedDictionary.md",
  "unencodedDigestUnknownAlgorithm.md",
]

devtools_pre_built("descriptions") {
  sources = []
  data = []
  foreach(file, devtools_issue_description_files) {
    sources += [ "descriptions/$file" ]
    data += [ "$target_gen_dir/descriptions/$file" ]
  }

  write_file("$target_gen_dir/description_list.json",
             devtools_issue_description_files,
             "json")
}

devtools_entrypoint("bundle") {
  entrypoint = "issues_manager.ts"

  deps = [ ":issues_manager" ]

  visibility = [
    ":*",
    "../../../mcp/*",
    "../../entrypoints/main/*",
    "../../panels/application/*",
    "../../panels/console/*",
    "../../panels/console_counters/*",
    "../../panels/elements/*",
    "../../panels/issues/*",
    "../../panels/network/*",
    "../../panels/security/*",
    "../../panels/sources/*",
    "../../testing/*",
    "../../ui/components/docs/issue_counter/*",
    "../../ui/components/issue_counter/*",
    "../../ui/components/markdown_view/*",
    "../../ui/legacy/components/cookie_table/*",
  ]

  visibility += devtools_models_visibility
}

ts_library("unittests") {
  testonly = true

  sources = [
    "CheckFormsIssuesTrigger.test.ts",
    "IssuesManager.test.ts",
  ]

  deps = [
    ":bundle",
    "../../core/common:bundle",
    "../../core/sdk:bundle",
    "../../generated:protocol",
    "../../testing",
  ]
}

devtools_foundation_module("foundation_unittests") {
  testonly = true

  sources = [
    "DeprecationIssue.test.ts",
    "ElementAccessibilityIssue.test.ts",
    "FederatedAuthUserInfoRequestIssue.test.ts",
    "GenericIssue.test.ts",
    "Issue.test.ts",
    "IssueAggregator.test.ts",
    "IssueResolver.test.ts",
    "LowTextContrastIssue.test.ts",
    "MarkdownIssueDescription.test.ts",
    "PermissionElementIssue.test.ts",
    "PropertyRuleIssue.test.ts",
    "RelatedIssue.test.ts",
    "SRIMessageSignatureIssue.test.ts",
    "SharedDictionaryIssue.test.ts",
    "StylesheetLoadingIssue.test.ts",
    "UnencodedDigestIssue.test.ts",
  ]

  deps = [
    ":bundle",
    "../../core/common:bundle",
    "../../core/sdk:bundle",
    "../../testing",
  ]
}
