{"version":3,"file":"CookieDeprecationMetadataIssue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/CookieDeprecationMetadataIssue.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAIhD,OAAO,EAAC,KAAK,EAA2B,MAAM,YAAY,CAAC;AAG3D,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,2BAA2B,EAAE,uDAAuD;CAC5E,CAAC;AACX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,yDAAyD,EAAE,SAAS,CAAC,CAAC;AAC/G,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAEtE,yEAAyE;AACzE,MAAM,OAAO,8BAA+B,SAAQ,KAA4D;IAC9G,YACI,YAAmE,EACnE,WAA6C;QAC/C,2FAA2F;QAC3F,MAAM,SAAS,GAAG,2GAAoE,GAAG,GAAG,YAAY,CAAC,SAAS,CAAC;QACnH,KAAK,CAAC,SAAS,EAAE,YAAY,EAAE,WAAW,CAAC,CAAC;IAC9C,CAAC;IAED,WAAW;QACT,yCAA2B;IAC7B,CAAC;IAED,cAAc;QACZ,MAAM,QAAQ,GACV,IAAI,CAAC,OAAO,EAAE,CAAC,SAAS,KAAK,WAAW,CAAC,CAAC,CAAC,+BAA+B,CAAC,CAAC,CAAC,gCAAgC,CAAC;QAElH,IAAI,UAAU,GAAG,EAAE,CAAC;QACpB,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC,gBAAgB,EAAE,CAAC;YACpC,UAAU,GAAG,gCAAgC,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,gBAAgB;gBAC3E,sDAAsD,CAAC;QAC7D,CAAC;QAED,OAAO;YACL,IAAI,EAAE,QAAQ;YACd,aAAa,EAAE,IAAI,GAAG,CAAC;gBACrB,CAAC,4BAA4B,EAAE,UAAU,CAAC;aAC3C,CAAC;YACF,KAAK,EAAE;gBACL;oBACE,IAAI,EAAE,4CAA4C;oBAClD,SAAS,EAAE,UAAU,CAAC,SAAS,CAAC,2BAA2B,CAAC;iBAC7D;aACF;SACF,CAAC;IACJ,CAAC;IAED,OAAO;QACL,wDAAiC;IACnC,CAAC;IAED,UAAU;QACR,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;IACxC,CAAC;IAED,MAAM,CAAC,kBAAkB,CACrB,WAA6C,EAC7C,cAA8C;QAChD,MAAM,OAAO,GAAG,cAAc,CAAC,OAAO,CAAC,qCAAqC,CAAC;QAC7E,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO,CAAC,IAAI,CAAC,6DAA6D,CAAC,CAAC;YAC5E,OAAO,EAAE,CAAC;QACZ,CAAC;QACD,OAAO,CAAC,IAAI,8BAA8B,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC,CAAC;IACpE,CAAC;CACF","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {Issue, IssueCategory, IssueKind} from './Issue.js';\nimport type {MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\nconst UIStrings = {\n  /**\n   * @description Label for a link for third-party cookie Issues.\n   */\n  thirdPartyPhaseoutExplained: 'Changes to Chrome\\'s treatment of third-party cookies',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('models/issues_manager/CookieDeprecationMetadataIssue.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\n/** TODO(b/305738703): Move this issue into a warning on CookieIssue. **/\nexport class CookieDeprecationMetadataIssue extends Issue<Protocol.Audits.CookieDeprecationMetadataIssueDetails> {\n  constructor(\n      issueDetails: Protocol.Audits.CookieDeprecationMetadataIssueDetails,\n      issuesModel: SDK.IssuesModel.IssuesModel|null) {\n    // Set a distinct code for ReadCookie and SetCookie issues, so they are grouped separately.\n    const issueCode = Protocol.Audits.InspectorIssueCode.CookieDeprecationMetadataIssue + '_' + issueDetails.operation;\n    super(issueCode, issueDetails, issuesModel);\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.OTHER;\n  }\n\n  getDescription(): MarkdownIssueDescription {\n    const fileName =\n        this.details().operation === 'SetCookie' ? 'cookieWarnMetadataGrantSet.md' : 'cookieWarnMetadataGrantRead.md';\n\n    let optOutText = '';\n    if (this.details().isOptOutTopLevel) {\n      optOutText = '\\n\\n (Top level site opt-out: ' + this.details().optOutPercentage +\n          '% - [learn more](gracePeriodStagedControlExplainer))';\n    }\n\n    return {\n      file: fileName,\n      substitutions: new Map([\n        ['PLACEHOLDER_topleveloptout', optOutText],\n      ]),\n      links: [\n        {\n          link: 'https://goo.gle/changes-to-chrome-browsing',\n          linkTitle: i18nString(UIStrings.thirdPartyPhaseoutExplained),\n        },\n      ],\n    };\n  }\n\n  getKind(): IssueKind {\n    return IssueKind.BREAKING_CHANGE;\n  }\n\n  primaryKey(): string {\n    return JSON.stringify(this.details());\n  }\n\n  static fromInspectorIssue(\n      issuesModel: SDK.IssuesModel.IssuesModel|null,\n      inspectorIssue: Protocol.Audits.InspectorIssue): CookieDeprecationMetadataIssue[] {\n    const details = inspectorIssue.details.cookieDeprecationMetadataIssueDetails;\n    if (!details) {\n      console.warn('Cookie deprecation metadata issue without details received.');\n      return [];\n    }\n    return [new CookieDeprecationMetadataIssue(details, issuesModel)];\n  }\n}\n"]}