{"version":3,"file":"DeprecationIssue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/DeprecationIssue.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Deprecation from '../../generated/Deprecation.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {Issue, IssueCategory, IssueKind} from './Issue.js';\nimport {type MarkdownIssueDescription, resolveLazyDescription} from './MarkdownIssueDescription.js';\n\nconst UIStrings = {\n  /**\n   * @description This links to the chrome feature status page when one exists.\n   */\n  feature: 'Check the feature status page for more details.',\n  /**\n   * @description This links to the chromium dash schedule when a milestone is set.\n   * @example {100} milestone\n   */\n  milestone: 'This change will go into effect with milestone {milestone}.',\n  /**\n   * @description Title of issue raised when a deprecated feature is used\n   */\n  title: 'Deprecated feature used',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('models/issues_manager/DeprecationIssue.ts', UIStrings);\nconst i18nLazyString = i18n.i18n.getLazilyComputedLocalizedString.bind(undefined, str_);\n\n// eslint-disable-next-line @devtools/l10n-filename-matches\nconst strDeprecation = i18n.i18n.registerUIStrings('generated/Deprecation.ts', Deprecation.UIStrings);\nconst i18nLazyDeprecationString = i18n.i18n.getLazilyComputedLocalizedString.bind(undefined, strDeprecation);\n\nexport class DeprecationIssue extends Issue {\n  #issueDetails: Protocol.Audits.DeprecationIssueDetails;\n\n  constructor(issueDetails: Protocol.Audits.DeprecationIssueDetails, issuesModel: SDK.IssuesModel.IssuesModel|null) {\n    const issueCode = [\n      Protocol.Audits.InspectorIssueCode.DeprecationIssue,\n      issueDetails.type,\n    ].join('::');\n    super({code: issueCode, umaCode: 'DeprecationIssue'}, issuesModel);\n    this.#issueDetails = issueDetails;\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.OTHER;\n  }\n\n  details(): Protocol.Audits.DeprecationIssueDetails {\n    return this.#issueDetails;\n  }\n\n  getDescription(): MarkdownIssueDescription {\n    let messageFunction = (): string => '';\n    const maybeEnglishMessage = (Deprecation.UIStrings as Record<string, string>)[this.#issueDetails.type];\n    if (maybeEnglishMessage) {\n      messageFunction = i18nLazyDeprecationString(maybeEnglishMessage);\n    }\n\n    const links = [];\n    const deprecationMeta = Deprecation.DEPRECATIONS_METADATA[this.#issueDetails.type];\n    const feature = deprecationMeta?.chromeStatusFeature ?? 0;\n    if (feature !== 0) {\n      links.push({\n        link: `https://chromestatus.com/feature/${feature}`,\n        linkTitle: i18nLazyString(UIStrings.feature),\n      });\n    }\n    const milestone = deprecationMeta?.milestone ?? 0;\n    if (milestone !== 0) {\n      links.push({\n        link: 'https://chromiumdash.appspot.com/schedule',\n        linkTitle: i18nLazyString(UIStrings.milestone, {milestone}),\n      });\n    }\n    return resolveLazyDescription({\n      file: 'deprecation.md',\n      substitutions: new Map([\n        ['PLACEHOLDER_title', i18nLazyString(UIStrings.title)],\n        ['PLACEHOLDER_message', messageFunction],\n      ]),\n      links,\n    });\n  }\n\n  override sources(): Iterable<Protocol.Audits.SourceCodeLocation> {\n    if (this.#issueDetails.sourceCodeLocation) {\n      return [this.#issueDetails.sourceCodeLocation];\n    }\n    return [];\n  }\n\n  primaryKey(): string {\n    return JSON.stringify(this.#issueDetails);\n  }\n\n  getKind(): IssueKind {\n    return IssueKind.BREAKING_CHANGE;\n  }\n\n  static fromInspectorIssue(\n      issuesModel: SDK.IssuesModel.IssuesModel|null,\n      inspectorIssue: Protocol.Audits.InspectorIssue): DeprecationIssue[] {\n    const details = inspectorIssue.details.deprecationIssueDetails;\n    if (!details) {\n      console.warn('Deprecation issue without details received.');\n      return [];\n    }\n    return [new DeprecationIssue(details, issuesModel)];\n  }\n}\n"]}