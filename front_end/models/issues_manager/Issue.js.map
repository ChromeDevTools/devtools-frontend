{"version":3,"file":"Issue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/Issue.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport type {MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\nconst UIStrings = {\n  /**\n   * @description The kind of an issue (plural) (Issues are categorized into kinds).\n   */\n  improvements: 'Improvements',\n  /**\n   * @description The kind of an issue (plural) (Issues are categorized into kinds).\n   */\n  pageErrors: 'Page Errors',\n  /**\n   * @description The kind of an issue (plural) (Issues are categorized into kinds).\n   */\n  breakingChanges: 'Breaking Changes',\n  /**\n   * @description A description for a kind of issue we display in the issues tab.\n   */\n  pageErrorIssue: 'A page error issue: the page is not working correctly',\n  /**\n   * @description A description for a kind of issue we display in the issues tab.\n   */\n  breakingChangeIssue: 'A breaking change issue: the page may stop working in an upcoming version of Chrome',\n  /**\n   * @description A description for a kind of issue we display in the issues tab.\n   */\n  improvementIssue: 'An improvement issue: there is an opportunity to improve the page',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('models/issues_manager/Issue.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport const enum IssueCategory {\n  CROSS_ORIGIN_EMBEDDER_POLICY = 'CrossOriginEmbedderPolicy',\n  GENERIC = 'Generic',\n  MIXED_CONTENT = 'MixedContent',\n  COOKIE = 'Cookie',\n  HEAVY_AD = 'HeavyAd',\n  CONTENT_SECURITY_POLICY = 'ContentSecurityPolicy',\n  LOW_TEXT_CONTRAST = 'LowTextContrast',\n  CORS = 'Cors',\n  ATTRIBUTION_REPORTING = 'AttributionReporting',\n  QUIRKS_MODE = 'QuirksMode',\n  PERMISSION_ELEMENT = 'PermissionElement',\n  OTHER = 'Other',\n}\n\nexport const enum IssueKind {\n  /**\n   * Something is not working in the page right now. Issues of this kind need\n   * usually be fixed right away. They usually indicate that a Web API is being\n   * used in a wrong way, or that a network request was misconfigured.\n   */\n  PAGE_ERROR = 'PageError',\n  /**\n   * The page is using a Web API or relying on browser behavior that is going\n   * to change in the future. If possible, the message associated with issues\n   * of this kind should include a time when the behavior is going to change.\n   */\n  BREAKING_CHANGE = 'BreakingChange',\n  /**\n   * Anything that can be improved about the page, but isn't urgent and doesn't\n   * impair functionality in a major way.\n   */\n  IMPROVEMENT = 'Improvement',\n}\n\nexport function getIssueKindName(issueKind: IssueKind): Common.UIString.LocalizedString {\n  switch (issueKind) {\n    case IssueKind.BREAKING_CHANGE:\n      return i18nString(UIStrings.breakingChanges);\n    case IssueKind.IMPROVEMENT:\n      return i18nString(UIStrings.improvements);\n    case IssueKind.PAGE_ERROR:\n      return i18nString(UIStrings.pageErrors);\n  }\n}\n\nexport function getIssueKindDescription(issueKind: IssueKind): Common.UIString.LocalizedString {\n  switch (issueKind) {\n    case IssueKind.PAGE_ERROR:\n      return i18nString(UIStrings.pageErrorIssue);\n    case IssueKind.BREAKING_CHANGE:\n      return i18nString(UIStrings.breakingChangeIssue);\n    case IssueKind.IMPROVEMENT:\n      return i18nString(UIStrings.improvementIssue);\n  }\n}\n\n/**\n * Union two issue kinds for issue aggregation. The idea is to show the most\n * important kind on aggregated issues that union issues of different kinds.\n */\nexport function unionIssueKind(a: IssueKind, b: IssueKind): IssueKind {\n  if (a === IssueKind.PAGE_ERROR || b === IssueKind.PAGE_ERROR) {\n    return IssueKind.PAGE_ERROR;\n  }\n  if (a === IssueKind.BREAKING_CHANGE || b === IssueKind.BREAKING_CHANGE) {\n    return IssueKind.BREAKING_CHANGE;\n  }\n  return IssueKind.IMPROVEMENT;\n}\n\nexport function getShowThirdPartyIssuesSetting(): Common.Settings.Setting<boolean> {\n  return Common.Settings.Settings.instance().createSetting('show-third-party-issues', true);\n}\n\nexport interface AffectedElement {\n  backendNodeId: Protocol.DOM.BackendNodeId;\n  nodeName: string;\n  target: SDK.Target.Target|null;\n}\nexport type ValidIssueDetails =\n    NonNullable<Protocol.Audits.InspectorIssueDetails[keyof Protocol.Audits.InspectorIssueDetails]>;\nexport abstract class Issue<IssueDetails extends ValidIssueDetails|null = ValidIssueDetails | null,\n                                                 IssueCode extends string = string> {\n  #issueCode: IssueCode;\n  #issuesModel: SDK.IssuesModel.IssuesModel|null;\n  protected issueId: Protocol.Audits.IssueId|undefined = undefined;\n  #issueDetails: IssueDetails;\n  #hidden: boolean;\n\n  constructor(\n      code: IssueCode|{code: IssueCode, umaCode: string}, issueDetails: IssueDetails,\n      issuesModel: SDK.IssuesModel.IssuesModel|null = null, issueId?: Protocol.Audits.IssueId) {\n    this.#issueCode = typeof code === 'object' ? code.code : code;\n    this.#issueDetails = issueDetails;\n    this.#issuesModel = issuesModel;\n    this.issueId = issueId;\n    Host.userMetrics.issueCreated(typeof code === 'string' ? code : code.umaCode);\n    this.#hidden = false;\n  }\n\n  code(): IssueCode {\n    return this.#issueCode;\n  }\n\n  abstract primaryKey(): string;\n  abstract getDescription(): MarkdownIssueDescription|null;\n  abstract getCategory(): IssueCategory;\n  abstract getKind(): IssueKind;\n\n  details(): IssueDetails {\n    return this.#issueDetails;\n  }\n\n  getBlockedByResponseDetails(): Iterable<Protocol.Audits.BlockedByResponseIssueDetails> {\n    return [];\n  }\n\n  cookies(): Iterable<Protocol.Audits.AffectedCookie> {\n    return [];\n  }\n\n  rawCookieLines(): Iterable<string> {\n    return [];\n  }\n\n  elements(): Iterable<AffectedElement> {\n    return [];\n  }\n\n  requests(): Iterable<Protocol.Audits.AffectedRequest> {\n    return [];\n  }\n\n  sources(): Iterable<Protocol.Audits.SourceCodeLocation> {\n    return [];\n  }\n\n  trackingSites(): Iterable<string> {\n    return [];\n  }\n\n  isAssociatedWithRequestId(requestId: string): boolean {\n    for (const request of this.requests()) {\n      if (request.requestId === requestId) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * The model might be unavailable or belong to a target that has already been disposed.\n   */\n  model(): SDK.IssuesModel.IssuesModel|null {\n    return this.#issuesModel;\n  }\n\n  isCausedByThirdParty(): boolean {\n    return false;\n  }\n\n  getIssueId(): Protocol.Audits.IssueId|undefined {\n    return this.issueId;\n  }\n\n  isHidden(): boolean {\n    return this.#hidden;\n  }\n\n  setHidden(hidden: boolean): void {\n    this.#hidden = hidden;\n  }\n\n  maybeCreateConsoleMessage(): SDK.ConsoleModel.ConsoleMessage|undefined {\n    return;\n  }\n}\n\nexport function toZeroBasedLocation(location: Protocol.Audits.SourceCodeLocation|undefined): {\n  url: Platform.DevToolsPath.UrlString,\n  scriptId: Protocol.Runtime.ScriptId|undefined,\n  lineNumber: number,\n  columnNumber: number|undefined,\n}|undefined {\n  if (!location) {\n    return undefined;\n  }\n  return {\n    url: location.url as Platform.DevToolsPath.UrlString,\n    scriptId: location.scriptId,\n    lineNumber: location.lineNumber,\n    columnNumber: location.columnNumber === 0 ? undefined : location.columnNumber - 1,\n  };\n}\n"]}