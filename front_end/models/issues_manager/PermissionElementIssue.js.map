{"version":3,"file":"PermissionElementIssue.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/PermissionElementIssue.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nimport {type AffectedElement, Issue, IssueCategory, IssueKind} from './Issue.js';\nimport type {MarkdownIssueDescription} from './MarkdownIssueDescription.js';\n\nexport class PermissionElementIssue extends Issue<Protocol.Audits.PermissionElementIssueDetails> {\n  #issueDetails: Protocol.Audits.PermissionElementIssueDetails;\n\n  constructor(\n      issueDetails: Protocol.Audits.PermissionElementIssueDetails, issuesModel: SDK.IssuesModel.IssuesModel|null) {\n    const issueCode = [\n      Protocol.Audits.InspectorIssueCode.PermissionElementIssue,\n      issueDetails.issueType,\n    ].join('::');\n    super(issueCode, issueDetails, issuesModel);\n    this.#issueDetails = issueDetails;\n  }\n\n  getCategory(): IssueCategory {\n    return IssueCategory.PERMISSION_ELEMENT;\n  }\n\n  getDescription(): MarkdownIssueDescription|null {\n    const issueType = this.#issueDetails.issueType;\n\n    switch (issueType) {\n      case Protocol.Audits.PermissionElementIssueType.InvalidType:\n        return {\n          file: 'permissionElementInvalidType.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.FencedFrameDisallowed:\n        return {\n          file: 'permissionElementFencedFrameDisallowed.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.CspFrameAncestorsMissing:\n        return {\n          file: 'permissionElementCspFrameAncestorsMissing.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.PermissionsPolicyBlocked:\n        return {\n          file: 'permissionElementPermissionsPolicyBlocked.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n            ['PLACEHOLDER_PermissionName', this.#issueDetails.permissionName || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.PaddingRightUnsupported:\n        return {\n          file: 'permissionElementPaddingRightUnsupported.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.PaddingBottomUnsupported:\n        return {\n          file: 'permissionElementPaddingBottomUnsupported.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.InsetBoxShadowUnsupported:\n        return {\n          file: 'permissionElementInsetBoxShadowUnsupported.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.RequestInProgress:\n        return {\n          file: 'permissionElementRequestInProgress.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.UntrustedEvent:\n        return {\n          file: 'permissionElementUntrustedEvent.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.RegistrationFailed:\n        return {\n          file: 'permissionElementRegistrationFailed.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.TypeNotSupported:\n        return {\n          file: 'permissionElementTypeNotSupported.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.InvalidTypeActivation:\n        return {\n          file: 'permissionElementInvalidTypeActivation.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.SecurityChecksFailed:\n        return {\n          file: 'permissionElementSecurityChecksFailed.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.ActivationDisabled: {\n        if (this.#issueDetails.occluderNodeInfo && this.#issueDetails.occluderParentNodeInfo) {\n          return {\n            file: 'permissionElementActivationDisabledWithOccluderParent.md',\n            substitutions: new Map([\n              ['PLACEHOLDER_DisableReason', this.#issueDetails.disableReason || ''],\n              ['PLACEHOLDER_OccluderInfo', this.#issueDetails.occluderNodeInfo || ''],\n              ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n              ['PLACEHOLDER_OccluderParentInfo', this.#issueDetails.occluderParentNodeInfo || ''],\n            ]),\n            links: [],\n          };\n        }\n\n        if (this.#issueDetails.occluderNodeInfo) {\n          return {\n            file: 'permissionElementActivationDisabledWithOccluder.md',\n            substitutions: new Map([\n              ['PLACEHOLDER_DisableReason', this.#issueDetails.disableReason || ''],\n              ['PLACEHOLDER_OccluderInfo', this.#issueDetails.occluderNodeInfo || ''],\n              ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n            ]),\n            links: [],\n          };\n        }\n\n        return {\n          file: 'permissionElementActivationDisabled.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_DisableReason', this.#issueDetails.disableReason || ''],\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      }\n      case Protocol.Audits.PermissionElementIssueType.GeolocationDeprecated:\n        return {\n          file: 'permissionElementGeolocationDeprecated.md',\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.InvalidDisplayStyle:\n        return {\n          file: 'permissionElementInvalidDisplayStyle.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.NonOpaqueColor:\n        return {\n          file: 'permissionElementNonOpaqueColor.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.LowContrast:\n        return {\n          file: 'permissionElementLowContrast.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.FontSizeTooSmall:\n        return {\n          file: 'permissionElementFontSizeTooSmall.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.FontSizeTooLarge:\n        return {\n          file: 'permissionElementFontSizeTooLarge.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      case Protocol.Audits.PermissionElementIssueType.InvalidSizeValue:\n        return {\n          file: 'permissionElementInvalidSizeValue.md',\n          substitutions: new Map([\n            ['PLACEHOLDER_Type', this.#issueDetails.type || ''],\n          ]),\n          links: [],\n        };\n      default:\n        console.warn('Unknown PermissionElementIssueType:', issueType);\n        return null;\n    }\n  }\n\n  override elements(): Iterable<AffectedElement> {\n    if (this.#issueDetails.nodeId) {\n      const target = this.model()?.target();\n      const result = [{\n        backendNodeId: this.#issueDetails.nodeId,\n        nodeName: this.#issueDetails.type || 'Affected element',\n        target: target || null,\n      }];\n      return result;\n    }\n    return [];\n  }\n\n  getKind(): IssueKind {\n    return this.#issueDetails.isWarning ? IssueKind.IMPROVEMENT : IssueKind.PAGE_ERROR;\n  }\n\n  primaryKey(): string {\n    return `${Protocol.Audits.InspectorIssueCode.PermissionElementIssue}-${JSON.stringify(this.#issueDetails)}`;\n  }\n\n  static fromInspectorIssue(\n      issuesModel: SDK.IssuesModel.IssuesModel|null,\n      inspectorIssue: Protocol.Audits.InspectorIssue): PermissionElementIssue[] {\n    const permissionElementIssueDetails = inspectorIssue.details.permissionElementIssueDetails;\n    if (!permissionElementIssueDetails) {\n      console.warn('Permission element issue without details received.');\n      return [];\n    }\n    return [new PermissionElementIssue(permissionElementIssueDetails, issuesModel)];\n  }\n}\n"]}