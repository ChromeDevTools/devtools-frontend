{"version":3,"file":"IsolatedFileSystemManager.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/IsolatedFileSystemManager.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2012 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\n\nimport type {FilesChangedData} from './FileSystemWorkspaceBinding.js';\nimport {IsolatedFileSystem} from './IsolatedFileSystem.js';\nimport {\n  Events as PlatformFileSystemEvents,\n  type PlatformFileSystem,\n  PlatformFileSystemType\n} from './PlatformFileSystem.js';\n\nconst UIStrings = {\n  /**\n   * @description Text in Isolated File System Manager of the Workspace settings in Settings\n   * @example {folder does not exist} PH1\n   */\n  unableToAddFilesystemS: 'Unable to add filesystem: {PH1}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('models/persistence/IsolatedFileSystemManager.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nlet isolatedFileSystemManagerInstance: IsolatedFileSystemManager|null;\n\nexport class IsolatedFileSystemManager extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  readonly #fileSystems: Map<Platform.DevToolsPath.UrlString, PlatformFileSystem>;\n  private readonly callbacks: Map<number, (arg0: Platform.DevToolsPath.RawPathString[]) => void>;\n  private readonly progresses: Map<number, Common.Progress.Progress>;\n  readonly #workspaceFolderExcludePatternSetting: Common.Settings.RegExpSetting;\n  private fileSystemRequestResolve: ((arg0: IsolatedFileSystem|null) => void)|null;\n  private readonly fileSystemsLoadedPromise: Promise<IsolatedFileSystem[]>;\n  private constructor() {\n    super();\n\n    this.#fileSystems = new Map();\n    this.callbacks = new Map();\n    this.progresses = new Map();\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.FileSystemRemoved, this.onFileSystemRemoved, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.FileSystemAdded, event => {\n          this.onFileSystemAdded(event);\n        }, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.FileSystemFilesChangedAddedRemoved, this.onFileSystemFilesChanged, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.IndexingTotalWorkCalculated, this.onIndexingTotalWorkCalculated, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.IndexingWorked, this.onIndexingWorked, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.IndexingDone, this.onIndexingDone, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.SearchCompleted, this.onSearchCompleted, this);\n\n    // Initialize exclude pattern settings\n    const defaultCommonExcludedFolders = [\n      '/node_modules/',\n      '/\\\\.devtools',\n      '/\\\\.git/',\n      '/\\\\.sass-cache/',\n      '/\\\\.hg/',\n      '/\\\\.idea/',\n      '/\\\\.svn/',\n      '/\\\\.cache/',\n      '/\\\\.project/',\n      '/\\\\.next/',\n    ];\n    const defaultWinExcludedFolders = ['/Thumbs.db$', '/ehthumbs.db$', '/Desktop.ini$', '/\\\\$RECYCLE.BIN/'];\n    const defaultMacExcludedFolders = [\n      '/\\\\.DS_Store$',\n      '/\\\\.Trashes$',\n      '/\\\\.Spotlight-V100$',\n      '/\\\\.AppleDouble$',\n      '/\\\\.LSOverride$',\n      '/Icon$',\n      '/\\\\._.*$',\n    ];\n    const defaultLinuxExcludedFolders = ['/.*~$'];\n    let defaultExcludedFolders: string[] = defaultCommonExcludedFolders;\n    if (Host.Platform.isWin()) {\n      defaultExcludedFolders = defaultExcludedFolders.concat(defaultWinExcludedFolders);\n    } else if (Host.Platform.isMac()) {\n      defaultExcludedFolders = defaultExcludedFolders.concat(defaultMacExcludedFolders);\n    } else {\n      defaultExcludedFolders = defaultExcludedFolders.concat(defaultLinuxExcludedFolders);\n    }\n    const defaultExcludedFoldersPattern = defaultExcludedFolders.join('|');\n    this.#workspaceFolderExcludePatternSetting = Common.Settings.Settings.instance().createRegExpSetting(\n        'workspace-folder-exclude-pattern', defaultExcludedFoldersPattern, Host.Platform.isWin() ? 'i' : '');\n\n    this.fileSystemRequestResolve = null;\n    this.fileSystemsLoadedPromise = this.requestFileSystems();\n  }\n\n  static instance(opts: {forceNew: boolean|null} = {forceNew: null}): IsolatedFileSystemManager {\n    const {forceNew} = opts;\n    if (!isolatedFileSystemManagerInstance || forceNew) {\n      isolatedFileSystemManagerInstance = new IsolatedFileSystemManager();\n    }\n\n    return isolatedFileSystemManagerInstance;\n  }\n\n  static removeInstance(): void {\n    isolatedFileSystemManagerInstance = null;\n  }\n\n  private requestFileSystems(): Promise<IsolatedFileSystem[]> {\n    const {resolve, promise} = Promise.withResolvers<IsolatedFileSystem[]>();\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.FileSystemsLoaded, onFileSystemsLoaded, this);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.requestFileSystems();\n    return promise;\n\n    function onFileSystemsLoaded(\n        this: IsolatedFileSystemManager,\n        event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.DevToolsFileSystem[]>): void {\n      const fileSystems = event.data;\n      const promises = [];\n      for (let i = 0; i < fileSystems.length; ++i) {\n        promises.push(this.#addFileSystem(fileSystems[i], false));\n      }\n      void Promise.all(promises).then(onFileSystemsAdded);\n    }\n\n    function onFileSystemsAdded(fileSystems: Array<IsolatedFileSystem|null>): void {\n      resolve(fileSystems.filter(fs => !!fs));\n    }\n  }\n\n  addFileSystem(type?: string): Promise<IsolatedFileSystem|null> {\n    Host.userMetrics.actionTaken(\n        type === 'overrides' ? Host.UserMetrics.Action.OverrideTabAddFolder :\n                               Host.UserMetrics.Action.WorkspaceTabAddFolder);\n    return new Promise(resolve => {\n      this.fileSystemRequestResolve = resolve;\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.addFileSystem(type || '');\n    });\n  }\n\n  removeFileSystem(fileSystem: PlatformFileSystem): void {\n    Host.userMetrics.actionTaken(\n        fileSystem.type() === PlatformFileSystemType.OVERRIDES ? Host.UserMetrics.Action.OverrideTabRemoveFolder :\n                                                                 Host.UserMetrics.Action.WorkspaceTabRemoveFolder);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.removeFileSystem(fileSystem.embedderPath());\n  }\n\n  waitForFileSystems(): Promise<IsolatedFileSystem[]> {\n    return this.fileSystemsLoadedPromise;\n  }\n\n  #addFileSystem(fileSystem: Host.InspectorFrontendHostAPI.DevToolsFileSystem, dispatchEvent: boolean):\n      Promise<IsolatedFileSystem|null> {\n    const embedderPath = fileSystem.fileSystemPath;\n    const fileSystemURL = Common.ParsedURL.ParsedURL.rawPathToUrlString(fileSystem.fileSystemPath);\n    const promise = IsolatedFileSystem.create(\n        this, fileSystemURL, embedderPath, hostFileSystemTypeToPlatformFileSystemType(fileSystem.type),\n        fileSystem.fileSystemName, fileSystem.rootURL, fileSystem.type === 'automatic');\n    return promise.then(storeFileSystem.bind(this));\n\n    function storeFileSystem(this: IsolatedFileSystemManager, fileSystem: IsolatedFileSystem|null): IsolatedFileSystem|\n        null {\n      if (!fileSystem) {\n        return null;\n      }\n      this.#fileSystems.set(fileSystemURL, fileSystem);\n      fileSystem.addEventListener(PlatformFileSystemEvents.FILE_SYSTEM_ERROR, this.#onFileSystemError, this);\n      if (dispatchEvent) {\n        this.dispatchEventToListeners(Events.FileSystemAdded, fileSystem);\n      }\n      return fileSystem;\n    }\n  }\n\n  addPlatformFileSystem(fileSystemURL: Platform.DevToolsPath.UrlString, fileSystem: PlatformFileSystem): void {\n    this.#fileSystems.set(fileSystemURL, fileSystem);\n    fileSystem.addEventListener(PlatformFileSystemEvents.FILE_SYSTEM_ERROR, this.#onFileSystemError, this);\n    this.dispatchEventToListeners(Events.FileSystemAdded, fileSystem);\n  }\n\n  private onFileSystemAdded(\n      event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.FileSystemAddedEvent>): void {\n    const {errorMessage, fileSystem} = event.data;\n    if (errorMessage) {\n      if (errorMessage !== '<selection cancelled>' && errorMessage !== '<permission denied>') {\n        Common.Console.Console.instance().error(i18nString(UIStrings.unableToAddFilesystemS, {PH1: errorMessage}));\n      }\n      if (!this.fileSystemRequestResolve) {\n        return;\n      }\n      this.fileSystemRequestResolve.call(null, null);\n      this.fileSystemRequestResolve = null;\n    } else if (fileSystem) {\n      void this.#addFileSystem(fileSystem, true).then(fileSystem => {\n        if (this.fileSystemRequestResolve) {\n          this.fileSystemRequestResolve.call(null, fileSystem);\n          this.fileSystemRequestResolve = null;\n        }\n      });\n    }\n  }\n\n  #onFileSystemError(event: Common.EventTarget.EventTargetEvent<string>): void {\n    this.dispatchEventToListeners(Events.FileSystemError, event.data);\n  }\n\n  private onFileSystemRemoved(event: Common.EventTarget.EventTargetEvent<Platform.DevToolsPath.RawPathString>): void {\n    const embedderPath = event.data;\n    const fileSystemPath = Common.ParsedURL.ParsedURL.rawPathToUrlString(embedderPath);\n    const isolatedFileSystem = this.#fileSystems.get(fileSystemPath);\n    if (!isolatedFileSystem) {\n      return;\n    }\n    this.#fileSystems.delete(fileSystemPath);\n    isolatedFileSystem.removeEventListener(PlatformFileSystemEvents.FILE_SYSTEM_ERROR, this.#onFileSystemError, this);\n    isolatedFileSystem.fileSystemRemoved();\n    this.dispatchEventToListeners(Events.FileSystemRemoved, isolatedFileSystem);\n  }\n\n  private onFileSystemFilesChanged(\n      event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.FilesChangedEvent>): void {\n    const urlPaths = {\n      changed: groupFilePathsIntoFileSystemPaths.call(this, event.data.changed),\n      added: groupFilePathsIntoFileSystemPaths.call(this, event.data.added),\n      removed: groupFilePathsIntoFileSystemPaths.call(this, event.data.removed),\n    };\n\n    this.dispatchEventToListeners(Events.FileSystemFilesChanged, urlPaths);\n\n    function groupFilePathsIntoFileSystemPaths(\n        this: IsolatedFileSystemManager, embedderPaths: Platform.DevToolsPath.RawPathString[]):\n        Platform.MapUtilities.Multimap<Platform.DevToolsPath.UrlString, Platform.DevToolsPath.UrlString> {\n      const paths =\n          new Platform.MapUtilities.Multimap<Platform.DevToolsPath.UrlString, Platform.DevToolsPath.UrlString>();\n      for (const embedderPath of embedderPaths) {\n        const filePath = Common.ParsedURL.ParsedURL.rawPathToUrlString(embedderPath);\n        for (const fileSystemPath of this.#fileSystems.keys()) {\n          const fileSystem = this.#fileSystems.get(fileSystemPath);\n          if (fileSystem?.isFileExcluded(Common.ParsedURL.ParsedURL.rawPathToEncodedPathString(embedderPath))) {\n            continue;\n          }\n          const pathPrefix = fileSystemPath.endsWith('/') ? fileSystemPath : fileSystemPath + '/';\n          if (!filePath.startsWith(pathPrefix)) {\n            continue;\n          }\n          paths.set(fileSystemPath, filePath);\n        }\n      }\n      return paths;\n    }\n  }\n\n  fileSystems(): PlatformFileSystem[] {\n    return [...this.#fileSystems.values()];\n  }\n\n  fileSystem(fileSystemPath: Platform.DevToolsPath.UrlString): PlatformFileSystem|null {\n    return this.#fileSystems.get(fileSystemPath) || null;\n  }\n\n  workspaceFolderExcludePatternSetting(): Common.Settings.RegExpSetting {\n    return this.#workspaceFolderExcludePatternSetting;\n  }\n\n  registerCallback(callback: (arg0: Platform.DevToolsPath.RawPathString[]) => void): number {\n    const requestId = ++lastRequestId;\n    this.callbacks.set(requestId, callback);\n    return requestId;\n  }\n\n  registerProgress(progress: Common.Progress.Progress): number {\n    const requestId = ++lastRequestId;\n    this.progresses.set(requestId, progress);\n    return requestId;\n  }\n\n  private onIndexingTotalWorkCalculated(\n      event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.IndexingTotalWorkCalculatedEvent>):\n      void {\n    const {requestId, totalWork} = event.data;\n    const progress = this.progresses.get(requestId);\n    if (!progress) {\n      return;\n    }\n    progress.totalWork = totalWork;\n  }\n\n  private onIndexingWorked(\n      event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.IndexingWorkedEvent>): void {\n    const {requestId, worked} = event.data;\n    const progress = this.progresses.get(requestId);\n    if (!progress) {\n      return;\n    }\n    progress.worked += worked;\n    if (progress.canceled) {\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.stopIndexing(requestId);\n      this.onIndexingDone(event);\n    }\n  }\n\n  private onIndexingDone(event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.IndexingEvent>):\n      void {\n    const {requestId} = event.data;\n    const progress = this.progresses.get(requestId);\n    if (!progress) {\n      return;\n    }\n    progress.done = true;\n    this.progresses.delete(requestId);\n  }\n\n  private onSearchCompleted(\n      event: Common.EventTarget.EventTargetEvent<Host.InspectorFrontendHostAPI.SearchCompletedEvent>): void {\n    const {requestId, files} = event.data;\n    const callback = this.callbacks.get(requestId);\n    if (!callback) {\n      return;\n    }\n    callback.call(null, files);\n    this.callbacks.delete(requestId);\n  }\n}\n\nexport enum Events {\n  /* eslint-disable @typescript-eslint/naming-convention -- Used by web_tests. */\n  FileSystemAdded = 'FileSystemAdded',\n  FileSystemRemoved = 'FileSystemRemoved',\n  FileSystemFilesChanged = 'FileSystemFilesChanged',\n  ExcludedFolderAdded = 'ExcludedFolderAdded',\n  ExcludedFolderRemoved = 'ExcludedFolderRemoved',\n  FileSystemError = 'FileSystemError',\n  /* eslint-enable @typescript-eslint/naming-convention */\n}\n\nexport interface EventTypes {\n  [Events.FileSystemAdded]: PlatformFileSystem;\n  [Events.FileSystemRemoved]: PlatformFileSystem;\n  [Events.FileSystemFilesChanged]: FilesChangedData;\n  [Events.ExcludedFolderAdded]: Platform.DevToolsPath.EncodedPathString;\n  [Events.ExcludedFolderRemoved]: Platform.DevToolsPath.EncodedPathString;\n  [Events.FileSystemError]: string;\n}\n\nlet lastRequestId = 0;\n\nfunction hostFileSystemTypeToPlatformFileSystemType(type: string): PlatformFileSystemType {\n  switch (type) {\n    case 'snippets':\n      return PlatformFileSystemType.SNIPPETS;\n    case 'overrides':\n      return PlatformFileSystemType.OVERRIDES;\n    default:\n      return PlatformFileSystemType.WORKSPACE_PROJECT;\n  }\n}\n"]}