{"version":3,"file":"AiAssistancePanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/AiAssistancePanel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/kit/kit.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as AiAssistanceModel from '../../models/ai_assistance/ai_assistance.js';\nimport * as Annotations from '../../models/annotations/annotations.js';\nimport * as Badges from '../../models/badges/badges.js';\nimport * as GreenDev from '../../models/greendev/greendev.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as Snackbars from '../../ui/components/snackbars/snackbars.js';\nimport * as UIHelpers from '../../ui/helpers/helpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as NetworkForward from '../network/forward/forward.js';\nimport * as NetworkPanel from '../network/network.js';\nimport * as TimelinePanel from '../timeline/timeline.js';\n\nimport aiAssistancePanelStyles from './aiAssistancePanel.css.js';\nimport {ArtifactsViewer} from './components/ArtifactsViewer.js';\nimport {\n  type AnswerPart,\n  type ChatMessage,\n  ChatMessageEntity,\n  ChatView,\n  type ImageInputData,\n  type ModelChatMessage,\n  type Props as ChatViewProps,\n  type Step\n} from './components/ChatView.js';\nimport {DisabledWidget} from './components/DisabledWidget.js';\nimport {ExploreWidget} from './components/ExploreWidget.js';\nimport {MarkdownRendererWithCodeBlock} from './components/MarkdownRendererWithCodeBlock.js';\nimport {PerformanceAgentMarkdownRenderer} from './components/PerformanceAgentMarkdownRenderer.js';\nimport {isAiAssistancePatchingEnabled} from './PatchWidget.js';\n\nconst {html} = Lit;\n\nconst AI_ASSISTANCE_SEND_FEEDBACK = 'https://crbug.com/364805393' as Platform.DevToolsPath.UrlString;\nconst AI_ASSISTANCE_HELP = 'https://developer.chrome.com/docs/devtools/ai-assistance';\nconst SCREENSHOT_QUALITY = 100;\nconst SHOW_LOADING_STATE_TIMEOUT = 100;\nconst JPEG_MIME_TYPE = 'image/jpeg';\n\nconst UIStrings = {\n  /**\n   * @description AI assistance UI text creating a new chat.\n   */\n  newChat: 'New chat',\n  /**\n   * @description AI assistance UI tooltip text for the help button.\n   */\n  help: 'Help',\n  /**\n   * @description AI assistant UI tooltip text for the settings button (gear icon).\n   */\n  settings: 'Settings',\n  /**\n   * @description AI assistant UI tooltip sending feedback.\n   */\n  sendFeedback: 'Send feedback',\n  /**\n   * @description Announcement text for screen readers when a new chat is created.\n   */\n  newChatCreated: 'New chat created',\n  /**\n   * @description Announcement text for screen readers when the chat is deleted.\n   */\n  chatDeleted: 'Chat deleted',\n  /**\n   * @description AI assistance UI text creating selecting a history entry.\n   */\n  history: 'History',\n  /**\n   * @description AI assistance UI text deleting the current chat session from local history.\n   */\n  deleteChat: 'Delete local chat',\n  /**\n   * @description AI assistance UI text that deletes all local history entries.\n   */\n  clearChatHistory: 'Clear local chats',\n  /**\n   *@description AI assistance UI text for the export conversation button.\n   */\n  exportConversation: 'Export conversation',\n  /**\n   * @description AI assistance UI text explains that he user had no pas conversations.\n   */\n  noPastConversations: 'No past conversations',\n  /**\n   * @description Placeholder text for an inactive text field. When active, it's used for the user's input to the GenAI assistance.\n   */\n  followTheSteps: 'Follow the steps above to ask a question',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForEmptyState: 'This is an experimental AI feature and won\\'t always get it right.',\n  /**\n   * @description The message shown in a toast when the response is copied to the clipboard.\n   */\n  responseCopiedToClipboard: 'Response copied to clipboard',\n} as const;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   * @description Announcement text for screen readers when the conversation starts.\n   */\n  answerLoading: 'Answer loading',\n  /**\n   * @description Announcement text for screen readers when the answer comes.\n   */\n  answerReady: 'Answer ready',\n  /**\n   * @description Placeholder text for the input shown when the conversation is blocked because a cross-origin context was selected.\n   */\n  crossOriginError: 'To talk about data from another origin, start a new chat',\n  /**\n   * @description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForStyling: 'Ask a question about the selected element',\n  /**\n   * @description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForNetwork: 'Ask a question about the selected network request',\n  /**\n   * @description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForFile: 'Ask a question about the selected file',\n  /**\n   * @description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformanceWithNoRecording: 'Record a performance trace and select an item to ask a question',\n  /**\n   * @description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForStylingNoContext: 'Select an element to ask a question',\n  /**\n   * @description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForNetworkNoContext: 'Select a network request to ask a question',\n  /**\n   * @description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForFileNoContext: 'Select a file to ask a question',\n  /**\n   * @description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformanceTrace: 'Ask a question about the selected performance trace',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformanceTraceNoContext: 'Record or select a performance trace to ask a question',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForStyling:\n      'Chat messages and any data the inspected page can access via Web APIs are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForStylingEnterpriseNoLogging:\n      'Chat messages and any data the inspected page can access via Web APIs are sent to Google. The content you submit and that is generated by this feature will not be used to improve Googles AI models. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForNetwork:\n      'Chat messages and the selected network request are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForNetworkEnterpriseNoLogging:\n      'Chat messages and the selected network request are sent to Google. The content you submit and that is generated by this feature will not be used to improve Googles AI models. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForFile:\n      'Chat messages and the selected file are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForFileEnterpriseNoLogging:\n      'Chat messages and the selected file are sent to Google. The content you submit and that is generated by this feature will not be used to improve Googles AI models. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForPerformance:\n      'Chat messages and trace data from your performance trace are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n  /**\n   * @description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForPerformanceEnterpriseNoLogging:\n      'Chat messages and data from your performance trace are sent to Google. The content you submit and that is generated by this feature will not be used to improve Googles AI models. This is an experimental AI feature and wont always get it right.',\n  /**\n   * @description Message displayed in toast in case of any failures while taking a screenshot of the page.\n   */\n  screenshotFailureMessage: 'Failed to take a screenshot. Please try again.',\n  /**\n   * @description Message displayed in toast in case of any failures while uploading an image file as input.\n   */\n  uploadImageFailureMessage: 'Failed to upload image. Please try again.',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/ai_assistance/AiAssistancePanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\n\nfunction selectedElementFilter(maybeNode: SDK.DOMModel.DOMNode|null): SDK.DOMModel.DOMNode|null {\n  if (maybeNode) {\n    return maybeNode.nodeType() === Node.ELEMENT_NODE ? maybeNode : null;\n  }\n\n  return null;\n}\n\nasync function getEmptyStateSuggestions(conversation?: AiAssistanceModel.AiConversation.AiConversation):\n    Promise<AiAssistanceModel.AiAgent.ConversationSuggestion[]> {\n  const context = conversation?.selectedContext;\n\n  if (context) {\n    const specialSuggestions = await context.getSuggestions();\n\n    if (specialSuggestions) {\n      return specialSuggestions;\n    }\n  }\n\n  if (!conversation?.type || conversation.isReadOnly) {\n    return [];\n  }\n\n  switch (conversation.type) {\n    case AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING:\n      return [\n        {title: 'What can you help me with?', jslogContext: 'styling-default'},\n        {title: 'Why isnt this element visible?', jslogContext: 'styling-default'},\n        {title: 'How do I center this element?', jslogContext: 'styling-default'},\n      ];\n    case AiAssistanceModel.AiHistoryStorage.ConversationType.FILE:\n      return [\n        {title: 'What does this script do?', jslogContext: 'file-default'},\n        {title: 'Is the script optimized for performance?', jslogContext: 'file-default'},\n        {title: 'Does the script handle user input safely?', jslogContext: 'file-default'},\n      ];\n    case AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK:\n      return [\n        {title: 'Why is this network request taking so long?', jslogContext: 'network-default'},\n        {title: 'Are there any security headers present?', jslogContext: 'network-default'},\n        {title: 'Why is the request failing?', jslogContext: 'network-default'},\n      ];\n    case AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE: {\n      return [\n        {title: 'What performance issues exist with my page?', jslogContext: 'performance-default'},\n      ];\n    }\n\n    default:\n      Platform.assertNever(conversation.type, 'Unknown conversation type');\n  }\n}\n\nfunction getMarkdownRenderer(conversation?: AiAssistanceModel.AiConversation.AiConversation):\n    MarkdownRendererWithCodeBlock {\n  const context = conversation?.selectedContext;\n\n  if (context instanceof AiAssistanceModel.PerformanceAgent.PerformanceTraceContext) {\n    if (!context.external) {\n      const focus = context.getItem();\n      return new PerformanceAgentMarkdownRenderer(\n          focus.parsedTrace.data.Meta.mainFrameId, focus.lookupEvent.bind(focus), focus.parsedTrace);\n    }\n  } else if (conversation?.type === AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE) {\n    // Handle historical conversations (can't linkify anything).\n    return new PerformanceAgentMarkdownRenderer();\n  }\n\n  return new MarkdownRendererWithCodeBlock();\n}\n\ninterface ToolbarViewInput {\n  onNewChatClick: () => void;\n  populateHistoryMenu: (contextMenu: UI.ContextMenu.ContextMenu) => void;\n  onDeleteClick: () => void;\n  onExportConversationClick: () => void;\n  onHelpClick: () => void;\n  onSettingsClick: () => void;\n  onArtifactsSidebarToggle: () => void;\n  artifactsSidebarVisible: boolean;\n  isLoading: boolean;\n  showChatActions: boolean;\n  showActiveConversationActions: boolean;\n}\n\nexport const enum ViewState {\n  DISABLED_VIEW = 'disabled-view',\n  CHAT_VIEW = 'chat-view',\n  EXPLORE_VIEW = 'explore-view'\n}\n\ntype PanelViewInput = {\n  state: ViewState.CHAT_VIEW,\n  props: ChatViewProps,\n}|{\n  state: ViewState.DISABLED_VIEW,\n  props: {aidaAvailability: Host.AidaClient.AidaAccessPreconditions},\n}|{\n  state: ViewState.EXPLORE_VIEW,\n};\n\nexport type ViewInput = ToolbarViewInput&PanelViewInput;\nexport interface PanelViewOutput {\n  chatView?: ChatView;\n}\n\ntype View = (input: ViewInput, output: PanelViewOutput, target: HTMLElement) => void;\n\nfunction toolbarView(input: ToolbarViewInput): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"toolbar-container\" role=\"toolbar\" jslog=${VisualLogging.toolbar()}>\n      <devtools-toolbar class=\"freestyler-left-toolbar\" role=\"presentation\">\n      ${input.showChatActions\n        ? html`<devtools-button\n          title=${i18nString(UIStrings.newChat)}\n          aria-label=${i18nString(UIStrings.newChat)}\n          .iconName=${'plus'}\n          .jslogContext=${'freestyler.new-chat'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onNewChatClick}></devtools-button>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-menu-button\n          title=${i18nString(UIStrings.history)}\n          aria-label=${i18nString(UIStrings.history)}\n          .iconName=${'history'}\n          .jslogContext=${'freestyler.history'}\n          .populateMenuCall=${input.populateHistoryMenu}\n        ></devtools-menu-button>`\n          : Lit.nothing}\n        ${input.showActiveConversationActions ? html`\n          <devtools-button\n              title=${i18nString(UIStrings.deleteChat)}\n              aria-label=${i18nString(UIStrings.deleteChat)}\n              .iconName=${'bin'}\n              .jslogContext=${'freestyler.delete'}\n              .variant=${Buttons.Button.Variant.TOOLBAR}\n              @click=${input.onDeleteClick}>\n          </devtools-button>\n          <devtools-button\n            title=${i18nString(UIStrings.exportConversation)}\n            aria-label=${i18nString(UIStrings.exportConversation)}\n            .iconName=${'download'}\n            .disabled=${input.isLoading}\n            .jslogContext=${'export-ai-conversation'}\n            .variant=${Buttons.Button.Variant.TOOLBAR}\n            @click=${input.onExportConversationClick}>\n          </devtools-button>`\n           : Lit.nothing}\n      </devtools-toolbar>\n      <devtools-toolbar class=\"freestyler-right-toolbar\" role=\"presentation\">\n        <devtools-link\n          class=\"toolbar-feedback-link\"\n          title=${i18nString(UIStrings.sendFeedback)}\n          href=${AI_ASSISTANCE_SEND_FEEDBACK}\n          jslogcontext=${'freestyler.send-feedback'}\n        >${i18nString(UIStrings.sendFeedback)}</devtools-link>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-button\n          title=${i18nString(UIStrings.help)}\n          aria-label=${i18nString(UIStrings.help)}\n          .iconName=${'help'}\n          .jslogContext=${'freestyler.help'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onHelpClick}></devtools-button>\n        <devtools-button\n          title=${i18nString(UIStrings.settings)}\n          aria-label=${i18nString(UIStrings.settings)}\n          .iconName=${'gear'}\n          .jslogContext=${'freestyler.settings'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onSettingsClick}></devtools-button>\n        <!-- If the green experiment is enabled, render the artifacts sidebar toggle button -->\n        ${GreenDev.Prototypes.instance().isEnabled('artifactViewer') ? html`<devtools-button\n          title=${i18nString(UIStrings.settings)}\n          aria-label=${i18nString(UIStrings.settings)}\n          .iconName=${input.artifactsSidebarVisible ? 'left-panel-open' : 'left-panel-close'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onArtifactsSidebarToggle}></devtools-button>` : Lit.nothing}\n      </devtools-toolbar>\n    </div>\n  `;\n  // clang-format on\n}\n\nfunction defaultView(input: ViewInput, output: PanelViewOutput, target: HTMLElement): void {\n  // clang-format off\n  function renderState(): Lit.TemplateResult {\n    switch (input.state) {\n      case ViewState.CHAT_VIEW: {\n      return html`\n        <devtools-ai-chat-view\n          .props=${input.props}\n          ${Lit.Directives.ref((el: Element | undefined) => {\n            if (!el || !(el instanceof ChatView)) {\n              return;\n            }\n\n            output.chatView = el;\n          })}\n        ></devtools-ai-chat-view>`;\n      }\n      case ViewState.EXPLORE_VIEW:\n        return html`<devtools-widget\n          class=\"fill-panel\"\n          .widgetConfig=${UI.Widget.widgetConfig(ExploreWidget)}\n        ></devtools-widget>`;\n\n      case ViewState.DISABLED_VIEW:\n        return html`<devtools-widget\n          class=\"fill-panel\"\n          .widgetConfig=${UI.Widget.widgetConfig(DisabledWidget, input.props)}\n        ></devtools-widget>`;\n    }\n  }\n\n  const panelWithToolbar = html`\n    ${toolbarView(input)}\n    <div class=\"ai-assistance-view-container\">${renderState()}</div>`;\n\n  // If the green experiment is enabled, render the chat view inside\n  // a split view to also have an artifacts viewer sidebar.\n  if(GreenDev.Prototypes.instance().isEnabled('artifactViewer')) {\n    Lit.render(\n      html`\n        <devtools-split-view\n          direction=\"column\"\n          sidebar-visibility=${input.artifactsSidebarVisible ? 'visible' : 'hidden'}\n          sidebar-position=\"second\"\n          sidebar-initial-size=\"520\"\n          style=\"width: 100%;\">\n          <div slot=\"main\" class=\"assistance-view-wrapper-with-sidebar\">\n            ${panelWithToolbar}\n          </div>\n          <div slot=\"sidebar\">\n            <div class=\"artifacts-toolbar-container\" role=\"toolbar\">\n              <div>Artifacts Viewer</div>\n            </div>\n            <devtools-widget\n              class=\"fill-panel\"\n              .widgetConfig=${UI.Widget.widgetConfig(ArtifactsViewer)}\n            ></devtools-widget>\n          </div>\n        </devtools-split-view>\n      `,\n      target\n    );\n  } else {\n    Lit.render(panelWithToolbar, target);\n  }\n  // clang-format on\n}\n\nfunction createNodeContext(node: SDK.DOMModel.DOMNode|null): AiAssistanceModel.StylingAgent.NodeContext|null {\n  if (!node) {\n    return null;\n  }\n  return new AiAssistanceModel.StylingAgent.NodeContext(node);\n}\n\nfunction createFileContext(file: Workspace.UISourceCode.UISourceCode|null): AiAssistanceModel.FileAgent.FileContext|\n    null {\n  if (!file) {\n    return null;\n  }\n  return new AiAssistanceModel.FileAgent.FileContext(file);\n}\n\nfunction createRequestContext(request: SDK.NetworkRequest.NetworkRequest|null):\n    AiAssistanceModel.NetworkAgent.RequestContext|null {\n  if (!request) {\n    return null;\n  }\n  const calculator = NetworkPanel.NetworkPanel.NetworkPanel.instance().networkLogView.timeCalculator();\n  return new AiAssistanceModel.NetworkAgent.RequestContext(request, calculator);\n}\n\nfunction createPerformanceTraceContext(focus: AiAssistanceModel.AIContext.AgentFocus|null):\n    AiAssistanceModel.PerformanceAgent.PerformanceTraceContext|null {\n  if (!focus) {\n    return null;\n  }\n  return new AiAssistanceModel.PerformanceAgent.PerformanceTraceContext(focus);\n}\n\nlet panelInstance: AiAssistancePanel;\nexport class AiAssistancePanel extends UI.Panel.Panel {\n  static panelName = 'freestyler';\n\n  // NodeJS debugging does not have Elements panel, thus this action might not exist.\n  #toggleSearchElementAction?: UI.ActionRegistration.Action;\n  #aidaClient: Host.AidaClient.AidaClient;\n  #viewOutput: PanelViewOutput = {};\n  #serverSideLoggingEnabled = isAiAssistanceServerSideLoggingEnabled();\n  #aiAssistanceEnabledSetting: Common.Settings.Setting<boolean>|undefined;\n  #changeManager = new AiAssistanceModel.ChangeManager.ChangeManager();\n  #mutex = new Common.Mutex.Mutex();\n\n  #conversation?: AiAssistanceModel.AiConversation.AiConversation;\n\n  #selectedFile: AiAssistanceModel.FileAgent.FileContext|null = null;\n  #selectedElement: AiAssistanceModel.StylingAgent.NodeContext|null = null;\n  #selectedPerformanceTrace: AiAssistanceModel.PerformanceAgent.PerformanceTraceContext|null = null;\n  #selectedRequest: AiAssistanceModel.NetworkAgent.RequestContext|null = null;\n  #isArtifactsSidebarOpen = false;\n  // Messages displayed in the `ChatView` component.\n  #messages: ChatMessage[] = [];\n\n  // Whether the UI should show loading or not.\n  #isLoading = false;\n  // Stores the availability status of the `AidaClient` and the reason for unavailability, if any.\n  #aidaAvailability: Host.AidaClient.AidaAccessPreconditions;\n  // Info of the currently logged in user.\n  #userInfo: {\n    accountImage?: string,\n    accountFullName?: string,\n  };\n  #imageInput?: ImageInputData;\n  // Used to disable send button when there is not text input.\n  #isTextInputEmpty = true;\n  #timelinePanelInstance: TimelinePanel.TimelinePanel.TimelinePanel|null = null;\n  #runAbortController = new AbortController();\n  #additionalContextItemsFromFloaty: UI.Floaty.FloatyContextSelection[] = [];\n\n  constructor(private view: View = defaultView, {aidaClient, aidaAvailability, syncInfo}: {\n    aidaClient: Host.AidaClient.AidaClient,\n    aidaAvailability: Host.AidaClient.AidaAccessPreconditions,\n    syncInfo: Host.InspectorFrontendHostAPI.SyncInformation,\n  }) {\n    super(AiAssistancePanel.panelName);\n    this.registerRequiredCSS(aiAssistancePanelStyles);\n    this.#aiAssistanceEnabledSetting = this.#getAiAssistanceEnabledSetting();\n\n    this.#aidaClient = aidaClient;\n    this.#aidaAvailability = aidaAvailability;\n    this.#userInfo = {\n      accountImage: syncInfo.accountImage,\n      accountFullName: syncInfo.accountFullName,\n    };\n\n    if (UI.ActionRegistry.ActionRegistry.instance().hasAction('elements.toggle-element-search')) {\n      this.#toggleSearchElementAction =\n          UI.ActionRegistry.ActionRegistry.instance().getAction('elements.toggle-element-search');\n    }\n    AiAssistanceModel.AiHistoryStorage.AiHistoryStorage.instance().addEventListener(\n        AiAssistanceModel.AiHistoryStorage.Events.HISTORY_DELETED, this.#onHistoryDeleted, this);\n    if (GreenDev.Prototypes.instance().isEnabled('artifactViewer')) {\n      AiAssistanceModel.ArtifactsManager.ArtifactsManager.instance().addEventListener(\n          AiAssistanceModel.ArtifactsManager.ArtifactAddedEvent.eventName, this.#onArtifactAdded.bind(this));\n    }\n  }\n\n  async #getPanelViewInput(): Promise<PanelViewInput> {\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n\n    if (this.#aidaAvailability !== Host.AidaClient.AidaAccessPreconditions.AVAILABLE ||\n        !this.#aiAssistanceEnabledSetting?.getIfNotDisabled() || blockedByAge) {\n      return {\n        state: ViewState.DISABLED_VIEW,\n        props: {\n          aidaAvailability: this.#aidaAvailability,\n        },\n      };\n    }\n\n    if (this.#conversation) {\n      const emptyStateSuggestions = await getEmptyStateSuggestions(this.#conversation);\n      const markdownRenderer = getMarkdownRenderer(this.#conversation);\n      return {\n        state: ViewState.CHAT_VIEW,\n        props: {\n          additionalFloatyContext: this.#additionalContextItemsFromFloaty,\n          blockedByCrossOrigin: this.#conversation.isBlockedByOrigin,\n          isLoading: this.#isLoading,\n          messages: this.#messages,\n          selectedContext: this.#conversation.selectedContext ?? null,\n          conversationType: this.#conversation.type,\n          isReadOnly: this.#conversation.isReadOnly ?? false,\n          changeSummary: this.#getChangeSummary(),\n          inspectElementToggled: this.#toggleSearchElementAction?.toggled() ?? false,\n          userInfo: this.#userInfo,\n          canShowFeedbackForm: this.#serverSideLoggingEnabled,\n          multimodalInputEnabled: isAiAssistanceMultimodalInputEnabled() &&\n              this.#conversation.type === AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING,\n          imageInput: this.#imageInput,\n          isTextInputDisabled: this.#isTextInputDisabled(),\n          emptyStateSuggestions,\n          inputPlaceholder: this.#getChatInputPlaceholder(),\n          disclaimerText: this.#getDisclaimerText(),\n          isTextInputEmpty: this.#isTextInputEmpty,\n          changeManager: this.#changeManager,\n          uploadImageInputEnabled: isAiAssistanceMultimodalUploadInputEnabled() &&\n              this.#conversation.type === AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING,\n          markdownRenderer,\n          isArtifactsSidebarOpen: this.#isArtifactsSidebarOpen,\n          onTextSubmit: async (\n              text: string, imageInput?: Host.AidaClient.Part,\n              multimodalInputType?: AiAssistanceModel.AiAgent.MultimodalInputType) => {\n            this.#imageInput = undefined;\n            this.#isTextInputEmpty = true;\n            Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceQuerySubmitted);\n            await this.#startConversation(text, imageInput, multimodalInputType);\n          },\n          onInspectElementClick: this.#handleSelectElementClick.bind(this),\n          onFeedbackSubmit: this.#handleFeedbackSubmit.bind(this),\n          onCancelClick: this.#cancel.bind(this),\n          onContextClick: this.#handleContextClick.bind(this),\n          onNewConversation: this.#handleNewChatRequest.bind(this),\n          onTakeScreenshot: isAiAssistanceMultimodalInputEnabled() ? this.#handleTakeScreenshot.bind(this) : undefined,\n          onRemoveImageInput: isAiAssistanceMultimodalInputEnabled() ? this.#handleRemoveImageInput.bind(this) :\n                                                                       undefined,\n          onCopyResponseClick: this.#onCopyResponseClick.bind(this),\n          onTextInputChange: this.#handleTextInputChange.bind(this),\n          onLoadImage: isAiAssistanceMultimodalUploadInputEnabled() ? this.#handleLoadImage.bind(this) : undefined,\n        }\n      };\n    }\n\n    return {\n      state: ViewState.EXPLORE_VIEW,\n    };\n  }\n\n  #getAiAssistanceEnabledSetting(): Common.Settings.Setting<boolean>|undefined {\n    try {\n      return Common.Settings.moduleSetting('ai-assistance-enabled') as Common.Settings.Setting<boolean>;\n    } catch {\n      return;\n    }\n  }\n\n  static async instance(opts: {\n    forceNew: boolean|null,\n  }|undefined = {forceNew: null}): Promise<AiAssistancePanel> {\n    const {forceNew} = opts;\n    if (!panelInstance || forceNew) {\n      const aidaClient = new Host.AidaClient.AidaClient();\n      const syncInfoPromise = new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      const [aidaAvailability, syncInfo] =\n          await Promise.all([Host.AidaClient.AidaClient.checkAccessPreconditions(), syncInfoPromise]);\n      panelInstance = new AiAssistancePanel(defaultView, {aidaClient, aidaAvailability, syncInfo});\n    }\n\n    return panelInstance;\n  }\n\n  /**\n   * Called when the TimelinePanel instance changes. We use this to listen to\n   * the status of if the user is viewing a trace or not, and update the\n   * placeholder text in the panel accordingly. We do this because if the user\n   * has an active trace, we show different text than if they are viewing\n   * the performance panel but have no trace imported.\n   */\n  #bindTimelineTraceListener(): void {\n    const timelinePanel = UI.Context.Context.instance().flavor(TimelinePanel.TimelinePanel.TimelinePanel);\n\n    // Avoid binding multiple times.\n    if (timelinePanel === this.#timelinePanelInstance) {\n      return;\n    }\n\n    // Ensure we clear up any listener from the old TimelinePanel instance.\n    this.#timelinePanelInstance?.removeEventListener(\n        TimelinePanel.TimelinePanel.Events.IS_VIEWING_TRACE, this.requestUpdate, this);\n    this.#timelinePanelInstance = timelinePanel;\n\n    if (this.#timelinePanelInstance) {\n      this.#timelinePanelInstance.addEventListener(\n          TimelinePanel.TimelinePanel.Events.IS_VIEWING_TRACE, this.requestUpdate, this);\n    }\n  }\n\n  #bindFloatyListener(): void {\n    const additionalContexts = UI.Context.Context.instance().flavor(UI.Floaty.FloatyFlavor);\n    if (!additionalContexts) {\n      return;\n    }\n    this.#additionalContextItemsFromFloaty = additionalContexts.selectedContexts;\n    this.requestUpdate();\n  }\n\n  #getDefaultConversationType(): AiAssistanceModel.AiHistoryStorage.ConversationType|undefined {\n    const {hostConfig} = Root.Runtime;\n    const viewManager = UI.ViewManager.ViewManager.instance();\n    const isElementsPanelVisible = viewManager.isViewVisible('elements');\n    const isNetworkPanelVisible = viewManager.isViewVisible('network');\n    const isSourcesPanelVisible = viewManager.isViewVisible('sources');\n    const isPerformancePanelVisible = viewManager.isViewVisible('timeline');\n\n    let targetConversationType: AiAssistanceModel.AiHistoryStorage.ConversationType|undefined;\n    if (isElementsPanelVisible && hostConfig.devToolsFreestyler?.enabled) {\n      targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING;\n    } else if (isNetworkPanelVisible && hostConfig.devToolsAiAssistanceNetworkAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK;\n    } else if (isSourcesPanelVisible && hostConfig.devToolsAiAssistanceFileAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.FILE;\n    } else if (isPerformancePanelVisible && hostConfig.devToolsAiAssistancePerformanceAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE;\n    }\n\n    return targetConversationType;\n  }\n\n  // We select the default agent based on the open panels if\n  // there isn't any active conversation.\n  #selectDefaultAgentIfNeeded(): void {\n    // If there already is an agent and if it is not empty,\n    // we don't automatically change the agent. In addition to this,\n    // we don't change the current agent when there is a message in flight.\n    if ((this.#conversation && !this.#conversation.isEmpty) || this.#isLoading) {\n      return;\n    }\n    const targetConversationType = this.#getDefaultConversationType();\n    if (this.#conversation?.type === targetConversationType) {\n      // The above if makes sure even if we have an active agent it's empty\n      // So we can just reuse it\n      return;\n    }\n    const conversation = targetConversationType ?\n        new AiAssistanceModel.AiConversation.AiConversation(\n            targetConversationType, [], undefined, false, this.#aidaClient, this.#changeManager) :\n        undefined;\n    this.#updateConversationState(conversation);\n  }\n\n  #updateConversationState(\n      conversation?: AiAssistanceModel.AiConversation.AiConversation,\n      ): void {\n    if (this.#conversation !== conversation) {\n      // Cancel any previous conversation\n      this.#cancel();\n      this.#messages = [];\n      this.#isLoading = false;\n      this.#conversation?.archiveConversation();\n\n      if (!conversation) {\n        const conversationType = this.#getDefaultConversationType();\n        if (conversationType) {\n          conversation = new AiAssistanceModel.AiConversation.AiConversation(\n              conversationType, [], undefined, false, this.#aidaClient, this.#changeManager);\n        }\n      }\n\n      this.#conversation = conversation;\n    }\n\n    this.#conversation?.setContext(this.#getConversationContext(this.#conversation));\n\n    this.requestUpdate();\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#viewOutput.chatView?.restoreScrollPosition();\n    this.#viewOutput.chatView?.focusTextInput();\n    void this.#handleAidaAvailabilityChange();\n    this.#selectedElement =\n        createNodeContext(selectedElementFilter(UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode)));\n    this.#selectedRequest =\n        createRequestContext(UI.Context.Context.instance().flavor(SDK.NetworkRequest.NetworkRequest));\n    this.#selectedPerformanceTrace =\n        createPerformanceTraceContext(UI.Context.Context.instance().flavor(AiAssistanceModel.AIContext.AgentFocus));\n    this.#selectedFile = createFileContext(UI.Context.Context.instance().flavor(Workspace.UISourceCode.UISourceCode));\n    this.#updateConversationState(this.#conversation);\n\n    this.#aiAssistanceEnabledSetting?.addChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction?.addEventListener(UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        AiAssistanceModel.AIContext.AgentFocus, this.#handlePerformanceTraceFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n\n    UI.ViewManager.ViewManager.instance().addEventListener(\n        UI.ViewManager.Events.VIEW_VISIBILITY_CHANGED, this.#selectDefaultAgentIfNeeded, this);\n\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrModified, this.#handleDOMNodeAttrChange, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrRemoved, this.#handleDOMNodeAttrChange, this);\n\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ResourceTreeModel.ResourceTreeModel, SDK.ResourceTreeModel.Events.PrimaryPageChanged,\n        this.#onPrimaryPageChanged, this);\n\n    // Listen to changes in the Timeline Panel state. We also call the\n    // function immediately in case the Performance panel is already shown\n    // when AI Assistance is loaded.\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#bindTimelineTraceListener, this);\n    this.#bindTimelineTraceListener();\n    this.#selectDefaultAgentIfNeeded();\n\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistancePanelOpened);\n\n    if (GreenDev.Prototypes.instance().isEnabled('inDevToolsFloaty')) {\n      UI.Context.Context.instance().addFlavorChangeListener(UI.Floaty.FloatyFlavor, this.#bindFloatyListener, this);\n      this.#bindFloatyListener();\n    }\n  }\n\n  #onArtifactAdded(): void {\n    if (AiAssistanceModel.ArtifactsManager.ArtifactsManager.instance().artifacts.length > 0) {\n      this.#isArtifactsSidebarOpen = true;\n      this.requestUpdate();\n    }\n  }\n\n  override willHide(): void {\n    super.willHide();\n    this.#aiAssistanceEnabledSetting?.removeChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction?.removeEventListener(\n        UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        AiAssistanceModel.AIContext.AgentFocus, this.#handlePerformanceTraceFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    UI.ViewManager.ViewManager.instance().removeEventListener(\n        UI.ViewManager.Events.VIEW_VISIBILITY_CHANGED, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#bindTimelineTraceListener, this);\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrModified,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrRemoved,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.ResourceTreeModel.ResourceTreeModel, SDK.ResourceTreeModel.Events.PrimaryPageChanged,\n        this.#onPrimaryPageChanged, this);\n\n    if (this.#timelinePanelInstance) {\n      this.#timelinePanelInstance.removeEventListener(\n          TimelinePanel.TimelinePanel.Events.IS_VIEWING_TRACE, this.requestUpdate, this);\n      this.#timelinePanelInstance = null;\n    }\n  }\n\n  #handleAidaAvailabilityChange = async(): Promise<void> => {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaAvailability) {\n      this.#aidaAvailability = currentAidaAvailability;\n      const syncInfo = await new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      this.#userInfo = {\n        accountImage: syncInfo.accountImage,\n        accountFullName: syncInfo.accountFullName,\n      };\n      this.requestUpdate();\n    }\n  };\n\n  #handleDOMNodeFlavorChange = (ev: Common.EventTarget.EventTargetEvent<SDK.DOMModel.DOMNode>): void => {\n    if (this.#selectedElement?.getItem() === ev.data) {\n      return;\n    }\n\n    this.#selectedElement = createNodeContext(selectedElementFilter(ev.data));\n    this.#updateConversationState(this.#conversation);\n  };\n\n  #handleDOMNodeAttrChange =\n      (ev: Common.EventTarget.EventTargetEvent<{node: SDK.DOMModel.DOMNode, name: string}>): void => {\n        if (this.#selectedElement?.getItem() === ev.data.node) {\n          if (ev.data.name === 'class' || ev.data.name === 'id') {\n            this.requestUpdate();\n          }\n        }\n      };\n\n  #handleNetworkRequestFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<SDK.NetworkRequest.NetworkRequest>): void => {\n        if (this.#selectedRequest?.getItem() === ev.data) {\n          return;\n        }\n\n        if (Boolean(ev.data)) {\n          const calculator = NetworkPanel.NetworkPanel.NetworkPanel.instance().networkLogView.timeCalculator();\n          this.#selectedRequest = new AiAssistanceModel.NetworkAgent.RequestContext(ev.data, calculator);\n        } else {\n          this.#selectedRequest = null;\n        }\n        this.#updateConversationState(this.#conversation);\n      };\n\n  #handlePerformanceTraceFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<AiAssistanceModel.AIContext.AgentFocus>): void => {\n        if (this.#selectedPerformanceTrace?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedPerformanceTrace =\n            Boolean(ev.data) ? new AiAssistanceModel.PerformanceAgent.PerformanceTraceContext(ev.data) : null;\n\n        this.#updateConversationState(this.#conversation);\n      };\n\n  #handleUISourceCodeFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.UISourceCode>): void => {\n        const newFile = ev.data;\n\n        if (!newFile || this.#selectedFile?.getItem() === newFile) {\n          return;\n        }\n        this.#selectedFile = new AiAssistanceModel.FileAgent.FileContext(ev.data);\n        this.#updateConversationState(this.#conversation);\n      };\n\n  #onPrimaryPageChanged(): void {\n    if (!this.#imageInput) {\n      return;\n    }\n\n    this.#imageInput = undefined;\n    this.requestUpdate();\n  }\n\n  #getChangeSummary(): string|undefined {\n    if (!isAiAssistancePatchingEnabled() || !this.#conversation || this.#conversation?.isReadOnly) {\n      return;\n    }\n\n    return this.#changeManager.formatChangesForPatching(this.#conversation.id, /* includeSourceLocation= */ true);\n  }\n\n  #getToolbarInput(): ToolbarViewInput {\n    return {\n      isLoading: this.#isLoading,\n      showChatActions: this.#shouldShowChatActions(),\n      showActiveConversationActions: Boolean(this.#conversation && !this.#conversation.isEmpty),\n      onNewChatClick: this.#handleNewChatRequest.bind(this),\n      populateHistoryMenu: this.#populateHistoryMenu.bind(this),\n      onDeleteClick: this.#onDeleteClicked.bind(this),\n      onExportConversationClick: this.#onExportConversationClick.bind(this),\n      onHelpClick: () => {\n        UIHelpers.openInNewTab(AI_ASSISTANCE_HELP);\n      },\n      onSettingsClick: () => {\n        void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n      },\n      onArtifactsSidebarToggle: () => {\n        this.#isArtifactsSidebarOpen = !this.#isArtifactsSidebarOpen;\n        this.requestUpdate();\n      },\n      artifactsSidebarVisible: this.#isArtifactsSidebarOpen,\n    };\n  }\n\n  override async performUpdate(): Promise<void> {\n    this.view(\n        {\n          ...this.#getToolbarInput(),\n          ...await this.#getPanelViewInput(),\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  #onCopyResponseClick(message: ModelChatMessage): void {\n    const markdown = getResponseMarkdown(message);\n    if (markdown) {\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(markdown);\n      Snackbars.Snackbar.Snackbar.show({\n        message: i18nString(UIStrings.responseCopiedToClipboard),\n      });\n    }\n  }\n\n  #handleSelectElementClick(): void {\n    UI.Context.Context.instance().setFlavor(\n        Common.ReturnToPanel.ReturnToPanelFlavor, new Common.ReturnToPanel.ReturnToPanelFlavor(this.panelName));\n    void this.#toggleSearchElementAction?.execute();\n  }\n\n  #isTextInputDisabled(): boolean {\n    // If sending a new message is blocked by cross origin context\n    // the text input is disabled.\n    if (this.#conversation && this.#conversation.isBlockedByOrigin) {\n      return true;\n    }\n\n    if (!this.#conversation) {\n      return true;\n    }\n\n    if (!this.#conversation.selectedContext) {\n      return true;\n    }\n\n    return false;\n  }\n\n  #shouldShowChatActions(): boolean {\n    const aiAssistanceSetting = this.#aiAssistanceEnabledSetting?.getIfNotDisabled();\n    const isBlockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (!aiAssistanceSetting || isBlockedByAge) {\n      return false;\n    }\n    if (this.#aidaAvailability === Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL ||\n        this.#aidaAvailability === Host.AidaClient.AidaAccessPreconditions.SYNC_IS_PAUSED) {\n      return false;\n    }\n    return true;\n  }\n\n  #getChatInputPlaceholder(): Platform.UIString.LocalizedString {\n    if (!this.#conversation) {\n      return i18nString(UIStrings.followTheSteps);\n    }\n\n    if (this.#conversation && this.#conversation.isBlockedByOrigin) {\n      return lockedString(UIStringsNotTranslate.crossOriginError);\n    }\n\n    switch (this.#conversation.type) {\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING:\n        return this.#conversation.selectedContext ?\n            lockedString(UIStringsNotTranslate.inputPlaceholderForStyling) :\n            lockedString(UIStringsNotTranslate.inputPlaceholderForStylingNoContext);\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.FILE:\n        return this.#conversation.selectedContext ?\n            lockedString(UIStringsNotTranslate.inputPlaceholderForFile) :\n            lockedString(UIStringsNotTranslate.inputPlaceholderForFileNoContext);\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK:\n        return this.#conversation.selectedContext ?\n            lockedString(UIStringsNotTranslate.inputPlaceholderForNetwork) :\n            lockedString(UIStringsNotTranslate.inputPlaceholderForNetworkNoContext);\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE: {\n        const perfPanel = UI.Context.Context.instance().flavor(TimelinePanel.TimelinePanel.TimelinePanel);\n        if (perfPanel?.hasActiveTrace()) {\n          return this.#conversation.selectedContext ?\n              lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceTrace) :\n              lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceTraceNoContext);\n        }\n\n        return lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceWithNoRecording);\n      }\n    }\n  }\n\n  #getDisclaimerText(): Platform.UIString.LocalizedString {\n    if (!this.#conversation || this.#conversation.isReadOnly) {\n      return i18nString(UIStrings.inputDisclaimerForEmptyState);\n    }\n\n    const noLogging = Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n        Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING;\n    switch (this.#conversation.type) {\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForStylingEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForStyling);\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.FILE:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForFileEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForFile);\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForNetworkEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForNetwork);\n\n      // It is deliberate that both Performance agents use the same disclaimer\n      // text and this has been approved by Privacy.\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformanceEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformance);\n    }\n  }\n\n  #handleFeedbackSubmit(rpcId: Host.AidaClient.RpcGlobalId, rating: Host.AidaClient.Rating, feedback?: string): void {\n    void this.#aidaClient.registerClientEvent({\n      corresponding_aida_rpc_global_id: rpcId,\n      disable_user_content_logging: !this.#serverSideLoggingEnabled,\n      do_conversation_client_event: {\n        user_feedback: {\n          sentiment: rating,\n          user_input: {\n            comment: feedback,\n          },\n        },\n      },\n    });\n  }\n\n  #handleContextClick(): void|Promise<void> {\n    if (!this.#conversation) {\n      return;\n    }\n\n    const context = this.#conversation.selectedContext;\n    if (context instanceof AiAssistanceModel.NetworkAgent.RequestContext) {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n          context.getItem(), NetworkForward.UIRequestLocation.UIRequestTabs.HEADERS_COMPONENT);\n      return Common.Revealer.reveal(requestLocation);\n    }\n    if (context instanceof AiAssistanceModel.FileAgent.FileContext) {\n      return Common.Revealer.reveal(context.getItem().uiLocation(0, 0));\n    }\n    if (context instanceof AiAssistanceModel.PerformanceAgent.PerformanceTraceContext) {\n      const focus = context.getItem();\n      if (focus.callTree) {\n        const event = focus.callTree.selectedNode?.event ?? focus.callTree.rootNode.event;\n        const revealable = new SDK.TraceObject.RevealableEvent(event);\n        return Common.Revealer.reveal(revealable);\n      }\n      if (focus.insight) {\n        return Common.Revealer.reveal(focus.insight);\n      }\n    }\n    // Node picker is using linkifier.\n  }\n\n  #canExecuteQuery(): boolean {\n    const isBrandedBuild = Boolean(Root.Runtime.hostConfig.aidaAvailability?.enabled);\n    const isBlockedByAge = Boolean(Root.Runtime.hostConfig.aidaAvailability?.blockedByAge);\n    const isAidaAvailable = Boolean(this.#aidaAvailability === Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n    const isUserOptedIn = Boolean(this.#aiAssistanceEnabledSetting?.getIfNotDisabled());\n\n    return isBrandedBuild && isAidaAvailable && isUserOptedIn && !isBlockedByAge;\n  }\n\n  async handleAction(actionId: string, opts?: Record<string, unknown>): Promise<void> {\n    if (this.#isLoading && !opts?.['prompt']) {\n      // If running some queries already, and this action doesn't contain a predefined prompt, focus the input with the abort\n      // button and do nothing.\n      this.#viewOutput.chatView?.focusTextInput();\n      return;\n    }\n\n    let targetConversationType: AiAssistanceModel.AiHistoryStorage.ConversationType|undefined;\n    switch (actionId) {\n      case 'freestyler.elements-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING;\n        break;\n      }\n      case 'freestyler.element-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanel);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING;\n        break;\n      }\n      case 'drjones.network-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK;\n        break;\n      }\n      case 'drjones.network-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanel);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK;\n        break;\n      }\n      case 'drjones.performance-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromPerformancePanelCallTree);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE;\n        break;\n      }\n      case 'drjones.sources-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.FILE;\n        break;\n      }\n      case 'drjones.sources-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanel);\n        targetConversationType = AiAssistanceModel.AiHistoryStorage.ConversationType.FILE;\n        break;\n      }\n    }\n\n    if (!targetConversationType) {\n      return;\n    }\n\n    let conversation = this.#conversation;\n    if (!this.#conversation || this.#conversation.type !== targetConversationType || this.#conversation.isEmpty) {\n      conversation = new AiAssistanceModel.AiConversation.AiConversation(\n          targetConversationType, [], undefined, false, this.#aidaClient, this.#changeManager);\n    }\n    this.#updateConversationState(conversation);\n    const predefinedPrompt = opts?.['prompt'];\n    if (predefinedPrompt && typeof predefinedPrompt === 'string') {\n      if (!this.#canExecuteQuery()) {\n        return;\n      }\n\n      this.#imageInput = undefined;\n      this.#isTextInputEmpty = true;\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceQuerySubmitted);\n      if (this.#conversation && this.#conversation.isBlockedByOrigin) {\n        this.#handleNewChatRequest();\n      }\n      await this.#startConversation(predefinedPrompt);\n    } else {\n      this.#viewOutput.chatView?.focusTextInput();\n    }\n  }\n\n  #populateHistoryMenu(contextMenu: UI.ContextMenu.ContextMenu): void {\n    const historicalConversations = AiAssistanceModel.AiHistoryStorage.AiHistoryStorage.instance().getHistory().map(\n        serializedConversation =>\n            AiAssistanceModel.AiConversation.AiConversation.fromSerializedConversation(serializedConversation));\n    for (const conversation of historicalConversations.reverse()) {\n      if (conversation.isEmpty || !conversation.title) {\n        continue;\n      }\n\n      contextMenu.defaultSection().appendCheckboxItem(conversation.title, () => {\n        void this.#openHistoricConversation(conversation);\n      }, {checked: (this.#conversation?.id === conversation.id), jslogContext: 'freestyler.history-item'});\n    }\n\n    const historyEmpty = contextMenu.defaultSection().items.length === 0;\n    if (historyEmpty) {\n      contextMenu.defaultSection().appendItem(i18nString(UIStrings.noPastConversations), () => {}, {\n        disabled: true,\n      });\n    }\n\n    contextMenu.footerSection().appendItem(\n        i18nString(UIStrings.clearChatHistory),\n        () => {\n          void AiAssistanceModel.AiHistoryStorage.AiHistoryStorage.instance().deleteAll();\n        },\n        {\n          disabled: historyEmpty,\n        },\n    );\n  }\n\n  #onHistoryDeleted(): void {\n    this.#updateConversationState();\n  }\n\n  #onDeleteClicked(): void {\n    if (!this.#conversation) {\n      return;\n    }\n\n    void AiAssistanceModel.AiHistoryStorage.AiHistoryStorage.instance().deleteHistoryEntry(this.#conversation.id);\n    this.#updateConversationState();\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.chatDeleted));\n  }\n\n  async #onExportConversationClick(): Promise<void> {\n    if (!this.#conversation) {\n      return;\n    }\n\n    const markdownContent = this.#conversation.getConversationMarkdown();\n    const contentData = new TextUtils.ContentData.ContentData(markdownContent, false, 'text/markdown');\n\n    const titleFormatted = Platform.StringUtilities.toSnakeCase(this.#conversation.title || '');\n    const prefix = 'devtools_';\n    const suffix = '.md';\n    const maxTitleLength = 64 - prefix.length - suffix.length;\n    let finalTitle = titleFormatted || 'conversation';\n    if (finalTitle.length > maxTitleLength) {\n      finalTitle = finalTitle.substring(0, maxTitleLength);\n    }\n    const filename = `${prefix}${finalTitle}${suffix}` as Platform.DevToolsPath.RawPathString;\n\n    await Workspace.FileManager.FileManager.instance().save(filename, contentData, true);\n    Workspace.FileManager.FileManager.instance().close(filename);\n  }\n\n  async #openHistoricConversation(conversation: AiAssistanceModel.AiConversation.AiConversation): Promise<void> {\n    if (this.#conversation?.id === conversation.id) {\n      return;\n    }\n\n    this.#updateConversationState(conversation);\n    await this.#doConversation(conversation.history);\n  }\n\n  #handleNewChatRequest(): void {\n    this.#updateConversationState();\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.newChatCreated));\n\n    if (Annotations.AnnotationRepository.annotationsEnabled()) {\n      Annotations.AnnotationRepository.instance().deleteAllAnnotations();\n    }\n  }\n\n  async #handleTakeScreenshot(): Promise<void> {\n    const mainTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!mainTarget) {\n      throw new Error('Could not find main target');\n    }\n    const model = mainTarget.model(SDK.ScreenCaptureModel.ScreenCaptureModel);\n    if (!model) {\n      throw new Error('Could not find model');\n    }\n    const showLoadingTimeout = setTimeout(() => {\n      this.#imageInput = {isLoading: true};\n      this.requestUpdate();\n    }, SHOW_LOADING_STATE_TIMEOUT);\n    const bytes = await model.captureScreenshot(\n        Protocol.Page.CaptureScreenshotRequestFormat.Jpeg,\n        SCREENSHOT_QUALITY,\n        SDK.ScreenCaptureModel.ScreenshotMode.FROM_VIEWPORT,\n    );\n    clearTimeout(showLoadingTimeout);\n    if (bytes) {\n      this.#imageInput = {\n        isLoading: false,\n        data: bytes,\n        mimeType: JPEG_MIME_TYPE,\n        inputType: AiAssistanceModel.AiAgent.MultimodalInputType.SCREENSHOT\n      };\n      this.requestUpdate();\n      void this.updateComplete.then(() => {\n        this.#viewOutput.chatView?.focusTextInput();\n      });\n    } else {\n      this.#imageInput = undefined;\n      this.requestUpdate();\n      Snackbars.Snackbar.Snackbar.show({\n        message: lockedString(UIStringsNotTranslate.screenshotFailureMessage),\n      });\n    }\n  }\n\n  #handleRemoveImageInput(): void {\n    this.#imageInput = undefined;\n    this.requestUpdate();\n    void this.updateComplete.then(() => {\n      this.#viewOutput.chatView?.focusTextInput();\n    });\n  }\n\n  #handleTextInputChange(value: string): void {\n    const disableSubmit = !value;\n    if (disableSubmit !== this.#isTextInputEmpty) {\n      this.#isTextInputEmpty = disableSubmit;\n      void this.requestUpdate();\n    }\n  }\n\n  async #handleLoadImage(file: File): Promise<void> {\n    const showLoadingTimeout = setTimeout(() => {\n      this.#imageInput = {isLoading: true};\n      this.requestUpdate();\n    }, SHOW_LOADING_STATE_TIMEOUT);\n    try {\n      const reader = new FileReader();\n      const dataUrl = await new Promise<string>((resolve, reject) => {\n        reader.onload = () => {\n          if (typeof reader.result === 'string') {\n            resolve(reader.result);\n          } else {\n            reject(new Error('FileReader result was not a string.'));\n          }\n        };\n        reader.readAsDataURL(file);\n      });\n      const commaIndex = dataUrl.indexOf(',');\n      const bytes = dataUrl.substring(commaIndex + 1);\n      this.#imageInput = {\n        isLoading: false,\n        data: bytes,\n        mimeType: file.type,\n        inputType: AiAssistanceModel.AiAgent.MultimodalInputType.UPLOADED_IMAGE\n      };\n    } catch {\n      this.#imageInput = undefined;\n      Snackbars.Snackbar.Snackbar.show({\n        message: lockedString(UIStringsNotTranslate.uploadImageFailureMessage),\n      });\n    }\n\n    clearTimeout(showLoadingTimeout);\n    this.requestUpdate();\n    void this.updateComplete.then(() => {\n      this.#viewOutput.chatView?.focusTextInput();\n    });\n  }\n\n  #cancel(): void {\n    this.#runAbortController.abort();\n    this.#runAbortController = new AbortController();\n  }\n\n  #getConversationContext(conversation?: AiAssistanceModel.AiConversation.AiConversation):\n      AiAssistanceModel.AiAgent.ConversationContext<unknown>|null {\n    if (!conversation) {\n      return null;\n    }\n    switch (conversation.type) {\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING:\n        return this.#selectedElement;\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.FILE:\n        return this.#selectedFile;\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.NETWORK:\n        return this.#selectedRequest;\n      case AiAssistanceModel.AiHistoryStorage.ConversationType.PERFORMANCE:\n        return this.#selectedPerformanceTrace;\n    }\n  }\n\n  async #startConversation(\n      text: string,\n      imageInput?: Host.AidaClient.Part,\n      multimodalInputType?: AiAssistanceModel.AiAgent.MultimodalInputType,\n      ): Promise<void> {\n    if (!this.#conversation) {\n      return;\n    }\n    // Cancel any previous in-flight conversation.\n    this.#cancel();\n    const signal = this.#runAbortController.signal;\n    const context = this.#getConversationContext(this.#conversation);\n    this.#conversation.setContext(context);\n\n    // If a different context is provided, it must be from the same origin.\n    if (this.#conversation.isBlockedByOrigin) {\n      // This error should not be reached. If it happens, some\n      // invariants do not hold anymore.\n      throw new Error('cross-origin context data should not be included');\n    }\n    if (this.#conversation.isEmpty) {\n      Badges.UserBadges.instance().recordAction(Badges.BadgeAction.STARTED_AI_CONVERSATION);\n    }\n    const multimodalInput = isAiAssistanceMultimodalInputEnabled() && imageInput && multimodalInputType ? {\n      input: imageInput,\n      id: crypto.randomUUID(),\n      type: multimodalInputType,\n    } :\n                                                                                                          undefined;\n\n    void VisualLogging.logFunctionCall(`start-conversation-${this.#conversation.type}`, 'ui');\n\n    await this.#doConversation(\n        this.#conversation.run(\n            text,\n            {\n              signal,\n              extraContext: this.#additionalContextItemsFromFloaty,\n              multimodalInput,\n            },\n            ),\n    );\n  }\n\n  async #doConversation(\n      items: Iterable<AiAssistanceModel.AiAgent.ResponseData, void, void>|\n      AsyncIterable<AiAssistanceModel.AiAgent.ResponseData, void, void>): Promise<void> {\n    const release = await this.#mutex.acquire();\n    try {\n      let systemMessage: ModelChatMessage = {\n        entity: ChatMessageEntity.MODEL,\n        parts: [],\n      };\n      let step: Step = {isLoading: true};\n\n      /**\n       * Commits the step to props only if necessary.\n       */\n      function commitStep(): void {\n        const lastPart = systemMessage.parts.at(-1);\n        if (lastPart?.type === 'step' && lastPart.step === step) {\n          return;\n        }\n        systemMessage.parts.push({\n          type: 'step',\n          step,\n        });\n      }\n\n      this.#isLoading = true;\n      let announcedAnswerLoading = false;\n      let announcedAnswerReady = false;\n      for await (const data of items) {\n        step.sideEffect = undefined;\n        switch (data.type) {\n          case AiAssistanceModel.AiAgent.ResponseType.USER_QUERY: {\n            this.#messages.push({\n              entity: ChatMessageEntity.USER,\n              text: data.query,\n              imageInput: data.imageInput,\n            });\n            systemMessage = {\n              entity: ChatMessageEntity.MODEL,\n              parts: [],\n            };\n            this.#messages.push(systemMessage);\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.QUERYING: {\n            step = {isLoading: true};\n            if (!systemMessage.parts.length) {\n              commitStep();\n            }\n\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.CONTEXT: {\n            step.title = data.title;\n            step.contextDetails = data.details;\n            step.isLoading = false;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.TITLE: {\n            step.title = data.title;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.THOUGHT: {\n            step.isLoading = false;\n            step.thought = data.thought;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.SUGGESTIONS: {\n            const lastPart = systemMessage.parts.at(-1);\n            if (lastPart?.type === 'answer') {\n              lastPart.suggestions = data.suggestions;\n            } else {\n              systemMessage.parts.push({\n                type: 'answer',\n                text: '',\n                suggestions: data.suggestions,\n              });\n            }\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.SIDE_EFFECT: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.sideEffect = {\n              onAnswer: (result: boolean) => {\n                data.confirm(result);\n                step.sideEffect = undefined;\n                this.requestUpdate();\n              },\n            };\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.ACTION: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.output ??= data.output;\n            step.canceled = data.canceled;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.ANSWER: {\n            systemMessage.rpcId = data.rpcId;\n            const lastPart = systemMessage.parts.at(-1);\n            if (lastPart?.type === 'answer') {\n              lastPart.text = data.text;\n              if (data.suggestions) {\n                lastPart.suggestions = data.suggestions;\n              }\n            } else {\n              const newPart: AnswerPart = {\n                type: 'answer',\n                text: data.text,\n              };\n              if (data.suggestions) {\n                newPart.suggestions = data.suggestions;\n              }\n              systemMessage.parts.push(newPart);\n            }\n\n            // When there is an answer without any thinking steps, we don't want to show the thinking step.\n            // TODO(crbug.com/463323934): Remove specially handling this case.\n            if (systemMessage.parts.length > 1) {\n              const firstPart = systemMessage.parts[0];\n              if (firstPart.type === 'step' && firstPart.step.isLoading && !firstPart.step.thought &&\n                  !firstPart.step.code && !firstPart.step.contextDetails) {\n                systemMessage.parts.shift();\n              }\n            }\n            step.isLoading = false;\n            break;\n          }\n          case AiAssistanceModel.AiAgent.ResponseType.ERROR: {\n            systemMessage.error = data.error;\n            const lastPart = systemMessage.parts.at(-1);\n            if (lastPart?.type === 'step') {\n              const lastStep = lastPart.step;\n              // Mark the last step as cancelled to make the UI feel better.\n              if (data.error === AiAssistanceModel.AiAgent.ErrorType.ABORT) {\n                lastStep.canceled = true;\n                // If error happens while the step is still loading remove it.\n              } else if (lastStep.isLoading) {\n                systemMessage.parts.pop();\n              }\n            }\n\n            if (data.error === AiAssistanceModel.AiAgent.ErrorType.BLOCK) {\n              const lastPart = systemMessage.parts.at(-1);\n              if (lastPart?.type === 'answer') {\n                systemMessage.parts.pop();\n              }\n            }\n            break;\n          }\n        }\n\n        // Commit update intermediate step when not\n        // in read only mode.\n        if (!this.#conversation?.isReadOnly) {\n          this.requestUpdate();\n\n          // This handles scrolling to the bottom for live conversations when:\n          // * User submits the query & the context step is shown.\n          // * There is a side effect dialog  shown.\n          if (data.type === AiAssistanceModel.AiAgent.ResponseType.CONTEXT ||\n              data.type === AiAssistanceModel.AiAgent.ResponseType.SIDE_EFFECT) {\n            this.#viewOutput.chatView?.scrollToBottom();\n          }\n\n          // Announce as status update to screen readers when:\n          // * Context is received (e.g. Analyzing the prompt)\n          // * Answer started streaming\n          // * Answer finished streaming\n          switch (data.type) {\n            case AiAssistanceModel.AiAgent.ResponseType.CONTEXT:\n              UI.ARIAUtils.LiveAnnouncer.status(data.title);\n              break;\n            case AiAssistanceModel.AiAgent.ResponseType.ANSWER: {\n              if (!data.complete && !announcedAnswerLoading) {\n                announcedAnswerLoading = true;\n                UI.ARIAUtils.LiveAnnouncer.status(lockedString(UIStringsNotTranslate.answerLoading));\n              } else if (data.complete && !announcedAnswerReady) {\n                announcedAnswerReady = true;\n                UI.ARIAUtils.LiveAnnouncer.status(lockedString(UIStringsNotTranslate.answerReady));\n              }\n            }\n          }\n        }\n      }\n\n      this.#isLoading = false;\n      this.requestUpdate();\n    } finally {\n      release();\n    }\n  }\n}\n\nexport function getResponseMarkdown(message: ModelChatMessage): string {\n  const contentParts = ['## AI'];\n\n  for (const part of message.parts) {\n    if (part.type === 'answer') {\n      contentParts.push(`### Answer\\n\\n${part.text}`);\n    } else {\n      const step = part.step;\n      if (step.title) {\n        contentParts.push(`### ${step.title}`);\n      }\n      if (step.contextDetails) {\n        contentParts.push(AiAssistanceModel.AiConversation.generateContextDetailsMarkdown(step.contextDetails));\n      }\n      if (step.thought) {\n        contentParts.push(step.thought);\n      }\n      if (step.code) {\n        contentParts.push(`**Code executed:**\\n\\`\\`\\`\\n${step.code.trim()}\\n\\`\\`\\``);\n      }\n      if (step.output) {\n        contentParts.push(`**Data returned:**\\n\\`\\`\\`\\n${step.output}\\n\\`\\`\\``);\n      }\n    }\n  }\n  return contentParts.join('\\n\\n');\n}\n\nexport class ActionDelegate implements UI.ActionRegistration.ActionDelegate {\n  handleAction(_context: UI.Context.Context, actionId: string, opts?: Record<string, unknown>): boolean {\n    switch (actionId) {\n      case 'freestyler.elements-floating-button':\n      case 'freestyler.element-panel-context':\n      case 'freestyler.main-menu':\n      case 'drjones.network-floating-button':\n      case 'drjones.network-panel-context':\n      case 'drjones.performance-panel-context':\n      case 'drjones.sources-floating-button':\n      case 'drjones.sources-panel-context': {\n        void (async () => {\n          const view = UI.ViewManager.ViewManager.instance().view(\n              AiAssistancePanel.panelName,\n          );\n\n          if (!view) {\n            return;\n          }\n\n          await UI.ViewManager.ViewManager.instance().showView(\n              AiAssistancePanel.panelName,\n          );\n\n          const minDrawerSize = UI.InspectorView.InspectorView.instance().totalSize() / 4;\n          if (UI.InspectorView.InspectorView.instance().drawerSize() < minDrawerSize) {\n            // If the drawer is too small, resize it to the quarter of the total size.\n            // This ensures the AI Assistance panel has enough space to be usable when opened via an action.\n            UI.InspectorView.InspectorView.instance().setDrawerSize(minDrawerSize);\n          }\n\n          const widget = (await view.widget()) as AiAssistancePanel;\n          void widget.handleAction(actionId, opts);\n        })();\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n\nfunction isAiAssistanceMultimodalUploadInputEnabled(): boolean {\n  return isAiAssistanceMultimodalInputEnabled() &&\n      Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.multimodalUploadInput);\n}\n\nfunction isAiAssistanceMultimodalInputEnabled(): boolean {\n  return Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.multimodal);\n}\n\nfunction isAiAssistanceServerSideLoggingEnabled(): boolean {\n  return !Root.Runtime.hostConfig.aidaAvailability?.disallowLogging;\n}\n"]}