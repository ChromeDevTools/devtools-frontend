{"version":3,"file":"ChatView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/ai_assistance/components/ChatView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/components/spinners/spinners.js';\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as AiAssistanceModel from '../../../models/ai_assistance/ai_assistance.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport type {MarkdownLitRenderer} from '../../../ui/components/markdown_view/MarkdownView.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport {Directives, html, nothing, render} from '../../../ui/lit/lit.js';\nimport {PatchWidget} from '../PatchWidget.js';\n\nimport {ChatInput} from './ChatInput.js';\nimport {ChatMessage, type Message, type ModelChatMessage} from './ChatMessage.js';\nimport chatViewStyles from './chatView.css.js';\n\nexport {ChatInput, type ImageInputData} from './ChatInput.js';\n\nconst {ref, repeat, classMap} = Directives;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   * @description Text for the empty state of the AI assistance panel.\n   */\n  emptyStateText: 'How can I help you?',\n  /**\n   * @description Text for the empty state of the Gemini panel.\n   */\n  emptyStateTextGemini: 'Where should we start?',\n} as const;\n\nconst lockedString = i18n.i18n.lockedString;\n\nconst SCROLL_ROUNDING_OFFSET = 1;\n\ninterface ViewOutput {\n  mainElement?: HTMLElement;\n  input?: UI.Widget.WidgetElement<ChatInput>;\n}\ntype View = (input: ChatWidgetInput, output: ViewOutput, target: HTMLElement|ShadowRoot) => void;\n\nexport interface Props {\n  onTextSubmit:\n      (text: string, imageInput?: Host.AidaClient.Part,\n       multimodalInputType?: AiAssistanceModel.AiAgent.MultimodalInputType) => void;\n  onInspectElementClick: () => void;\n  onFeedbackSubmit: (rpcId: Host.AidaClient.RpcGlobalId, rate: Host.AidaClient.Rating, feedback?: string) => void;\n  onCancelClick: () => void;\n  onContextClick: () => void;\n  onNewConversation: () => void;\n  onCopyResponseClick: (message: ModelChatMessage) => void;\n  changeManager: AiAssistanceModel.ChangeManager.ChangeManager;\n  inspectElementToggled: boolean;\n  messages: Message[];\n  selectedContext: AiAssistanceModel.AiAgent.ConversationContext<unknown>|null;\n  isLoading: boolean;\n  canShowFeedbackForm: boolean;\n  userInfo: Pick<Host.InspectorFrontendHostAPI.SyncInformation, 'accountImage'|'accountGivenName'>;\n  conversationType: AiAssistanceModel.AiHistoryStorage.ConversationType;\n  isReadOnly: boolean;\n  blockedByCrossOrigin: boolean;\n  changeSummary?: string;\n  multimodalInputEnabled?: boolean;\n  isTextInputDisabled: boolean;\n  emptyStateSuggestions: AiAssistanceModel.AiAgent.ConversationSuggestion[];\n  inputPlaceholder: Platform.UIString.LocalizedString;\n  disclaimerText: Platform.UIString.LocalizedString;\n  uploadImageInputEnabled?: boolean;\n  markdownRenderer: MarkdownLitRenderer;\n  additionalFloatyContext: UI.Floaty.FloatyContextSelection[];\n}\n\ninterface ChatWidgetInput extends Props {\n  accountGivenName: string;\n  handleScroll: (ev: Event) => void;\n  handleSuggestionClick: (title: string) => void;\n  handleMessageContainerRef: (el: Element|undefined) => void;\n}\n\nconst DEFAULT_VIEW: View = (input, output, target) => {\n  const chatUiClasses = classMap({\n    'chat-ui': true,\n    gemini: AiAssistanceModel.AiUtils.isGeminiBranding(),\n  });\n\n  const inputWidgetClasses = classMap({\n    'chat-input-widget': true,\n    sticky: !input.isReadOnly,\n  });\n\n  // clang-format off\n    render(html`\n      <style>${chatViewStyles}</style>\n      <div class=${chatUiClasses}>\n        <main @scroll=${input.handleScroll} ${ref(element => { output.mainElement = element as HTMLElement; } )}>\n          ${input.messages.length > 0 ? html`\n            <div class=\"messages-container\" ${ref(input.handleMessageContainerRef)}>\n              ${repeat(input.messages, message =>\n                html`<devtools-widget .widgetConfig=${UI.Widget.widgetConfig(ChatMessage, {\n                  message,\n                  isLoading: input.isLoading,\n                  isReadOnly: input.isReadOnly,\n                  canShowFeedbackForm: input.canShowFeedbackForm,\n                  userInfo: input.userInfo,\n                  markdownRenderer: input.markdownRenderer,\n                  isLastMessage: input.messages.at(-1) === message,\n                  onSuggestionClick: input.handleSuggestionClick,\n                  onFeedbackSubmit: input.onFeedbackSubmit,\n                  onCopyResponseClick: input.onCopyResponseClick,\n                })}></devtools-widget>`\n              )}\n              ${input.isLoading ? nothing : html`<devtools-widget\n                .widgetConfig=${UI.Widget.widgetConfig(PatchWidget, {\n                  changeSummary: input.changeSummary ?? '',\n                  changeManager: input.changeManager,\n                })}\n              ></devtools-widget>`}\n            </div>\n          ` : html`\n            <div class=\"empty-state-container\">\n              <div class=\"header\">\n                <div class=\"icon\">\n                  <devtools-icon\n                    name=\"smart-assistant\"\n                  ></devtools-icon>\n                </div>\n                ${AiAssistanceModel.AiUtils.isGeminiBranding() ?\n                  html`\n                    <h1 class='greeting'>Hello${input.accountGivenName ? `, ${input.accountGivenName}` : ''}</h1>\n                    <p class='cta'>${lockedString(UIStringsNotTranslate.emptyStateTextGemini)}</p>\n                  ` : html`<h1>${lockedString(UIStringsNotTranslate.emptyStateText)}</h1>`\n                }\n              </div>\n              <div class=\"empty-state-content\">\n                ${input.emptyStateSuggestions.map(({title, jslogContext}) => {\n                  return html`<devtools-button\n                    class=\"suggestion\"\n                    @click=${() => input.handleSuggestionClick(title)}\n                    .data=${\n                      {\n                        variant: Buttons.Button.Variant.OUTLINED,\n                        size: Buttons.Button.Size.REGULAR,\n                        title,\n                        jslogContext: jslogContext ?? 'suggestion',\n                        disabled: input.isTextInputDisabled,\n                      } as Buttons.Button.ButtonData\n                    }\n                  >${title}</devtools-button>`;\n                })}\n              </div>\n            </div>\n          `}\n          <devtools-widget class=${inputWidgetClasses} .widgetConfig=${UI.Widget.widgetConfig(ChatInput, {\n            isLoading: input.isLoading,\n            blockedByCrossOrigin: input.blockedByCrossOrigin,\n            isTextInputDisabled: input.isTextInputDisabled,\n            inputPlaceholder: input.inputPlaceholder,\n            disclaimerText: input.disclaimerText,\n            selectedContext: input.selectedContext,\n            inspectElementToggled: input.inspectElementToggled,\n            multimodalInputEnabled: input.multimodalInputEnabled ?? false,\n            conversationType: input.conversationType,\n            uploadImageInputEnabled: input.uploadImageInputEnabled ?? false,\n            isReadOnly: input.isReadOnly,\n            additionalFloatyContext: input.additionalFloatyContext,\n            onContextClick: input.onContextClick,\n            onInspectElementClick: input.onInspectElementClick,\n            onTextSubmit: input.onTextSubmit,\n            onCancelClick: input.onCancelClick,\n            onNewConversation: input.onNewConversation,\n          })} ${ref(element => { output.input = element as UI.Widget.WidgetElement<ChatInput>; } )}></devtools-widget>\n        </main>\n      </div>\n    `, target);\n  // clang-format on\n};\nexport class ChatView extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #scrollTop?: number;\n  #props: Props;\n  #messagesContainerElement?: Element;\n  #output: ViewOutput = {};\n  #messagesContainerResizeObserver = new ResizeObserver(() => this.#handleMessagesContainerResize());\n  /**\n   * Indicates whether the chat scroll position should be pinned to the bottom.\n   *\n   * This is true when:\n   *   - The scroll is at the very bottom, allowing new messages to push the scroll down automatically.\n   *   - The panel is initially rendered and the user hasn't scrolled yet.\n   *\n   * It is set to false when the user scrolls up to view previous messages.\n   */\n  #pinScrollToBottom = true;\n  /**\n   * Indicates whether the scroll event originated from code\n   * or a user action. When set to `true`, `handleScroll` will ignore the event,\n   * allowing it to only handle user-driven scrolls and correctly decide\n   * whether to pin the content to the bottom.\n   */\n  #isProgrammaticScroll = false;\n  #view: View;\n\n  constructor(props: Props, view = DEFAULT_VIEW) {\n    super();\n    this.#props = props;\n    this.#view = view;\n  }\n\n  set props(props: Props) {\n    this.#props = props;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#render();\n\n    if (this.#messagesContainerElement) {\n      this.#messagesContainerResizeObserver.observe(this.#messagesContainerElement);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.#messagesContainerResizeObserver.disconnect();\n  }\n\n  focusTextInput(): void {\n    const textArea = this.#shadow.querySelector('.chat-input') as HTMLTextAreaElement;\n    if (!textArea) {\n      return;\n    }\n\n    textArea.focus();\n  }\n\n  restoreScrollPosition(): void {\n    if (this.#scrollTop === undefined) {\n      return;\n    }\n\n    if (!this.#output.mainElement) {\n      return;\n    }\n\n    this.#setMainElementScrollTop(this.#scrollTop);\n  }\n\n  scrollToBottom(): void {\n    if (!this.#output.mainElement) {\n      return;\n    }\n\n    this.#setMainElementScrollTop(this.#output.mainElement.scrollHeight);\n  }\n\n  #handleMessagesContainerResize(): void {\n    if (!this.#pinScrollToBottom) {\n      return;\n    }\n\n    if (!this.#output.mainElement) {\n      return;\n    }\n\n    if (this.#pinScrollToBottom) {\n      this.#setMainElementScrollTop(this.#output.mainElement.scrollHeight);\n    }\n  }\n\n  #setMainElementScrollTop(scrollTop: number): void {\n    if (!this.#output.mainElement) {\n      return;\n    }\n\n    this.#scrollTop = scrollTop;\n    this.#isProgrammaticScroll = true;\n    this.#output.mainElement.scrollTop = scrollTop;\n  }\n\n  #handleMessageContainerRef = (el: Element|undefined): void => {\n    this.#messagesContainerElement = el;\n\n    if (el) {\n      this.#messagesContainerResizeObserver.observe(el);\n    } else {\n      this.#pinScrollToBottom = true;\n      this.#messagesContainerResizeObserver.disconnect();\n    }\n  };\n\n  #handleScroll = (ev: Event): void => {\n    if (!ev.target || !(ev.target instanceof HTMLElement)) {\n      return;\n    }\n\n    // Do not handle scroll events caused by programmatically\n    // updating the scroll position. We want to know whether user\n    // did scroll the container from the user interface.\n    if (this.#isProgrammaticScroll) {\n      this.#isProgrammaticScroll = false;\n      return;\n    }\n\n    this.#scrollTop = ev.target.scrollTop;\n    this.#pinScrollToBottom =\n        ev.target.scrollTop + ev.target.clientHeight + SCROLL_ROUNDING_OFFSET > ev.target.scrollHeight;\n  };\n\n  #handleSuggestionClick = (suggestion: string): void => {\n    this.#output.input?.getWidget()?.setInputValue(suggestion);\n    this.#render();\n    this.focusTextInput();\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceDynamicSuggestionClicked);\n  };\n\n  #render(): void {\n    this.#view(\n        {\n          ...this.#props,\n          accountGivenName: this.#props.userInfo.accountGivenName ?? '',\n          handleScroll: this.#handleScroll,\n          handleSuggestionClick: this.#handleSuggestionClick,\n          handleMessageContainerRef: this.#handleMessageContainerRef,\n        },\n        this.#output, this.#shadow);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-ai-chat-view': ChatView;\n  }\n}\n\ncustomElements.define('devtools-ai-chat-view', ChatView);\n"]}