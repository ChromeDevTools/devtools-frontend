{"version":3,"file":"PerformanceAgentFlameChart.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/ai_assistance/components/PerformanceAgentFlameChart.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Trace from '../../../models/trace/trace.js';\nimport * as PerfUI from '../../../ui/legacy/components/perf_ui/perf_ui.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as Timeline from '../../timeline/timeline.js';\n\nconst {html} = Lit;\n\nexport interface PerformanceAgentFlameChartData {\n  parsedTrace: Trace.TraceModel.ParsedTrace|null;\n  start: number;\n  end: number;\n}\n\nexport class PerformanceAgentFlameChart extends HTMLElement implements PerfUI.FlameChart.FlameChartDelegate {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #flameChartContainer = document.createElement('div');\n  #flameChart: PerfUI.FlameChart.FlameChart;\n  #dataProvider: Timeline.TimelineFlameChartDataProvider.TimelineFlameChartDataProvider;\n  #parsedTrace: Trace.TraceModel.ParsedTrace|null = null;\n\n  constructor() {\n    super();\n    this.#flameChartContainer.classList.add('container');\n    this.#dataProvider = new Timeline.TimelineFlameChartDataProvider.TimelineFlameChartDataProvider();\n    this.#flameChart = new PerfUI.FlameChart.FlameChart(this.#dataProvider, this);\n    this.#flameChart.markAsRoot();\n    this.#flameChart.show(this.#flameChartContainer);\n  }\n\n  set data(data: PerformanceAgentFlameChartData) {\n    if (!data.parsedTrace) {\n      return;\n    }\n    this.#parsedTrace = data.parsedTrace;\n    const entityMapper = new Trace.EntityMapper.EntityMapper(data.parsedTrace);\n    this.#dataProvider.setModel(data.parsedTrace, entityMapper);\n    this.#dataProvider.buildWithCustomTracksForTest({\n      filterTracks: trackName => trackName.startsWith('Main'),\n      expandTracks: () => true,\n    });\n\n    let start = Trace.Types.Timing.Micro(data.start);\n    let end = Trace.Types.Timing.Micro(data.end);\n\n    const minTraceTime = data.parsedTrace.data.Meta.traceBounds.min;\n    const maxTraceTime = data.parsedTrace.data.Meta.traceBounds.max;\n\n    // If the start and end are not within the trace, display the whole trace duration.\n    if (start < 0 || end < 0 || start >= end || start === end || start < minTraceTime || end > maxTraceTime) {\n      start = minTraceTime;\n      end = maxTraceTime;\n      // eslint-disable-next-line no-console\n      console.log('[GreenDev] Flamechart widget bounds reset to the whole trace duration.');\n    }\n\n    const bounds = Trace.Helpers.Timing.traceWindowMicroSecondsToMilliSeconds({\n      min: Trace.Types.Timing.Micro(start),\n      max: Trace.Types.Timing.Micro(end),\n      range: Trace.Types.Timing.Micro(end - start),\n    });\n    this.#flameChart.setWindowTimes(bounds.min, bounds.max);\n    this.#flameChart.setSize(600, 200);\n    this.#render();\n  }\n\n  #render(): void {\n    if (!this.#parsedTrace) {\n      return;\n    }\n    const output = html`\n        <style>\n          :host {\n            display: flex;\n          }\n\n          .container {\n            display: flex;\n            width: 600px;\n            height: 200px;\n          }\n\n          .flex-auto {\n            flex: auto;\n          }\n\n          .vbox {\n            display: flex;\n            flex-direction: column;\n            position: relative;\n          }\n        </style>\n        ${this.#flameChartContainer}\n      `;\n    // eslint-disable-next-line @devtools/no-lit-render-outside-of-view\n    Lit.render(output, this.#shadow, {host: this});\n\n    this.#flameChart.update();\n    this.#flameChart.setSize(600, 200);\n  }\n  windowChanged(startTime: number, endTime: number, animate: boolean): void {\n    this.#flameChart.setWindowTimes(startTime, endTime, animate);\n  }\n\n  updateRangeSelection(startTime: number, endTime: number): void {\n    this.#flameChart.updateRangeSelection(startTime, endTime);\n  }\n\n  updateSelectedEntry(_entryIndex: number): void {\n  }\n\n  updateSelectedGroup(_flameChart: PerfUI.FlameChart.FlameChart, _group: PerfUI.FlameChart.Group|null): void {\n  }\n}\n\ncustomElements.define('devtools-performance-agent-flame-chart', PerformanceAgentFlameChart);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-performance-agent-flame-chart': PerformanceAgentFlameChart;\n  }\n}\n"]}