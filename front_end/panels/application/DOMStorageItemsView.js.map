{"version":3,"file":"DOMStorageItemsView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/DOMStorageItemsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\n/*\n * Copyright (C) 2008 Nokia Inc.  All rights reserved.\n * Copyright (C) 2013 Samsung Electronics. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {DOMStorage} from './DOMStorageModel.js';\nimport {KeyValueStorageItemsView} from './KeyValueStorageItemsView.js';\n\nconst UIStrings = {\n  /**\n   * @description Name for the \"DOM Storage Items\" table that shows the content of the DOM Storage.\n   */\n  domStorageItems: 'DOM Storage Items',\n  /**\n   * @description Text for announcing that the \"DOM Storage Items\" table was cleared, that is, all\n   * entries were deleted.\n   */\n  domStorageItemsCleared: 'DOM Storage Items cleared',\n  /**\n   * @description Text for announcing a DOM Storage key/value item has been deleted\n   */\n  domStorageItemDeleted: 'The storage item was deleted.',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/DOMStorageItemsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class DOMStorageItemsView extends KeyValueStorageItemsView {\n  private domStorage: DOMStorage;\n  private eventListeners: Common.EventTarget.EventDescriptor[];\n\n  constructor(domStorage: DOMStorage) {\n    super(i18nString(UIStrings.domStorageItems), 'dom-storage', true);\n\n    this.domStorage = domStorage;\n    if (domStorage.storageKey) {\n      this.toolbar?.setStorageKey(domStorage.storageKey);\n    }\n\n    this.element.classList.add('storage-view', 'table');\n\n    this.showPreview(null, null);\n\n    this.eventListeners = [];\n    this.setStorage(domStorage);\n  }\n\n  protected createPreview(key: string, value: string): Promise<UI.Widget.Widget|null> {\n    const protocol = this.domStorage.isLocalStorage ? 'localstorage' : 'sessionstorage';\n    const url = `${protocol}://${key}` as Platform.DevToolsPath.UrlString;\n    const provider = TextUtils.StaticContentProvider.StaticContentProvider.fromString(\n        url,\n        Common.ResourceType.resourceTypes.XHR,\n        value,\n    );\n    return SourceFrame.PreviewFactory.PreviewFactory.createPreview(\n        provider,\n        'text/plain',\n    );\n  }\n\n  setStorage(domStorage: DOMStorage): void {\n    Common.EventTarget.removeEventListeners(this.eventListeners);\n    this.domStorage = domStorage;\n    const storageKind = domStorage.isLocalStorage ? 'local-storage-data' : 'session-storage-data';\n    this.element.setAttribute('jslog', `${VisualLogging.pane().context(storageKind)}`);\n    if (domStorage.storageKey) {\n      this.toolbar?.setStorageKey(domStorage.storageKey);\n    }\n    this.eventListeners = [\n      this.domStorage.addEventListener(DOMStorage.Events.DOM_STORAGE_ITEMS_CLEARED, this.domStorageItemsCleared, this),\n      this.domStorage.addEventListener(DOMStorage.Events.DOM_STORAGE_ITEM_REMOVED, this.domStorageItemRemoved, this),\n      this.domStorage.addEventListener(DOMStorage.Events.DOM_STORAGE_ITEM_ADDED, this.domStorageItemAdded, this),\n      this.domStorage.addEventListener(DOMStorage.Events.DOM_STORAGE_ITEM_UPDATED, this.domStorageItemUpdated, this),\n    ];\n    this.refreshItems();\n  }\n\n  private domStorageItemsCleared(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemsCleared();\n  }\n\n  override itemsCleared(): void {\n    super.itemsCleared();\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.domStorageItemsCleared));\n  }\n\n  private domStorageItemRemoved(event: Common.EventTarget.EventTargetEvent<DOMStorage.DOMStorageItemRemovedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemRemoved(event.data.key);\n  }\n\n  override itemRemoved(key: string): void {\n    super.itemRemoved(key);\n    UI.ARIAUtils.LiveAnnouncer.alert(i18nString(UIStrings.domStorageItemDeleted));\n  }\n\n  private domStorageItemAdded(event: Common.EventTarget.EventTargetEvent<DOMStorage.DOMStorageItemAddedEvent>): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemAdded(event.data.key, event.data.value);\n  }\n\n  private domStorageItemUpdated(event: Common.EventTarget.EventTargetEvent<DOMStorage.DOMStorageItemUpdatedEvent>):\n      void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    this.itemUpdated(event.data.key, event.data.value);\n  }\n\n  override refreshItems(): void {\n    void this.#refreshItems();\n  }\n\n  async #refreshItems(): Promise<void> {\n    const items = await this.domStorage.getItems();\n    if (!items || !this.toolbar) {\n      return;\n    }\n    const {filterRegex} = this.toolbar;\n    const filteredItems = items.map(item => ({key: item[0], value: item[1]}))\n                              .filter(item => filterRegex?.test(`${item.key} ${item.value}`) ?? true);\n    this.showItems(filteredItems);\n  }\n\n  override deleteAllItems(): void {\n    this.domStorage.clear();\n    // explicitly clear the view because the event won't be fired when it has no items\n    this.domStorageItemsCleared();\n  }\n\n  protected removeItem(key: string): void {\n    this.domStorage?.removeItem(key);\n  }\n\n  protected setItem(key: string, value: string): void {\n    this.domStorage?.setItem(key, value);\n  }\n}\n"]}