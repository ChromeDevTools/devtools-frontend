{"version":3,"file":"PermissionsPolicySection.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/PermissionsPolicySection.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/components/icon_button/icon_button.js';\nimport '../../../ui/components/report_view/report_view.js';\n\nimport * as Common from '../../../core/common/common.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../generated/protocol.js';\nimport * as NetworkForward from '../../../panels/network/forward/forward.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport {html, type LitTemplate, nothing, render, type TemplateResult} from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport permissionsPolicySectionStyles from './permissionsPolicySection.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Label for a button. When clicked more details (for the content this button refers to) will be shown.\n   */\n  showDetails: 'Show details',\n  /**\n   * @description Label for a button. When clicked some details (for the content this button refers to) will be hidden.\n   */\n  hideDetails: 'Hide details',\n  /**\n   * @description Label for a list of features which are allowed according to the current Permissions policy\n   *(a mechanism that allows developers to enable/disable browser features and APIs (e.g. camera, geolocation, autoplay))\n   */\n  allowedFeatures: 'Allowed Features',\n  /**\n   * @description Label for a list of features which are disabled according to the current Permissions policy\n   *(a mechanism that allows developers to enable/disable browser features and APIs (e.g. camera, geolocation, autoplay))\n   */\n  disabledFeatures: 'Disabled Features',\n  /**\n   * @description Tooltip text for a link to a specific request's headers in the Network panel.\n   */\n  clickToShowHeader: 'Click to reveal the request whose \"`Permissions-Policy`\" HTTP header disables this feature.',\n  /**\n   * @description Tooltip text for a link to a specific iframe in the Elements panel (Iframes can be nested, the link goes\n   *  to the outer-most iframe which blocks a certain feature).\n   */\n  clickToShowIframe: 'Click to reveal the top-most iframe which does not allow this feature in the elements panel.',\n  /**\n   * @description Text describing that a specific feature is blocked by not being included in the iframe's \"allow\" attribute.\n   */\n  disabledByIframe: 'missing in iframe \"`allow`\" attribute',\n  /**\n   * @description Text describing that a specific feature is blocked by a Permissions Policy specified in a request header.\n   */\n  disabledByHeader: 'disabled by \"`Permissions-Policy`\" header',\n  /**\n   * @description Text describing that a specific feature is blocked by virtue of being inside a fenced frame tree.\n   */\n  disabledByFencedFrame: 'disabled inside a `fencedframe`',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/PermissionsPolicySection.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface PermissionsPolicySectionData {\n  policies: Protocol.Page.PermissionsPolicyFeatureState[];\n  showDetails: boolean;\n}\n\nexport function renderIconLink(\n    iconName: string, title: Platform.UIString.LocalizedString, clickHandler: (() => void)|(() => Promise<void>),\n    jsLogContext: string): TemplateResult {\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n  return html`\n    <devtools-button\n      .iconName=${iconName}\n      title=${title}\n      aria-label=${title}\n      .variant=${Buttons.Button.Variant.ICON}\n      .size=${Buttons.Button.Size.SMALL}\n      @click=${clickHandler}\n      jslog=${VisualLogging.action().track({click: true}).context(jsLogContext)}>\n    </devtools-button>`;\n  // clang-format on\n}\n\nfunction renderAllowed(allowed: Protocol.Page.PermissionsPolicyFeatureState[]): LitTemplate {\n  if (!allowed.length) {\n    return nothing;\n  }\n  return html`\n    <devtools-report-key>${i18nString(UIStrings.allowedFeatures)}</devtools-report-key>\n    <devtools-report-value>${allowed.map(({feature}) => feature).join(', ')}</devtools-report-value>`;\n}\n\nfunction renderDisallowed(\n    data: Array<{\n      policy: Protocol.Page.PermissionsPolicyFeatureState,\n      blockReason?: Protocol.Page.PermissionsPolicyBlockReason,\n      linkTargetDOMNode?: SDK.DOMModel.DOMNode,\n      linkTargetRequest?: SDK.NetworkRequest.NetworkRequest,\n    }>,\n    showDetails: boolean,\n    onToggleShowDetails: () => void,\n    onRevealDOMNode: (linkTargetDOMNode: SDK.DOMModel.DOMNode) => Promise<void>,\n    onRevealHeader: (linkTargetRequest: SDK.NetworkRequest.NetworkRequest) => Promise<void>,\n    ): LitTemplate {\n  if (!data.length) {\n    return nothing;\n  }\n  if (!showDetails) {\n    // clang-format off\n    return html`\n      <devtools-report-key>${i18nString(UIStrings.disabledFeatures)}</devtools-report-key>\n      <devtools-report-value>\n        ${data.map(({policy}) => policy.feature).join(', ')}\n        <devtools-button\n            class=\"disabled-features-button\"\n            .variant=${Buttons.Button.Variant.OUTLINED}\n            @click=${onToggleShowDetails}\n            jslog=${VisualLogging.action('show-disabled-features-details').track({click: true})}>\n          ${i18nString(UIStrings.showDetails)}\n        </devtools-button>\n      </devtools-report-value>`;\n    // clang-format on\n  }\n\n  const featureRows = data.map(({policy, blockReason, linkTargetDOMNode, linkTargetRequest}) => {\n    const blockReasonText = (() => {\n      switch (blockReason) {\n        case Protocol.Page.PermissionsPolicyBlockReason.IframeAttribute:\n          return i18nString(UIStrings.disabledByIframe);\n        case Protocol.Page.PermissionsPolicyBlockReason.Header:\n          return i18nString(UIStrings.disabledByHeader);\n        case Protocol.Page.PermissionsPolicyBlockReason.InFencedFrameTree:\n          return i18nString(UIStrings.disabledByFencedFrame);\n        default:\n          return '';\n      }\n    })();\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return html`\n      <div class=\"permissions-row\">\n        <div>\n          <devtools-icon class=\"allowed-icon extra-large\" name=\"cross-circle\">\n          </devtools-icon>\n        </div>\n        <div class=\"feature-name text-ellipsis\">${policy.feature}</div>\n        <div class=\"block-reason\">${blockReasonText}</div>\n        <div>\n          ${linkTargetDOMNode ?\n            renderIconLink('code-circle', i18nString(UIStrings.clickToShowIframe),\n                           () => onRevealDOMNode(linkTargetDOMNode), 'reveal-in-elements') :\n            nothing}\n          ${linkTargetRequest ?\n            renderIconLink('arrow-up-down-circle', i18nString(UIStrings.clickToShowHeader),\n                           () => onRevealHeader(linkTargetRequest), 'reveal-in-network') :\n            nothing}\n        </div>\n      </div>`;\n    // clang-format on\n  });\n\n  // clang-format off\n  return html`\n    <devtools-report-key>${i18nString(UIStrings.disabledFeatures)}</devtools-report-key>\n    <devtools-report-value class=\"policies-list\">\n      ${featureRows}\n      <div class=\"permissions-row\">\n        <devtools-button\n            .variant=${Buttons.Button.Variant.OUTLINED}\n            @click=${onToggleShowDetails}\n            jslog=${VisualLogging.action('hide-disabled-features-details').track({click: true})}>\n          ${i18nString(UIStrings.hideDetails)}\n        </devtools-button>\n      </div>\n    </devtools-report-value>`;\n  // clang-format on\n}\n\ninterface ViewInput {\n  allowed: Protocol.Page.PermissionsPolicyFeatureState[];\n  disallowed: Array<{\n    policy: Protocol.Page.PermissionsPolicyFeatureState,\n    blockReason?: Protocol.Page.PermissionsPolicyBlockReason,\n    linkTargetDOMNode?: SDK.DOMModel.DOMNode,\n    linkTargetRequest?: SDK.NetworkRequest.NetworkRequest,\n  }>;\n  showDetails: boolean;\n  onToggleShowDetails: () => void;\n  onRevealDOMNode: (linkTargetDOMNode: SDK.DOMModel.DOMNode) => Promise<void>;\n  onRevealHeader: (linkTargetRequest: SDK.NetworkRequest.NetworkRequest) => Promise<void>;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nconst DEFAULT_VIEW: View = (input, output, target) => {\n  // clang-format off\n  render(html`\n    <style>${permissionsPolicySectionStyles}</style>\n    <devtools-report-section-header>\n      ${i18n.i18n.lockedString('Permissions Policy')}\n    </devtools-report-section-header>\n    ${renderAllowed(input.allowed)}\n    ${(input.allowed.length > 0 && input.disallowed.length > 0) ?\n      html`<devtools-report-divider class=\"subsection-divider\"></devtools-report-divider>` : nothing}\n    ${renderDisallowed(\n        input.disallowed, input.showDetails,\n        input.onToggleShowDetails, input.onRevealDOMNode, input.onRevealHeader)}\n    <devtools-report-divider></devtools-report-divider>`, target);\n  // clang-format on\n};\n\nexport class PermissionsPolicySection extends UI.Widget.Widget {\n  #policies: Protocol.Page.PermissionsPolicyFeatureState[] = [];\n  #showDetails = false;\n  #view: View;\n\n  constructor(element?: HTMLElement, view = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  set policies(policies: Protocol.Page.PermissionsPolicyFeatureState[]) {\n    this.#policies = policies;\n    this.requestUpdate();\n  }\n\n  get policies(): Protocol.Page.PermissionsPolicyFeatureState[] {\n    return this.#policies;\n  }\n\n  set showDetails(showDetails: boolean) {\n    this.#showDetails = showDetails;\n    this.requestUpdate();\n  }\n\n  get showDetails(): boolean {\n    return this.#showDetails;\n  }\n\n  #toggleShowPermissionsDisallowedDetails(): void {\n    this.showDetails = !this.showDetails;\n  }\n\n  async #revealDOMNode(linkTargetDOMNode: SDK.DOMModel.DOMNode): Promise<void> {\n    await Common.Revealer.reveal(linkTargetDOMNode);\n  }\n\n  async #revealHeader(linkTargetRequest: SDK.NetworkRequest.NetworkRequest): Promise<void> {\n    if (!linkTargetRequest) {\n      return;\n    }\n    const headerName =\n        linkTargetRequest.responseHeaderValue('permissions-policy') ? 'permissions-policy' : 'feature-policy';\n    const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.responseHeaderMatch(\n        linkTargetRequest,\n        {name: headerName, value: ''},\n    );\n    await Common.Revealer.reveal(requestLocation);\n  }\n\n  override async performUpdate(): Promise<void> {\n    const frameManager = SDK.FrameManager.FrameManager.instance();\n    const policies = this.#policies.sort((a, b) => a.feature.localeCompare(b.feature));\n    const allowed = policies.filter(p => p.allowed).sort((a, b) => a.feature.localeCompare(b.feature));\n    const disallowed = policies.filter(p => !p.allowed).sort((a, b) => a.feature.localeCompare(b.feature));\n    const disallowedData = this.#showDetails ? await Promise.all(disallowed.map(async policy => {\n      const frame = policy.locator ? frameManager.getFrame(policy.locator.frameId) : undefined;\n      const blockReason = policy.locator?.blockReason;\n      const linkTargetDOMNode = await ((blockReason === Protocol.Page.PermissionsPolicyBlockReason.IframeAttribute &&\n                                        frame?.getOwnerDOMNodeOrDocument()) ||\n                                       undefined);\n      const resource = frame?.resourceForURL(frame.url);\n      const linkTargetRequest =\n          (blockReason === Protocol.Page.PermissionsPolicyBlockReason.Header && resource?.request) || undefined;\n      return {policy, blockReason, linkTargetDOMNode, linkTargetRequest};\n    })) :\n                                               disallowed.map(policy => ({policy}));\n\n    this.#view(\n        {\n          allowed,\n          disallowed: disallowedData,\n          showDetails: this.#showDetails,\n          onToggleShowDetails: this.#toggleShowPermissionsDisallowedDetails.bind(this),\n          onRevealDOMNode: this.#revealDOMNode.bind(this),\n          onRevealHeader: this.#revealHeader.bind(this),\n        },\n        undefined, this.contentElement);\n  }\n}\n"]}