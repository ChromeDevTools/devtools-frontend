{"version":3,"file":"ProtocolHandlersView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/ProtocolHandlersView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../ui/components/icon_button/icon_button.js';\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as Input from '../../../ui/components/input/input.js';\nimport * as uiI18n from '../../../ui/i18n/i18n.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport protocolHandlersViewStyles from './protocolHandlersView.css.js';\n\nconst {html} = Lit;\n\nconst PROTOCOL_DOCUMENT_URL = 'https://web.dev/url-protocol-handler/';\nconst UIStrings = {\n  /**\n   * @description Status message for when protocol handlers are detected in the manifest\n   * @example {protocolhandler/manifest.json} PH1\n   */\n  protocolDetected:\n      'Found valid protocol handler registration in the {PH1}. With the app installed, test the registered protocols.',\n  /**\n   * @description Status message for when protocol handlers are not detected in the manifest\n   * @example {protocolhandler/manifest.json} PH1\n   */\n  protocolNotDetected:\n      'Define protocol handlers in the {PH1} to register your app as a handler for custom protocols when your app is installed.',\n  /**\n   * @description Text wrapping a link pointing to more information on handling protocol handlers\n   * @example {https://example.com/} PH1\n   */\n  needHelpReadOur: 'Need help? Read {PH1}.',\n  /**\n   * @description Link text for more information on URL protocol handler registrations for PWAs\n   */\n  protocolHandlerRegistrations: 'URL protocol handler registration for PWAs',\n  /**\n   * @description In text hyperlink to the PWA manifest\n   */\n  manifest: 'manifest',\n  /**\n   * @description Text for test protocol button\n   */\n  testProtocol: 'Test protocol',\n  /**\n   * @description Aria text for screen reader to announce they can select a protocol handler in the dropdown\n   */\n  dropdownLabel: 'Select protocol handler',\n  /**\n   * @description Aria text for screen reader to announce they can enter query parameters or endpoints into the textbox\n   */\n  textboxLabel: 'Query parameter or endpoint for protocol handler',\n  /**\n   * @description Placeholder for textbox input field, rest of the URL of protocol to test.\n   */\n  textboxPlaceholder: 'Enter URL',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/ProtocolHandlersView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\ninterface HTMLSelectElementEvent extends Event {\n  target: HTMLSelectElement;\n}\n\ninterface HTMLInputElementEvent extends Event {\n  target: HTMLInputElement;\n}\n\nexport interface ProtocolHandler {\n  protocol: string;\n  url: string;\n}\n\nexport interface ProtocolHandlersData {\n  protocolHandlers: ProtocolHandler[];\n  manifestLink: Platform.DevToolsPath.UrlString;\n}\n\nexport class ProtocolHandlersView extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #protocolHandlers: ProtocolHandler[] = [];\n  #manifestLink: Platform.DevToolsPath.UrlString = Platform.DevToolsPath.EmptyUrlString;\n  #selectedProtocolState = '';\n  #queryInputState = '';\n\n  set data(data: ProtocolHandlersData) {\n    const isNewManifest = this.#manifestLink !== data.manifestLink;\n    this.#protocolHandlers = data.protocolHandlers;\n    this.#manifestLink = data.manifestLink;\n    if (isNewManifest) {\n      this.#update();\n    }\n  }\n\n  #update(): void {\n    this.#queryInputState = '';\n    this.#selectedProtocolState = this.#protocolHandlers[0]?.protocol ?? '';\n    this.#render();\n  }\n\n  #renderStatusMessage(): Lit.TemplateResult {\n    const manifestInTextLink =\n        UI.XLink.XLink.create(this.#manifestLink, i18nString(UIStrings.manifest), undefined, undefined, 'manifest');\n    const statusString = this.#protocolHandlers.length > 0 ? UIStrings.protocolDetected : UIStrings.protocolNotDetected;\n    // clang-format off\n    return html`\n    <div class=\"protocol-handlers-row status\">\n            <devtools-icon class=\"inline-icon\"\n                           name=${this.#protocolHandlers.length > 0 ? 'check-circle' : 'info'}>\n            </devtools-icon>\n            ${uiI18n.getFormatLocalizedString(str_, statusString, {\n      PH1: manifestInTextLink,\n    })}\n    </div>\n    `;\n    // clang-format on\n  }\n\n  #renderProtocolTest(): Lit.LitTemplate {\n    if (this.#protocolHandlers.length === 0) {\n      return Lit.nothing;\n    }\n    const protocolOptions =\n        this.#protocolHandlers.filter(p => p.protocol)\n            .map(p => html`<option value=${p.protocol} jslog=${VisualLogging.item(p.protocol).track({\n                   click: true,\n                 })}>${p.protocol}://</option>`);\n    return html`\n       <div class=\"protocol-handlers-row\">\n        <select class=\"protocol-select\" @change=${this.#handleProtocolSelect} aria-label=${\n        i18nString(UIStrings.dropdownLabel)}>\n           ${protocolOptions}\n        </select>\n        <input .value=${this.#queryInputState} class=\"devtools-text-input\" type=\"text\" @change=${\n        this.#handleQueryInputChange} aria-label=${i18nString(UIStrings.textboxLabel)}\n        placeholder=${i18nString(UIStrings.textboxPlaceholder)} />\n        <devtools-button .variant=${Buttons.Button.Variant.PRIMARY} @click=${this.#handleTestProtocolClick}>\n            ${i18nString(UIStrings.testProtocol)}\n        </devtools-button>\n        </div>\n      `;\n  }\n\n  #handleProtocolSelect = (evt: HTMLSelectElementEvent): void => {\n    this.#selectedProtocolState = evt.target.value;\n  };\n\n  #handleQueryInputChange = (evt: HTMLInputElementEvent): void => {\n    this.#queryInputState = evt.target.value;\n    this.#render();\n  };\n\n  #handleTestProtocolClick = (): void => {\n    const protocolURL = `${this.#selectedProtocolState}://${this.#queryInputState}` as Platform.DevToolsPath.UrlString;\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(protocolURL);\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.CaptureTestProtocolClicked);\n  };\n\n  #render(): void {\n    const protocolDocLink = UI.XLink.XLink.create(\n        PROTOCOL_DOCUMENT_URL, i18nString(UIStrings.protocolHandlerRegistrations), undefined, undefined, 'learn-more');\n    // inspectorCommonStyles is used for the <select> styling that is used for the dropdown\n    // clang-format off\n    Lit.render(html`\n      <style>${protocolHandlersViewStyles}</style>\n      <style>${UI.inspectorCommonStyles}</style>\n      <style>${Input.textInputStyles}</style>\n      ${this.#renderStatusMessage()}\n      <div class=\"protocol-handlers-row\">\n          ${uiI18n.getFormatLocalizedString(str_, UIStrings.needHelpReadOur, {PH1: protocolDocLink})}\n      </div>\n      ${this.#renderProtocolTest()}\n    `, this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-protocol-handlers-view', ProtocolHandlersView);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-protocol-handlers-view': ProtocolHandlersView;\n  }\n}\n"]}