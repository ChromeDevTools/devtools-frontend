{"version":3,"file":"ProtocolHandlersView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/ProtocolHandlersView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/components/icon_button/icon_button.js';\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as Input from '../../../ui/components/input/input.js';\nimport * as uiI18n from '../../../ui/i18n/i18n.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport {\n  html,\n  i18nTemplate as unboundI18nTemplate,\n  type LitTemplate,\n  nothing,\n  render,\n  type TemplateResult\n} from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport protocolHandlersViewStyles from './protocolHandlersView.css.js';\n\nconst PROTOCOL_DOCUMENT_URL = 'https://web.dev/url-protocol-handler/';\nconst UIStrings = {\n  /**\n   * @description Status message for when protocol handlers are detected in the manifest\n   * @example {protocolhandler/manifest.json} PH1\n   */\n  protocolDetected:\n      'Found valid protocol handler registration in the {PH1}. With the app installed, test the registered protocols.',\n  /**\n   * @description Status message for when protocol handlers are not detected in the manifest\n   * @example {protocolhandler/manifest.json} PH1\n   */\n  protocolNotDetected:\n      'Define protocol handlers in the {PH1} to register your app as a handler for custom protocols when your app is installed.',\n  /**\n   * @description Text wrapping a link pointing to more information on handling protocol handlers\n   * @example {https://example.com/} PH1\n   */\n  needHelpReadOur: 'Need help? Read {PH1}.',\n  /**\n   * @description Link text for more information on URL protocol handler registrations for PWAs\n   */\n  protocolHandlerRegistrations: 'URL protocol handler registration for PWAs',\n  /**\n   * @description In text hyperlink to the PWA manifest\n   */\n  manifest: 'manifest',\n  /**\n   * @description Text for test protocol button\n   */\n  testProtocol: 'Test protocol',\n  /**\n   * @description Aria text for screen reader to announce they can select a protocol handler in the dropdown\n   */\n  dropdownLabel: 'Select protocol handler',\n  /**\n   * @description Aria text for screen reader to announce they can enter query parameters or endpoints into the textbox\n   */\n  textboxLabel: 'Query parameter or endpoint for protocol handler',\n  /**\n   * @description Placeholder for textbox input field, rest of the URL of protocol to test.\n   */\n  textboxPlaceholder: 'Enter URL',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/ProtocolHandlersView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst i18nTemplate = unboundI18nTemplate.bind(undefined, str_);\n\nfunction renderStatusMessage(\n    protocolHandlers: readonly ProtocolHandler[], manifestLink: Platform.DevToolsPath.UrlString): TemplateResult {\n  const manifestInTextLink =\n      UI.XLink.XLink.create(manifestLink, i18nString(UIStrings.manifest), undefined, undefined, 'manifest');\n  const statusString = protocolHandlers.length > 0 ? UIStrings.protocolDetected : UIStrings.protocolNotDetected;\n  // clang-format off\n  return html`\n    <div class=\"protocol-handlers-row status\">\n      <devtools-icon class=\"inline-icon\"\n                     name=${protocolHandlers.length > 0 ? 'check-circle' : 'info'}>\n      </devtools-icon>\n      ${uiI18n.getFormatLocalizedString(str_, statusString, {PH1: manifestInTextLink })}\n    </div>`;\n  // clang-format on\n}\n\nfunction renderProtocolTest(\n    protocolHandlers: readonly ProtocolHandler[], queryInputState: string,\n    protocolSelectHandler: (evt: HTMLSelectElementEvent) => void,\n    queryInputChangeHandler: (evt: HTMLInputElementEvent) => void, testProtocolClickHandler: () => void): LitTemplate {\n  if (protocolHandlers.length === 0) {\n    return nothing;\n  }\n  // clang-format off\n  return html`\n    <div class=\"protocol-handlers-row\">\n      <select class=\"protocol-select\" @change=${protocolSelectHandler}\n              aria-label=${i18nString(UIStrings.dropdownLabel)}>\n        ${protocolHandlers.filter(p => p.protocol).map(({protocol}) => html`\n          <option value=${protocol} jslog=${VisualLogging.item(protocol).track({click: true})}>\n            ${protocol}://\n          </option>`)}\n      </select>\n      <input .value=${queryInputState} class=\"devtools-text-input\" type=\"text\"\n             @change=${queryInputChangeHandler} aria-label=${i18nString(UIStrings.textboxLabel)}\n             placeholder=${i18nString(UIStrings.textboxPlaceholder)} />\n      <devtools-button .variant=${Buttons.Button.Variant.PRIMARY} @click=${testProtocolClickHandler}>\n        ${i18nString(UIStrings.testProtocol)}\n      </devtools-button>\n    </div>`;\n  // clang-format on\n}\n\ninterface HTMLSelectElementEvent extends Event {\n  target: HTMLSelectElement;\n}\n\ninterface HTMLInputElementEvent extends Event {\n  target: HTMLInputElement;\n}\n\ninterface ViewInput {\n  protocolHandler: ProtocolHandler[];\n  manifestLink: Platform.DevToolsPath.UrlString;\n  queryInputState: string;\n  protocolSelectHandler: (evt: HTMLSelectElementEvent) => void;\n  queryInputChangeHandler: (evt: HTMLInputElementEvent) => void;\n  testProtocolClickHandler: () => void;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nconst DEFAULT_VIEW: View = (input, _output, target) => {\n  // inspectorCommonStyles is used for the <select> styling that is used for the dropdown\n  // clang-format off\n  render(html`\n    <style>${protocolHandlersViewStyles}</style>\n    <style>${UI.inspectorCommonStyles}</style>\n    <style>${Input.textInputStyles}</style>\n    ${renderStatusMessage(input.protocolHandler, input.manifestLink)}\n    <div class=\"protocol-handlers-row\">\n      ${i18nTemplate(UIStrings.needHelpReadOur, {PH1: html`\n        <x-link href=${PROTOCOL_DOCUMENT_URL} tabindex=0 class=\"devtools-link\" jslog=${\n            VisualLogging.link('learn-more').track({click: true, keydown: 'Enter|Space'})}>\n          ${i18nString(UIStrings.protocolHandlerRegistrations)}\n        </x-link>`})}\n    </div>\n    ${renderProtocolTest(input.protocolHandler, input.queryInputState, input.protocolSelectHandler,\n                         input.queryInputChangeHandler, input.testProtocolClickHandler)}\n  `, target);\n  // clang-format on\n};\n\nexport interface ProtocolHandler {\n  protocol: string;\n  url: string;\n}\n\nexport interface ProtocolHandlersData {\n  protocolHandlers: ProtocolHandler[];\n  manifestLink: Platform.DevToolsPath.UrlString;\n}\n\nexport class ProtocolHandlersView extends UI.Widget.Widget {\n  #protocolHandlers: ProtocolHandler[] = [];\n  #manifestLink: Platform.DevToolsPath.UrlString = Platform.DevToolsPath.EmptyUrlString;\n  #selectedProtocolState = '';\n  #queryInputState = '';\n  #view: View;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {useShadowDom: false});\n    this.#view = view;\n  }\n\n  set protocolHandlers(protocolHandlers: ProtocolHandler[]) {\n    this.#protocolHandlers = protocolHandlers;\n    this.requestUpdate();\n  }\n\n  get protocolHandlers(): ProtocolHandler[] {\n    return this.#protocolHandlers;\n  }\n\n  set manifestLink(manifestLink: Platform.DevToolsPath.UrlString) {\n    const isNewManifest = this.#manifestLink !== manifestLink;\n    this.#manifestLink = manifestLink;\n    if (isNewManifest) {\n      this.#queryInputState = '';\n      this.#selectedProtocolState = this.#protocolHandlers[0]?.protocol ?? '';\n    }\n    this.requestUpdate();\n  }\n\n  get manifestLink(): Platform.DevToolsPath.UrlString {\n    return this.#manifestLink;\n  }\n\n  #handleProtocolSelect = (evt: HTMLSelectElementEvent): void => {\n    this.#selectedProtocolState = evt.target.value;\n  };\n\n  #handleQueryInputChange = (evt: HTMLInputElementEvent): void => {\n    this.#queryInputState = evt.target.value;\n    this.requestUpdate();\n  };\n\n  #handleTestProtocolClick = (): void => {\n    const protocolURL = `${this.#selectedProtocolState}://${this.#queryInputState}` as Platform.DevToolsPath.UrlString;\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(protocolURL);\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.CaptureTestProtocolClicked);\n  };\n\n  override performUpdate(): void {\n    this.#view(\n        {\n          protocolHandler: this.#protocolHandlers,\n          manifestLink: this.#manifestLink,\n          queryInputState: this.#queryInputState,\n          protocolSelectHandler: this.#handleProtocolSelect,\n          queryInputChangeHandler: this.#handleQueryInputChange,\n          testProtocolClickHandler: this.#handleTestProtocolClick,\n        },\n        undefined, this.contentElement);\n  }\n}\n"]}