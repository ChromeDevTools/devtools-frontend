{"version":3,"file":"PreloadingDisabledInfobar.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/PreloadingDisabledInfobar.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../../ui/components/report_view/report_view.js';\nimport '../../../../ui/kit/kit.js';\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as Buttons from '../../../../ui/components/buttons/buttons.js';\nimport * as Dialogs from '../../../../ui/components/dialogs/dialogs.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport {html, i18nTemplate, type LitTemplate, nothing, render} from '../../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../../ui/visual_logging/visual_logging.js';\n\nimport preloadingDisabledInfobarStyles from './preloadingDisabledInfobar.css.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\nconst UIStrings = {\n  /**\n   * @description Infobar text for disabled case\n   */\n  infobarPreloadingIsDisabled: 'Speculative loading is disabled',\n  /**\n   * @description Infobar text for force-enabled case\n   */\n  infobarPreloadingIsForceEnabled: 'Speculative loading is force-enabled',\n  /**\n   * @description Title for dialog\n   */\n  titleReasonsPreventingPreloading: 'Reasons preventing speculative loading',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByPreference: 'User settings or extensions',\n  /**\n   * @description Description in dialog\n   * @example {Preload pages settings (linked to chrome://settings/performance)} PH1\n   * @example {Extensions settings (linked to chrome://extensions)} PH2\n   */\n  descriptionDisabledByPreference:\n      'Speculative loading is disabled because of user settings or an extension. Go to {PH1} to update your preference. Go to {PH2} to disable any extension that blocks speculative loading.',\n  /**\n   * @description Text of link\n   */\n  preloadingPagesSettings: 'Preload pages settings',\n  /**\n   * @description Text of link\n   */\n  extensionsSettings: 'Extensions settings',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByDataSaver: 'Data Saver',\n  /**\n   * @description Description in dialog\n   */\n  descriptionDisabledByDataSaver: 'Speculative loading is disabled because of the operating system\\'s Data Saver mode.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByBatterySaver: 'Battery Saver',\n  /**\n   * @description Description in dialog\n   */\n  descriptionDisabledByBatterySaver:\n      'Speculative loading is disabled because of the operating system\\'s Battery Saver mode.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByHoldbackPrefetchSpeculationRules: 'Prefetch was disabled, but is force-enabled now',\n  /**\n   * @description Description in infobar\n   */\n  descriptionDisabledByHoldbackPrefetchSpeculationRules:\n      'Prefetch is forced-enabled because DevTools is open. When DevTools is closed, prefetch will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByHoldbackPrerenderSpeculationRules: 'Prerendering was disabled, but is force-enabled now',\n  /**\n   * @description Description in infobar\n   */\n  descriptionDisabledByHoldbackPrerenderSpeculationRules:\n      'Prerendering is forced-enabled because DevTools is open. When DevTools is closed, prerendering will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n  /**\n   * @description Footer link for more details\n   */\n  footerLearnMore: 'Learn more',\n} as const;\nconst str_ =\n    i18n.i18n.registerUIStrings('panels/application/preloading/components/PreloadingDisabledInfobar.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst LINK = 'https://developer.chrome.com/blog/prerender-pages/';\n\nexport interface ViewInput {\n  header: Platform.UIString.LocalizedString|null;\n  warnings: Array<{\n    key: Platform.UIString.LocalizedString,\n    valueId: string,\n    placeholders?: Record<string, {\n                  title: Platform.UIString.LocalizedString,\n                  href: Platform.DevToolsPath.UrlString,\n                }>,\n  }>;\n}\n\ntype ViewOutput = unknown;\n\nexport type View = (input: ViewInput, output: ViewOutput, target: HTMLElement|DocumentFragment) => void;\n\nexport const DEFAULT_VIEW: View = (input, _output, target) => {\n  let template: LitTemplate = nothing;\n  if (input.header !== null) {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    template = html`\n        <style>${preloadingDisabledInfobarStyles}</style>\n        <div id=\"container\">\n          <span id=\"header\">${input.header}</span>\n          <devtools-button-dialog .data=${{\n                                    iconName: 'info',\n                                    variant: Buttons.Button.Variant.ICON,\n                                    closeButton: true,\n                                    position: Dialogs.Dialog.DialogVerticalPosition.AUTO,\n                                    horizontalAlignment: Dialogs.Dialog.DialogHorizontalAlignment.AUTO,\n                                    closeOnESC: true,\n                                    closeOnScroll: false,\n                                    dialogTitle: i18nString(UIStrings.titleReasonsPreventingPreloading),\n                                  } as Dialogs.ButtonDialog.ButtonDialogData}\n                                  jslog=${VisualLogging.dialog('preloading-disabled').track({resize: true, keydown: 'Escape'})}>\n            <div id=\"contents\">\n              <devtools-report>\n                ${input.warnings.map(({key, valueId, placeholders = {}}) => {\n                  const value = i18nTemplate(\n                      str_, valueId,\n                      Object.fromEntries(Object.entries(placeholders).map(\n                          ([key, {title, href}]) =>\n                              [key, html`<devtools-link href=${href}>${title}</devtools-link>`])));\n                  return html`\n                      <div class=\"key\">${key}</div>\n                      <div class=\"value\">${value}</div>\n                    `;\n                })}\n              </devtools-report>\n              <div id=\"footer\">\n                <devtools-link href=${LINK} jslogcontext=\"learn-more\">\n                  ${i18nString(UIStrings.footerLearnMore)}\n                </devtools-link>\n              </div>\n            </div>\n          </devtools-button-dialog>\n        </div>`;\n    // clang-format on\n  }\n  render(template, target);\n};\n\nexport class PreloadingDisabledInfobar extends UI.Widget.VBox {\n  #view: View;\n  #disabledByPreference = false;\n  #disabledByDataSaver = false;\n  #disabledByBatterySaver = false;\n  #disabledByHoldbackPrefetchSpeculationRules = false;\n  #disabledByHoldbackPrerenderSpeculationRules = false;\n\n  constructor(view: View = DEFAULT_VIEW) {\n    super({useShadowDom: true});\n    this.#view = view;\n  }\n\n  get disabledByPreference(): boolean {\n    return this.#disabledByPreference;\n  }\n\n  set disabledByPreference(value: boolean) {\n    if (this.#disabledByPreference !== value) {\n      this.#disabledByPreference = value;\n      this.requestUpdate();\n    }\n  }\n\n  get disabledByDataSaver(): boolean {\n    return this.#disabledByDataSaver;\n  }\n\n  set disabledByDataSaver(value: boolean) {\n    if (this.#disabledByDataSaver !== value) {\n      this.#disabledByDataSaver = value;\n      this.requestUpdate();\n    }\n  }\n\n  get disabledByBatterySaver(): boolean {\n    return this.#disabledByBatterySaver;\n  }\n\n  set disabledByBatterySaver(value: boolean) {\n    if (this.#disabledByBatterySaver !== value) {\n      this.#disabledByBatterySaver = value;\n      this.requestUpdate();\n    }\n  }\n\n  get disabledByHoldbackPrefetchSpeculationRules(): boolean {\n    return this.#disabledByHoldbackPrefetchSpeculationRules;\n  }\n\n  set disabledByHoldbackPrefetchSpeculationRules(value: boolean) {\n    if (this.#disabledByHoldbackPrefetchSpeculationRules !== value) {\n      this.#disabledByHoldbackPrefetchSpeculationRules = value;\n      this.requestUpdate();\n    }\n  }\n\n  get disabledByHoldbackPrerenderSpeculationRules(): boolean {\n    return this.#disabledByHoldbackPrerenderSpeculationRules;\n  }\n\n  set disabledByHoldbackPrerenderSpeculationRules(value: boolean) {\n    if (this.#disabledByHoldbackPrerenderSpeculationRules !== value) {\n      this.#disabledByHoldbackPrerenderSpeculationRules = value;\n      this.requestUpdate();\n    }\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    let header: Platform.UIString.LocalizedString|null = null;\n    if (this.#disabledByPreference || this.#disabledByDataSaver || this.#disabledByBatterySaver) {\n      header = i18nString(UIStrings.infobarPreloadingIsDisabled);\n    } else if (this.#disabledByHoldbackPrefetchSpeculationRules || this.#disabledByHoldbackPrerenderSpeculationRules) {\n      header = i18nString(UIStrings.infobarPreloadingIsForceEnabled);\n    }\n    const warnings = [];\n    if (this.#disabledByPreference) {\n      warnings.push({\n        key: i18nString(UIStrings.headerDisabledByPreference),\n        valueId: UIStrings.descriptionDisabledByPreference,\n        placeholders: {\n          PH1: {\n            title: i18nString(UIStrings.preloadingPagesSettings),\n            href: urlString`chrome://settings/performance`,\n          },\n          PH2: {\n            title: i18nString(UIStrings.extensionsSettings),\n            href: urlString`chrome://extensions`,\n          },\n        },\n      });\n    }\n    if (this.#disabledByDataSaver) {\n      warnings.push({\n        key: i18nString(UIStrings.headerDisabledByDataSaver),\n        valueId: UIStrings.descriptionDisabledByDataSaver,\n      });\n    }\n    if (this.#disabledByBatterySaver) {\n      warnings.push({\n        key: i18nString(UIStrings.headerDisabledByBatterySaver),\n        valueId: UIStrings.descriptionDisabledByBatterySaver,\n      });\n    }\n    if (this.#disabledByHoldbackPrefetchSpeculationRules) {\n      warnings.push({\n        key: i18nString(UIStrings.headerDisabledByHoldbackPrefetchSpeculationRules),\n        valueId: UIStrings.descriptionDisabledByHoldbackPrefetchSpeculationRules,\n      });\n    }\n    if (this.#disabledByHoldbackPrerenderSpeculationRules) {\n      warnings.push({\n        key: i18nString(UIStrings.headerDisabledByHoldbackPrerenderSpeculationRules),\n        valueId: UIStrings.descriptionDisabledByHoldbackPrerenderSpeculationRules,\n      });\n    }\n    const input: ViewInput = {\n      header,\n      warnings,\n    };\n    const output: ViewOutput = undefined;\n    this.#view(input, output, this.contentElement);\n  }\n}\n"]}