{"version":3,"file":"PreloadingDisabledInfobar.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/PreloadingDisabledInfobar.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../../ui/components/report_view/report_view.js';\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as Buttons from '../../../../ui/components/buttons/buttons.js';\nimport * as ChromeLink from '../../../../ui/components/chrome_link/chrome_link.js';\nimport * as Dialogs from '../../../../ui/components/dialogs/dialogs.js';\nimport * as LegacyWrapper from '../../../../ui/components/legacy_wrapper/legacy_wrapper.js';\nimport * as RenderCoordinator from '../../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as uiI18n from '../../../../ui/i18n/i18n.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../../ui/visual_logging/visual_logging.js';\n\nimport preloadingDisabledInfobarStyles from './preloadingDisabledInfobar.css.js';\n\nconst {html} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Infobar text for disabled case\n   */\n  infobarPreloadingIsDisabled: 'Speculative loading is disabled',\n  /**\n   * @description Infobar text for force-enabled case\n   */\n  infobarPreloadingIsForceEnabled: 'Speculative loading is force-enabled',\n  /**\n   * @description Title for dialog\n   */\n  titleReasonsPreventingPreloading: 'Reasons preventing speculative loading',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByPreference: 'User settings or extensions',\n  /**\n   * @description Description in dialog\n   * @example {Preload pages settings (linked to chrome://settings/performance)} PH1\n   * @example {Extensions settings (linked to chrome://extensions)} PH2\n   */\n  descriptionDisabledByPreference:\n      'Speculative loading is disabled because of user settings or an extension. Go to {PH1} to update your preference. Go to {PH2} to disable any extension that blocks speculative loading.',\n  /**\n   * @description Text of link\n   */\n  preloadingPagesSettings: 'Preload pages settings',\n  /**\n   * @description Text of link\n   */\n  extensionsSettings: 'Extensions settings',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByDataSaver: 'Data Saver',\n  /**\n   * @description Description in dialog\n   */\n  descriptionDisabledByDataSaver: 'Speculative loading is disabled because of the operating system\\'s Data Saver mode.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByBatterySaver: 'Battery Saver',\n  /**\n   * @description Description in dialog\n   */\n  descriptionDisabledByBatterySaver:\n      'Speculative loading is disabled because of the operating system\\'s Battery Saver mode.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByHoldbackPrefetchSpeculationRules: 'Prefetch was disabled, but is force-enabled now',\n  /**\n   * @description Description in infobar\n   */\n  descriptionDisabledByHoldbackPrefetchSpeculationRules:\n      'Prefetch is forced-enabled because DevTools is open. When DevTools is closed, prefetch will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n  /**\n   * @description Header in dialog\n   */\n  headerDisabledByHoldbackPrerenderSpeculationRules: 'Prerendering was disabled, but is force-enabled now',\n  /**\n   * @description Description in infobar\n   */\n  descriptionDisabledByHoldbackPrerenderSpeculationRules:\n      'Prerendering is forced-enabled because DevTools is open. When DevTools is closed, prerendering will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n  /**\n   * @description Footer link for more details\n   */\n  footerLearnMore: 'Learn more',\n} as const;\nconst str_ =\n    i18n.i18n.registerUIStrings('panels/application/preloading/components/PreloadingDisabledInfobar.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class PreloadingDisabledInfobar extends LegacyWrapper.LegacyWrapper.WrappableComponent<UI.Widget.VBox> {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #data: Protocol.Preload.PreloadEnabledStateUpdatedEvent = {\n    disabledByPreference: false,\n    disabledByDataSaver: false,\n    disabledByBatterySaver: false,\n    disabledByHoldbackPrefetchSpeculationRules: false,\n    disabledByHoldbackPrerenderSpeculationRules: false,\n  };\n\n  connectedCallback(): void {\n    void this.#render();\n  }\n\n  set data(data: Protocol.Preload.PreloadEnabledStateUpdatedEvent) {\n    this.#data = data;\n    void this.#render();\n  }\n\n  async #render(): Promise<void> {\n    await RenderCoordinator.write('PreloadingDisabledInfobar render', () => {\n      Lit.render(this.#renderTemplate(), this.#shadow, {host: this});\n    });\n  }\n\n  #renderTemplate(): Lit.LitTemplate {\n    const forceEnabled =\n        this.#data.disabledByHoldbackPrefetchSpeculationRules || this.#data.disabledByHoldbackPrerenderSpeculationRules;\n    const disabled =\n        this.#data.disabledByPreference || this.#data.disabledByDataSaver || this.#data.disabledByBatterySaver;\n\n    let header;\n    if (disabled) {\n      header = i18nString(UIStrings.infobarPreloadingIsDisabled);\n    } else if (forceEnabled) {\n      header = i18nString(UIStrings.infobarPreloadingIsForceEnabled);\n    } else {\n      return Lit.nothing;\n    }\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return html`\n      <style>${preloadingDisabledInfobarStyles}</style>\n      <div id='container'>\n        <span id='header'>\n          ${header}\n        </span>\n\n        <devtools-button-dialog\n          .data=${{\n            iconName: 'info',\n            variant: Buttons.Button.Variant.ICON,\n            closeButton: true,\n            position: Dialogs.Dialog.DialogVerticalPosition.AUTO,\n            horizontalAlignment: Dialogs.Dialog.DialogHorizontalAlignment.AUTO,\n            closeOnESC: true,\n            closeOnScroll: false,\n            dialogTitle: i18nString(UIStrings.titleReasonsPreventingPreloading),\n          } as Dialogs.ButtonDialog.ButtonDialogData}\n          jslog=${VisualLogging.dialog('preloading-disabled').track({resize: true, keydown: 'Escape'})}\n        >\n          ${this.#dialogContents()}\n        </devtools-button-dialog>\n      </div>\n    `;\n    // clang-format on\n  }\n\n  #dialogContents(): Lit.LitTemplate {\n    const LINK = 'https://developer.chrome.com/blog/prerender-pages/';\n\n    const learnMoreLink =\n        UI.XLink.XLink.create(LINK, i18nString(UIStrings.footerLearnMore), undefined, undefined, 'learn-more');\n    const iconLink = UI.Fragment.html`\n      <x-link class=\"icon-link devtools-link\" tabindex=\"0\" href=\"${LINK}\"></x-link>\n    ` as UI.XLink.XLink;\n\n    return html`\n      <div id='contents'>\n        <devtools-report>\n          ${this.#maybeDisableByPreference()}\n          ${this.#maybeDisableByDataSaver()}\n          ${this.#maybeDisableByBatterySaver()}\n          ${this.#maybeDisableByHoldbackPrefetchSpeculationRules()}\n          ${this.#maybeDisableByHoldbackPrerenderSpeculationRules()}\n        </devtools-report>\n        <div id='footer'>\n          ${learnMoreLink}\n          ${iconLink}\n        </div>\n      </div>\n    `;\n  }\n\n  #maybeKeyValue(shouldShow: boolean, header: string, description: string|Element): Lit.LitTemplate {\n    if (!shouldShow) {\n      return Lit.nothing;\n    }\n\n    return html`\n      <div class='key'>\n        ${header}\n      </div>\n      <div class='value'>\n        ${description}\n      </div>\n    `;\n  }\n\n  #maybeDisableByPreference(): Lit.LitTemplate {\n    const preloadingSettingLink = new ChromeLink.ChromeLink.ChromeLink();\n    preloadingSettingLink.href = 'chrome://settings/performance' as Platform.DevToolsPath.UrlString;\n    preloadingSettingLink.textContent = i18nString(UIStrings.preloadingPagesSettings);\n    const extensionsSettingLink = new ChromeLink.ChromeLink.ChromeLink();\n    extensionsSettingLink.href = 'chrome://extensions' as Platform.DevToolsPath.UrlString;\n    extensionsSettingLink.textContent = i18nString(UIStrings.extensionsSettings);\n    const description = uiI18n.getFormatLocalizedString(\n        str_, UIStrings.descriptionDisabledByPreference, {PH1: preloadingSettingLink, PH2: extensionsSettingLink});\n    return this.#maybeKeyValue(\n        this.#data.disabledByPreference, i18nString(UIStrings.headerDisabledByPreference), description);\n  }\n\n  #maybeDisableByDataSaver(): Lit.LitTemplate {\n    return this.#maybeKeyValue(\n        this.#data.disabledByDataSaver, i18nString(UIStrings.headerDisabledByDataSaver),\n        i18nString(UIStrings.descriptionDisabledByDataSaver));\n  }\n\n  #maybeDisableByBatterySaver(): Lit.LitTemplate {\n    return this.#maybeKeyValue(\n        this.#data.disabledByBatterySaver, i18nString(UIStrings.headerDisabledByBatterySaver),\n        i18nString(UIStrings.descriptionDisabledByBatterySaver));\n  }\n\n  #maybeDisableByHoldbackPrefetchSpeculationRules(): Lit.LitTemplate {\n    return this.#maybeKeyValue(\n        this.#data.disabledByHoldbackPrefetchSpeculationRules,\n        i18nString(UIStrings.headerDisabledByHoldbackPrefetchSpeculationRules),\n        i18nString(UIStrings.descriptionDisabledByHoldbackPrefetchSpeculationRules));\n  }\n\n  #maybeDisableByHoldbackPrerenderSpeculationRules(): Lit.LitTemplate {\n    return this.#maybeKeyValue(\n        this.#data.disabledByHoldbackPrerenderSpeculationRules,\n        i18nString(UIStrings.headerDisabledByHoldbackPrerenderSpeculationRules),\n        i18nString(UIStrings.descriptionDisabledByHoldbackPrerenderSpeculationRules));\n  }\n}\n\ncustomElements.define('devtools-resources-preloading-disabled-infobar', PreloadingDisabledInfobar);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-resources-preloading-disabled-infobar': PreloadingDisabledInfobar;\n  }\n}\n"]}