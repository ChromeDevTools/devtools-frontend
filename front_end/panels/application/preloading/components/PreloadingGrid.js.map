{"version":3,"file":"PreloadingGrid.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/PreloadingGrid.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../../ui/legacy/components/data_grid/data_grid.js';\nimport '../../../../ui/kit/kit.js';\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport preloadingGridStyles from './preloadingGrid.css.js';\nimport {capitalizedAction, composedStatus, ruleSetTagOrLocationShort, sortOrder} from './PreloadingString.js';\n\nconst {PreloadingStatus} = SDK.PreloadingModel;\n\nconst UIStrings = {\n  /**\n   * @description Column header: Action of preloading (prefetch/prerender)\n   */\n  action: 'Action',\n  /**\n   * @description Column header: A rule set of preloading\n   */\n  ruleSet: 'Rule set',\n  /**\n   * @description Column header: Status of preloading attempt\n   */\n  status: 'Status',\n  /**\n   * @description Status: Prerender failed, but prefetch is available\n   */\n  prefetchFallbackReady: 'Prefetch fallback ready',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/preloading/components/PreloadingGrid.ts', UIStrings);\nexport const i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst {render, html, nothing, Directives: {styleMap}} = Lit;\n\n// Shorten URL if a preloading attempt is same-origin.\nfunction urlShort(row: PreloadingGridRow, securityOrigin: string|null): string {\n  const url = row.pipeline.getOriginallyTriggered().key.url;\n  return securityOrigin && url.startsWith(securityOrigin) ? url.slice(securityOrigin.length) : url;\n}\n\nexport interface PreloadingGridRow {\n  id: string;\n  pipeline: SDK.PreloadingModel.PreloadPipeline;\n  ruleSets: Protocol.Preload.RuleSet[];\n}\n\nexport interface ViewInput {\n  rows?: PreloadingGridRow[];\n  pageURL?: Platform.DevToolsPath.UrlString;\n  onSelect?: ({rowId}: {rowId: string}) => void;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const PRELOADING_GRID_DEFAULT_VIEW: View = (input, _output, target): void => {\n  if (!input.rows || input.pageURL === undefined) {\n    render(nothing, target);\n    return;\n  }\n\n  const {rows, pageURL} = input;\n  const securityOrigin = pageURL === '' ? null : (new Common.ParsedURL.ParsedURL(pageURL)).securityOrigin();\n\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n  render(html`\n    <style>${preloadingGridStyles}</style>\n    <div class=\"preloading-container\">\n      <devtools-data-grid striped>\n        <table>\n          <tr>\n            <th id=\"url\" weight=\"40\" sortable>${i18n.i18n.lockedString('URL')}</th>\n            <th id=\"action\" weight=\"15\" sortable>${i18nString(UIStrings.action)}</th>\n            <th id=\"rule-set\" weight=\"20\" sortable>${i18nString(UIStrings.ruleSet)}</th>\n            <th id=\"status\" weight=\"40\" sortable>${i18nString(UIStrings.status)}</th>\n          </tr>\n          ${rows.map(row => {\n            const attempt = row.pipeline.getOriginallyTriggered();\n            const prefetchStatus = row.pipeline.getPrefetch()?.status;\n            const prerenderStatus = row.pipeline.getPrerender()?.status;\n            const hasWarning =\n                (prerenderStatus === PreloadingStatus.FAILURE &&\n                (prefetchStatus === PreloadingStatus.READY || prefetchStatus === PreloadingStatus.SUCCESS));\n            const hasError = row.pipeline.getOriginallyTriggered().status === PreloadingStatus.FAILURE;\n            return html`<tr @select=${() => input.onSelect?.({rowId: row.id})}>\n              <td title=${attempt.key.url}>${urlShort(row, securityOrigin)}</td>\n              <td>${capitalizedAction(attempt.action)}</td>\n              <td>${row.ruleSets.length === 0 ? '' : ruleSetTagOrLocationShort(row.ruleSets[0], pageURL)}</td>\n              <td data-value=${sortOrder(attempt)}>\n                <div style=${styleMap({color: hasWarning ? 'var(--sys-color-orange-bright)'\n                                              : hasError   ? 'var(--sys-color-error)'\n                                                            : 'var(--sys-color-on-surface)'})}>\n                  ${(hasError || hasWarning) ?  html`\n                    <devtools-icon\n                      name=${hasWarning ? 'warning-filled' : 'cross-circle-filled'}\n                      class='medium'\n                      style=${styleMap({\n                        'vertical-align': 'sub',\n                      })}\n                    ></devtools-icon>` : ''}\n                  ${hasWarning ? i18nString(UIStrings.prefetchFallbackReady) : composedStatus(attempt)}\n                </div>\n              </td>\n            </tr>`;\n          })}\n        </table>\n      </devtools-data-grid>\n    </div>\n  `, target);\n};  // clang-format on\n\n/** Grid component to show prerendering attempts. **/\nexport class PreloadingGrid extends UI.Widget.VBox {\n  #view: View;\n  #rows?: PreloadingGridRow[];\n  #pageURL?: Platform.DevToolsPath.UrlString;\n  #onSelect?: ({rowId}: {rowId: string}) => void;\n\n  constructor(view?: View) {\n    super();\n    this.#view = view ?? PRELOADING_GRID_DEFAULT_VIEW;\n    this.requestUpdate();\n  }\n\n  set rows(rows: PreloadingGridRow[]) {\n    this.#rows = rows;\n    this.requestUpdate();\n  }\n\n  set pageURL(pageURL: Platform.DevToolsPath.UrlString) {\n    this.#pageURL = pageURL;\n    this.requestUpdate();\n  }\n\n  set onSelect(onSelect: ({rowId}: {rowId: string}) => void) {\n    this.#onSelect = onSelect;\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    const viewInput: ViewInput = {\n      rows: this.#rows,\n      pageURL: this.#pageURL,\n      onSelect: this.#onSelect?.bind(this),\n    };\n    this.#view(viewInput, undefined, this.contentElement);\n  }\n}\n"]}