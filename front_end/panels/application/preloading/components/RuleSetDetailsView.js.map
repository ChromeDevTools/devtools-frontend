{"version":3,"file":"RuleSetDetailsView.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/RuleSetDetailsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as Formatter from '../../../../models/formatter/formatter.js';\nimport * as CodeMirror from '../../../../third_party/codemirror.next/codemirror.next.js';\nimport * as CodeHighlighter from '../../../../ui/components/code_highlighter/code_highlighter.js';\nimport * as TextEditor from '../../../../ui/components/text_editor/text_editor.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport {html, nothing, render} from '../../../../ui/lit/lit.js';\n\nimport ruleSetDetailsViewStyles from './RuleSetDetailsView.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Text in RuleSetDetailsView of the Application panel if no element is selected. An element here is an item in a\n   *             table of speculation rules. Speculation rules define the rules when and which urls should be prefetched.\n   *             https://developer.chrome.com/docs/devtools/application/debugging-speculation-rules\n   */\n  noElementSelected: 'No element selected',\n  /**\n   * @description Text in RuleSetDetailsView of the Application panel if no element is selected. An element here is an item in a\n   *             table of speculation rules. Speculation rules define the rules when and which urls should be prefetched.\n   *             https://developer.chrome.com/docs/devtools/application/debugging-speculation-rules\n   */\n  selectAnElementForMoreDetails: 'Select an element for more details',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/preloading/components/RuleSetDetailsView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\ntype RuleSet = Protocol.Preload.RuleSet;\n\nconst codeMirrorJsonType = await CodeHighlighter.CodeHighlighter.languageFromMIME('application/json');\n\nexport interface ViewInput {\n  url: string;\n  errorMessage?: string;\n  editorState: CodeMirror.EditorState;\n  sourceText: string;\n}\n\nexport const DEFAULT_VIEW = (input: ViewInput|null, _output: object, target: HTMLElement): void => {\n  // clang-format off\n  render(html`\n    <style>${ruleSetDetailsViewStyles}</style>\n    <style>${UI.inspectorCommonStyles}</style>\n    ${input\n      ? html`\n        <div class=\"content\">\n          <div class=\"ruleset-header\" id=\"ruleset-url\">${input.url}</div>\n          ${input.errorMessage ? html`\n            <div class=\"ruleset-header\">\n              <devtools-icon name=\"cross-circle\" class=\"medium\">\n              </devtools-icon>\n              <span id=\"error-message-text\">${input.errorMessage}</span>\n            </div>\n          ` : nothing}\n        </div>\n        <div class=\"text-ellipsis\">\n          <devtools-text-editor .style.flexGrow=${'1'} .state=${input.editorState}></devtools-text-editor>\n        </div>`\n      : html`\n          <div class=\"placeholder\">\n            <div class=\"empty-state\">\n              <span class=\"empty-state-header\">${i18nString(UIStrings.noElementSelected)}</span>\n              <span class=\"empty-state-description\">${i18nString(UIStrings.selectAnElementForMoreDetails)}</span>\n            </div>\n          </div>`\n    }\n    `, target);\n  // clang-format on\n};\n\nexport class RuleSetDetailsView extends UI.Widget.VBox {\n  readonly #view: typeof DEFAULT_VIEW;\n  #ruleSet: RuleSet|null = null;\n  #shouldPrettyPrint = true;\n\n  constructor(element?: HTMLElement, view = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.requestUpdate();\n  }\n\n  set ruleSet(ruleSet: RuleSet|null) {\n    this.#ruleSet = ruleSet;\n    this.requestUpdate();\n  }\n\n  set shouldPrettyPrint(shouldPrettyPrint: boolean) {\n    this.#shouldPrettyPrint = shouldPrettyPrint;\n    this.requestUpdate();\n  }\n\n  override async performUpdate(): Promise<void> {\n    if (!this.#ruleSet) {\n      this.#view(null, {}, this.contentElement);\n      return;\n    }\n\n    const sourceText = await this.#getSourceText();\n    const editorState = CodeMirror.EditorState.create({\n      doc: sourceText,\n      extensions: [\n        TextEditor.Config.baseConfiguration(sourceText),\n        CodeMirror.lineNumbers(),\n        CodeMirror.EditorState.readOnly.of(true),\n        codeMirrorJsonType as CodeMirror.Extension,\n        CodeMirror.syntaxHighlighting(CodeHighlighter.CodeHighlighter.highlightStyle),\n      ],\n    });\n\n    this.#view(\n        {\n          url: this.#ruleSet.url || SDK.TargetManager.TargetManager.instance().inspectedURL(),\n          errorMessage: this.#ruleSet.errorMessage,\n          editorState,\n          sourceText,\n        },\n        {}, this.contentElement);\n  }\n\n  async #getSourceText(): Promise<string> {\n    if (this.#shouldPrettyPrint && this.#ruleSet?.sourceText !== undefined) {\n      const formattedResult =\n          await Formatter.ScriptFormatter.formatScriptContent('application/json', this.#ruleSet.sourceText);\n      return formattedResult.formattedContent;\n    }\n\n    return this.#ruleSet?.sourceText || '';\n  }\n}\n"]}