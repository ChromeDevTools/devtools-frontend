{"version":3,"file":"RuleSetGrid.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/RuleSetGrid.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../../ui/legacy/components/data_grid/data_grid.js';\nimport '../../../../ui/kit/kit.js';\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport {assertNotNullOrUndefined} from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../../generated/protocol.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport {Directives, html, type LitTemplate, nothing, render} from '../../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../../ui/visual_logging/visual_logging.js';\nimport * as NetworkForward from '../../../network/forward/forward.js';\nimport * as PreloadingHelper from '../helper/helper.js';\n\nimport * as PreloadingString from './PreloadingString.js';\nimport ruleSetGridStyles from './ruleSetGrid.css.js';\n\nconst {styleMap} = Directives;\n\nconst UIStrings = {\n  /**\n   * @description Column header: Short URL of rule set.\n   */\n  ruleSet: 'Rule set',\n  /**\n   * @description Column header: Show how many preloads are associated if valid, error counts if invalid.\n   */\n  status: 'Status',\n  /**\n   * @description button: Title of button to reveal the corresponding request of rule set in Elements panel\n   */\n  clickToOpenInElementsPanel: 'Click to open in Elements panel',\n  /**\n   * @description button: Title of button to reveal the corresponding request of rule set in Network panel\n   */\n  clickToOpenInNetworkPanel: 'Click to open in Network panel',\n  /**\n   * @description Value of status, specifying rule set contains how many errors.\n   */\n  errors: '{errorCount, plural, =1 {# error} other {# errors}}',\n  /**\n   * @description button: Title of button to reveal preloading attempts with filter by selected rule set\n   */\n  buttonRevealPreloadsAssociatedWithRuleSet: 'Reveal speculative loads associated with this rule set',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/application/preloading/components/RuleSetGrid.ts', UIStrings);\nexport const i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface RuleSetGridData {\n  rows: RuleSetGridRow[];\n  pageURL: Platform.DevToolsPath.UrlString;\n}\n\nexport interface RuleSetGridRow {\n  ruleSet: Protocol.Preload.RuleSet;\n  preloadsStatusSummary: string;\n}\n\nexport type View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\n\nexport interface ViewInput {\n  data: RuleSetGridData|null;\n  onSelect: (ruleSetId: Protocol.Preload.RuleSetId) => void;\n  onRevealInElements: (ruleSet: Protocol.Preload.RuleSet) => void;\n  onRevealInNetwork: (ruleSet: Protocol.Preload.RuleSet) => void;\n  onRevealPreloadsAssociatedWithRuleSet: (ruleSet: Protocol.Preload.RuleSet) => void;\n}\n\nexport type ViewOutput = unknown;\n\nexport const DEFAULT_VIEW: View = (input, _output, target) => {\n  let template: LitTemplate = nothing;\n  if (input.data !== null) {\n    const {rows, pageURL} = input.data;\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    template =\n      html`\n          <style>${ruleSetGridStyles}</style>\n          <div class=\"ruleset-container\" jslog=${VisualLogging.pane('preloading-rules')}>\n            <devtools-data-grid striped>\n              <table>\n                <tr>\n                  <th id=\"rule-set\" weight=\"20\" sortable>\n                    ${i18nString(UIStrings.ruleSet)}\n                  </th>\n                  <th id=\"status\" weight=\"80\" sortable>\n                    ${i18nString(UIStrings.status)}\n                  </th>\n                </tr>\n                ${rows.map(({ruleSet, preloadsStatusSummary}) => {\n                  const location = PreloadingString.ruleSetTagOrLocationShort(ruleSet, pageURL);\n                  const revealInElements = ruleSet.backendNodeId !== undefined;\n                  const revealInNetwork = ruleSet.url !== undefined && ruleSet.requestId;\n                  return html`\n                    <tr @select=${() => input.onSelect(ruleSet.id)}>\n                      <td>\n                        ${revealInElements || revealInNetwork ? html`\n                          <button class=\"link\" role=\"link\"\n                              @click=${() => {\n                                if (revealInElements) {\n                                  input.onRevealInElements(ruleSet);\n                                } else {\n                                  input.onRevealInNetwork(ruleSet);\n                                }\n                              }}\n                              title=${revealInElements ? i18nString(UIStrings.clickToOpenInElementsPanel)\n                                                      : i18nString(UIStrings.clickToOpenInNetworkPanel)}\n                              style=${styleMap({\n                                border: 'none',\n                                background: 'none',\n                                color: 'var(--icon-link)',\n                                cursor: 'pointer',\n                                'text-decoration': 'underline',\n                                'padding-inline-start': '0',\n                                'padding-inline-end': '0',\n                              })}\n                              jslog=${VisualLogging\n                                  .action(revealInElements ? 'reveal-in-elements' : 'reveal-in-network')\n                                  .track({click: true})}\n                            >\n                              <devtools-icon name=${revealInElements ? 'code-circle' : 'arrow-up-down-circle'} class=\"medium\"\n                                style=${styleMap({\n                                  color: 'var(--icon-link)',\n                                  'vertical-align': 'sub',\n                                })}\n                              ></devtools-icon>\n                              ${location}\n                            </button>`\n                            : location}\n                    </td>\n                    <td>\n                      ${ruleSet.errorType !== undefined ? html`\n                        <span style=${styleMap({color: 'var(--sys-color-error)'})}>\n                          ${i18nString(UIStrings.errors, {errorCount: 1})}\n                        </span>` : ''} ${ruleSet.errorType !== Protocol.Preload.RuleSetErrorType.SourceIsNotJsonObject &&\n                        ruleSet.errorType !== Protocol.Preload.RuleSetErrorType.InvalidRulesetLevelTag ?\n                        html`\n                        <button class=\"link\" role=\"link\"\n                          @click=${() => input.onRevealPreloadsAssociatedWithRuleSet(ruleSet)}\n                          title=${i18nString(UIStrings.buttonRevealPreloadsAssociatedWithRuleSet)}\n                          style=${styleMap({\n                            color: 'var(--sys-color-primary)',\n                            'text-decoration': 'underline',\n                            cursor: 'pointer',\n                            border: 'none',\n                            background: 'none',\n                            'padding-inline-start': '0',\n                            'padding-inline-end': '0',\n                          })}\n                          jslog=${VisualLogging.action('reveal-preloads').track({click: true})}>\n                          ${preloadsStatusSummary}\n                        </button>` : ''}\n                    </td>\n                  </tr>\n                `;})}\n              </table>\n            </devtools-data-grid>\n          </div>`;\n    // clang-format on\n  }\n  render(template, target);\n};\n\n/** Grid component to show SpeculationRules rule sets. **/\nexport class RuleSetGrid extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.VBox>(UI.Widget.VBox) {\n  readonly #view: View;\n  #data: RuleSetGridData|null = null;\n\n  constructor(view: View = DEFAULT_VIEW) {\n    super({useShadowDom: true});\n    this.#view = view;\n  }\n\n  get data(): RuleSetGridData|null {\n    return this.#data;\n  }\n\n  set data(data: RuleSetGridData|null) {\n    this.#data = data;\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    const input: ViewInput = {\n      data: this.#data,\n      onSelect: this.dispatchEventToListeners.bind(this, Events.SELECT),\n      onRevealInElements: this.#revealSpeculationRulesInElements.bind(this),\n      onRevealInNetwork: this.#revealSpeculationRulesInNetwork.bind(this),\n      onRevealPreloadsAssociatedWithRuleSet: this.#revealAttemptViewWithFilter.bind(this),\n    };\n    const output = undefined;\n    this.#view(input, output, this.contentElement);\n  }\n\n  #revealSpeculationRulesInElements(ruleSet: Protocol.Preload.RuleSet): void {\n    assertNotNullOrUndefined(ruleSet.backendNodeId);\n\n    const target = SDK.TargetManager.TargetManager.instance().scopeTarget();\n    if (target === null) {\n      return;\n    }\n\n    void Common.Revealer.reveal(new SDK.DOMModel.DeferredDOMNode(target, ruleSet.backendNodeId));\n  }\n\n  #revealSpeculationRulesInNetwork(ruleSet: Protocol.Preload.RuleSet): void {\n    assertNotNullOrUndefined(ruleSet.requestId);\n    const request = SDK.TargetManager.TargetManager.instance()\n                        .scopeTarget()\n                        ?.model(SDK.NetworkManager.NetworkManager)\n                        ?.requestForId(ruleSet.requestId) ||\n        null;\n    if (request === null) {\n      return;\n    }\n\n    const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n        request, NetworkForward.UIRequestLocation.UIRequestTabs.PREVIEW, {clearFilter: false});\n    void Common.Revealer.reveal(requestLocation);\n  }\n\n  #revealAttemptViewWithFilter(ruleSet: Protocol.Preload.RuleSet): void {\n    void Common.Revealer.reveal(new PreloadingHelper.PreloadingForward.AttemptViewWithFilter(ruleSet.id));\n  }\n}\n\nexport const enum Events {\n  SELECT = 'select',\n}\n\nexport interface EventTypes {\n  [Events.SELECT]: Protocol.Preload.RuleSetId;\n}\n"]}