{"version":3,"file":"AiCodeCompletionSummaryToolbar.js","sourceRoot":"","sources":["../../../../../../front_end/panels/common/AiCodeCompletionSummaryToolbar.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/components/spinners/spinners.js';\nimport '../../ui/components/tooltips/tooltips.js';\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {Directives, html, nothing, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {AiCodeCompletionDisclaimer} from './AiCodeCompletionDisclaimer.js';\nimport styles from './aiCodeCompletionSummaryToolbar.css.js';\n\nconst UIStringsNotTranslate = {\n  /**\n   * @description Text for recitation notice\n   */\n  generatedCodeMayBeSubjectToALicense: 'Generated code may be subject to a license.',\n  /**\n   * @description Text for citations\n   */\n  viewSources: 'View Sources',\n} as const;\n\nconst lockedString = i18n.i18n.lockedString;\n\nexport interface AiCodeCompletionSummaryToolbarProps {\n  citationsTooltipId: string;\n  disclaimerTooltipId?: string;\n  spinnerTooltipId?: string;\n  hasTopBorder?: boolean;\n}\n\nexport interface ViewInput {\n  disclaimerTooltipId?: string;\n  spinnerTooltipId?: string;\n  citations?: Set<string>;\n  citationsTooltipId: string;\n  loading: boolean;\n  hasTopBorder: boolean;\n  aidaAvailability?: Host.AidaClient.AidaAccessPreconditions;\n}\n\nexport type View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const DEFAULT_SUMMARY_TOOLBAR_VIEW: View = (input, _output, target) => {\n  if (input.aidaAvailability !== Host.AidaClient.AidaAccessPreconditions.AVAILABLE) {\n    render(nothing, target);\n    return;\n  }\n  const toolbarClasses = Directives.classMap({\n    'ai-code-completion-summary-toolbar': true,\n    'has-disclaimer': Boolean(input.disclaimerTooltipId),\n    'has-recitation-notice': Boolean(input.citations && input.citations.size > 0),\n    'has-top-border': input.hasTopBorder,\n  });\n\n  // clang-format off\n  const disclaimer = input.disclaimerTooltipId && input.spinnerTooltipId ?\n    html`<devtools-widget\n            .widgetConfig=${UI.Widget.widgetConfig(AiCodeCompletionDisclaimer, {\n      disclaimerTooltipId: input.disclaimerTooltipId,\n      spinnerTooltipId: input.spinnerTooltipId,\n      loading: input.loading,\n    })} class=\"disclaimer-widget\"></devtools-widget>` : nothing;\n\n  const recitationNotice = input.citations && input.citations.size > 0 ?\n    html`<div class=\"ai-code-completion-recitation-notice\">\n                ${lockedString(UIStringsNotTranslate.generatedCodeMayBeSubjectToALicense)}\n                <span class=\"link\"\n                    role=\"link\"\n                    aria-details=${input.citationsTooltipId}\n                    aria-describedby=${input.citationsTooltipId}\n                    tabIndex=\"0\">\n                  ${lockedString(UIStringsNotTranslate.viewSources)}&nbsp;${lockedString('(' + input.citations.size + ')')}\n                </span>\n                <devtools-tooltip\n                    id=${input.citationsTooltipId}\n                    variant=${'rich'}\n                    jslogContext=${'ai-code-completion-citations'}\n                ><div class=\"citations-tooltip-container\">\n                    ${Directives.repeat(input.citations, citation => html`<x-link\n                        tabIndex=\"0\"\n                        href=${citation}\n                        jslog=${VisualLogging.link('ai-code-completion-citations.citation-link').track({\n      click: true\n    })}>${citation}</x-link>`)}</div></devtools-tooltip>\n            </div>` : nothing;\n\n  render(\n    html`\n        <style>${styles}</style>\n        <div class=${toolbarClasses}>\n          ${disclaimer}\n          ${recitationNotice}\n        </div>\n        `, target);\n  // clang-format on\n};\n\nexport class AiCodeCompletionSummaryToolbar extends UI.Widget.Widget {\n  readonly #view: View;\n\n  #disclaimerTooltipId?: string;\n  #spinnerTooltipId?: string;\n  #citationsTooltipId: string;\n  #citations = new Set<string>();\n  #loading = false;\n  #hasTopBorder = false;\n\n  #aidaAvailability?: Host.AidaClient.AidaAccessPreconditions;\n  #boundOnAidaAvailabilityChange: () => Promise<void>;\n\n  constructor(props: AiCodeCompletionSummaryToolbarProps, view?: View) {\n    super();\n    this.#disclaimerTooltipId = props.disclaimerTooltipId;\n    this.#spinnerTooltipId = props.spinnerTooltipId;\n    this.#citationsTooltipId = props.citationsTooltipId;\n    this.#hasTopBorder = props.hasTopBorder ?? false;\n    this.#boundOnAidaAvailabilityChange = this.#onAidaAvailabilityChange.bind(this);\n    this.#view = view ?? DEFAULT_SUMMARY_TOOLBAR_VIEW;\n    this.requestUpdate();\n  }\n\n  async #onAidaAvailabilityChange(): Promise<void> {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaAvailability) {\n      this.#aidaAvailability = currentAidaAvailability;\n      this.requestUpdate();\n    }\n  }\n\n  setLoading(loading: boolean): void {\n    this.#loading = loading;\n    this.requestUpdate();\n  }\n\n  updateCitations(citations: string[]): void {\n    citations.forEach(citation => this.#citations.add(citation));\n    this.requestUpdate();\n  }\n\n  clearCitations(): void {\n    this.#citations.clear();\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    this.#view(\n        {\n          disclaimerTooltipId: this.#disclaimerTooltipId,\n          spinnerTooltipId: this.#spinnerTooltipId,\n          citations: this.#citations,\n          citationsTooltipId: this.#citationsTooltipId,\n          loading: this.#loading,\n          hasTopBorder: this.#hasTopBorder,\n          aidaAvailability: this.#aidaAvailability,\n        },\n        undefined, this.contentElement);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n    void this.#onAidaAvailabilityChange();\n  }\n\n  override willHide(): void {\n    super.willHide();\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n  }\n}\n"]}