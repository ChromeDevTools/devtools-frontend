{"version":3,"file":"Annotation.js","sourceRoot":"","sources":["../../../../../../front_end/panels/common/Annotation.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAC7B,oDAAoD;AACpD,4DAA4D;AAE5D,OAAO,KAAK,WAAW,MAAM,yCAAyC,CAAC;AACvE,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAChD,OAAO,KAAK,YAAY,MAAM,gDAAgD,CAAC;AAC/E,OAAO,EAAC,IAAI,EAAE,OAAO,EAAE,MAAM,EAAC,MAAM,qBAAqB,CAAC;AAC1D,OAAO,KAAK,aAAa,MAAM,2CAA2C,CAAC;AAE3E,OAAO,gBAAgB,MAAM,qBAAqB,CAAC;AAEnD,0EAA0E;AAC1E,0CAA0C;AAC1C,EAAE;AACF,2EAA2E;AAC3E,yEAAyE;AACzE,uEAAuE;AACvE,wEAAwE;AACxE,yCAAyC;AAEzC,8EAA8E;AAC9E,0FAA0F;AAC1F,MAAM,gCAAgC,GAAG,CAAC,CAAC;AAC3C,2DAA2D;AAC3D,MAAM,sBAAsB,GAAG,CAAC,CAAC;AAcjC,MAAM,CAAC,MAAM,YAAY,GAAS,CAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE;IACrD,MAAM,EAAC,SAAS,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,EAAE,eAAe,EAAE,YAAY,EAAE,YAAY,EAAC,GAAG,KAAK,CAAC;IAEhH,mFAAmF;IACnF,mFAAmF;IACnF,+DAA+D;IAC/D,MAAM,cAAc,GAAG,YAAY,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC,gBAAgB,CAAC,sBAAsB,CAAC,CAAC;IAErG,MAAM,aAAa,GAAG;QACpB,QAAQ,CAAC,CAAC,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE;QACxC,CAAC,UAAU,CAAC,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC,EAAE;KAC3C,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAEZ,mBAAmB;IACnB,MAAM,CAAC,IAAI,CAAA;aACA,gBAAgB;MACvB,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAA;;gBAEL,gCAAgC,GAAG,CAAC;iBACnC,sBAAsB;;eAExB,gCAAgC;;eAEhC,gCAAgC,GAAG,CAAC;eACpC,sBAAsB;mBAClB,cAAc;;;;eAIlB,gCAAgC;;;iBAG9B,cAAc;;;KAG1B,CAAC,CAAC,CAAC,OAAO;iCACkB,aAAa,WAAW,UAAU,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI;QACjF,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG;;MAE1B,eAAe,CAAC,CAAC;QACf,IAAI,CAAA,eAAe,YAAY;;;eAGxB,CAAC,CAAC,CAAC,OAAO;KACpB,EAAE,MAAM,CAAC,CAAC;IACb,kBAAkB;AACpB,CAAC,CAAC;AAEF,MAAM,OAAO,UAAW,SAAQ,EAAE,CAAC,MAAM,CAAC,MAAM;IACrC,KAAK,CAAO;IACZ,GAAG,CAAS;IACrB,UAAU,CAAS;IACnB,EAAE,GAAG,CAAC,CAAC;IACP,EAAE,GAAG,CAAC,CAAC;IACP,WAAW,GAAG,KAAK,CAAC;IACpB,SAAS,GAAG,KAAK,CAAC;IAClB,SAAS,GAAG,KAAK,CAAC;IAClB,WAAW,GAAG,KAAK,CAAC;IACpB,gBAAgB,GAAG,KAAK,CAAC;IAEzB,YACI,EAAU,EAAE,KAAa,EAAE,YAAqB,EAAE,QAAiB,EAAE,UAAmB,EACxF,eAAwB,EAAE,IAAI,GAAG,YAAY;QAC/C,KAAK,CAAC,EAAC,KAAK,EAAE,GAAG,aAAa,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,KAAK,CAAC,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,EAAE,EAAE,YAAY,EAAE,IAAI,EAAC,CAAC,CAAC;QACjG,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,WAAW,GAAG,YAAY,CAAC;QAChC,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;QAC9B,IAAI,CAAC,gBAAgB,GAAG,eAAe,CAAC;IAC1C,CAAC;IAED,OAAO;QACL,IAAI,CAAC,WAAW,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC;QACrC,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,aAAa;QACX,IAAI,CAAC,IAAI,EAAE,CAAC;QACZ,WAAW,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACzE,CAAC;IAEQ,QAAQ;QACf,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC;QACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC;QACxC,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAEQ,aAAa;QACpB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACtB,OAAO;QACT,CAAC;QACD,MAAM,KAAK,GAAG;YACZ,SAAS,EAAE,IAAI,CAAC,UAAU;YAC1B,UAAU,EAAE,IAAI,CAAC,WAAW;YAC5B,QAAQ,EAAE,IAAI,CAAC,SAAS;YACxB,UAAU,EAAE,IAAI,CAAC,WAAW;YAC5B,eAAe,EAAE,IAAI,CAAC,gBAAgB;YACtC,CAAC,EAAE,IAAI,CAAC,EAAE;YACV,CAAC,EAAE,IAAI,CAAC,EAAE;YACV,YAAY,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC;YACrC,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC;SAC5C,CAAC;QACF,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAElD,IAAI,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC1B,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,UAAU,CAAuB,CAAC;YACpF,MAAM,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,eAAe,CAAuB,CAAC;YAC7F,IAAI,OAAO,IAAI,WAAW,EAAE,CAAC;gBAC3B,MAAM,WAAW,GAAG,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,IAAI,GAAG,CAAC,CAAC;gBAC1D,MAAM,YAAY,GAAG,OAAO,CAAC,qBAAqB,EAAE,CAAC,KAAK,CAAC;gBAC3D,+EAA+E;gBAC/E,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,WAAW,GAAG,YAAY,GAAG,EAAE,IAAI,CAAC;YAClE,CAAC;QACH,CAAC;IACH,CAAC;IAED,IAAI;QACF,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,cAAc;QACZ,OAAO,EAAC,CAAC,EAAE,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,EAAC,CAAC;IAClC,CAAC;IAED,cAAc,CAAC,CAAS,EAAE,CAAS;QACjC,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QACZ,IAAI,CAAC,EAAE,GAAG,CAAC,CAAC;QACZ,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACrB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC;YACzC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC;QAC1C,CAAC;QACD,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,QAAQ;QACN,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;CACF","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport * as Annotations from '../../models/annotations/annotations.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ThemeSupport from '../../ui/legacy/theme_support/theme_support.js';\nimport {html, nothing, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport annotationStyles from './annotation.css.js';\n\n// This class handles drawing of Annotations for the GreenDev project, but\n// is not for general use (at the moment).\n//\n// **Important**: all of this functionality is behind the GreenDev flag. We\n// have **no intention** of pushing this feature live in this state. This\n// is code landing to user test in Canary that will not ship without an\n// additional project to make this code fully production worthy. That is\n// why this CL has no tests, for example.\n\n// The label is angled on the left from the centre of the entry it belongs to.\n// `LABEL_AND_CONNECTOR_SHIFT_LENGTH` specifies how many pixels to the left it is shifted.\nconst LABEL_AND_CONNECTOR_SHIFT_LENGTH = 8;\n// Length of the line that connects the label to the entry.\nconst LABEL_CONNECTOR_HEIGHT = 7;\n\ninterface ViewInput {\n  inputText: string;\n  isExpanded: boolean;\n  anchored: boolean;\n  expandable: boolean;\n  showCloseButton: boolean;\n  clickHandler: () => void;\n  closeHandler: () => void;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, _, target) => {\n  const {inputText: label, isExpanded, anchored, expandable, showCloseButton, clickHandler, closeHandler} = input;\n\n  // TODO(finnur): Use `x`, and `y` passed via `input` to set the coordinates for the\n  // *Widget* (not the `overlay` div), then remove the `this.element.style` calls and\n  // remove the lint override no-imperative-dom-api from the top.\n  const connectorColor = ThemeSupport.ThemeSupport.instance().getComputedValue('--color-text-primary');\n\n  const overlayStyles = [\n    anchored ? 'left: 17px; top: 11px;' : '',\n    !expandable ? 'pointer-events: none;' : '',\n  ].join(' ');\n\n  // clang-format off\n  render(html`\n    <style>${annotationStyles}</style>\n    ${anchored ? html`\n      <svg class=\"connectorContainer\"\n        width=${LABEL_AND_CONNECTOR_SHIFT_LENGTH * 2}\n        height=${LABEL_CONNECTOR_HEIGHT}>\n        <line\n          x1=${LABEL_AND_CONNECTOR_SHIFT_LENGTH}\n          y1=0\n          x2=${LABEL_AND_CONNECTOR_SHIFT_LENGTH * 2}\n          y2=${LABEL_CONNECTOR_HEIGHT}\n          stroke=${connectorColor}\n          stroke-width=2\n        />\n        <circle\n          cx=${LABEL_AND_CONNECTOR_SHIFT_LENGTH}\n          cy=0\n          r=3\n          fill=${connectorColor}\n        />\n      </svg>\n    ` : nothing}\n    <div class='overlay' style=${overlayStyles} @click=${expandable ? clickHandler : null}>\n      ${isExpanded ? label : '!'}\n    </div>\n    ${showCloseButton ?\n        html`<svg @click=${closeHandler} class=\"close-button\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle cx=\"8\" cy=\"8\" r=\"7.5\" fill=\"#EEE\" stroke=\"#888\"/>\n          <path d=\"M5 5L11 11M5 11L11 5\" stroke=\"#888\" stroke-width=\"2\"/>\n        </svg>` : nothing}\n    `, target);\n  // clang-format on\n};\n\nexport class Annotation extends UI.Widget.Widget {\n  readonly #view: View;\n  readonly #id: number;\n  #inputText: string;\n  #x = 0;\n  #y = 0;\n  #isExpanded = false;\n  #hasShown = false;\n  #anchored = false;\n  #expandable = false;\n  #showCloseButton = false;\n\n  constructor(\n      id: number, label: string, showExpanded: boolean, anchored: boolean, expandable: boolean,\n      showCloseButton: boolean, view = DEFAULT_VIEW) {\n    super({jslog: `${VisualLogging.panel('annotation').track({resize: true})}`, useShadowDom: true});\n    this.#id = id;\n    this.#view = view;\n    this.#isExpanded = showExpanded;\n    this.#inputText = label;\n    this.#anchored = anchored;\n    this.#expandable = expandable;\n    this.#showCloseButton = showCloseButton;\n  }\n\n  #toggle(): void {\n    this.#isExpanded = !this.#isExpanded;\n    this.requestUpdate();\n  }\n\n  #closeHandler(): void {\n    this.hide();\n    Annotations.AnnotationRepository.instance().deleteAnnotation(this.#id);\n  }\n\n  override wasShown(): void {\n    this.element.style.position = 'absolute';\n    this.element.style.left = `${this.#x}px`;\n    this.element.style.top = `${this.#y}px`;\n    super.wasShown();\n    this.#hasShown = true;\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    const input = {\n      inputText: this.#inputText,\n      isExpanded: this.#isExpanded,\n      anchored: this.#anchored,\n      expandable: this.#expandable,\n      showCloseButton: this.#showCloseButton,\n      x: this.#x,\n      y: this.#y,\n      clickHandler: this.#toggle.bind(this),\n      closeHandler: this.#closeHandler.bind(this),\n    };\n    this.#view(input, undefined, this.contentElement);\n\n    if (this.#showCloseButton) {\n      const overlay = this.contentElement.querySelector('.overlay') as HTMLElement | null;\n      const closeButton = this.contentElement.querySelector('.close-button') as HTMLElement | null;\n      if (overlay && closeButton) {\n        const overlayLeft = parseFloat(overlay.style.left || '0');\n        const overlayWidth = overlay.getBoundingClientRect().width;\n        // Position the button to the right of the overlay, adjusting for button width.\n        closeButton.style.left = `${overlayLeft + overlayWidth - 16}px`;\n      }\n    }\n  }\n\n  hide(): void {\n    this.detach();\n  }\n\n  getCoordinates(): {x: number, y: number} {\n    return {x: this.#x, y: this.#y};\n  }\n\n  setCoordinates(x: number, y: number): void {\n    this.#x = x;\n    this.#y = y;\n    if (this.isShowing()) {\n      this.element.style.left = `${this.#x}px`;\n      this.element.style.top = `${this.#y}px`;\n    }\n    this.requestUpdate();\n  }\n\n  hasShown(): boolean {\n    return this.#hasShown;\n  }\n}\n"]}