{"version":3,"file":"ExtensionPanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/common/ExtensionPanel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2012 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as _ProtocolClient from '../../core/protocol_client/protocol_client.js';  // eslint-disable-line @typescript-eslint/no-unused-vars\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Extensions from '../../models/extensions/extensions.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type {ExtensionServer} from './ExtensionServer.js';\nimport {ExtensionNotifierView, ExtensionView} from './ExtensionView.js';\n\nexport class ExtensionPanel extends UI.Panel.Panel implements UI.SearchableView.Searchable {\n  private readonly server: ExtensionServer;\n  private readonly id: string;\n  private readonly panelToolbar: UI.Toolbar.Toolbar;\n  readonly #searchableView: UI.SearchableView.SearchableView;\n\n  constructor(server: ExtensionServer, panelName: string, id: string, pageURL: string) {\n    super(panelName);\n    this.server = server;\n    this.id = id;\n    this.setHideOnDetach();\n    this.panelToolbar = this.element.createChild('devtools-toolbar', 'hidden');\n\n    this.#searchableView = new UI.SearchableView.SearchableView(this, null);\n    this.#searchableView.show(this.element);\n\n    const extensionView = new ExtensionView(server, this.id, pageURL, 'extension');\n    extensionView.show(this.#searchableView.element);\n  }\n\n  addToolbarItem(item: UI.Toolbar.ToolbarItem): void {\n    this.panelToolbar.classList.remove('hidden');\n    this.panelToolbar.appendToolbarItem(item);\n  }\n\n  onSearchCanceled(): void {\n    this.server.notifySearchAction(this.id, Extensions.ExtensionAPI.PrivateAPI.Panels.SearchAction.CancelSearch);\n    this.#searchableView.updateSearchMatchesCount(0);\n  }\n\n  override searchableView(): UI.SearchableView.SearchableView {\n    return this.#searchableView;\n  }\n\n  performSearch(searchConfig: UI.SearchableView.SearchConfig, _shouldJump: boolean, _jumpBackwards?: boolean): void {\n    const query = searchConfig.query;\n    this.server.notifySearchAction(\n        this.id, Extensions.ExtensionAPI.PrivateAPI.Panels.SearchAction.PerformSearch, query);\n  }\n\n  jumpToNextSearchResult(): void {\n    this.server.notifySearchAction(this.id, Extensions.ExtensionAPI.PrivateAPI.Panels.SearchAction.NextSearchResult);\n  }\n\n  jumpToPreviousSearchResult(): void {\n    this.server.notifySearchAction(\n        this.id, Extensions.ExtensionAPI.PrivateAPI.Panels.SearchAction.PreviousSearchResult);\n  }\n\n  supportsCaseSensitiveSearch(): boolean {\n    return false;\n  }\n\n  supportsWholeWordSearch(): boolean {\n    return false;\n  }\n\n  supportsRegexSearch(): boolean {\n    return false;\n  }\n}\n\nexport class ExtensionButton {\n  private readonly id: string;\n  readonly #toolbarButton: UI.Toolbar.ToolbarButton;\n  constructor(server: ExtensionServer, id: string, iconURL: string, tooltip?: string, disabled?: boolean) {\n    this.id = id;\n\n    this.#toolbarButton = new UI.Toolbar.ToolbarButton('', '');\n    this.#toolbarButton.addEventListener(\n        UI.Toolbar.ToolbarButton.Events.CLICK, server.notifyButtonClicked.bind(server, this.id));\n    this.update(iconURL, tooltip, disabled);\n  }\n\n  update(iconURL?: string, tooltip?: string, disabled?: boolean): void {\n    if (typeof iconURL === 'string') {\n      this.#toolbarButton.setBackgroundImage(iconURL);\n    }\n    if (typeof tooltip === 'string') {\n      this.#toolbarButton.setTitle(tooltip);\n    }\n    if (typeof disabled === 'boolean') {\n      this.#toolbarButton.setEnabled(!disabled);\n    }\n  }\n\n  toolbarButton(): UI.Toolbar.ToolbarButton {\n    return this.#toolbarButton;\n  }\n}\n\nexport class ExtensionSidebarPane extends UI.View.SimpleView {\n  readonly #panelName: string;\n  private server: ExtensionServer;\n  #id: string;\n  private extensionView?: ExtensionView;\n  private objectPropertiesView?: ExtensionNotifierView;\n  constructor(server: ExtensionServer, panelName: string, title: Platform.UIString.LocalizedString, id: string) {\n    // For backwards compatibility we use the Kebab case version of the `title`\n    // as `viewId` for sidebar panes created by extensions.\n    const viewId = Platform.StringUtilities.toKebabCase(title);\n    super({title, viewId});\n    this.element.classList.add('fill');\n    this.#panelName = panelName;\n    this.server = server;\n    this.#id = id;\n  }\n\n  id(): string {\n    return this.#id;\n  }\n\n  panelName(): string {\n    return this.#panelName;\n  }\n\n  setObject(object: Object, title: string|undefined, callback: (arg0?: (string|null)|undefined) => void): void {\n    this.createObjectPropertiesView();\n    this.#setObject(SDK.RemoteObject.RemoteObject.fromLocalObject(object), title, callback);\n  }\n\n  setExpression(\n      expression: string, title: string|undefined, evaluateOptions: Object|undefined, securityOrigin: string,\n      callback: (arg0?: (string|null)|undefined) => void): void {\n    this.createObjectPropertiesView();\n    this.server.evaluate(\n        expression, true, false, evaluateOptions, securityOrigin, this.onEvaluate.bind(this, title, callback));\n  }\n\n  setPage(url: Platform.DevToolsPath.UrlString): void {\n    if (this.objectPropertiesView) {\n      this.objectPropertiesView.detach();\n      delete this.objectPropertiesView;\n    }\n    if (this.extensionView) {\n      this.extensionView.detach(true);\n    }\n\n    this.extensionView = new ExtensionView(this.server, this.#id, url, 'extension fill');\n    this.extensionView.show(this.element);\n\n    if (!this.element.style.height) {\n      this.setHeight('150px');\n    }\n  }\n\n  setHeight(height: string): void {\n    this.element.style.height = height;\n  }\n\n  private onEvaluate(\n      title: string|undefined, callback: (arg0?: (string|null)|undefined) => void, error: string|null,\n      result: SDK.RemoteObject.RemoteObject|null, _wasThrown?: boolean): void {\n    if (error) {\n      callback(error.toString());\n    } else if (!result) {\n      callback();\n    } else {\n      this.#setObject(result, title, callback);\n    }\n  }\n\n  private createObjectPropertiesView(): void {\n    if (this.objectPropertiesView) {\n      return;\n    }\n    if (this.extensionView) {\n      this.extensionView.detach(true);\n      delete this.extensionView;\n    }\n    this.objectPropertiesView = new ExtensionNotifierView(this.server, this.#id);\n    this.objectPropertiesView.show(this.element);\n  }\n\n  #setObject(\n      object: SDK.RemoteObject.RemoteObject, title: string|undefined,\n      callback: (arg0?: (string|null)|undefined) => void): void {\n    const objectPropertiesView = this.objectPropertiesView;\n    // This may only happen if setPage() was called while we were evaluating the expression.\n    if (!objectPropertiesView) {\n      callback('operation cancelled');\n      return;\n    }\n    objectPropertiesView.element.removeChildren();\n    void UI.UIUtils.Renderer.render(object, {title, editable: false, expand: true}).then(result => {\n      if (!result) {\n        callback();\n        return;\n      }\n      objectPropertiesView.element.appendChild(result.element);\n      callback();\n    });\n  }\n}\n"]}