{"version":3,"file":"ConsoleViewport.js","sourceRoot":"","sources":["../../../../../../front_end/panels/console/ConsoleViewport.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2013 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Components from '../../ui/legacy/components/utils/utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {ConsoleViewMessage, getMessageForElement} from './ConsoleViewMessage.js';\n\ninterface SelectionModel {\n  item: number;\n  node: Node;\n  offset: number;\n}\n\nexport class ConsoleViewport {\n  element: HTMLElement;\n  private topGapElement: HTMLElement;\n  private topGapElementActive: boolean;\n  #contentElement: HTMLElement;\n  private bottomGapElement: HTMLElement;\n  private bottomGapElementActive: boolean;\n  private provider: ConsoleViewportProvider;\n  private virtualSelectedIndex: number;\n  private firstActiveIndex: number;\n  private lastActiveIndex: number;\n  private renderedItems: ConsoleViewportElement[];\n  private anchorSelection: SelectionModel|null;\n  private headSelection: SelectionModel|null;\n  private itemCount: number;\n  private cumulativeHeights: Int32Array;\n  private muteCopyHandler: boolean;\n  private readonly observer: MutationObserver;\n  private readonly observerConfig: {\n    childList: boolean,\n    subtree: boolean,\n  };\n  #stickToBottom: boolean;\n  private selectionIsBackward: boolean;\n  private lastSelectedElement?: HTMLElement|null;\n  private cachedProviderElements?: Array<ConsoleViewportElement|null>;\n\n  constructor(provider: ConsoleViewportProvider) {\n    this.element = document.createElement('div');\n    this.element.style.overflow = 'auto';\n    this.topGapElement = this.element.createChild('div');\n    this.topGapElement.style.height = '0px';\n    this.topGapElement.style.color = 'transparent';\n    this.topGapElementActive = false;\n    this.#contentElement = this.element.createChild('div');\n    this.bottomGapElement = this.element.createChild('div');\n    this.bottomGapElement.style.height = '0px';\n    this.bottomGapElement.style.color = 'transparent';\n    this.bottomGapElementActive = false;\n\n    // Text content needed for range intersection checks in updateSelectionModel.\n    // Use Unicode ZERO WIDTH NO-BREAK SPACE, which avoids contributing any height to the element's layout overflow.\n    this.topGapElement.textContent = '\\uFEFF';\n    this.bottomGapElement.textContent = '\\uFEFF';\n\n    UI.ARIAUtils.setHidden(this.topGapElement, true);\n    UI.ARIAUtils.setHidden(this.bottomGapElement, true);\n\n    this.provider = provider;\n    this.element.addEventListener('scroll', this.onScroll.bind(this), false);\n    this.element.addEventListener('copy', (this.onCopy.bind(this) as EventListener), false);\n    this.element.addEventListener('dragstart', (this.onDragStart.bind(this) as (arg0: Event) => unknown), false);\n    this.#contentElement.addEventListener('focusin', (this.onFocusIn.bind(this) as EventListener), false);\n    this.#contentElement.addEventListener('focusout', (this.onFocusOut.bind(this) as EventListener), false);\n    this.#contentElement.addEventListener('keydown', (this.onKeyDown.bind(this) as EventListener), false);\n    this.virtualSelectedIndex = -1;\n    this.#contentElement.tabIndex = -1;\n\n    this.firstActiveIndex = -1;\n    this.lastActiveIndex = -1;\n    this.renderedItems = [];\n    this.anchorSelection = null;\n    this.headSelection = null;\n    this.itemCount = 0;\n    this.cumulativeHeights = new Int32Array(0);\n    this.muteCopyHandler = false;\n\n    // Listen for any changes to descendants and trigger a refresh. This ensures\n    // that items updated asynchronously will not break stick-to-bottom behavior\n    // if they change the scroll height.\n    this.observer = new MutationObserver(this.refresh.bind(this));\n    this.observerConfig = {childList: true, subtree: true};\n    this.#stickToBottom = false;\n    this.selectionIsBackward = false;\n  }\n\n  stickToBottom(): boolean {\n    return this.#stickToBottom;\n  }\n\n  setStickToBottom(value: boolean): void {\n    this.#stickToBottom = value;\n    if (this.#stickToBottom) {\n      this.observer.observe(this.#contentElement, this.observerConfig);\n    } else {\n      this.observer.disconnect();\n    }\n  }\n\n  hasVirtualSelection(): boolean {\n    return this.virtualSelectedIndex !== -1;\n  }\n\n  copyWithStyles(): void {\n    this.muteCopyHandler = true;\n    this.element.ownerDocument.execCommand('copy');\n    this.muteCopyHandler = false;\n  }\n\n  private onCopy(event: ClipboardEvent): void {\n    if (this.muteCopyHandler) {\n      return;\n    }\n\n    const text = this.selectedText();\n    if (!text) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (this.selectionContainsTable()) {\n      this.copyWithStyles();\n    } else if (event.clipboardData) {\n      event.clipboardData.setData('text/plain', text);\n    }\n  }\n\n  private onFocusIn(event: FocusEvent): void {\n    const renderedIndex =\n        this.renderedItems.findIndex(item => item.element().isSelfOrAncestor((event.target as Node | null)));\n    if (renderedIndex !== -1) {\n      this.virtualSelectedIndex = this.firstActiveIndex + renderedIndex;\n    }\n    let focusLastChild = false;\n    // Make default selection when moving from external (e.g. prompt) to the container.\n    if (this.virtualSelectedIndex === -1 && this.isOutsideViewport((event.relatedTarget as Element | null)) &&\n        event.target === this.#contentElement && this.itemCount) {\n      focusLastChild = true;\n      this.virtualSelectedIndex = this.itemCount - 1;\n\n      // Update stick to bottom before scrolling into view.\n      this.refresh();\n      this.scrollItemIntoView(this.virtualSelectedIndex);\n    }\n    this.updateFocusedItem(focusLastChild);\n  }\n\n  private onFocusOut(event: FocusEvent): void {\n    if (this.isOutsideViewport((event.relatedTarget as Element | null))) {\n      this.virtualSelectedIndex = -1;\n    }\n    this.updateFocusedItem();\n  }\n\n  private isOutsideViewport(element: Element|null): boolean {\n    return element !== null && !element.isSelfOrDescendant(this.#contentElement);\n  }\n\n  private onDragStart(event: DragEvent): boolean {\n    const text = this.selectedText();\n    if (!text) {\n      return false;\n    }\n    if (event.dataTransfer) {\n      event.dataTransfer.clearData();\n      event.dataTransfer.setData('text/plain', text);\n      event.dataTransfer.effectAllowed = 'copy';\n    }\n    return true;\n  }\n\n  private onKeyDown(event: KeyboardEvent): void {\n    if (UI.UIUtils.isEditing() || !this.itemCount || event.shiftKey) {\n      return;\n    }\n    let isArrowUp = false;\n    switch (event.key) {\n      case 'ArrowUp':\n        if (this.virtualSelectedIndex > 0) {\n          isArrowUp = true;\n          this.virtualSelectedIndex--;\n        } else {\n          return;\n        }\n        break;\n      case 'ArrowDown':\n        if (this.virtualSelectedIndex < this.itemCount - 1) {\n          this.virtualSelectedIndex++;\n        } else {\n          return;\n        }\n        break;\n      case 'Home':\n        this.virtualSelectedIndex = 0;\n        break;\n      case 'End':\n        this.virtualSelectedIndex = this.itemCount - 1;\n        break;\n      default:\n        return;\n    }\n    event.consume(true);\n    this.scrollItemIntoView(this.virtualSelectedIndex);\n    this.updateFocusedItem(isArrowUp);\n  }\n\n  private updateFocusedItem(focusLastChild?: boolean): void {\n    const selectedElement = this.renderedElementAt(this.virtualSelectedIndex);\n    const changed = this.lastSelectedElement !== selectedElement;\n    const containerHasFocus = this.#contentElement === UI.DOMUtilities.deepActiveElement(this.element.ownerDocument);\n    if (this.lastSelectedElement && changed) {\n      this.lastSelectedElement.classList.remove('console-selected');\n    }\n    if (selectedElement && (focusLastChild || changed || containerHasFocus) && this.element.hasFocus()) {\n      selectedElement.classList.add('console-selected');\n      const consoleViewMessage = getMessageForElement(selectedElement);\n      if (consoleViewMessage) {\n        UI.Context.Context.instance().setFlavor(ConsoleViewMessage, consoleViewMessage);\n      }\n      // Do not focus the message if something within holds focus (e.g. object).\n      if (focusLastChild) {\n        this.setStickToBottom(false);\n        this.renderedItems[this.virtualSelectedIndex - this.firstActiveIndex].focusLastChildOrSelf();\n      } else if (!selectedElement.hasFocus()) {\n        selectedElement.focus({preventScroll: true});\n      }\n    }\n    if (this.itemCount && !this.#contentElement.hasFocus()) {\n      this.#contentElement.tabIndex = 0;\n    } else {\n      this.#contentElement.tabIndex = -1;\n    }\n    this.lastSelectedElement = selectedElement;\n  }\n\n  contentElement(): Element {\n    return this.#contentElement;\n  }\n\n  invalidate(): void {\n    delete this.cachedProviderElements;\n    this.itemCount = this.provider.itemCount();\n    if (this.virtualSelectedIndex > this.itemCount - 1) {\n      this.virtualSelectedIndex = this.itemCount - 1;\n    }\n    this.rebuildCumulativeHeights();\n    this.refresh();\n  }\n\n  private providerElement(index: number): ConsoleViewportElement|null {\n    if (!this.cachedProviderElements) {\n      this.cachedProviderElements = new Array(this.itemCount);\n    }\n    let element = this.cachedProviderElements[index];\n    if (!element) {\n      element = this.provider.itemElement(index);\n      this.cachedProviderElements[index] = element;\n    }\n    return element;\n  }\n\n  private rebuildCumulativeHeights(): void {\n    const firstActiveIndex = this.firstActiveIndex;\n    const lastActiveIndex = this.lastActiveIndex;\n    let height = 0;\n    this.cumulativeHeights = new Int32Array(this.itemCount);\n    for (let i = 0; i < this.itemCount; ++i) {\n      if (firstActiveIndex <= i && i - firstActiveIndex < this.renderedItems.length && i <= lastActiveIndex) {\n        height += this.renderedItems[i - firstActiveIndex].element().offsetHeight;\n      } else {\n        height += this.provider.fastHeight(i);\n      }\n      this.cumulativeHeights[i] = height;\n    }\n  }\n\n  private rebuildCumulativeHeightsIfNeeded(): void {\n    let totalCachedHeight = 0;\n    let totalMeasuredHeight = 0;\n    // Check whether current items in DOM have changed heights. Tolerate 1-pixel\n    // error due to double-to-integer rounding errors.\n    for (let i = 0; i < this.renderedItems.length; ++i) {\n      const cachedItemHeight = this.cachedItemHeight(this.firstActiveIndex + i);\n      const measuredHeight = this.renderedItems[i].element().offsetHeight;\n      if (Math.abs(cachedItemHeight - measuredHeight) > 1) {\n        this.rebuildCumulativeHeights();\n        return;\n      }\n      totalMeasuredHeight += measuredHeight;\n      totalCachedHeight += cachedItemHeight;\n      if (Math.abs(totalCachedHeight - totalMeasuredHeight) > 1) {\n        this.rebuildCumulativeHeights();\n        return;\n      }\n    }\n  }\n\n  private cachedItemHeight(index: number): number {\n    return index === 0 ? this.cumulativeHeights[0] : this.cumulativeHeights[index] - this.cumulativeHeights[index - 1];\n  }\n\n  private isSelectionBackwards(selection: Selection|null): boolean {\n    if (!selection?.rangeCount || !selection.anchorNode || !selection.focusNode) {\n      return false;\n    }\n    const range = document.createRange();\n    range.setStart(selection.anchorNode, selection.anchorOffset);\n    range.setEnd(selection.focusNode, selection.focusOffset);\n    return range.collapsed;\n  }\n\n  private createSelectionModel(itemIndex: number, node: Node, offset: number): {\n    item: number,\n    node: Node,\n    offset: number,\n  } {\n    return {item: itemIndex, node, offset};\n  }\n\n  private updateSelectionModel(selection: Selection|null): boolean {\n    const range = selection?.rangeCount ? selection.getRangeAt(0) : null;\n    if (!range || (!selection || selection.isCollapsed) || !this.element.hasSelection()) {\n      this.headSelection = null;\n      this.anchorSelection = null;\n      return false;\n    }\n\n    let firstSelectedIndex: number = Number.MAX_VALUE;\n    let lastSelectedIndex = -1;\n\n    let hasVisibleSelection = false;\n    for (let i = 0; i < this.renderedItems.length; ++i) {\n      if (range.intersectsNode(this.renderedItems[i].element())) {\n        const index = i + this.firstActiveIndex;\n        firstSelectedIndex = Math.min(firstSelectedIndex, index);\n        lastSelectedIndex = Math.max(lastSelectedIndex, index);\n        hasVisibleSelection = true;\n      }\n    }\n    const topOverlap = range.intersectsNode(this.topGapElement) && this.topGapElementActive;\n    const bottomOverlap = range.intersectsNode(this.bottomGapElement) && this.bottomGapElementActive;\n    if (!topOverlap && !bottomOverlap && !hasVisibleSelection) {\n      this.headSelection = null;\n      this.anchorSelection = null;\n      return false;\n    }\n\n    if (!this.anchorSelection || !this.headSelection) {\n      this.anchorSelection = this.createSelectionModel(0, this.element, 0);\n      this.headSelection = this.createSelectionModel(this.itemCount - 1, this.element, this.element.children.length);\n      this.selectionIsBackward = false;\n    }\n\n    const isBackward = this.isSelectionBackwards(selection);\n    const startSelection = this.selectionIsBackward ? this.headSelection : this.anchorSelection;\n    const endSelection = this.selectionIsBackward ? this.anchorSelection : this.headSelection;\n    let firstSelected: SelectionModel|null = null;\n    let lastSelected: SelectionModel|null = null;\n    if (hasVisibleSelection) {\n      firstSelected = this.createSelectionModel(firstSelectedIndex, (range.startContainer), range.startOffset);\n      lastSelected = this.createSelectionModel(lastSelectedIndex, (range.endContainer), range.endOffset);\n    }\n    if (topOverlap && bottomOverlap && hasVisibleSelection) {\n      firstSelected = (firstSelected && firstSelected.item < startSelection.item) ? firstSelected : startSelection;\n      lastSelected = (lastSelected && lastSelected.item > endSelection.item) ? lastSelected : endSelection;\n    } else if (!hasVisibleSelection) {\n      firstSelected = startSelection;\n      lastSelected = endSelection;\n    } else if (topOverlap) {\n      firstSelected = isBackward ? this.headSelection : this.anchorSelection;\n    } else if (bottomOverlap) {\n      lastSelected = isBackward ? this.anchorSelection : this.headSelection;\n    }\n\n    if (isBackward) {\n      this.anchorSelection = lastSelected;\n      this.headSelection = firstSelected;\n    } else {\n      this.anchorSelection = firstSelected;\n      this.headSelection = lastSelected;\n    }\n    this.selectionIsBackward = isBackward;\n    return true;\n  }\n\n  private restoreSelection(selection: Selection|null): void {\n    if (!selection || !this.anchorSelection || !this.headSelection) {\n      return;\n    }\n\n    const clampSelection = (selection: SelectionModel, isSelectionBackwards: boolean): {\n      element: Node,\n      offset: number,\n    } => {\n      if (this.firstActiveIndex <= selection.item && selection.item <= this.lastActiveIndex) {\n        return {element: selection.node, offset: selection.offset};\n      }\n\n      const element = selection.item < this.firstActiveIndex ? this.topGapElement : this.bottomGapElement;\n      return {element, offset: isSelectionBackwards ? 1 : 0};\n    };\n\n    const {element: anchorElement, offset: anchorOffset} =\n        clampSelection(this.anchorSelection, Boolean(this.selectionIsBackward));\n    const {element: headElement, offset: headOffset} = clampSelection(this.headSelection, !this.selectionIsBackward);\n    selection.setBaseAndExtent(anchorElement, anchorOffset, headElement, headOffset);\n  }\n\n  private selectionContainsTable(): boolean {\n    if (!this.anchorSelection || !this.headSelection) {\n      return false;\n    }\n\n    const start = this.selectionIsBackward ? this.headSelection.item : this.anchorSelection.item;\n    const end = this.selectionIsBackward ? this.anchorSelection.item : this.headSelection.item;\n\n    for (let i = start; i <= end; i++) {\n      const element = (this.providerElement(i) as ConsoleViewMessage);\n      if (element?.consoleMessage().type === 'table') {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  refresh(): void {\n    this.observer.disconnect();\n    this.#refresh();\n    if (this.#stickToBottom) {\n      this.observer.observe(this.#contentElement, this.observerConfig);\n    }\n  }\n\n  #refresh(): void {\n    if (!this.visibleHeight()) {\n      return;\n    }  // Do nothing for invisible controls.\n\n    if (!this.itemCount) {\n      for (let i = 0; i < this.renderedItems.length; ++i) {\n        this.renderedItems[i].willHide();\n      }\n      this.renderedItems = [];\n      this.#contentElement.removeChildren();\n      this.topGapElement.style.height = '0px';\n      this.bottomGapElement.style.height = '0px';\n      this.firstActiveIndex = -1;\n      this.lastActiveIndex = -1;\n      this.updateFocusedItem();\n      return;\n    }\n\n    const selection = this.element.getComponentSelection();\n    const shouldRestoreSelection = this.updateSelectionModel(selection);\n\n    const visibleFrom = this.element.scrollTop;\n    const visibleHeight = this.visibleHeight();\n    const activeHeight = visibleHeight * 2;\n    this.rebuildCumulativeHeightsIfNeeded();\n\n    // When the viewport is scrolled to the bottom, using the cumulative heights estimate is not\n    // precise enough to determine next visible indices. This stickToBottom check avoids extra\n    // calls to refresh in those cases.\n    if (this.#stickToBottom) {\n      this.firstActiveIndex = Math.max(this.itemCount - Math.ceil(activeHeight / this.provider.minimumRowHeight()), 0);\n      this.lastActiveIndex = this.itemCount - 1;\n    } else {\n      this.firstActiveIndex = Math.max(\n          Platform.ArrayUtilities.lowerBound(\n              this.cumulativeHeights, visibleFrom + 1 - (activeHeight - visibleHeight) / 2,\n              Platform.ArrayUtilities.DEFAULT_COMPARATOR),\n          0);\n      // Proactively render more rows in case some of them will be collapsed without triggering refresh. @see crbug.com/390169\n      this.lastActiveIndex = this.firstActiveIndex + Math.ceil(activeHeight / this.provider.minimumRowHeight()) - 1;\n      this.lastActiveIndex = Math.min(this.lastActiveIndex, this.itemCount - 1);\n    }\n\n    const topGapHeight = this.cumulativeHeights[this.firstActiveIndex - 1] || 0;\n    const bottomGapHeight =\n        this.cumulativeHeights[this.cumulativeHeights.length - 1] - this.cumulativeHeights[this.lastActiveIndex];\n\n    function prepare(this: ConsoleViewport): void {\n      this.topGapElement.style.height = topGapHeight + 'px';\n      this.bottomGapElement.style.height = bottomGapHeight + 'px';\n      this.topGapElementActive = Boolean(topGapHeight);\n      this.bottomGapElementActive = Boolean(bottomGapHeight);\n      this.#contentElement.style.setProperty('height', '10000000px');\n    }\n\n    this.partialViewportUpdate(prepare.bind(this));\n    this.#contentElement.style.removeProperty('height');\n    // Should be the last call in the method as it might force layout.\n    if (shouldRestoreSelection) {\n      this.restoreSelection(selection);\n    }\n    if (this.#stickToBottom) {\n      this.element.scrollTop = 10000000;\n    }\n  }\n\n  private partialViewportUpdate(prepare: () => void): void {\n    const itemsToRender = new Set<ConsoleViewportElement>();\n    for (let i = this.firstActiveIndex; i <= this.lastActiveIndex; ++i) {\n      const providerElement = this.providerElement(i);\n      console.assert(Boolean(providerElement), 'Expected provider element to be defined');\n      if (providerElement) {\n        itemsToRender.add(providerElement);\n      }\n    }\n    const willBeHidden = this.renderedItems.filter(item => !itemsToRender.has(item));\n    for (let i = 0; i < willBeHidden.length; ++i) {\n      willBeHidden[i].willHide();\n    }\n    prepare();\n    let hadFocus = false;\n    for (let i = 0; i < willBeHidden.length; ++i) {\n      hadFocus = hadFocus || willBeHidden[i].element().hasFocus();\n      willBeHidden[i].element().remove();\n    }\n\n    const wasShown = [];\n    let anchor: (ChildNode|null) = this.#contentElement.firstChild;\n    for (const viewportElement of itemsToRender) {\n      const element = viewportElement.element();\n      if (element !== anchor) {\n        const shouldCallWasShown = !element.parentElement;\n        if (shouldCallWasShown) {\n          wasShown.push(viewportElement);\n        }\n        this.#contentElement.insertBefore(element, anchor);\n      } else {\n        anchor = anchor.nextSibling;\n      }\n    }\n    for (let i = 0; i < wasShown.length; ++i) {\n      wasShown[i].wasShown();\n    }\n    this.renderedItems = Array.from(itemsToRender);\n\n    if (hadFocus) {\n      this.#contentElement.focus();\n    }\n    this.updateFocusedItem();\n  }\n\n  private selectedText(): string|null {\n    this.updateSelectionModel(this.element.getComponentSelection());\n    if (!this.headSelection || !this.anchorSelection) {\n      return null;\n    }\n\n    let startSelection: SelectionModel|null = null;\n    let endSelection: SelectionModel|null = null;\n    if (this.selectionIsBackward) {\n      startSelection = this.headSelection;\n      endSelection = this.anchorSelection;\n    } else {\n      startSelection = this.anchorSelection;\n      endSelection = this.headSelection;\n    }\n\n    const textLines = [];\n    for (let i = startSelection.item; i <= endSelection.item; ++i) {\n      const providerElement = this.providerElement(i);\n      console.assert(Boolean(providerElement));\n      if (!providerElement) {\n        continue;\n      }\n      const element = providerElement.element();\n      const lineContent = element.childTextNodes().map(Components.Linkifier.Linkifier.untruncatedNodeText).join('');\n      textLines.push(lineContent);\n    }\n\n    const endProviderElement = this.providerElement(endSelection.item);\n    const endSelectionElement = endProviderElement?.element();\n    if (endSelectionElement && endSelection.node?.isSelfOrDescendant(endSelectionElement)) {\n      const itemTextOffset = this.textOffsetInNode(endSelectionElement, endSelection.node, endSelection.offset);\n      if (textLines.length > 0) {\n        textLines[textLines.length - 1] = textLines[textLines.length - 1].substring(0, itemTextOffset);\n      }\n    }\n\n    const startProviderElement = this.providerElement(startSelection.item);\n    const startSelectionElement = startProviderElement?.element();\n    if (startSelectionElement && startSelection.node?.isSelfOrDescendant(startSelectionElement)) {\n      const itemTextOffset = this.textOffsetInNode(startSelectionElement, startSelection.node, startSelection.offset);\n      textLines[0] = textLines[0].substring(itemTextOffset);\n    }\n\n    return textLines.join('\\n');\n  }\n\n  private textOffsetInNode(itemElement: Element, selectionNode: Node, offset: number): number {\n    // If the selectionNode is not a TextNode, we may need to convert a child offset into a character offset.\n    const textContentLength = selectionNode.textContent ? selectionNode.textContent.length : 0;\n    if (selectionNode.nodeType !== Node.TEXT_NODE) {\n      if (offset < selectionNode.childNodes.length) {\n        selectionNode = (selectionNode.childNodes.item(offset) as Node);\n        offset = 0;\n      } else {\n        offset = textContentLength;\n      }\n    }\n\n    let chars = 0;\n    let node: Node|null = itemElement;\n    while ((node = node.traverseNextNode(itemElement)) && node !== selectionNode) {\n      if (node.nodeType !== Node.TEXT_NODE ||\n          (node.parentNode &&\n           (node.parentNode.nodeName === 'STYLE' || node.parentNode.nodeName === 'SCRIPT' ||\n            node.parentNode.nodeName === '#document-fragment'))) {\n        continue;\n      }\n      chars += Components.Linkifier.Linkifier.untruncatedNodeText(node).length;\n    }\n    // If the selected node text was truncated, treat any non-zero offset as the full length.\n    const untruncatedContainerLength = Components.Linkifier.Linkifier.untruncatedNodeText(selectionNode).length;\n    if (offset > 0 && untruncatedContainerLength !== textContentLength) {\n      offset = untruncatedContainerLength;\n    }\n    return chars + offset;\n  }\n\n  private onScroll(_event: Event): void {\n    this.refresh();\n  }\n\n  firstVisibleIndex(): number {\n    if (!this.cumulativeHeights.length) {\n      return -1;\n    }\n    this.rebuildCumulativeHeightsIfNeeded();\n    return Platform.ArrayUtilities.lowerBound(\n        this.cumulativeHeights, this.element.scrollTop + 1, Platform.ArrayUtilities.DEFAULT_COMPARATOR);\n  }\n\n  lastVisibleIndex(): number {\n    if (!this.cumulativeHeights.length) {\n      return -1;\n    }\n    this.rebuildCumulativeHeightsIfNeeded();\n    const scrollBottom = this.element.scrollTop + this.element.clientHeight;\n    const right = this.itemCount - 1;\n    return Platform.ArrayUtilities.lowerBound(\n        this.cumulativeHeights, scrollBottom, Platform.ArrayUtilities.DEFAULT_COMPARATOR, undefined, right);\n  }\n\n  renderedElementAt(index: number): HTMLElement|null {\n    if (index === -1 || index < this.firstActiveIndex || index > this.lastActiveIndex) {\n      return null;\n    }\n    return this.renderedItems[index - this.firstActiveIndex].element();\n  }\n\n  scrollItemIntoView(index: number, makeLast?: boolean): void {\n    const firstVisibleIndex = this.firstVisibleIndex();\n    const lastVisibleIndex = this.lastVisibleIndex();\n    if (index > firstVisibleIndex && index < lastVisibleIndex) {\n      return;\n    }\n    // If the prompt is visible, then the last item must be fully on screen.\n    if (index === lastVisibleIndex && this.cumulativeHeights[index] <= this.element.scrollTop + this.visibleHeight()) {\n      return;\n    }\n    if (makeLast) {\n      this.forceScrollItemToBeLast(index);\n    } else if (index <= firstVisibleIndex) {\n      this.forceScrollItemToBeFirst(index);\n    } else if (index >= lastVisibleIndex) {\n      this.forceScrollItemToBeLast(index);\n    }\n  }\n\n  forceScrollItemToBeFirst(index: number): void {\n    console.assert(index >= 0 && index < this.itemCount, 'Cannot scroll item at invalid index');\n    this.setStickToBottom(false);\n    this.rebuildCumulativeHeightsIfNeeded();\n    this.element.scrollTop = index > 0 ? this.cumulativeHeights[index - 1] : 0;\n    if (UI.UIUtils.isScrolledToBottom(this.element)) {\n      this.setStickToBottom(true);\n    }\n    this.refresh();\n    // After refresh, the item is in DOM, but may not be visible (items above were larger than expected).\n    const renderedElement = this.renderedElementAt(index);\n    if (renderedElement) {\n      renderedElement.scrollIntoView(true /* alignTop */);\n    }\n  }\n\n  forceScrollItemToBeLast(index: number): void {\n    console.assert(index >= 0 && index < this.itemCount, 'Cannot scroll item at invalid index');\n    this.setStickToBottom(false);\n    this.rebuildCumulativeHeightsIfNeeded();\n    this.element.scrollTop = this.cumulativeHeights[index] - this.visibleHeight();\n    if (UI.UIUtils.isScrolledToBottom(this.element)) {\n      this.setStickToBottom(true);\n    }\n    this.refresh();\n    // After refresh, the item is in DOM, but may not be visible (items above were larger than expected).\n    const renderedElement = this.renderedElementAt(index);\n    if (renderedElement) {\n      renderedElement.scrollIntoView(false /* alignTop */);\n    }\n  }\n\n  private visibleHeight(): number {\n    // Use offsetHeight instead of clientHeight to avoid being affected by horizontal scroll.\n    return this.element.offsetHeight;\n  }\n}\n\nexport interface ConsoleViewportProvider {\n  fastHeight(index: number): number;\n  itemCount(): number;\n  minimumRowHeight(): number;\n  itemElement(index: number): ConsoleViewportElement|null;\n}\n\nexport interface ConsoleViewportElement {\n  willHide(): void;\n  wasShown(): void;\n  element(): HTMLElement;\n  focusLastChildOrSelf(): void;\n}\n"]}