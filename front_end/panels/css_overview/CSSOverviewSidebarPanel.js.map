{"version":3,"file":"CSSOverviewSidebarPanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/css_overview/CSSOverviewSidebarPanel.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,2BAA2B,CAAC;AAEnC,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAChD,OAAO,KAAK,OAAO,MAAM,wCAAwC,CAAC;AAClE,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAChD,OAAO,EAAC,UAAU,EAAE,IAAI,EAAE,MAAM,EAAC,MAAM,qBAAqB,CAAC;AAC7D,OAAO,KAAK,aAAa,MAAM,2CAA2C,CAAC;AAE3E,OAAO,6BAA6B,MAAM,kCAAkC,CAAC;AAE7E,MAAM,EAAC,QAAQ,EAAC,GAAG,UAAU,CAAC;AAE9B,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,aAAa,EAAE,gBAAgB;IAC/B;;OAEG;IACH,uBAAuB,EAAE,4BAA4B;CAC7C,CAAC;AACX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,gDAAgD,EAAE,SAAS,CAAC,CAAC;AACtG,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAWtE,MAAM,CAAC,MAAM,YAAY,GAAS,CAAC,KAAK,EAAE,OAAO,EAAE,MAAM,EAAE,EAAE;IAC3D,MAAM,OAAO,GAAG,CAAC,KAAY,EAAQ,EAAE;QACrC,IAAI,KAAK,CAAC,MAAM,YAAY,WAAW,EAAE,CAAC;YACxC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,IAAI,EAAE,EAAE,CAAC;gBACP,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;YACxB,CAAC;QACH,CAAC;IACH,CAAC,CAAC;IACF,MAAM,SAAS,GAAG,CAAC,KAAoB,EAAQ,EAAE;QAC/C,IAAI,KAAK,CAAC,GAAG,KAAK,OAAO,IAAI,KAAK,CAAC,GAAG,KAAK,SAAS,IAAI,KAAK,CAAC,GAAG,KAAK,WAAW,EAAE,CAAC;YAClF,OAAO;QACT,CAAC;QACD,IAAI,KAAK,CAAC,MAAM,YAAY,WAAW,EAAE,CAAC;YACxC,MAAM,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,IAAI,EAAE,EAAE,CAAC;gBACP,KAAK,CAAC,aAAa,CAAC,EAAE,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;YACrC,CAAC;QACH,CAAC;QAED,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,mBAAmB;IACnB,MAAM,CAAC,IAAI,CAAA;eACE,6BAA6B;mDACO,OAAO,aAAa,SAAS;wBACxD,UAAU,CAAC,SAAS,CAAC,uBAAuB,CAAC;;;qCAGhC,UAAU,CAAC,SAAS,CAAC,aAAa,CAAC,WAAW,KAAK,CAAC,OAAO;4BACpE,OAAO,aAAa,8CAA8B;gCAC9C,6BAA6B;;;UAGnD,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAC,EAAE,EAAE,IAAI,EAAC,EAAE,EAAE;QAC/B,MAAM,QAAQ,GAAG,EAAE,KAAK,KAAK,CAAC,UAAU,CAAC;QACzC,OAAO,IAAI,CAAA;sDACiC,QAAQ,CAAC,EAAC,QAAQ,EAAC,CAAC;6BAC7C,QAAQ;0CACK,EAAE;wBACpB,aAAa,CAAC,IAAI,CAAC,gBAAgB,EAAE,EAAE,CAAC;aACrC,KAAK,CAAC,EAAC,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,yBAAyB,EAAC,CAAC;gBACnE,IAAI;mBACD,CAAC;IACZ,CAAC,CAAC;aACG,EACP,MAAM,CAAC,CAAC;IACZ,kBAAkB;AACpB,CAAC,CAAC;AAEF,MAAM,OAAO,uBAAwB,SAAQ,EAAE,CAAC,MAAM,CAAC,IAAI;IACzD,KAAK,CAAO;IACZ,MAAM,GAAsC,EAAE,CAAC;IAC/C,WAAW,CAAU;IACrB,eAAe,GAAG,CAAC,GAAW,EAAE,YAAqB,EAAQ,EAAE,GAAE,CAAC,CAAC;IACnE,QAAQ,GAAG,GAAS,EAAE,GAAE,CAAC,CAAC;IAE1B,YAAY,OAAqB,EAAE,IAAI,GAAG,YAAY;QACpD,KAAK,CAAC,OAAO,EAAE,EAAC,YAAY,EAAE,IAAI,EAAE,cAAc,EAAE,IAAI,EAAC,CAAC,CAAC;QAC3D,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACpB,CAAC;IAEQ,aAAa;QACpB,MAAM,SAAS,GAAG;YAChB,KAAK,EAAE,IAAI,CAAC,MAAM;YAClB,UAAU,EAAE,IAAI,CAAC,WAAW;YAC5B,OAAO,EAAE,IAAI,CAAC,QAAQ;YACtB,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC;YACzC,aAAa,EAAE,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC;SAC9C,CAAC;QACF,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IACjD,CAAC;IAED,IAAI,KAAK,CAAC,KAAwC;QAChD,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,IAAI,UAAU,CAAC,EAAU;QACvB,KAAK,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;IACxB,CAAC;IAED,IAAI,cAAc,CAAC,QAAoD;QACrE,IAAI,CAAC,eAAe,GAAG,QAAQ,CAAC;QAChC,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,IAAI,OAAO,CAAC,QAAoB;QAC9B,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,OAAO,CAAC,EAAU,EAAE,WAAW,GAAG,KAAK;QACrC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;QACtB,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,eAAe,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IAED,YAAY,CAAC,EAAU;QACrB,KAAK,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,cAAc,CAAC,EAAU,EAAE,GAAW;QACpC,IAAI,GAAG,KAAK,OAAO,EAAE,CAAC;YACpB,KAAK,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;QAC9B,CAAC;aAAM,CAAC,CAAE,oBAAoB;YAC5B,IAAI,aAAa,GAAG,CAAC,CAAC,CAAC;YACvB,KAAK,IAAI,GAAG,GAAG,CAAC,EAAE,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE,EAAE,CAAC;gBAClD,IAAI,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,CAAC;oBAC/B,aAAa,GAAG,GAAG,CAAC;oBACpB,MAAM;gBACR,CAAC;YACH,CAAC;YACD,IAAI,aAAa,GAAG,CAAC,EAAE,CAAC;gBACtB,OAAO;YACT,CAAC;YAED,MAAM,MAAM,GAAG,CAAC,GAAG,KAAK,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC9C,MAAM,aAAa,GAAG,CAAC,aAAa,GAAG,MAAM,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;YACpE,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,EAAE,CAAC;YACjD,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChB,OAAO;YACT,CAAC;YAED,KAAK,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE;gBAC7C,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;gBACpB,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;YACvB,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;CACF","sourcesContent":["// Copyright 2019 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {Directives, html, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport cssOverviewSidebarPanelStyles from './cssOverviewSidebarPanel.css.js';\n\nconst {classMap} = Directives;\n\nconst UIStrings = {\n  /**\n   * @description Label for the 'Clear overview' button in the CSS overview report\n   */\n  clearOverview: 'Clear overview',\n  /**\n   * @description Accessible label for the CSS overview panel sidebar\n   */\n  cssOverviewPanelSidebar: 'CSS overview panel sidebar',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/css_overview/CSSOverviewSidebarPanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\ninterface ViewInput {\n  items: Array<{name: string, id: string}>;\n  selectedId?: string;\n  onReset: () => void;\n  onItemClick: (id: string) => void;\n  onItemKeyDown: (id: string, key: string) => void;\n}\ntype View = (input: ViewInput, output: object, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, _output, target) => {\n  const onClick = (event: Event): void => {\n    if (event.target instanceof HTMLElement) {\n      const id = event.target.dataset.id;\n      if (id) {\n        input.onItemClick(id);\n      }\n    }\n  };\n  const onKeyDown = (event: KeyboardEvent): void => {\n    if (event.key !== 'Enter' && event.key !== 'ArrowUp' && event.key !== 'ArrowDown') {\n      return;\n    }\n    if (event.target instanceof HTMLElement) {\n      const id = event.target.dataset.id;\n      if (id) {\n        input.onItemKeyDown(id, event.key);\n      }\n    }\n\n    event.consume(true);\n  };\n\n  // clang-format off\n  render(html`\n      <style>${cssOverviewSidebarPanelStyles}</style>\n      <div class=\"overview-sidebar-panel\" @click=${onClick} @keydown=${onKeyDown}\n           aria-label=${i18nString(UIStrings.cssOverviewPanelSidebar)} role=\"tree\">\n        <div class=\"overview-toolbar\">\n          <devtools-toolbar>\n            <devtools-button title=${i18nString(UIStrings.clearOverview)} @click=${input.onReset}\n                .iconName=${'clear'} .variant=${Buttons.Button.Variant.TOOLBAR}\n                .jslogContext=${'css-overview.clear-overview'}></devtools-button>\n          </devtools-toolbar>\n        </div>\n        ${input.items.map(({id, name}) => {\n          const selected = id === input.selectedId;\n          return html`\n            <div class=\"overview-sidebar-panel-item ${classMap({selected})}\"\n                ?autofocus=${selected}\n                role=\"treeitem\" data-id=${id} tabindex=\"0\"\n                jslog=${VisualLogging.item(`css-overview.${id}`)\n                          .track({click: true, keydown: 'Enter|ArrowUp|ArrowDown'})}>\n              ${name}\n            </div>`;\n        })}\n      </div>`,\n      target);\n  // clang-format on\n};\n\nexport class CSSOverviewSidebarPanel extends UI.Widget.VBox {\n  #view: View;\n  #items: Array<{name: string, id: string}> = [];\n  #selectedId?: string;\n  #onItemSelected = (_id: string, _shouldFocus: boolean): void => {};\n  #onReset = (): void => {};\n\n  constructor(element?: HTMLElement, view = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true, delegatesFocus: true});\n    this.#view = view;\n  }\n\n  override performUpdate(): void {\n    const viewInput = {\n      items: this.#items,\n      selectedId: this.#selectedId,\n      onReset: this.#onReset,\n      onItemClick: this.#onItemClick.bind(this),\n      onItemKeyDown: this.#onItemKeyDown.bind(this)\n    };\n    this.#view(viewInput, {}, this.contentElement);\n  }\n\n  set items(items: Array<{name: string, id: string}>) {\n    this.#items = items;\n    this.requestUpdate();\n  }\n\n  set selectedId(id: string) {\n    void this.#select(id);\n  }\n\n  set onItemSelected(callback: (id: string, shouldFocus: boolean) => void) {\n    this.#onItemSelected = callback;\n    this.requestUpdate();\n  }\n\n  set onReset(callback: () => void) {\n    this.#onReset = callback;\n    this.requestUpdate();\n  }\n\n  #select(id: string, shouldFocus = false): Promise<void> {\n    this.#selectedId = id;\n    this.requestUpdate();\n    this.#onItemSelected(id, shouldFocus);\n    return this.updateComplete;\n  }\n\n  #onItemClick(id: string): void {\n    void this.#select(id, false);\n  }\n\n  #onItemKeyDown(id: string, key: string): void {\n    if (key === 'Enter') {\n      void this.#select(id, true);\n    } else {  // arrow up/down key\n      let currItemIndex = -1;\n      for (let idx = 0; idx < this.#items.length; idx++) {\n        if (this.#items[idx].id === id) {\n          currItemIndex = idx;\n          break;\n        }\n      }\n      if (currItemIndex < 0) {\n        return;\n      }\n\n      const moveTo = (key === 'ArrowDown' ? 1 : -1);\n      const nextItemIndex = (currItemIndex + moveTo) % this.#items.length;\n      const nextItemId = this.#items[nextItemIndex].id;\n      if (!nextItemId) {\n        return;\n      }\n\n      void this.#select(nextItemId, false).then(() => {\n        this.element.blur();\n        this.element.focus();\n      });\n    }\n  }\n}\n"]}