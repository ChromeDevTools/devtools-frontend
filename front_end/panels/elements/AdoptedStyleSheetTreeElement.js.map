{"version":3,"file":"AdoptedStyleSheetTreeElement.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/AdoptedStyleSheetTreeElement.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as CodeHighlighter from '../../ui/components/code_highlighter/code_highlighter.js';\nimport * as Components from '../../ui/legacy/components/utils/utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport {PanelUtils} from '../utils/utils.js';\n\nimport type {EditorHandles} from './ElementsTreeElement.js';\n\nexport class AdoptedStyleSheetSetTreeElement extends UI.TreeOutline.TreeElement {\n  constructor(readonly adoptedStyleSheets: SDK.DOMModel.AdoptedStyleSheet[]) {\n    super('');\n    const documentElement = this.listItemElement.createChild('span');\n    UI.UIUtils.createTextChild(documentElement, '#adopted-style-sheets');\n    for (const adoptedStyleSheet of adoptedStyleSheets) {\n      this.appendChild(new AdoptedStyleSheetTreeElement(adoptedStyleSheet));\n    }\n  }\n}\n\nexport class AdoptedStyleSheetTreeElement extends UI.TreeOutline.TreeElement {\n  private eventListener: Common.EventTarget.EventDescriptor|null = null;\n\n  constructor(readonly adoptedStyleSheet: SDK.DOMModel.AdoptedStyleSheet) {\n    super('');\n    const header = adoptedStyleSheet.cssModel.styleSheetHeaderForId(adoptedStyleSheet.id);\n    if (header) {\n      AdoptedStyleSheetTreeElement.createContents(header, this);\n    } else {\n      this.eventListener = adoptedStyleSheet.cssModel.addEventListener(\n          SDK.CSSModel.Events.StyleSheetAdded, this.onStyleSheetAdded, this);\n    }\n  }\n\n  onStyleSheetAdded({data: header}: Common.EventTarget.EventTargetEvent<SDK.CSSStyleSheetHeader.CSSStyleSheetHeader>):\n      void {\n    if (header.id === this.adoptedStyleSheet.id) {\n      AdoptedStyleSheetTreeElement.createContents(header, this);\n      this.adoptedStyleSheet.cssModel.removeEventListener(\n          SDK.CSSModel.Events.StyleSheetAdded, this.onStyleSheetAdded, this);\n      this.eventListener = null;\n    }\n  }\n\n  static createContents(header: SDK.CSSStyleSheetHeader.CSSStyleSheetHeader, treeElement: UI.TreeOutline.TreeElement):\n      void {\n    const documentElement = treeElement.listItemElement.createChild('span');\n    const linkText = header.sourceURL;\n    UI.UIUtils.createTextChild(documentElement, '#adopted-style-sheet' + (linkText ? ' (' : ''));\n    if (linkText) {\n      documentElement.appendChild(Components.Linkifier.Linkifier.linkifyURL(linkText, {\n        text: linkText,\n        preventClick: true,\n        showColumnNumber: false,\n        inlineFrameIndex: 0,\n      }));\n      UI.UIUtils.createTextChild(documentElement, ')');\n    }\n    treeElement.appendChild(new AdoptedStyleSheetContentsTreeElement(header));\n  }\n\n  highlight(): void {\n    PanelUtils.highlightElement(this.listItemElement);\n  }\n}\n\nexport class AdoptedStyleSheetContentsTreeElement extends UI.TreeOutline.TreeElement {\n  private editing: EditorHandles|null = null;\n\n  constructor(private readonly styleSheetHeader: SDK.CSSStyleSheetHeader.CSSStyleSheetHeader) {\n    super('');\n  }\n\n  override onbind(): void {\n    this.styleSheetHeader.cssModel().addEventListener(\n        SDK.CSSModel.Events.StyleSheetChanged, this.onStyleSheetChanged, this);\n    void this.onpopulate();\n  }\n\n  override onunbind(): void {\n    if (this.editing) {\n      this.editing.cancel();\n    }\n    this.styleSheetHeader.cssModel().removeEventListener(\n        SDK.CSSModel.Events.StyleSheetChanged, this.onStyleSheetChanged, this);\n  }\n\n  override async onpopulate(): Promise<void> {\n    const data = await this.styleSheetHeader.requestContentData();\n    if (!TextUtils.ContentData.ContentData.isError(data) && data.isTextContent) {\n      this.listItemElement.removeChildren();\n      const newNode = this.listItemElement.createChild('span', 'webkit-html-text-node webkit-html-css-node');\n      newNode.setAttribute('jslog', `${VisualLogging.value('css-text-node').track({change: true, dblclick: true})}`);\n      const text = data.text;\n      newNode.textContent = text.replace(/^[\\n\\r]+|\\s+$/g, '');\n      void CodeHighlighter.CodeHighlighter.highlightNode(newNode, 'text/css');\n    }\n  }\n\n  onStyleSheetChanged({data: {styleSheetId}}: Common.EventTarget.EventTargetEvent<SDK.CSSModel.StyleSheetChangedEvent>):\n      void {\n    if (styleSheetId === this.styleSheetHeader.id) {\n      void this.onpopulate();\n    }\n  }\n\n  override ondblclick(event: Event): boolean {\n    if (this.editing) {\n      return false;\n    }\n    void this.startEditing(event.target as Element);\n    return false;\n  }\n\n  override onenter(): boolean {\n    if (this.editing) {\n      return false;\n    }\n    const target = this.listItemElement.querySelector('.webkit-html-text-node');\n    if (target) {\n      void this.startEditing(target);\n      return true;\n    }\n    return false;\n  }\n\n  private async startEditing(target: Element): Promise<void> {\n    if (this.editing || UI.UIUtils.isBeingEdited(target)) {\n      return;\n    }\n\n    const textNode = target.enclosingNodeOrSelfWithClass('webkit-html-text-node');\n    if (!textNode) {\n      return;\n    }\n\n    const data = await this.styleSheetHeader.requestContentData();\n    textNode.textContent = (TextUtils.ContentData.ContentData.isError(data) || !data.isTextContent) ? '' : data.text;\n\n    const config =\n        new UI.InplaceEditor.Config(this.editingCommitted.bind(this), () => this.editingCancelled(), undefined);\n\n    const editorHandles = UI.InplaceEditor.InplaceEditor.startEditing(textNode, config);\n    if (!editorHandles) {\n      return;\n    }\n\n    this.editing = {\n      commit: editorHandles.commit,\n      cancel: editorHandles.cancel,\n      editor: undefined,\n      resize: () => {},\n    };\n\n    const componentSelection = this.listItemElement.getComponentSelection();\n    componentSelection?.selectAllChildren(textNode);\n  }\n\n  private async editingCommitted(element: Element, newText: string, oldText: string|null): Promise<void> {\n    this.editing = null;\n\n    if (newText !== oldText) {\n      await this.styleSheetHeader.cssModel().setStyleSheetText(this.styleSheetHeader.id, newText, false);\n    }\n\n    this.editingCancelled();\n  }\n\n  private editingCancelled(): void {\n    this.editing = null;\n    void this.onpopulate();\n  }\n\n  isEditing(): boolean {\n    return this.editing !== null;\n  }\n}\n"]}