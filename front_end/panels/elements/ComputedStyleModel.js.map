{"version":3,"file":"ComputedStyleModel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/ComputedStyleModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {ComputedStyleWidget} from './ComputedStyleWidget.js';\nimport {StylesSidebarPane} from './StylesSidebarPane.js';\n\nexport class ComputedStyleModel extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  #node: SDK.DOMModel.DOMNode|null;\n  #cssModel: SDK.CSSModel.CSSModel|null;\n  private eventListeners: Common.EventTarget.EventDescriptor[];\n  private frameResizedTimer?: number;\n  private computedStylePromise?: Promise<ComputedStyle|null>;\n  private currentTrackedNodeId?: number;\n\n  constructor() {\n    super();\n    this.#cssModel = null;\n    this.eventListeners = [];\n    this.#node = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.onNodeChanged, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        StylesSidebarPane, this.evaluateTrackingComputedStyleUpdatesForNode, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        ComputedStyleWidget, this.evaluateTrackingComputedStyleUpdatesForNode, this);\n  }\n\n  dispose(): void {\n    UI.Context.Context.instance().removeFlavorChangeListener(SDK.DOMModel.DOMNode, this.onNodeChanged, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        StylesSidebarPane, this.evaluateTrackingComputedStyleUpdatesForNode, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        ComputedStyleWidget, this.evaluateTrackingComputedStyleUpdatesForNode, this);\n  }\n\n  node(): SDK.DOMModel.DOMNode|null {\n    return this.#node;\n  }\n\n  cssModel(): SDK.CSSModel.CSSModel|null {\n    return this.#cssModel?.isEnabled() ? this.#cssModel : null;\n  }\n\n  // This is a debounced method because the user might be navigated from Styles tab to Computed Style tab and vice versa.\n  // For that case, we want to only run this function once.\n  private evaluateTrackingComputedStyleUpdatesForNode = Common.Debouncer.debounce((): void => {\n    if (!this.#node) {\n      // There isn't a node selected now, so let's stop tracking computed style updates for the previously tracked node.\n      if (this.currentTrackedNodeId) {\n        void this.cssModel()?.trackComputedStyleUpdatesForNode(undefined);\n        this.currentTrackedNodeId = undefined;\n      }\n      return;\n    }\n\n    const isComputedStyleWidgetVisible = Boolean(UI.Context.Context.instance().flavor(ComputedStyleWidget));\n    const isStylesTabVisible = Boolean(UI.Context.Context.instance().flavor(StylesSidebarPane));\n    const shouldTrackComputedStyleUpdates = isComputedStyleWidgetVisible ||\n        (isStylesTabVisible && Root.Runtime.hostConfig.devToolsAnimationStylesInStylesTab?.enabled);\n    // There is a selected node but not the computed style widget nor the styles tab is visible.\n    // If there is a previously tracked node let's stop tracking computed style updates for that node.\n    if (!shouldTrackComputedStyleUpdates) {\n      if (this.currentTrackedNodeId) {\n        void this.cssModel()?.trackComputedStyleUpdatesForNode(undefined);\n        this.currentTrackedNodeId = undefined;\n      }\n      return;\n    }\n\n    // Either computed style widget or styles tab is visible\n    // if the currently tracked node id is not the same as the selected node\n    // let's start tracking the currently selected node.\n    if (this.currentTrackedNodeId !== this.#node.id) {\n      void this.cssModel()?.trackComputedStyleUpdatesForNode(this.#node.id);\n      this.currentTrackedNodeId = this.#node.id;\n    }\n  }, 100);\n\n  private onNodeChanged(event: Common.EventTarget.EventTargetEvent<SDK.DOMModel.DOMNode|null>): void {\n    this.#node = event.data;\n    this.updateModel(this.#node ? this.#node.domModel().cssModel() : null);\n    this.onCSSModelChanged(null);\n    this.evaluateTrackingComputedStyleUpdatesForNode();\n  }\n\n  private updateModel(cssModel: SDK.CSSModel.CSSModel|null): void {\n    if (this.#cssModel === cssModel) {\n      return;\n    }\n    Common.EventTarget.removeEventListeners(this.eventListeners);\n    this.#cssModel = cssModel;\n    const domModel = cssModel ? cssModel.domModel() : null;\n    const resourceTreeModel = cssModel ? cssModel.target().model(SDK.ResourceTreeModel.ResourceTreeModel) : null;\n    if (cssModel && domModel && resourceTreeModel) {\n      this.eventListeners = [\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetAdded, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetRemoved, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetChanged, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.FontsUpdated, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.MediaQueryResultChanged, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.PseudoStateForced, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.StartingStylesStateForced, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.ModelWasEnabled, this.onCSSModelChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.ComputedStyleUpdated, this.onComputedStyleChanged, this),\n        domModel.addEventListener(SDK.DOMModel.Events.DOMMutated, this.onDOMModelChanged, this),\n        resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.FrameResized, this.onFrameResized, this),\n      ];\n    }\n  }\n\n  private onCSSModelChanged(event: Common.EventTarget.EventTargetEvent<CSSModelChangedEvent>|null): void {\n    delete this.computedStylePromise;\n    this.dispatchEventToListeners(Events.CSS_MODEL_CHANGED, event?.data ?? null);\n  }\n\n  private onComputedStyleChanged(\n      event: Common.EventTarget.EventTargetEvent<SDK.CSSModel.ComputedStyleUpdatedEvent>|null): void {\n    delete this.computedStylePromise;\n    // If the event contains `nodeId` and that's not the same as this node's id\n    // we don't emit the COMPUTED_STYLE_CHANGED event.\n    if (event?.data && 'nodeId' in event.data && event.data.nodeId !== this.#node?.id) {\n      return;\n    }\n\n    this.dispatchEventToListeners(Events.COMPUTED_STYLE_CHANGED);\n  }\n\n  private onDOMModelChanged(event: Common.EventTarget.EventTargetEvent<SDK.DOMModel.DOMNode>): void {\n    // Any attribute removal or modification can affect the styles of \"related\" nodes.\n    const node = event.data;\n    if (!this.#node ||\n        this.#node !== node && node.parentNode !== this.#node.parentNode && !node.isAncestor(this.#node)) {\n      return;\n    }\n    this.onCSSModelChanged(null);\n  }\n\n  private onFrameResized(): void {\n    function refreshContents(this: ComputedStyleModel): void {\n      this.onCSSModelChanged(null);\n      delete this.frameResizedTimer;\n    }\n\n    if (this.frameResizedTimer) {\n      clearTimeout(this.frameResizedTimer);\n    }\n\n    this.frameResizedTimer = window.setTimeout(refreshContents.bind(this), 100);\n  }\n\n  private elementNode(): SDK.DOMModel.DOMNode|null {\n    const node = this.node();\n    if (!node) {\n      return null;\n    }\n    return node.enclosingElementOrSelf();\n  }\n\n  async fetchComputedStyle(): Promise<ComputedStyle|null> {\n    const elementNode = this.elementNode();\n    const cssModel = this.cssModel();\n    if (!elementNode || !cssModel) {\n      return null;\n    }\n    const nodeId = elementNode.id;\n    if (!nodeId) {\n      return null;\n    }\n\n    if (!this.computedStylePromise) {\n      this.computedStylePromise = cssModel.getComputedStyle(nodeId).then(verifyOutdated.bind(this, elementNode));\n    }\n\n    return await this.computedStylePromise;\n\n    function verifyOutdated(\n        this: ComputedStyleModel, elementNode: SDK.DOMModel.DOMNode, style: Map<string, string>|null): ComputedStyle|\n        null {\n      return elementNode === this.elementNode() && style ? new ComputedStyle(elementNode, style) :\n                                                           null as ComputedStyle | null;\n    }\n  }\n}\n\nexport const enum Events {\n  CSS_MODEL_CHANGED = 'CSSModelChanged',\n  COMPUTED_STYLE_CHANGED = 'ComputedStyleChanged',\n}\n\nexport type CSSModelChangedEvent = SDK.CSSStyleSheetHeader.CSSStyleSheetHeader|SDK.CSSModel.StyleSheetChangedEvent|\n                                   SDK.CSSModel.PseudoStateForcedEvent|SDK.DOMModel.DOMNode|null|void;\n\nexport interface EventTypes {\n  [Events.CSS_MODEL_CHANGED]: CSSModelChangedEvent;\n  [Events.COMPUTED_STYLE_CHANGED]: void;\n}\n\nexport class ComputedStyle {\n  node: SDK.DOMModel.DOMNode;\n  computedStyle: Map<string, string>;\n  constructor(node: SDK.DOMModel.DOMNode, computedStyle: Map<string, string>) {\n    this.node = node;\n    this.computedStyle = computedStyle;\n  }\n}\n"]}