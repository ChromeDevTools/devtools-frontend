{"version":3,"file":"DOMPath.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/DOMPath.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\n\nexport const fullQualifiedSelector = function(node: SDK.DOMModel.DOMNode, justSelector?: boolean): string {\n  if (node.nodeType() !== Node.ELEMENT_NODE) {\n    return node.localName() || node.nodeName().toLowerCase();\n  }\n  return cssPath(node, justSelector);\n};\n\nexport const cssPath = function(node: SDK.DOMModel.DOMNode, optimized?: boolean): string {\n  if (node.nodeType() !== Node.ELEMENT_NODE) {\n    return '';\n  }\n\n  const steps = [];\n  let contextNode: SDK.DOMModel.DOMNode|null = node;\n  while (contextNode) {\n    const step = cssPathStep(contextNode, Boolean(optimized), contextNode === node);\n    if (!step) {\n      break;\n    }  // Error - bail out early.\n    steps.push(step);\n    if (step.optimized) {\n      break;\n    }\n    contextNode = contextNode.parentNode;\n  }\n\n  steps.reverse();\n  return steps.join(' > ');\n};\n\nexport const canGetJSPath = function(node: SDK.DOMModel.DOMNode): boolean {\n  let wp: (SDK.DOMModel.DOMNode|null)|SDK.DOMModel.DOMNode = node;\n  while (wp) {\n    const shadowRoot = wp.ancestorShadowRoot();\n    if (shadowRoot && shadowRoot.shadowRootType() !== SDK.DOMModel.DOMNode.ShadowRootTypes.Open) {\n      return false;\n    }\n    wp = wp.ancestorShadowHost();\n  }\n  return true;\n};\n\nexport const jsPath = function(node: SDK.DOMModel.DOMNode, optimized?: boolean): string {\n  if (node.nodeType() !== Node.ELEMENT_NODE) {\n    return '';\n  }\n\n  const path = [];\n  let wp: (SDK.DOMModel.DOMNode|null)|SDK.DOMModel.DOMNode = node;\n  while (wp) {\n    path.push(cssPath(wp, optimized));\n    wp = wp.ancestorShadowHost();\n  }\n  path.reverse();\n  let result = '';\n  for (let i = 0; i < path.length; ++i) {\n    const string = JSON.stringify(path[i]);\n    if (i) {\n      result += `.shadowRoot.querySelector(${string})`;\n    } else {\n      result += `document.querySelector(${string})`;\n    }\n  }\n  return result;\n};\n\nconst cssPathStep = function(node: SDK.DOMModel.DOMNode, optimized: boolean, isTargetNode: boolean): Step|null {\n  if (node.nodeType() !== Node.ELEMENT_NODE) {\n    return null;\n  }\n\n  const id = node.getAttribute('id');\n  if (optimized) {\n    if (id) {\n      return new Step(idSelector(id), true);\n    }\n    const nodeNameLower = node.nodeName().toLowerCase();\n    if (nodeNameLower === 'body' || nodeNameLower === 'head' || nodeNameLower === 'html') {\n      return new Step(node.nodeNameInCorrectCase(), true);\n    }\n  }\n  const nodeName = node.nodeNameInCorrectCase();\n\n  if (id) {\n    return new Step(nodeName + idSelector(id), true);\n  }\n  const parent = node.parentNode;\n  if (!parent || parent.nodeType() === Node.DOCUMENT_NODE) {\n    return new Step(nodeName, true);\n  }\n\n  function prefixedElementClassNames(node: SDK.DOMModel.DOMNode): string[] {\n    const classAttribute = node.getAttribute('class');\n    if (!classAttribute) {\n      return [];\n    }\n\n    return classAttribute.split(/\\s+/g).filter(Boolean).map(function(name) {\n      // The prefix is required to store \"__proto__\" in a object-based map.\n      return '$' + name;\n    });\n  }\n\n  function idSelector(id: string): string {\n    return '#' + CSS.escape(id);\n  }\n\n  const prefixedOwnClassNamesArray = prefixedElementClassNames(node);\n  let needsClassNames = false;\n  let needsNthChild = false;\n  let ownIndex = -1;\n  let elementIndex = -1;\n  const siblings = parent.children();\n  for (let i = 0; siblings && (ownIndex === -1 || !needsNthChild) && i < siblings.length; ++i) {\n    const sibling = siblings[i];\n    if (sibling.nodeType() !== Node.ELEMENT_NODE) {\n      continue;\n    }\n    elementIndex += 1;\n    if (sibling === node) {\n      ownIndex = elementIndex;\n      continue;\n    }\n    if (needsNthChild) {\n      continue;\n    }\n    if (sibling.nodeNameInCorrectCase() !== nodeName) {\n      continue;\n    }\n\n    needsClassNames = true;\n    const ownClassNames = new Set<string>(prefixedOwnClassNamesArray);\n    if (!ownClassNames.size) {\n      needsNthChild = true;\n      continue;\n    }\n    const siblingClassNamesArray = prefixedElementClassNames(sibling);\n    for (let j = 0; j < siblingClassNamesArray.length; ++j) {\n      const siblingClass = siblingClassNamesArray[j];\n      if (!ownClassNames.has(siblingClass)) {\n        continue;\n      }\n      ownClassNames.delete(siblingClass);\n      if (!ownClassNames.size) {\n        needsNthChild = true;\n        break;\n      }\n    }\n  }\n\n  let result = nodeName;\n  if (isTargetNode && nodeName.toLowerCase() === 'input' && node.getAttribute('type') && !node.getAttribute('id') &&\n      !node.getAttribute('class')) {\n    result += '[type=' + CSS.escape((node.getAttribute('type')) || '') + ']';\n  }\n  if (needsNthChild) {\n    result += ':nth-child(' + (ownIndex + 1) + ')';\n  } else if (needsClassNames) {\n    for (const prefixedName of prefixedOwnClassNamesArray) {\n      result += '.' + CSS.escape(prefixedName.slice(1));\n    }\n  }\n\n  return new Step(result, false);\n};\n\nexport const xPath = function(node: SDK.DOMModel.DOMNode, optimized?: boolean): string {\n  if (node.nodeType() === Node.DOCUMENT_NODE) {\n    return '/';\n  }\n\n  const steps = [];\n  let contextNode: SDK.DOMModel.DOMNode|null = node;\n  while (contextNode) {\n    const step = xPathValue(contextNode, optimized);\n    if (!step) {\n      break;\n    }  // Error - bail out early.\n    steps.push(step);\n    if (step.optimized) {\n      break;\n    }\n    contextNode = contextNode.parentNode;\n  }\n\n  steps.reverse();\n  return (steps.length && steps[0].optimized ? '' : '/') + steps.join('/');\n};\n\nconst xPathValue = function(node: SDK.DOMModel.DOMNode, optimized?: boolean): Step|null {\n  let ownValue;\n  const ownIndex = xPathIndex(node);\n  if (ownIndex === -1) {\n    return null;\n  }  // Error.\n\n  switch (node.nodeType()) {\n    case Node.ELEMENT_NODE:\n      if (optimized && node.getAttribute('id')) {\n        return new Step('//*[@id=\"' + node.getAttribute('id') + '\"]', true);\n      }\n      ownValue = node.localName();\n      break;\n    case Node.ATTRIBUTE_NODE:\n      ownValue = '@' + node.nodeName();\n      break;\n    case Node.TEXT_NODE:\n    case Node.CDATA_SECTION_NODE:\n      ownValue = 'text()';\n      break;\n    case Node.PROCESSING_INSTRUCTION_NODE:\n      ownValue = 'processing-instruction()';\n      break;\n    case Node.COMMENT_NODE:\n      ownValue = 'comment()';\n      break;\n    case Node.DOCUMENT_NODE:\n      ownValue = '';\n      break;\n    default:\n      ownValue = '';\n      break;\n  }\n\n  if (ownIndex > 0) {\n    ownValue += '[' + ownIndex + ']';\n  }\n\n  return new Step(ownValue, node.nodeType() === Node.DOCUMENT_NODE);\n};\n\nconst xPathIndex = function(node: SDK.DOMModel.DOMNode): number {\n  /**\n   * Returns -1 in case of error, 0 if no siblings matching the same expression,\n   * <XPath index among the same expression-matching sibling nodes> otherwise.\n   */\n  function areNodesSimilar(left: SDK.DOMModel.DOMNode, right: SDK.DOMModel.DOMNode): boolean {\n    if (left === right) {\n      return true;\n    }\n\n    if (left.nodeType() === Node.ELEMENT_NODE && right.nodeType() === Node.ELEMENT_NODE) {\n      return left.localName() === right.localName();\n    }\n\n    if (left.nodeType() === right.nodeType()) {\n      return true;\n    }\n\n    // XPath treats CDATA as text nodes.\n    const leftType = left.nodeType() === Node.CDATA_SECTION_NODE ? Node.TEXT_NODE : left.nodeType();\n    const rightType = right.nodeType() === Node.CDATA_SECTION_NODE ? Node.TEXT_NODE : right.nodeType();\n    return leftType === rightType;\n  }\n\n  const siblings = node.parentNode ? node.parentNode.children() : null;\n  if (!siblings) {\n    return 0;\n  }  // Root node - no siblings.\n  let hasSameNamedElements;\n  for (let i = 0; i < siblings.length; ++i) {\n    if (areNodesSimilar(node, siblings[i]) && siblings[i] !== node) {\n      hasSameNamedElements = true;\n      break;\n    }\n  }\n  if (!hasSameNamedElements) {\n    return 0;\n  }\n  let ownIndex = 1;  // XPath indices start with 1.\n  for (let i = 0; i < siblings.length; ++i) {\n    if (areNodesSimilar(node, siblings[i])) {\n      if (siblings[i] === node) {\n        return ownIndex;\n      }\n      ++ownIndex;\n    }\n  }\n  return -1;  // An error occurred: |node| not found in parent's children.\n};\n\nexport class Step {\n  value: string;\n  optimized: boolean;\n  constructor(value: string, optimized: boolean) {\n    this.value = value;\n    this.optimized = optimized || false;\n  }\n\n  toString(): string {\n    return this.value;\n  }\n}\n"]}