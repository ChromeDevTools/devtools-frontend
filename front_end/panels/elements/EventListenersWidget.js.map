{"version":3,"file":"EventListenersWidget.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/EventListenersWidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2007 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Joseph Pecoraro\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {html, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as EventListeners from '../event_listeners/event_listeners.js';\n\nconst {bindToAction, bindToSetting} = UI.UIUtils;\n\nconst UIStrings = {\n  /**\n   * @description Title of show framework listeners setting in event listeners widget of the elements panel\n   */\n  frameworkListeners: 'Resolve `Framework` listeners',\n  /**\n   * @description Tooltip text that appears on the setting when hovering over it in Event Listeners Widget of the Elements panel\n   */\n  showListenersOnTheAncestors: 'Show listeners on the ancestors',\n  /**\n   * @description Alternative title text of a setting in Event Listeners Widget of the Elements panel\n   */\n  ancestors: 'Ancestors',\n  /**\n   * @description Title of dispatch filter in event listeners widget of the elements panel\n   */\n  eventListenersCategory: 'Event listeners category',\n  /**\n   * @description Text for everything\n   */\n  all: 'All',\n  /**\n   * @description Text in Event Listeners Widget of the Elements panel\n   */\n  passive: 'Passive',\n  /**\n   * @description Text in Event Listeners Widget of the Elements panel\n   */\n  blocking: 'Blocking',\n  /**\n   * @description Tooltip text that appears on the setting when hovering over it in Event Listeners Widget of the Elements panel\n   */\n  resolveEventListenersBoundWith: 'Resolve event listeners bound with framework',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/elements/EventListenersWidget.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nlet eventListenersWidgetInstance: EventListenersWidget;\n\ninterface ViewInput {\n  refreshEventListenersActionName: string;\n  showForAncestorsSetting: Common.Settings.Setting<boolean>;\n  dispatchFilterBySetting: Common.Settings.Setting<string>;\n  showFrameworkListenersSetting: Common.Settings.Setting<boolean>;\n  onDispatchFilterTypeChange: (value: string) => void;\n  onEventListenersViewChange: () => void;\n  dispatchFilters: Array<{name: string, value: string}>;\n  selectedDispatchFilter: string;\n  eventListenerObjects: Array<SDK.RemoteObject.RemoteObject|null>;\n  filter: {\n    showFramework: boolean,\n    showPassive: boolean,\n    showBlocking: boolean,\n  };\n}\n\ntype View = (input: ViewInput, output: object, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, _output, target) => {\n  // clang-format off\n  render(html`\n    <div jslog=${VisualLogging.pane('elements.event-listeners').track({ resize: true })}>\n      <devtools-toolbar class=\"event-listener-toolbar\" role=\"presentation\">\n        <devtools-button ${bindToAction(input.refreshEventListenersActionName)}></devtools-button>\n        <devtools-checkbox title=${i18nString(UIStrings.showListenersOnTheAncestors)}\n          ${bindToSetting(input.showForAncestorsSetting)}\n          jslog=${VisualLogging.toggle('show-event-listeners-for-ancestors').track({ change: true })}>\n          ${i18nString(UIStrings.ancestors)}\n        </devtools-checkbox>\n        <select class=\"dispatch-filter\"\n          title=${i18nString(UIStrings.eventListenersCategory)}\n          aria-label=${i18nString(UIStrings.eventListenersCategory)}\n          jslog=${VisualLogging.filterDropdown().track({ change: true })}\n          @change=${(e: Event) => input.onDispatchFilterTypeChange((e.target as HTMLSelectElement).value)}>\n          ${input.dispatchFilters.map(filter => html`\n            <option value=${filter.value} ?selected=${filter.value === input.selectedDispatchFilter}>\n              ${filter.name}\n            </option>`)}\n        </select>\n        <devtools-checkbox title=${i18nString(UIStrings.resolveEventListenersBoundWith)}\n          ${bindToSetting(input.showFrameworkListenersSetting)}\n          jslog=${VisualLogging.toggle('show-frameowkr-listeners').track({ change: true })}>\n          ${i18nString(UIStrings.frameworkListeners)}\n        </devtools-checkbox>\n      </devtools-toolbar>\n      <devtools-widget .widgetConfig=${UI.Widget.widgetConfig(EventListeners.EventListenersView.EventListenersView, {\n        changeCallback: input.onEventListenersViewChange,\n        objects: input.eventListenerObjects,\n        filter: input.filter,\n      })}></devtools-widget>\n    </div>`, target);\n  // clang-format on\n};\n\nexport class EventListenersWidget extends UI.Widget.VBox {\n  private showForAncestorsSetting: Common.Settings.Setting<boolean>;\n  private readonly dispatchFilterBySetting: Common.Settings.Setting<string>;\n  private readonly showFrameworkListenersSetting: Common.Settings.Setting<boolean>;\n  private lastRequestedNode?: SDK.DOMModel.DOMNode;\n  readonly #view: View;\n\n  constructor(view: View = DEFAULT_VIEW) {\n    super();\n    this.#view = view;\n    this.showForAncestorsSetting =\n        Common.Settings.Settings.instance().moduleSetting('show-event-listeners-for-ancestors');\n    this.showForAncestorsSetting.addChangeListener(this.requestUpdate.bind(this));\n\n    this.dispatchFilterBySetting =\n        Common.Settings.Settings.instance().createSetting('event-listener-dispatch-filter-type', DispatchFilterBy.All);\n    this.dispatchFilterBySetting.addChangeListener(this.requestUpdate.bind(this));\n\n    this.showFrameworkListenersSetting =\n        Common.Settings.Settings.instance().createSetting('show-frameowkr-listeners', true);\n    this.showFrameworkListenersSetting.setTitle(i18nString(UIStrings.frameworkListeners));\n    this.showFrameworkListenersSetting.addChangeListener(this.requestUpdate.bind(this));\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.requestUpdate.bind(this));\n    this.requestUpdate();\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n  }|undefined = {forceNew: null}): EventListenersWidget {\n    const {forceNew} = opts;\n    if (!eventListenersWidgetInstance || forceNew) {\n      eventListenersWidgetInstance = new EventListenersWidget();\n    }\n\n    return eventListenersWidgetInstance;\n  }\n\n  override async performUpdate(): Promise<void> {\n    const dispatchFilter = this.dispatchFilterBySetting.get();\n    const showPassive = dispatchFilter === DispatchFilterBy.All || dispatchFilter === DispatchFilterBy.Passive;\n    const showBlocking = dispatchFilter === DispatchFilterBy.All || dispatchFilter === DispatchFilterBy.Blocking;\n\n    const input = {\n      refreshEventListenersActionName: 'elements.refresh-event-listeners',\n      showForAncestorsSetting: this.showForAncestorsSetting,\n      dispatchFilterBySetting: this.dispatchFilterBySetting,\n      showFrameworkListenersSetting: this.showFrameworkListenersSetting,\n      onDispatchFilterTypeChange: (value: string) => {\n        this.dispatchFilterBySetting.set(value);\n      },\n      onEventListenersViewChange: this.requestUpdate.bind(this),\n      dispatchFilters: [\n        {name: i18nString(UIStrings.all), value: DispatchFilterBy.All},\n        {name: i18nString(UIStrings.passive), value: DispatchFilterBy.Passive},\n        {name: i18nString(UIStrings.blocking), value: DispatchFilterBy.Blocking},\n      ],\n      selectedDispatchFilter: dispatchFilter,\n      eventListenerObjects: [] as Array<SDK.RemoteObject.RemoteObject|null>,\n      filter: {showFramework: this.showFrameworkListenersSetting.get(), showPassive, showBlocking},\n    };\n\n    if (this.lastRequestedNode) {\n      this.lastRequestedNode.domModel().runtimeModel().releaseObjectGroup(objectGroupName);\n      delete this.lastRequestedNode;\n    }\n    const node = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n    if (node) {\n      this.lastRequestedNode = node;\n      const selectedNodeOnly = !this.showForAncestorsSetting.get();\n      const promises = [];\n      promises.push(node.resolveToObject(objectGroupName));\n      if (!selectedNodeOnly) {\n        let currentNode: (SDK.DOMModel.DOMNode|null) = node.parentNode;\n        while (currentNode) {\n          promises.push(currentNode.resolveToObject(objectGroupName));\n          currentNode = currentNode.parentNode;\n        }\n        promises.push(this.windowObjectInNodeContext(node));\n      }\n      input.eventListenerObjects = await Promise.all(promises);\n    }\n\n    this.#view(input, {}, this.contentElement);\n  }\n\n  override wasShown(): void {\n    UI.Context.Context.instance().setFlavor(EventListenersWidget, this);\n    super.wasShown();\n  }\n\n  override willHide(): void {\n    super.willHide();\n    UI.Context.Context.instance().setFlavor(EventListenersWidget, null);\n  }\n\n  private windowObjectInNodeContext(node: SDK.DOMModel.DOMNode): Promise<SDK.RemoteObject.RemoteObject|null> {\n    const executionContexts = node.domModel().runtimeModel().executionContexts();\n    let context: SDK.RuntimeModel.ExecutionContext = executionContexts[0];\n    if (node.frameId()) {\n      for (let i = 0; i < executionContexts.length; ++i) {\n        const executionContext = executionContexts[i];\n        if (executionContext.frameId === node.frameId() && executionContext.isDefault) {\n          context = executionContext;\n        }\n      }\n    }\n\n    return context\n        .evaluate(\n            {\n              expression: 'self',\n              objectGroup: objectGroupName,\n              includeCommandLineAPI: false,\n              silent: true,\n              returnByValue: false,\n              generatePreview: false,\n            },\n            /* userGesture */ false,\n            /* awaitPromise */ false)\n        .then(result => {\n          if ('object' in result) {\n            return result.object;\n          }\n          return null;\n        });\n  }\n\n  eventListenersArrivedForTest(): void {\n  }\n}\n\nexport const DispatchFilterBy = {\n  All: 'All',\n  Blocking: 'Blocking',\n  Passive: 'Passive',\n};\n\nconst objectGroupName = 'event-listeners-panel';\n\nexport class ActionDelegate implements UI.ActionRegistration.ActionDelegate {\n  handleAction(_context: UI.Context.Context, actionId: string): boolean {\n    switch (actionId) {\n      case 'elements.refresh-event-listeners': {\n        EventListenersWidget.instance().requestUpdate();\n        return true;\n      }\n    }\n    return false;\n  }\n}\n"]}