{"version":3,"file":"ImagePreviewPopover.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/ImagePreviewPopover.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAI7B,OAAO,KAAK,UAAU,MAAM,2CAA2C,CAAC;AACxE,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAEhD;;;;;GAKG;AACH,MAAM,OAAO,mBAAmB;IACb,cAAc,CAAkC;IAChD,UAAU,CAAiD;IAC3D,OAAO,CAAiC;IACzD,YACI,SAAsB,EAAE,cAA+C,EACvE,UAA0D;QAC5D,IAAI,CAAC,cAAc,GAAG,cAAc,CAAC;QACrC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,OAAO;YACR,IAAI,EAAE,CAAC,aAAa,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,wBAAwB,CAAC,CAAC;QAC3G,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IAClC,CAAC;IAEO,aAAa,CAAC,KAAY;QAChC,MAAM,IAAI,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,IAAI,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO;YACL,GAAG,EAAE,IAAI,CAAC,WAAW,EAAE;YACvB,IAAI,EAAE,SAAS;YACf,IAAI,EAAE,KAAK,EAAE,OAA+B,EAAE,EAAE;gBAC9C,MAAM,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACrC,IAAI,CAAC,IAAI,EAAE,CAAC;oBACV,OAAO,KAAK,CAAC;gBACf,CAAC;gBACD,MAAM,mBAAmB,GAAG,MAAM,UAAU,CAAC,YAAY,CAAC,YAAY,CAAC,qBAAqB,CAAC,IAAI,CAAC,CAAC;gBACnG,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,YAAY,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE;oBAC3E,YAAY,EAAE,SAAS;oBACvB,mBAAmB;oBACnB,KAAK,qDAAsC;iBAC5C,CAAC,CAAC;gBACH,IAAI,OAAO,EAAE,CAAC;oBACZ,OAAO,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;gBAC9C,CAAC;gBACD,OAAO,OAAO,CAAC,OAAO,CAAC,CAAC;YAC1B,CAAC;SACF,CAAC;IACJ,CAAC;IAED,IAAI;QACF,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;IAC7B,CAAC;IAED,MAAM,CAAC,WAAW,CAAC,OAAgB,EAAE,GAAoC;QACvE,eAAe,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAClC,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,MAAM,CAAC,WAAW,CAAC,OAAgB;QACjC,OAAO,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IACtC,CAAC;CACF;AAED,MAAM,eAAe,GAAG,IAAI,OAAO,EAA4C,CAAC","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../core/platform/platform.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Components from '../../ui/legacy/components/utils/utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\n/**\n * ImagePreviewPopover sets listeners on the container element to display\n * an image preview if needed. The image URL comes from the event (mouseover) target\n * in a property identified by HrefSymbol. To enable preview for any child element\n * set the property HrefSymbol.\n */\nexport class ImagePreviewPopover {\n  private readonly getLinkElement: (arg0: Event) => Element | null;\n  private readonly getDOMNode: (arg0: Element) => SDK.DOMModel.DOMNode | null;\n  private readonly popover: UI.PopoverHelper.PopoverHelper;\n  constructor(\n      container: HTMLElement, getLinkElement: (arg0: Event) => Element | null,\n      getDOMNode: (arg0: Element) => SDK.DOMModel.DOMNode | null) {\n    this.getLinkElement = getLinkElement;\n    this.getDOMNode = getDOMNode;\n    this.popover =\n        new UI.PopoverHelper.PopoverHelper(container, this.handleRequest.bind(this), 'elements.image-preview');\n    this.popover.setTimeout(0, 100);\n  }\n\n  private handleRequest(event: Event): UI.PopoverHelper.PopoverRequest|null {\n    const link = this.getLinkElement(event);\n    if (!link) {\n      return null;\n    }\n    const href = elementToURLMap.get(link);\n    if (!href) {\n      return null;\n    }\n    return {\n      box: link.boxInWindow(),\n      hide: undefined,\n      show: async (popover: UI.GlassPane.GlassPane) => {\n        const node = this.getDOMNode((link));\n        if (!node) {\n          return false;\n        }\n        const precomputedFeatures = await Components.ImagePreview.ImagePreview.loadDimensionsForNode(node);\n        const preview = await Components.ImagePreview.ImagePreview.build(href, true, {\n          imageAltText: undefined,\n          precomputedFeatures,\n          align: Components.ImagePreview.Align.CENTER,\n        });\n        if (preview) {\n          popover.contentElement.appendChild(preview);\n        }\n        return Boolean(preview);\n      },\n    };\n  }\n\n  hide(): void {\n    this.popover.hidePopover();\n  }\n\n  static setImageUrl(element: Element, url: Platform.DevToolsPath.UrlString): Element {\n    elementToURLMap.set(element, url);\n    return element;\n  }\n\n  static getImageURL(element: Element): Platform.DevToolsPath.UrlString|undefined {\n    return elementToURLMap.get(element);\n  }\n}\n\nconst elementToURLMap = new WeakMap<Element, Platform.DevToolsPath.UrlString>();\n"]}