{"version":3,"file":"AdornerManager.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/elements/components/AdornerManager.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAS7B,MAAM,CAAN,IAAY,kBAgBX;AAhBD,WAAY,kBAAkB;IAC5B,+BAAS,CAAA;IACT,6CAAuB,CAAA;IACvB,mCAAa,CAAA;IACb,mCAAa,CAAA;IACb,+CAAyB,CAAA;IACzB,qCAAe,CAAA;IACf,yCAAmB,CAAA;IACnB,uCAAiB,CAAA;IACjB,uCAAiB,CAAA;IACjB,iDAA2B,CAAA;IAC3B,mCAAa,CAAA;IACb,iDAA2B,CAAA;IAC3B,uDAAiC,CAAA;IACjC,yCAAmB,CAAA;IACnB,6CAAuB,CAAA;AACzB,CAAC,EAhBW,kBAAkB,KAAlB,kBAAkB,QAgB7B;AAOD,MAAM,OAAO,cAAc;IACzB,gBAAgB,GAAuB,IAAI,GAAG,EAAE,CAAC;IACjD,aAAa,CAAiC;IAE9C,YAAY,YAA4C;QACtD,IAAI,CAAC,aAAa,GAAG,YAAY,CAAC;QAClC,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,cAAc,CAAC,QAA4B;QACzC,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;QACjC,IAAI,CAAC,uBAAuB,EAAE,CAAC;IACjC,CAAC;IAED,WAAW;QACT,OAAO,IAAI,CAAC,gBAAgB,CAAC;IAC/B,CAAC;IAED,gBAAgB,CAAC,WAAmB;QAClC,OAAO,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,WAAW,CAAC,IAAI,KAAK,CAAC;IACzD,CAAC;IAED,uBAAuB;QACrB,MAAM,WAAW,GAAG,EAAE,CAAC;QACvB,KAAK,MAAM,CAAC,OAAO,EAAE,SAAS,CAAC,IAAI,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACzD,WAAW,CAAC,IAAI,CAAC,EAAC,OAAO,EAAE,SAAS,EAAC,CAAC,CAAC;QACzC,CAAC;QACD,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;IACtC,CAAC;IAED,aAAa;QACX,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC;QAC7C,KAAK,MAAM,OAAO,IAAI,WAAW,EAAE,CAAC;YAClC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;QAChE,CAAC;IACH,CAAC;IAED,aAAa;QACX,IAAI,CAAC,aAAa,EAAE,CAAC;QAErB,+DAA+D;QAC/D,MAAM,gBAAgB,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,EAAE,CAAC,CAAC;QAC/D,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,kBAAkB,CAAC,EAAE,CAAC;YACxD,gBAAgB,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YACjC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;gBACxC,iDAAiD;gBACjD,MAAM,SAAS,GAAG,OAAO,KAAK,kBAAkB,CAAC,KAAK,CAAC;gBACvD,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAChD,CAAC;QACH,CAAC;QACD,KAAK,MAAM,eAAe,IAAI,gBAAgB,EAAE,CAAC;YAC/C,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAChD,CAAC;QAED,IAAI,CAAC,uBAAuB,EAAE,CAAC;IACjC,CAAC;CACF","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\ninterface AdornerSetting {\n  adorner: string;\n  isEnabled: boolean;\n}\n\ntype AdornerSettingsMap = Map<string, boolean>;\n\nexport enum RegisteredAdorners {\n  AD = 'ad',\n  CONTAINER = 'container',\n  FLEX = 'flex',\n  GRID = 'grid',\n  GRID_LANES = 'grid-lanes',\n  MEDIA = 'media',\n  POPOVER = 'popover',\n  REVEAL = 'reveal',\n  SCROLL = 'scroll',\n  SCROLL_SNAP = 'scroll-snap',\n  SLOT = 'slot',\n  VIEW_SOURCE = 'view-source',\n  STARTING_STYLE = 'starting-style',\n  SUBGRID = 'subgrid',\n  TOP_LAYER = 'top-layer',\n}\n\ninterface SettingStore<Setting> {\n  get(): Setting;\n  set(setting: Setting): void;\n}\n\nexport class AdornerManager {\n  #adornerSettings: AdornerSettingsMap = new Map();\n  #settingStore: SettingStore<AdornerSetting[]>;\n\n  constructor(settingStore: SettingStore<AdornerSetting[]>) {\n    this.#settingStore = settingStore;\n    this.#syncSettings();\n  }\n\n  updateSettings(settings: AdornerSettingsMap): void {\n    this.#adornerSettings = settings;\n    this.#persistCurrentSettings();\n  }\n\n  getSettings(): Readonly<AdornerSettingsMap> {\n    return this.#adornerSettings;\n  }\n\n  isAdornerEnabled(adornerText: string): boolean {\n    return this.#adornerSettings.get(adornerText) || false;\n  }\n\n  #persistCurrentSettings(): void {\n    const settingList = [];\n    for (const [adorner, isEnabled] of this.#adornerSettings) {\n      settingList.push({adorner, isEnabled});\n    }\n    this.#settingStore.set(settingList);\n  }\n\n  #loadSettings(): void {\n    const settingList = this.#settingStore.get();\n    for (const setting of settingList) {\n      this.#adornerSettings.set(setting.adorner, setting.isEnabled);\n    }\n  }\n\n  #syncSettings(): void {\n    this.#loadSettings();\n\n    // Prune outdated adorners and add new ones to the persistence.\n    const outdatedAdorners = new Set(this.#adornerSettings.keys());\n    for (const adorner of Object.values(RegisteredAdorners)) {\n      outdatedAdorners.delete(adorner);\n      if (!this.#adornerSettings.has(adorner)) {\n        // Only the MEDIA adorner is disabled by default.\n        const isEnabled = adorner !== RegisteredAdorners.MEDIA;\n        this.#adornerSettings.set(adorner, isEnabled);\n      }\n    }\n    for (const outdatedAdorner of outdatedAdorners) {\n      this.#adornerSettings.delete(outdatedAdorner);\n    }\n\n    this.#persistCurrentSettings();\n  }\n}\n"]}