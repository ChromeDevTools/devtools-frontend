{"version":3,"file":"InspectedPagePlaceholder.js","sourceRoot":"","sources":["../../../../../../front_end/panels/emulation/InspectedPagePlaceholder.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport inspectedPagePlaceholderStyles from './inspectedPagePlaceholder.css.js';\n\nlet inspectedPagePlaceholderInstance: InspectedPagePlaceholder;\n\nexport class InspectedPagePlaceholder extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.Widget>(\n    UI.Widget.Widget) {\n  private updateId?: number;\n  constructor() {\n    super({useShadowDom: true});\n    this.registerRequiredCSS(inspectedPagePlaceholderStyles);\n    UI.ZoomManager.ZoomManager.instance().addEventListener(UI.ZoomManager.Events.ZOOM_CHANGED, this.onResize, this);\n    this.restoreMinimumSize();\n  }\n\n  static instance(opts: {\n    forceNew: null,\n  } = {forceNew: null}): InspectedPagePlaceholder {\n    const {forceNew} = opts;\n    if (!inspectedPagePlaceholderInstance || forceNew) {\n      inspectedPagePlaceholderInstance = new InspectedPagePlaceholder();\n    }\n\n    return inspectedPagePlaceholderInstance;\n  }\n\n  override onResize(): void {\n    if (this.updateId) {\n      this.element.window().cancelAnimationFrame(this.updateId);\n    }\n    this.updateId = this.element.window().requestAnimationFrame(this.update.bind(this, false));\n  }\n\n  restoreMinimumSize(): void {\n    this.setMinimumSize(150, 150);\n  }\n\n  clearMinimumSize(): void {\n    this.setMinimumSize(1, 1);\n  }\n\n  private dipPageRect(): {\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  } {\n    const zoomFactor = UI.ZoomManager.ZoomManager.instance().zoomFactor();\n    const rect = this.element.getBoundingClientRect();\n    const bodyRect = this.element.ownerDocument.body.getBoundingClientRect();\n\n    const left = Math.max(rect.left * zoomFactor, bodyRect.left * zoomFactor);\n    const top = Math.max(rect.top * zoomFactor, bodyRect.top * zoomFactor);\n    const bottom = Math.min(rect.bottom * zoomFactor, bodyRect.bottom * zoomFactor);\n    const right = Math.min(rect.right * zoomFactor, bodyRect.right * zoomFactor);\n\n    return {x: left, y: top, width: right - left, height: bottom - top};\n  }\n\n  update(force?: boolean): void {\n    delete this.updateId;\n    const rect = this.dipPageRect();\n    const bounds = {\n      x: Math.round(rect.x),\n      y: Math.round(rect.y),\n      height: Math.max(1, Math.round(rect.height)),\n      width: Math.max(1, Math.round(rect.width)),\n    };\n    if (force) {\n      // Short term fix for Lighthouse interop.\n      --bounds.height;\n      this.dispatchEventToListeners(Events.UPDATE, bounds);\n      ++bounds.height;\n    }\n    this.dispatchEventToListeners(Events.UPDATE, bounds);\n  }\n}\n\nexport const enum Events {\n  UPDATE = 'Update',\n}\n\nexport interface Bounds {\n  x: number;\n  y: number;\n  height: number;\n  width: number;\n}\n\nexport interface EventTypes {\n  [Events.UPDATE]: Bounds;\n}\n"]}