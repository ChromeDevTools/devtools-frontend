{"version":3,"file":"ConsoleInsight.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/explain/components/ConsoleInsight.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../ui/components/spinners/spinners.js';\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as Root from '../../../core/root/root.js';\nimport * as Marked from '../../../third_party/marked/marked.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as Input from '../../../ui/components/input/input.js';\nimport * as MarkdownView from '../../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport * as Console from '../../console/console.js';\n\nimport styles from './consoleInsight.css.js';\n\n// Note: privacy and legal notices are not localized so far.\nconst UIStrings = {\n  /**\n   * @description The title of the insight source \"Console message\".\n   */\n  consoleMessage: 'Console message',\n  /**\n   * @description The title of the insight source \"Stacktrace\".\n   */\n  stackTrace: 'Stacktrace',\n  /**\n   * @description The title of the insight source \"Network request\".\n   */\n  networkRequest: 'Network request',\n  /**\n   * @description The title of the insight source \"Related code\".\n   */\n  relatedCode: 'Related code',\n  /**\n   * @description The title that is shown while the insight is being generated.\n   */\n  generating: 'Generating explanation…',\n  /**\n   * @description The header that indicates that the content shown is a console\n   * insight.\n   */\n  insight: 'Explanation',\n  /**\n   * @description The title of the a button that closes the insight pane.\n   */\n  closeInsight: 'Close explanation',\n  /**\n   * @description The title of the list of source data that was used to generate the insight.\n   */\n  inputData: 'Data used to understand this message',\n  /**\n   * @description The title of the button that allows submitting positive\n   * feedback about the console insight.\n   */\n  goodResponse: 'Good response',\n  /**\n   * @description The title of the button that allows submitting negative\n   * feedback about the console insight.\n   */\n  badResponse: 'Bad response',\n  /**\n   * @description The title of the button that opens a page to report a legal\n   * issue with the console insight.\n   */\n  report: 'Report legal issue',\n  /**\n   * @description The text of the header inside the console insight pane when there was an error generating an insight.\n   */\n  error: 'DevTools has encountered an error',\n  /**\n   * @description The message shown when an error has been encountered.\n   */\n  errorBody: 'Something went wrong. Try again.',\n  /**\n   * @description Label for screen readers that is added to the end of the link\n   * title to indicate that the link will be opened in a new tab.\n   */\n  opensInNewTab: '(opens in a new tab)',\n  /**\n   * @description The title of a link that allows the user to learn more about\n   * the feature.\n   */\n  learnMore: 'Learn more',\n  /**\n   * @description The error message when the user is not logged in into Chrome.\n   */\n  notLoggedIn: 'This feature is only available when you sign into Chrome with your Google account.',\n  /**\n   * @description The title of a button which opens the Chrome SignIn page.\n   */\n  signIn: 'Sign in',\n  /**\n   * @description The header shown when the internet connection is not\n   * available.\n   */\n  offlineHeader: 'DevTools can’t reach the internet',\n  /**\n   * @description Message shown when the user is offline.\n   */\n  offline: 'Check your internet connection and try again.',\n  /**\n   * @description The message shown if the user is not logged in.\n   */\n  signInToUse: 'Sign in to use this feature',\n  /**\n   * @description The title of the button that searches for the console\n   * insight using a search engine instead of using console insights.\n   */\n  search: 'Use search instead',\n  /**\n   * @description Shown to the user when the network request data is not\n   * available and a page reload might populate it.\n   */\n  reloadRecommendation:\n      'Reload the page to capture related network request data for this message in order to create a better insight.',\n  /**\n   * @description Shown to the user when they need to enable the console insights feature in settings in order to use it.\n   * @example {Console insights in Settings} PH1\n   */\n  turnOnInSettings:\n      'Turn on {PH1} to receive AI assistance for understanding and addressing console warnings and errors.',\n  /**\n   * @description Text for a link to Chrome DevTools Settings.\n   */\n  settingsLink: '`Console insights` in Settings',\n  /**\n   * @description The title of the list of references/recitations that were used to generate the insight.\n   */\n  references: 'Sources and related content',\n  /**\n   * @description Sub-heading for a list of links to URLs which are related to the AI-generated response.\n   */\n  relatedContent: 'Related content',\n  /**\n   * @description Error message shown when the request to get an AI response times out.\n   */\n  timedOut: 'Generating a response took too long. Please try again.',\n  /**\n   * @description Text informing the user that AI assistance is not available in Incognito mode or Guest mode.\n   */\n  notAvailableInIncognitoMode: 'AI assistance is not available in Incognito mode or Guest mode',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/explain/components/ConsoleInsight.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst i18nTemplate = Lit.i18nTemplate.bind(undefined, str_);\n\nconst {render, html, Directives} = Lit;\n\nexport class CloseEvent extends Event {\n  static readonly eventName = 'close';\n\n  constructor() {\n    super(CloseEvent.eventName, {composed: true, bubbles: true});\n  }\n}\n\ntype PublicPromptBuilder = Pick<Console.PromptBuilder.PromptBuilder, 'buildPrompt'|'getSearchQuery'>;\ntype PublicAidaClient = Pick<Host.AidaClient.AidaClient, 'doConversation'|'registerClientEvent'>;\n\nfunction localizeType(sourceType: Console.PromptBuilder.SourceType): string {\n  switch (sourceType) {\n    case Console.PromptBuilder.SourceType.MESSAGE:\n      return i18nString(UIStrings.consoleMessage);\n    case Console.PromptBuilder.SourceType.STACKTRACE:\n      return i18nString(UIStrings.stackTrace);\n    case Console.PromptBuilder.SourceType.NETWORK_REQUEST:\n      return i18nString(UIStrings.networkRequest);\n    case Console.PromptBuilder.SourceType.RELATED_CODE:\n      return i18nString(UIStrings.relatedCode);\n  }\n}\n\nconst TERMS_OF_SERVICE_URL = 'https://policies.google.com/terms';\nconst PRIVACY_POLICY_URL = 'https://policies.google.com/privacy';\nconst CODE_SNIPPET_WARNING_URL = 'https://support.google.com/legal/answer/13505487';\nconst LEARN_MORE_URL = 'https://goo.gle/devtools-console-messages-ai' as Platform.DevToolsPath.UrlString;\nconst REPORT_URL = 'https://support.google.com/legal/troubleshooter/1114905?hl=en#ts=1115658%2C13380504' as\n    Platform.DevToolsPath.UrlString;\nconst SIGN_IN_URL = 'https://accounts.google.com' as Platform.DevToolsPath.UrlString;\n\ninterface ViewInput {\n  state: StateData;\n  closing: boolean;\n  disableAnimations: boolean;\n  renderer: MarkdownView.MarkdownView.MarkdownInsightRenderer;\n  selectedRating?: boolean;\n  noLogging: boolean;\n  areReferenceDetailsOpen: boolean;\n  highlightedCitationIndex: number;\n  callbacks: {\n    onClose: () => void,\n    onAnimationEnd: () => void,\n    onSearch: () => void,\n    onRating: (isPositive: boolean) => void,\n    onReport: () => void,\n    onGoToSignIn: () => void,\n    onConsentReminderConfirmed: () => Promise<void>,\n    onToggleReferenceDetails: (event: Event) => void,\n    onDisclaimerSettingsLink: () => void,\n    onReminderSettingsLink: () => void,\n    onEnableInsightsInSettingsLink: () => void,\n    onReferencesOpen: () => void,\n  };\n}\n\ninterface ViewOutput {\n  headerRef: Lit.Directives.Ref<HTMLHeadingElement>;\n  citationLinks: HTMLElement[];\n}\n\nconst enum State {\n  INSIGHT = 'insight',\n  LOADING = 'loading',\n  ERROR = 'error',\n  SETTING_IS_NOT_TRUE = 'setting-is-not-true',\n  CONSENT_REMINDER = 'consent-reminder',\n  NOT_LOGGED_IN = 'not-logged-in',\n  SYNC_IS_PAUSED = 'sync-is-paused',\n  OFFLINE = 'offline',\n}\n\ntype StateData = {\n  type: State.LOADING,\n  consentOnboardingCompleted: boolean,\n}|{\n  type: State.INSIGHT,\n  tokens: MarkdownView.MarkdownView.MarkdownViewData['tokens'],\n  validMarkdown: boolean,\n  sources: Console.PromptBuilder.Source[],\n  isPageReloadRecommended: boolean,\n  completed: boolean,\n  directCitationUrls: string[],\n  relatedUrls: string[],\n  timedOut?: boolean,\n}&Host.AidaClient.DoConversationResponse|{\n  type: State.ERROR,\n  error: string,\n}|{\n  type: State.CONSENT_REMINDER,\n  sources: Console.PromptBuilder.Source[],\n  isPageReloadRecommended: boolean,\n}|{\n  type: State.SETTING_IS_NOT_TRUE,\n}|{\n  type: State.NOT_LOGGED_IN,\n}|{\n  type: State.SYNC_IS_PAUSED,\n}|{\n  type: State.OFFLINE,\n};\n\nconst markedExtension = {\n  name: 'citation',\n  level: 'inline',\n  start(src: string) {\n    return src.match(/\\[\\^/)?.index;\n  },\n  tokenizer(src: string) {\n    const match = src.match(/^\\[\\^(\\d+)\\]/);\n    if (match) {\n      return {\n        type: 'citation',\n        raw: match[0],\n        linkText: Number(match[1]),\n      };\n    }\n    return false;\n  },\n  renderer: () => '',\n};\n\nfunction isSearchRagResponse(metadata: Host.AidaClient.ResponseMetadata): boolean {\n  return Boolean(metadata.factualityMetadata?.facts.length);\n}\n\nconst blockPropagation = (e: Event): void => e.stopPropagation();\n\nfunction renderSearchButton(onSearch: ViewInput['callbacks']['onSearch']): Lit.TemplateResult {\n  // clang-format off\n  return html`<devtools-button\n    @click=${onSearch}\n    class=\"search-button\"\n    .variant=${Buttons.Button.Variant.OUTLINED}\n    .jslogContext=${'search'}\n  >\n    ${i18nString(UIStrings.search)}\n  </devtools-button>`;\n  // clang-format on\n}\n\nfunction renderLearnMoreAboutInsights(): Lit.TemplateResult {\n  // clang-format off\n  return html`<x-link href=${LEARN_MORE_URL} class=\"link\" jslog=${VisualLogging.link('learn-more').track({click: true})}>\n    ${i18nString(UIStrings.learnMore)}\n  </x-link>`;\n  // clang-format on\n}\n\nfunction maybeRenderSources(\n    directCitationUrls: string[], highlightedCitationIndex: number, output: ViewOutput): Lit.LitTemplate {\n  if (!directCitationUrls.length) {\n    return Lit.nothing;\n  }\n\n  // clang-format off\n  return html`\n    <ol class=\"sources-list\">\n      ${directCitationUrls.map((url, index) => html`\n        <li>\n          <x-link\n            href=${url}\n            class=${Directives.classMap({link: true, highlighted: index === highlightedCitationIndex})}\n            jslog=${VisualLogging.link('references.console-insights').track({click: true})}\n            ${Directives.ref(e => { output.citationLinks[index] = e as HTMLElement; })}\n          >\n            ${url}\n          </x-link>\n        </li>\n      `)}\n    </ol>\n  `;\n  // clang-format on\n}\n\nfunction maybeRenderRelatedContent(relatedUrls: string[], directCitationUrls: string[]): Lit.LitTemplate {\n  if (relatedUrls.length === 0) {\n    return Lit.nothing;\n  }\n  // clang-format off\n  return html`\n    ${directCitationUrls.length ? html`<h3>${i18nString(UIStrings.relatedContent)}</h3>` : Lit.nothing}\n    <ul class=\"references-list\">\n      ${relatedUrls.map(relatedUrl => html`\n        <li>\n          <x-link\n            href=${relatedUrl}\n            class=\"link\"\n            jslog=${VisualLogging.link('references.console-insights').track({click: true})}\n          >\n            ${relatedUrl}\n          </x-link>\n        </li>\n      `)}\n    </ul>\n  `;\n  // clang-format on\n}\n\nfunction renderLoading(): Lit.TemplateResult {\n  // clang-format off\n  return html`\n    <div role=\"presentation\" aria-label=\"Loading\" class=\"loader\" style=\"clip-path: url('#clipPath');\">\n      <svg width=\"100%\" height=\"64\">\n        <clipPath id=\"clipPath\">\n          <rect x=\"0\" y=\"0\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n          <rect x=\"0\" y=\"24\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n          <rect x=\"0\" y=\"48\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n        </clipPath>\n      </svg>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderInsightSourcesList(\n    sources: Console.PromptBuilder.Source[], isPageReloadRecommended: boolean): Lit.TemplateResult {\n  // clang-format off\n  return html`\n    <div class=\"insight-sources\">\n      <ul>\n        ${Directives.repeat(sources, item => item.value, item => {\n          return html`<li><x-link class=\"link\" title=\"${localizeType(item.type)} ${i18nString(UIStrings.opensInNewTab)}\" href=\"data:text/plain;charset=utf-8,${encodeURIComponent(item.value)}\" jslog=${VisualLogging.link('source-' + item.type).track({click: true})}>\n            <devtools-icon name=\"open-externally\"></devtools-icon>\n            ${localizeType(item.type)}\n          </x-link></li>`;\n        })}\n        ${isPageReloadRecommended ? html`<li class=\"source-disclaimer\">\n          <devtools-icon name=\"warning\"></devtools-icon>\n          ${i18nString(UIStrings.reloadRecommendation)}</li>` : Lit.nothing}\n      </ul>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderInsight(\n    insight: Extract<StateData, {type: State.INSIGHT}>,\n    {renderer, disableAnimations, areReferenceDetailsOpen, highlightedCitationIndex, callbacks}: ViewInput,\n    output: ViewOutput): Lit.TemplateResult {\n  // clang-format off\n      return html`\n        ${\n          insight.validMarkdown ? html`<devtools-markdown-view\n            .data=${{tokens: insight.tokens, renderer, animationEnabled: !disableAnimations} as MarkdownView.MarkdownView.MarkdownViewData}>\n          </devtools-markdown-view>`: insight.explanation\n        }\n        ${insight.timedOut ? html`<p class=\"error-message\">${i18nString(UIStrings.timedOut)}</p>` : Lit.nothing}\n        ${isSearchRagResponse(insight.metadata) ? html`\n          <details\n            class=\"references\"\n            ?open=${areReferenceDetailsOpen}\n            jslog=${VisualLogging.expand('references').track({click: true})}\n            @toggle=${callbacks.onToggleReferenceDetails}\n            @transitionend=${callbacks.onReferencesOpen}\n          >\n            <summary>${i18nString(UIStrings.references)}</summary>\n            ${maybeRenderSources(insight.directCitationUrls, highlightedCitationIndex, output)}\n            ${maybeRenderRelatedContent(insight.relatedUrls, insight.directCitationUrls)}\n          </details>\n        ` : Lit.nothing}\n        <details jslog=${VisualLogging.expand('sources').track({click: true})}>\n          <summary>${i18nString(UIStrings.inputData)}</summary>\n          ${renderInsightSourcesList(insight.sources, insight.isPageReloadRecommended)}\n        </details>\n        <div class=\"buttons\">\n          ${renderSearchButton(callbacks.onSearch)}\n        </div>`;\n  // clang-format on\n}\n\nfunction renderError(message: string): Lit.TemplateResult {\n  // clang-format off\n  return html`<div class=\"error\">${message}</div>`;\n  // clang-format on\n}\n\nfunction renderConsentReminder(noLogging: boolean): Lit.TemplateResult {\n  // clang-format off\n  return html`\n    <h3>Things to consider</h3>\n    <div class=\"reminder-items\">\n      <div>\n        <devtools-icon name=\"google\" class=\"medium\">\n        </devtools-icon>\n      </div>\n      <div>The console message, associated stack trace, related source code, and the associated network headers are sent to Google to generate explanations. ${noLogging\n          ? 'The content you submit and that is generated by this feature will not be used to improve Google’s AI models.'\n          : 'This data may be seen by human reviewers to improve this feature. Avoid sharing sensitive or personal information.'}\n      </div>\n      <div>\n        <devtools-icon name=\"policy\" class=\"medium\">\n        </devtools-icon>\n      </div>\n      <div>Use of this feature is subject to the <x-link\n          href=${TERMS_OF_SERVICE_URL}\n          class=\"link\"\n          jslog=${VisualLogging.link('terms-of-service.console-insights').track({click: true})}>\n        Google Terms of Service\n        </x-link> and <x-link\n          href=${PRIVACY_POLICY_URL}\n          class=\"link\"\n          jslog=${VisualLogging.link('privacy-policy.console-insights').track({click: true})}>\n        Google Privacy Policy\n        </x-link>\n      </div>\n      <div>\n        <devtools-icon name=\"warning\" class=\"medium\">\n        </devtools-icon>\n      </div>\n      <div>\n        <x-link\n          href=${CODE_SNIPPET_WARNING_URL}\n          class=\"link\"\n          jslog=${VisualLogging.link('code-snippets-explainer.console-insights').track({click: true})}\n        >Use generated code snippets with caution</x-link>\n      </div>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderSettingIsNotTrue(onEnableInsightsInSettingsLink: () => void): Lit.TemplateResult {\n  // clang-format off\n  const settingsLink = html`\n    <button\n      class=\"link\" role=\"link\"\n      jslog=${VisualLogging.action('open-ai-settings').track({click: true})}\n      @click=${onEnableInsightsInSettingsLink}\n    >${i18nString(UIStrings.settingsLink)}</button>`;\n\n  return html`\n    <div class=\"badge\">\n      <devtools-icon name=\"lightbulb-spark\" class=\"medium\">\n      </devtools-icon>\n    </div>\n    <div>\n      ${i18nTemplate(UIStrings.turnOnInSettings, {PH1: settingsLink})} ${\n      renderLearnMoreAboutInsights()}\n    </div>`;\n  // clang-format on\n}\n\nfunction renderNotLoggedIn(): Lit.TemplateResult {\n  return renderError(\n      Root.Runtime.hostConfig.isOffTheRecord ? i18nString(UIStrings.notAvailableInIncognitoMode) :\n                                               i18nString(UIStrings.notLoggedIn));\n}\n\nfunction renderDisclaimer(noLogging: boolean, onDisclaimerSettingsLink: () => void): Lit.LitTemplate {\n  // clang-format off\n  return html`<span>\n    AI tools may generate inaccurate info that doesn't represent Google's views. ${noLogging\n      ? 'The content you submit and that is generated by this feature will not be used to improve Google’s AI models.'\n      : 'Data sent to Google may be seen by human reviewers to improve this feature.'\n    } <button class=\"link\" role=\"link\" @click=${onDisclaimerSettingsLink}\n              jslog=${VisualLogging.action('open-ai-settings').track({click: true})}>\n      Open settings\n    </button> or <x-link href=${LEARN_MORE_URL}\n        class=\"link\" jslog=${VisualLogging.link('learn-more').track({click: true})}>\n      learn more\n    </x-link>\n  </span>`;\n  // clang-format on\n}\n\nfunction renderDisclaimerFooter(noLogging: boolean, onDisclaimerSettingsLink: () => void): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"disclaimer\">\n      ${renderDisclaimer(noLogging, onDisclaimerSettingsLink)}\n    </div>`;\n  // clang-format on\n}\n\nfunction renderSignInFooter(onGoToSignIn: () => void): Lit.LitTemplate {\n  if (Root.Runtime.hostConfig.isOffTheRecord) {\n    return Lit.nothing;\n  }\n  // clang-format off\n  return html`\n    <div class=\"filler\"></div>\n    <div>\n      <devtools-button\n        @click=${onGoToSignIn}\n        .variant=${Buttons.Button.Variant.PRIMARY}\n        .jslogContext=${'update-settings'}\n      >\n        ${i18nString(UIStrings.signIn)}\n      </devtools-button>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderConsentReminderFooter(onReminderSettingsLink: () => void, onConsentReminderConfirmed: () => void): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"filler\"></div>\n    <div class=\"buttons\">\n      <devtools-button\n        @click=${onReminderSettingsLink}\n        .variant=${Buttons.Button.Variant.TONAL}\n        .jslogContext=${'settings'}\n        .title=${'Settings'}\n      >\n        Settings\n      </devtools-button>\n      <devtools-button\n        class='continue-button'\n        @click=${onConsentReminderConfirmed}\n        .variant=${Buttons.Button.Variant.PRIMARY}\n        .jslogContext=${'continue'}\n        .title=${'continue'}\n      >\n        Continue\n      </devtools-button>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderInsightFooter(noLogging: ViewInput['noLogging'], selectedRating: ViewInput['selectedRating'], callbacks: ViewInput['callbacks']): Lit.LitTemplate {\n  // clang-format off\n  return html`\n  <div class=\"disclaimer\">\n    ${renderDisclaimer(noLogging, callbacks.onDisclaimerSettingsLink)}\n  </div>\n  <div class=\"filler\"></div>\n  <div class=\"rating\">\n    <devtools-button\n      data-rating=\"true\"\n      .iconName=${'thumb-up'}\n      .toggledIconName=${'thumb-up'}\n      .variant=${Buttons.Button.Variant.ICON_TOGGLE}\n      .size=${Buttons.Button.Size.SMALL}\n      .toggleOnClick=${false}\n      .toggleType=${Buttons.Button.ToggleType.PRIMARY}\n      .disabled=${selectedRating !== undefined}\n      .toggled=${selectedRating === true}\n      .title=${i18nString(UIStrings.goodResponse)}\n      .jslogContext=${'thumbs-up'}\n      @click=${() => callbacks.onRating(true)}\n    ></devtools-button>\n    <devtools-button\n      data-rating=\"false\"\n      .iconName=${'thumb-down'}\n      .toggledIconName=${'thumb-down'}\n      .variant=${Buttons.Button.Variant.ICON_TOGGLE}\n      .size=${Buttons.Button.Size.SMALL}\n      .toggleOnClick=${false}\n      .toggleType=${Buttons.Button.ToggleType.PRIMARY}\n      .disabled=${selectedRating !== undefined}\n      .toggled=${selectedRating === false}\n      .title=${i18nString(UIStrings.badResponse)}\n      .jslogContext=${'thumbs-down'}\n      @click=${() => callbacks.onRating(false)}\n    ></devtools-button>\n    <devtools-button\n      .iconName=${'report'}\n      .variant=${Buttons.Button.Variant.ICON}\n      .size=${Buttons.Button.Size.SMALL}\n      .title=${i18nString(UIStrings.report)}\n      .jslogContext=${'report'}\n      @click=${callbacks.onReport}\n    ></devtools-button>\n  </div>`;\n  // clang-format on\n}\n\nfunction renderHeaderIcon(): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"header-icon-container\">\n      <devtools-icon name=\"lightbulb-spark\" class=\"large\">\n      </devtools-icon>\n    </div>`;\n  // clang-format on\n}\n\ninterface HeaderInput {\n  headerText: string;\n  showIcon?: boolean;\n  showSpinner?: boolean;\n  onClose: ViewInput['callbacks']['onClose'];\n}\n\nfunction renderHeader(\n    {headerText, showIcon = false, showSpinner = false, onClose}: HeaderInput,\n    headerRef: Lit.Directives.Ref<HTMLHeadingElement>): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <header>\n      ${showIcon ? renderHeaderIcon() : Lit.nothing}\n      <div class=\"filler\">\n        <h2 tabindex=\"-1\" ${Directives.ref(headerRef)}>\n          ${headerText}\n        </h2>\n        ${showSpinner ? html`<devtools-spinner></devtools-spinner>` : Lit.nothing}\n      </div>\n      <div class=\"close-button\">\n        <devtools-button\n          .iconName=${'cross'}\n          .variant=${Buttons.Button.Variant.ICON}\n          .size=${Buttons.Button.Size.SMALL}\n          .title=${i18nString(UIStrings.closeInsight)}\n          jslog=${VisualLogging.close().track({click: true})}\n          @click=${onClose}\n        ></devtools-button>\n      </div>\n    </header>\n  `;\n  // clang-format on\n}\n\nexport class ConsoleInsight extends HTMLElement {\n  static async create(promptBuilder: PublicPromptBuilder, aidaClient: PublicAidaClient): Promise<ConsoleInsight> {\n    const aidaPreconditions = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    return new ConsoleInsight(promptBuilder, aidaClient, aidaPreconditions);\n  }\n\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  disableAnimations = false;\n\n  #promptBuilder: PublicPromptBuilder;\n  #aidaClient: PublicAidaClient;\n  #renderer: MarkdownView.MarkdownView.MarkdownInsightRenderer;\n\n  // Main state.\n  #state: StateData;\n  #headerRef = Directives.createRef<HTMLHeadingElement>();\n  #citationLinks: HTMLElement[] = [];\n  #highlightedCitationIndex = -1;  // -1 for no highlight, 0-based index otherwise\n  #areReferenceDetailsOpen = false;\n  #stateChanging = false;\n  #closing = false;\n\n  // Rating sub-form state.\n  #selectedRating?: boolean;\n\n  #consoleInsightsEnabledSetting: Common.Settings.Setting<boolean>|undefined;\n  #aidaPreconditions: Host.AidaClient.AidaAccessPreconditions;\n  #boundOnAidaAvailabilityChange: () => Promise<void>;\n  #marked: Marked.Marked.Marked;\n\n  constructor(\n      promptBuilder: PublicPromptBuilder, aidaClient: PublicAidaClient,\n      aidaPreconditions: Host.AidaClient.AidaAccessPreconditions) {\n    super();\n    this.#promptBuilder = promptBuilder;\n    this.#aidaClient = aidaClient;\n    this.#aidaPreconditions = aidaPreconditions;\n    this.#consoleInsightsEnabledSetting = this.#getConsoleInsightsEnabledSetting();\n    this.#renderer = new MarkdownView.MarkdownView.MarkdownInsightRenderer(this.#citationClickHandler.bind(this));\n    this.#marked = new Marked.Marked.Marked({extensions: [markedExtension]});\n\n    this.#state = this.#getStateFromAidaAvailability();\n    this.#boundOnAidaAvailabilityChange = this.#onAidaAvailabilityChange.bind(this);\n    this.#render();\n    this.focus();\n  }\n\n  #citationClickHandler(index: number): void {\n    if (this.#state.type !== State.INSIGHT) {\n      return;\n    }\n    const areDetailsAlreadyExpanded = this.#areReferenceDetailsOpen;\n    this.#areReferenceDetailsOpen = true;\n    // index is 1-based, #currentHighlightedCitationIndex is 0-based\n    this.#highlightedCitationIndex = index - 1;\n    this.#render();\n\n    // If details are open, focus and scroll to citation immediately. Otherwise wait for opening transition.\n    if (areDetailsAlreadyExpanded) {\n      this.#scrollToHighlightedCitation();\n    }\n  }\n\n  #scrollToHighlightedCitation(): void {\n    const highlightedElement = this.#citationLinks[this.#highlightedCitationIndex];\n    if (highlightedElement) {\n      highlightedElement.scrollIntoView({behavior: 'auto'});\n      highlightedElement.focus();\n    }\n  }\n\n  #getStateFromAidaAvailability(): StateData {\n    switch (this.#aidaPreconditions) {\n      case Host.AidaClient.AidaAccessPreconditions.AVAILABLE: {\n        // Allows skipping the consent reminder if the user enabled the feature via settings in the current session\n        const skipReminder =\n            Common.Settings.Settings.instance()\n                .createSetting('console-insights-skip-reminder', false, Common.Settings.SettingStorageType.SESSION)\n                .get();\n        return {\n          type: State.LOADING,\n          consentOnboardingCompleted: this.#getOnboardingCompletedSetting().get() || skipReminder,\n        };\n      }\n      case Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL:\n        return {\n          type: State.NOT_LOGGED_IN,\n        };\n      case Host.AidaClient.AidaAccessPreconditions.SYNC_IS_PAUSED:\n        return {\n          type: State.SYNC_IS_PAUSED,\n        };\n      case Host.AidaClient.AidaAccessPreconditions.NO_INTERNET:\n        return {\n          type: State.OFFLINE,\n        };\n    }\n  }\n\n  // off -> entrypoints are shown, and point to the AI setting panel where the setting can be turned on\n  // on -> entrypoints are shown, and console insights can be generated\n  #getConsoleInsightsEnabledSetting(): Common.Settings.Setting<boolean>|undefined {\n    try {\n      return Common.Settings.moduleSetting('console-insights-enabled') as Common.Settings.Setting<boolean>;\n    } catch {\n      return;\n    }\n  }\n\n  // off -> consent reminder is shown, unless the 'console-insights-enabled'-setting has been enabled in the current DevTools session\n  // on -> no consent reminder shown\n  #getOnboardingCompletedSetting(): Common.Settings.Setting<boolean> {\n    return Common.Settings.Settings.instance().createLocalSetting('console-insights-onboarding-finished', false);\n  }\n\n  connectedCallback(): void {\n    this.#consoleInsightsEnabledSetting?.addChangeListener(this.#onConsoleInsightsSettingChanged, this);\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (this.#state.type === State.LOADING && this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true &&\n        !blockedByAge && this.#state.consentOnboardingCompleted) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.GeneratingInsightWithoutDisclaimer);\n    }\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n    // If AIDA availability has changed while the component was disconnected, we need to update.\n    void this.#onAidaAvailabilityChange();\n    // The setting might have been turned on/off while the component was disconnected.\n    // Update the state, unless the current state is already terminal (`INSIGHT` or `ERROR`).\n    if (this.#state.type !== State.INSIGHT && this.#state.type !== State.ERROR) {\n      this.#state = this.#getStateFromAidaAvailability();\n    }\n    void this.#generateInsightIfNeeded();\n  }\n\n  disconnectedCallback(): void {\n    this.#consoleInsightsEnabledSetting?.removeChangeListener(this.#onConsoleInsightsSettingChanged, this);\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n  }\n\n  async #onAidaAvailabilityChange(): Promise<void> {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaPreconditions) {\n      this.#aidaPreconditions = currentAidaAvailability;\n      this.#state = this.#getStateFromAidaAvailability();\n      void this.#generateInsightIfNeeded();\n    }\n  }\n\n  #onConsoleInsightsSettingChanged(): void {\n    if (this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true) {\n      this.#getOnboardingCompletedSetting().set(true);\n    }\n    if (this.#state.type === State.SETTING_IS_NOT_TRUE &&\n        this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true) {\n      this.#transitionTo({\n        type: State.LOADING,\n        consentOnboardingCompleted: true,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserConfirmedInSettings);\n      void this.#generateInsightIfNeeded();\n    }\n    if (this.#state.type === State.CONSENT_REMINDER &&\n        this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === false) {\n      this.#transitionTo({\n        type: State.LOADING,\n        consentOnboardingCompleted: false,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserAbortedInSettings);\n      void this.#generateInsightIfNeeded();\n    }\n  }\n\n  #transitionTo(newState: StateData): void {\n    this.#stateChanging = this.#state.type !== newState.type;\n    this.#state = newState;\n    this.#render();\n  }\n\n  async #generateInsightIfNeeded(): Promise<void> {\n    if (this.#state.type !== State.LOADING) {\n      return;\n    }\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (this.#consoleInsightsEnabledSetting?.getIfNotDisabled() !== true || blockedByAge) {\n      this.#transitionTo({\n        type: State.SETTING_IS_NOT_TRUE,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserShown);\n      return;\n    }\n    if (!this.#state.consentOnboardingCompleted) {\n      const {sources, isPageReloadRecommended} = await this.#promptBuilder.buildPrompt();\n      this.#transitionTo({\n        type: State.CONSENT_REMINDER,\n        sources,\n        isPageReloadRecommended,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserShown);\n      return;\n    }\n    await this.#generateInsight();\n  }\n\n  #onClose(): void {\n    if (this.#state.type === State.CONSENT_REMINDER) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserCanceled);\n    }\n    this.#closing = true;\n    this.#render();\n  }\n\n  #onAnimationEnd(): void {\n    if (this.#closing) {\n      this.dispatchEvent(new CloseEvent());\n      return;\n    }\n    if (this.#stateChanging) {\n      this.#headerRef.value?.focus();\n    }\n    if (this.#highlightedCitationIndex !== -1) {\n      this.#highlightedCitationIndex = -1;\n      this.#render();\n    }\n  }\n\n  #onRating(isPositive: boolean): void {\n    if (this.#state.type !== State.INSIGHT) {\n      throw new Error('Unexpected state');\n    }\n    if (this.#state.metadata?.rpcGlobalId === undefined) {\n      throw new Error('RPC Id not in metadata');\n    }\n    // If it was rated, do not record again.\n    if (this.#selectedRating !== undefined) {\n      return;\n    }\n\n    this.#selectedRating = isPositive;\n    this.#render();\n    if (this.#selectedRating) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedPositive);\n    } else {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedNegative);\n    }\n    const disallowLogging = Root.Runtime.hostConfig.aidaAvailability?.disallowLogging ?? true;\n    void this.#aidaClient.registerClientEvent({\n      corresponding_aida_rpc_global_id: this.#state.metadata.rpcGlobalId,\n      disable_user_content_logging: disallowLogging,\n      do_conversation_client_event: {\n        user_feedback: {\n          sentiment: this.#selectedRating ? Host.AidaClient.Rating.POSITIVE : Host.AidaClient.Rating.NEGATIVE,\n        },\n      },\n    });\n  }\n\n  #onReport(): void {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(REPORT_URL);\n  }\n\n  #onSearch(): void {\n    const query = this.#promptBuilder.getSearchQuery();\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openSearchResultsInNewTab(query);\n  }\n\n  async #onConsentReminderConfirmed(): Promise<void> {\n    this.#getOnboardingCompletedSetting().set(true);\n    this.#transitionTo({\n      type: State.LOADING,\n      consentOnboardingCompleted: true,\n    });\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserConfirmed);\n    await this.#generateInsight();\n  }\n\n  #insertCitations(explanation: string, metadata: Host.AidaClient.ResponseMetadata):\n      {explanationWithCitations: string, directCitationUrls: string[]} {\n    const directCitationUrls: string[] = [];\n    if (!isSearchRagResponse(metadata) || !metadata.attributionMetadata) {\n      return {explanationWithCitations: explanation, directCitationUrls};\n    }\n\n    const {attributionMetadata} = metadata;\n    const sortedCitations =\n        attributionMetadata.citations\n            .filter(citation => citation.sourceType === Host.AidaClient.CitationSourceType.WORLD_FACTS)\n            .sort((a, b) => (b.endIndex || 0) - (a.endIndex || 0));\n    let explanationWithCitations = explanation;\n    for (const [index, citation] of sortedCitations.entries()) {\n      // Matches optional punctuation mark followed by whitespace.\n      // Ensures citation is placed at the end of a word.\n      const myRegex = /[.,:;!?]*\\s/g;\n      myRegex.lastIndex = citation.endIndex || 0;\n      const result = myRegex.exec(explanationWithCitations);\n      if (result && citation.uri) {\n        explanationWithCitations = explanationWithCitations.slice(0, result.index) +\n            `[^${sortedCitations.length - index}]` + explanationWithCitations.slice(result.index);\n        directCitationUrls.push(citation.uri);\n      }\n    }\n\n    directCitationUrls.reverse();\n    return {explanationWithCitations, directCitationUrls};\n  }\n\n  #modifyTokensToHandleCitationsInCode(tokens: Marked.Marked.TokensList): void {\n    for (const token of tokens) {\n      if (token.type === 'code') {\n        // Find and remove '[^number]' from within code block\n        const matches: String[]|null = token.text.match(/\\[\\^\\d+\\]/g);\n        token.text = token.text.replace(/\\[\\^\\d+\\]/g, '');\n        // And add as a citation for the whole code block\n        if (matches?.length) {\n          const citations = matches.map(match => {\n            const index = parseInt(match.slice(2, -1), 10);\n            return {\n              index,\n              clickHandler: this.#citationClickHandler.bind(this, index),\n            };\n          });\n          (token as MarkdownView.MarkdownView.CodeTokenWithCitation).citations = citations;\n        }\n      }\n    }\n  }\n\n  #deriveRelatedUrls(directCitationUrls: string[], metadata: Host.AidaClient.ResponseMetadata): string[] {\n    if (!metadata.factualityMetadata?.facts.length) {\n      return [];\n    }\n\n    const relatedUrls =\n        metadata.factualityMetadata.facts.filter(fact => fact.sourceUri && !directCitationUrls.includes(fact.sourceUri))\n            .map(fact => fact.sourceUri as string) ||\n        [];\n    const trainingDataUrls =\n        metadata.attributionMetadata?.citations\n            .filter(\n                citation => citation.sourceType === Host.AidaClient.CitationSourceType.TRAINING_DATA &&\n                    (citation.uri || citation.repository))\n            .map(citation => citation.uri || `https://www.github.com/${citation.repository}`) ||\n        [];\n    const dedupedTrainingDataUrls =\n        [...new Set(trainingDataUrls.filter(url => !relatedUrls.includes(url) && !directCitationUrls.includes(url)))];\n    relatedUrls.push(...dedupedTrainingDataUrls);\n    return relatedUrls;\n  }\n\n  async #generateInsight(): Promise<void> {\n    try {\n      for await (const {sources, isPageReloadRecommended, explanation, metadata, completed} of this.#getInsight()) {\n        const {explanationWithCitations, directCitationUrls} = this.#insertCitations(explanation, metadata);\n        const relatedUrls = this.#deriveRelatedUrls(directCitationUrls, metadata);\n        const tokens = this.#validateMarkdown(explanationWithCitations);\n        const valid = tokens !== false;\n        if (valid) {\n          this.#modifyTokensToHandleCitationsInCode(tokens);\n        }\n        this.#transitionTo({\n          type: State.INSIGHT,\n          tokens: valid ? tokens : [],\n          validMarkdown: valid,\n          explanation,\n          sources,\n          metadata,\n          isPageReloadRecommended,\n          completed,\n          directCitationUrls,\n          relatedUrls,\n        });\n      }\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightGenerated);\n    } catch (err) {\n      console.error('[ConsoleInsight] Error in #generateInsight:', err);\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErrored);\n      if (err.message === 'doAidaConversation timed out' && this.#state.type === State.INSIGHT) {\n        this.#state.timedOut = true;\n        this.#transitionTo({...this.#state, completed: true, timedOut: true});\n      } else {\n        this.#transitionTo({\n          type: State.ERROR,\n          error: err.message,\n        });\n      }\n    }\n  }\n\n  /**\n   * Validates the markdown by trying to render it.\n   */\n  #validateMarkdown(text: string): Marked.Marked.TokensList|false {\n    try {\n      const tokens = this.#marked.lexer(text);\n      for (const token of tokens) {\n        this.#renderer.renderToken(token);\n      }\n      return tokens;\n    } catch {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredMarkdown);\n      return false;\n    }\n  }\n\n  async *\n      #getInsight(): AsyncGenerator<\n          {sources: Console.PromptBuilder.Source[], isPageReloadRecommended: boolean}&\n          Host.AidaClient.DoConversationResponse,\n          void, void> {\n    const {prompt, sources, isPageReloadRecommended} = await this.#promptBuilder.buildPrompt();\n    try {\n      for await (const response of this.#aidaClient.doConversation(\n          Host.AidaClient.AidaClient.buildConsoleInsightsRequest(prompt))) {\n        yield {sources, isPageReloadRecommended, ...response};\n      }\n    } catch (err) {\n      if (err.message === 'Server responded: permission denied') {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredPermissionDenied);\n      } else if (err.message.startsWith('Cannot send request:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredCannotSend);\n      } else if (err.message.startsWith('Request failed:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredRequestFailed);\n      } else if (err.message.startsWith('Cannot parse chunk:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredCannotParseChunk);\n      } else if (err.message === 'Unknown chunk result') {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredUnknownChunk);\n      } else if (err.message.startsWith('Server responded:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredApi);\n      } else {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredOther);\n      }\n      throw err;\n    }\n  }\n\n  #onGoToSignIn(): void {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(SIGN_IN_URL);\n  }\n\n  #onToggleReferenceDetails(event: Event): void {\n    const detailsElement = event.target as HTMLDetailsElement;\n\n    if (detailsElement) {\n      this.#areReferenceDetailsOpen = detailsElement.open;\n      if (!detailsElement.open) {\n        this.#highlightedCitationIndex = -1;\n      }\n      this.#render();\n    }\n  }\n\n  #onDisclaimerSettingsLink(): void {\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #onReminderSettingsLink(): void {\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserSettingsLinkClicked);\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #onEnableInsightsInSettingsLink(): void {\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserSettingsLinkClicked);\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #render(): void {\n    const input: ViewInput = {\n      state: this.#state,\n      closing: this.#closing,\n      disableAnimations: this.disableAnimations,\n      renderer: this.#renderer,\n      selectedRating: this.#selectedRating,\n      noLogging: Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n          Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING,\n      areReferenceDetailsOpen: this.#areReferenceDetailsOpen,\n      highlightedCitationIndex: this.#highlightedCitationIndex,\n      callbacks: {\n        onClose: this.#onClose.bind(this),\n        onAnimationEnd: this.#onAnimationEnd.bind(this),\n        onSearch: this.#onSearch.bind(this),\n        onRating: this.#onRating.bind(this),\n        onReport: this.#onReport.bind(this),\n        onGoToSignIn: this.#onGoToSignIn.bind(this),\n        onConsentReminderConfirmed: this.#onConsentReminderConfirmed.bind(this),\n        onToggleReferenceDetails: this.#onToggleReferenceDetails.bind(this),\n        onDisclaimerSettingsLink: this.#onDisclaimerSettingsLink.bind(this),\n        onReminderSettingsLink: this.#onReminderSettingsLink.bind(this),\n        onEnableInsightsInSettingsLink: this.#onEnableInsightsInSettingsLink.bind(this),\n        onReferencesOpen: this.#scrollToHighlightedCitation.bind(this),\n      },\n    };\n    const output: ViewOutput = {\n      headerRef: this.#headerRef,\n      citationLinks: [],\n    };\n\n    // Future Widget view function starts here.\n    const {state, noLogging, callbacks} = input;\n    const {onClose, onDisclaimerSettingsLink} = callbacks;\n\n    const jslog = `${VisualLogging.section(state.type).track({resize: true})}`;\n    let header: Lit.LitTemplate = Lit.nothing;\n    let main: Lit.LitTemplate = Lit.nothing;\n    const mainClasses: Record<string, true> = {};\n    let footer: Lit.LitTemplate|undefined;\n\n    switch (state.type) {\n      case State.LOADING:\n        header = renderHeader({headerText: i18nString(UIStrings.generating), onClose}, output.headerRef);\n        main = renderLoading();\n        break;\n      case State.INSIGHT:\n        header = renderHeader(\n            {headerText: i18nString(UIStrings.insight), onClose, showSpinner: !state.completed}, output.headerRef);\n        main = renderInsight(state, input, output);\n        footer = renderInsightFooter(noLogging, input.selectedRating, callbacks);\n        break;\n      case State.ERROR:\n        header = renderHeader({headerText: i18nString(UIStrings.error), onClose}, output.headerRef);\n        main = renderError(i18nString(UIStrings.errorBody));\n        footer = renderDisclaimerFooter(noLogging, onDisclaimerSettingsLink);\n        break;\n      case State.CONSENT_REMINDER:\n        header = renderHeader(\n            {headerText: 'Understand console messages with AI', onClose, showIcon: true}, output.headerRef);\n        mainClasses['reminder-container'] = true;\n        main = renderConsentReminder(noLogging);\n        footer = renderConsentReminderFooter(callbacks.onReminderSettingsLink, callbacks.onConsentReminderConfirmed);\n        break;\n      case State.SETTING_IS_NOT_TRUE:\n        mainClasses['opt-in-teaser'] = true;\n        main = renderSettingIsNotTrue(callbacks.onEnableInsightsInSettingsLink);\n        break;\n      case State.NOT_LOGGED_IN:\n      case State.SYNC_IS_PAUSED:\n        header = renderHeader({headerText: i18nString(UIStrings.signInToUse), onClose}, output.headerRef);\n        main = renderNotLoggedIn();\n        footer = renderSignInFooter(callbacks.onGoToSignIn);\n        break;\n      case State.OFFLINE:\n        header = renderHeader({headerText: i18nString(UIStrings.offlineHeader), onClose}, output.headerRef);\n        main = renderError(i18nString(UIStrings.offline));\n        footer = renderDisclaimerFooter(noLogging, onDisclaimerSettingsLink);\n        break;\n    }\n\n    // clang-format off\n    render(html`\n      <style>${styles}</style>\n      <style>${Input.checkboxStyles}</style>\n      <div\n        class=${Directives.classMap({wrapper: true, closing: input.closing})}\n        jslog=${VisualLogging.pane('console-insights').track({resize: true})}\n        @animationend=${callbacks.onAnimationEnd}\n        @keydown=${blockPropagation}\n        @keyup=${blockPropagation}\n        @keypress=${blockPropagation}\n        @click=${blockPropagation}\n      >\n        <div class=\"animation-wrapper\">\n          ${header}\n          <main jslog=${jslog} class=${Directives.classMap(mainClasses)}>\n            ${main}\n          </main>\n          ${footer?html`<footer jslog=${VisualLogging.section('footer')}>\n            ${footer}\n          </footer>`:Lit.nothing}\n        </div>\n      </div>\n    `, this.#shadow, {\n      host: this,\n    });\n    // clang-format on\n\n    this.#citationLinks = output.citationLinks;\n  }\n}\n\ncustomElements.define('devtools-console-insight', ConsoleInsight);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-console-insight': ConsoleInsight;\n  }\n}\n"]}