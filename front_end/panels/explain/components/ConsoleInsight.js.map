{"version":3,"file":"ConsoleInsight.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/explain/components/ConsoleInsight.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../ui/components/spinners/spinners.js';\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as Root from '../../../core/root/root.js';\nimport * as Marked from '../../../third_party/marked/marked.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as Input from '../../../ui/components/input/input.js';\nimport * as MarkdownView from '../../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport * as Console from '../../console/console.js';\n\nimport styles from './consoleInsight.css.js';\nimport listStyles from './consoleInsightSourcesList.css.js';\n\n// Note: privacy and legal notices are not localized so far.\nconst UIStrings = {\n  /**\n   * @description The title of the insight source \"Console message\".\n   */\n  consoleMessage: 'Console message',\n  /**\n   * @description The title of the insight source \"Stacktrace\".\n   */\n  stackTrace: 'Stacktrace',\n  /**\n   * @description The title of the insight source \"Network request\".\n   */\n  networkRequest: 'Network request',\n  /**\n   * @description The title of the insight source \"Related code\".\n   */\n  relatedCode: 'Related code',\n  /**\n   * @description The title that is shown while the insight is being generated.\n   */\n  generating: 'Generating explanation…',\n  /**\n   * @description The header that indicates that the content shown is a console\n   * insight.\n   */\n  insight: 'Explanation',\n  /**\n   * @description The title of the a button that closes the insight pane.\n   */\n  closeInsight: 'Close explanation',\n  /**\n   * @description The title of the list of source data that was used to generate the insight.\n   */\n  inputData: 'Data used to understand this message',\n  /**\n   * @description The title of the button that allows submitting positive\n   * feedback about the console insight.\n   */\n  goodResponse: 'Good response',\n  /**\n   * @description The title of the button that allows submitting negative\n   * feedback about the console insight.\n   */\n  badResponse: 'Bad response',\n  /**\n   * @description The title of the button that opens a page to report a legal\n   * issue with the console insight.\n   */\n  report: 'Report legal issue',\n  /**\n   * @description The text of the header inside the console insight pane when there was an error generating an insight.\n   */\n  error: 'DevTools has encountered an error',\n  /**\n   * @description The message shown when an error has been encountered.\n   */\n  errorBody: 'Something went wrong. Try again.',\n  /**\n   * @description Label for screen readers that is added to the end of the link\n   * title to indicate that the link will be opened in a new tab.\n   */\n  opensInNewTab: '(opens in a new tab)',\n  /**\n   * @description The title of a link that allows the user to learn more about\n   * the feature.\n   */\n  learnMore: 'Learn more',\n  /**\n   * @description The error message when the user is not logged in into Chrome.\n   */\n  notLoggedIn: 'This feature is only available when you sign into Chrome with your Google account.',\n  /**\n   * @description The title of a button which opens the Chrome SignIn page.\n   */\n  signIn: 'Sign in',\n  /**\n   * @description The header shown when the internet connection is not\n   * available.\n   */\n  offlineHeader: 'DevTools can’t reach the internet',\n  /**\n   * @description Message shown when the user is offline.\n   */\n  offline: 'Check your internet connection and try again.',\n  /**\n   * @description The message shown if the user is not logged in.\n   */\n  signInToUse: 'Sign in to use this feature',\n  /**\n   * @description The title of the button that searches for the console\n   * insight using a search engine instead of using console insights.\n   */\n  search: 'Use search instead',\n  /**\n   * @description Shown to the user when the network request data is not\n   * available and a page reload might populate it.\n   */\n  reloadRecommendation:\n      'Reload the page to capture related network request data for this message in order to create a better insight.',\n  /**\n   * @description Shown to the user when they need to enable the console insights feature in settings in order to use it.\n   * @example {Console insights in Settings} PH1\n   */\n  turnOnInSettings:\n      'Turn on {PH1} to receive AI assistance for understanding and addressing console warnings and errors.',\n  /**\n   * @description Text for a link to Chrome DevTools Settings.\n   */\n  settingsLink: '`Console insights` in Settings',\n  /**\n   * @description The title of the list of references/recitations that were used to generate the insight.\n   */\n  references: 'Sources and related content',\n  /**\n   * @description Sub-heading for a list of links to URLs which are related to the AI-generated response.\n   */\n  relatedContent: 'Related content',\n  /**\n   * @description Error message shown when the request to get an AI response times out.\n   */\n  timedOut: 'Generating a response took too long. Please try again.',\n  /**\n   * @description Text informing the user that AI assistance is not available in Incognito mode or Guest mode.\n   */\n  notAvailableInIncognitoMode: 'AI assistance is not available in Incognito mode or Guest mode',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/explain/components/ConsoleInsight.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst i18nTemplate = Lit.i18nTemplate.bind(undefined, str_);\n\nconst {render, html, Directives} = Lit;\n\nexport class CloseEvent extends Event {\n  static readonly eventName = 'close';\n\n  constructor() {\n    super(CloseEvent.eventName, {composed: true, bubbles: true});\n  }\n}\n\ntype PublicPromptBuilder = Pick<Console.PromptBuilder.PromptBuilder, 'buildPrompt'|'getSearchQuery'>;\ntype PublicAidaClient = Pick<Host.AidaClient.AidaClient, 'doConversation'|'registerClientEvent'>;\n\nfunction localizeType(sourceType: Console.PromptBuilder.SourceType): string {\n  switch (sourceType) {\n    case Console.PromptBuilder.SourceType.MESSAGE:\n      return i18nString(UIStrings.consoleMessage);\n    case Console.PromptBuilder.SourceType.STACKTRACE:\n      return i18nString(UIStrings.stackTrace);\n    case Console.PromptBuilder.SourceType.NETWORK_REQUEST:\n      return i18nString(UIStrings.networkRequest);\n    case Console.PromptBuilder.SourceType.RELATED_CODE:\n      return i18nString(UIStrings.relatedCode);\n  }\n}\n\nconst TERMS_OF_SERVICE_URL = 'https://policies.google.com/terms';\nconst PRIVACY_POLICY_URL = 'https://policies.google.com/privacy';\nconst CODE_SNIPPET_WARNING_URL = 'https://support.google.com/legal/answer/13505487';\nconst LEARN_MORE_URL = 'https://goo.gle/devtools-console-messages-ai' as Platform.DevToolsPath.UrlString;\nconst REPORT_URL = 'https://support.google.com/legal/troubleshooter/1114905?hl=en#ts=1115658%2C13380504' as\n    Platform.DevToolsPath.UrlString;\nconst SIGN_IN_URL = 'https://accounts.google.com' as Platform.DevToolsPath.UrlString;\n\ninterface ViewInput {\n  state: StateData;\n  disableAnimations: boolean;\n  renderer: MarkdownView.MarkdownView.MarkdownInsightRenderer;\n  selectedRating?: boolean;\n  noLogging: boolean;\n  onClose: () => void;\n  onSearch: () => void;\n  onRating: (event: Event) => void;\n  onReport: () => void;\n  onGoToSignIn: () => void;\n  onConsentReminderConfirmed: () => Promise<void>;\n  onToggleReferenceDetails: () => void;\n  onDisclaimerSettingsLink: () => void;\n  onReminderSettingsLink: () => void;\n  onEnableInsightsInSettingsLink: () => void;\n}\n\ninterface ViewOutput {\n  referenceDetailsRef: Lit.Directives.Ref<HTMLDetailsElement>;\n}\n\nconst enum State {\n  INSIGHT = 'insight',\n  LOADING = 'loading',\n  ERROR = 'error',\n  SETTING_IS_NOT_TRUE = 'setting-is-not-true',\n  CONSENT_REMINDER = 'consent-reminder',\n  NOT_LOGGED_IN = 'not-logged-in',\n  SYNC_IS_PAUSED = 'sync-is-paused',\n  OFFLINE = 'offline',\n}\n\ntype StateData = {\n  type: State.LOADING,\n  consentOnboardingCompleted: boolean,\n}|{\n  type: State.INSIGHT,\n  tokens: MarkdownView.MarkdownView.MarkdownViewData['tokens'],\n  validMarkdown: boolean,\n  sources: Console.PromptBuilder.Source[],\n  isPageReloadRecommended: boolean,\n  completed: boolean,\n  directCitationUrls: string[],\n  relatedUrls: string[],\n  timedOut?: boolean,\n}&Host.AidaClient.DoConversationResponse|{\n  type: State.ERROR,\n  error: string,\n}|{\n  type: State.CONSENT_REMINDER,\n  sources: Console.PromptBuilder.Source[],\n  isPageReloadRecommended: boolean,\n}|{\n  type: State.SETTING_IS_NOT_TRUE,\n}|{\n  type: State.NOT_LOGGED_IN,\n}|{\n  type: State.SYNC_IS_PAUSED,\n}|{\n  type: State.OFFLINE,\n};\n\nconst markedExtension = {\n  name: 'citation',\n  level: 'inline',\n  start(src: string) {\n    return src.match(/\\[\\^/)?.index;\n  },\n  tokenizer(src: string) {\n    const match = src.match(/^\\[\\^(\\d+)\\]/);\n    if (match) {\n      return {\n        type: 'citation',\n        raw: match[0],\n        linkText: Number(match[1]),\n      };\n    }\n    return false;\n  },\n  renderer: () => '',\n};\n\nfunction isSearchRagResponse(metadata: Host.AidaClient.ResponseMetadata): boolean {\n  return Boolean(metadata.factualityMetadata?.facts.length);\n}\n\nfunction renderSearchButton(input: ViewInput): Lit.TemplateResult {\n  // clang-format off\n  return html`<devtools-button\n    @click=${input.onSearch}\n    class=\"search-button\"\n    .variant=${Buttons.Button.Variant.OUTLINED}\n    .jslogContext=${'search'}\n  >\n    ${i18nString(UIStrings.search)}\n  </devtools-button>`;\n  // clang-format on\n}\n\nfunction renderLearnMoreAboutInsights(): Lit.TemplateResult {\n  // clang-format off\n  return html`<x-link href=${LEARN_MORE_URL} class=\"link\" jslog=${VisualLogging.link('learn-more').track({click: true})}>\n    ${i18nString(UIStrings.learnMore)}\n  </x-link>`;\n  // clang-format on\n}\n\nfunction maybeRenderSources(state: StateData): Lit.LitTemplate {\n  if (state.type !== State.INSIGHT || !state.directCitationUrls.length) {\n    return Lit.nothing;\n  }\n\n  // clang-format off\n  return html`\n    <ol class=\"sources-list\">\n      ${state.directCitationUrls.map((url, index) => html`\n        <li>\n          <x-link\n            href=${url}\n            class=\"link\"\n            data-index=${index + 1}\n            jslog=${VisualLogging.link('references.console-insights').track({click: true})}\n          >\n            ${url}\n          </x-link>\n        </li>\n      `)}\n    </ol>\n  `;\n  // clang-format on\n}\n\nfunction maybeRenderRelatedContent(state: StateData): Lit.LitTemplate {\n  if (state.type !== State.INSIGHT || state.relatedUrls.length === 0) {\n    return Lit.nothing;\n  }\n  // clang-format off\n  return html`\n    ${state.directCitationUrls.length ? html`<h3>${i18nString(UIStrings.relatedContent)}</h3>` : Lit.nothing}\n    <ul class=\"references-list\">\n      ${state.relatedUrls.map(relatedUrl => html`\n        <li>\n          <x-link\n            href=${relatedUrl}\n            class=\"link\"\n            jslog=${VisualLogging.link('references.console-insights').track({click: true})}\n          >\n            ${relatedUrl}\n          </x-link>\n        </li>\n      `)}\n    </ul>\n  `;\n  // clang-format on\n}\n\nfunction renderMain(input: ViewInput, output: ViewOutput): Lit.TemplateResult {\n  const jslog = `${VisualLogging.section(input.state.type).track({resize: true})}`;\n\n  // clang-format off\n  switch (input.state.type) {\n    case State.LOADING:\n      return html`<main jslog=${jslog}>\n          <div role=\"presentation\" aria-label=\"Loading\" class=\"loader\" style=\"clip-path: url('#clipPath');\">\n            <svg width=\"100%\" height=\"64\">\n              <clipPath id=\"clipPath\">\n                <rect x=\"0\" y=\"0\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n                <rect x=\"0\" y=\"24\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n                <rect x=\"0\" y=\"48\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n              </clipPath>\n            </svg>\n          </div>\n        </main>`;\n    case State.INSIGHT:\n      return html`\n      <main jslog=${jslog}>\n        ${\n          input.state.validMarkdown ? html`<devtools-markdown-view\n            .data=${{tokens: input.state.tokens, renderer: input.renderer, animationEnabled: !input.disableAnimations} as MarkdownView.MarkdownView.MarkdownViewData}>\n          </devtools-markdown-view>`: input.state.explanation\n        }\n        ${input.state.timedOut ? html`<p class=\"error-message\">${i18nString(UIStrings.timedOut)}</p>` : Lit.nothing}\n        ${isSearchRagResponse(input.state.metadata) ? html`\n          <details class=\"references\" ${Lit.Directives.ref(output.referenceDetailsRef)} @toggle=${input.onToggleReferenceDetails} jslog=${VisualLogging.expand('references').track({click: true})}>\n            <summary>${i18nString(UIStrings.references)}</summary>\n            ${maybeRenderSources(input.state)}\n            ${maybeRenderRelatedContent(input.state)}\n          </details>\n        ` : Lit.nothing}\n        <details jslog=${VisualLogging.expand('sources').track({click: true})}>\n          <summary>${i18nString(UIStrings.inputData)}</summary>\n          <devtools-console-insight-sources-list .sources=${input.state.sources} .isPageReloadRecommended=${input.state.isPageReloadRecommended}>\n          </devtools-console-insight-sources-list>\n        </details>\n        <div class=\"buttons\">\n          ${renderSearchButton(input)}\n        </div>\n      </main>`;\n    case State.ERROR:\n      return html`\n      <main jslog=${jslog}>\n        <div class=\"error\">${i18nString(UIStrings.errorBody)}</div>\n      </main>`;\n    case State.CONSENT_REMINDER:\n      return html`\n        <main class=\"reminder-container\" jslog=${jslog}>\n          <h3>Things to consider</h3>\n          <div class=\"reminder-items\">\n            <div>\n              <devtools-icon name=\"google\" class=\"medium\">\n              </devtools-icon>\n            </div>\n            <div>The console message, associated stack trace, related source code, and the associated network headers are sent to Google to generate explanations. ${input.noLogging\n                ? 'The content you submit and that is generated by this feature will not be used to improve Google’s AI models.'\n                : 'This data may be seen by human reviewers to improve this feature. Avoid sharing sensitive or personal information.'}\n            </div>\n            <div>\n              <devtools-icon name=\"policy\" class=\"medium\">\n              </devtools-icon>\n            </div>\n            <div>Use of this feature is subject to the <x-link\n                href=${TERMS_OF_SERVICE_URL}\n                class=\"link\"\n                jslog=${VisualLogging.link('terms-of-service.console-insights').track({click: true})}>\n              Google Terms of Service\n              </x-link> and <x-link\n                href=${PRIVACY_POLICY_URL}\n                class=\"link\"\n                jslog=${VisualLogging.link('privacy-policy.console-insights').track({click: true})}>\n              Google Privacy Policy\n              </x-link>\n            </div>\n            <div>\n              <devtools-icon name=\"warning\" class=\"medium\">\n              </devtools-icon>\n            </div>\n            <div>\n              <x-link\n                href=${CODE_SNIPPET_WARNING_URL}\n                class=\"link\"\n                jslog=${VisualLogging.link('code-snippets-explainer.console-insights').track({click: true})}\n              >Use generated code snippets with caution</x-link>\n            </div>\n          </div>\n        </main>\n      `;\n    case State.SETTING_IS_NOT_TRUE: {\n      const settingsLink = html`<button\n          class=\"link\" role=\"link\"\n          jslog=${VisualLogging.action('open-ai-settings').track({click: true})}\n          @click=${input.onEnableInsightsInSettingsLink}\n        >${i18nString(UIStrings.settingsLink)}</button>`;\n\n      return html`<main class=\"opt-in-teaser\" jslog=${jslog}>\n        <div class=\"badge\">\n          <devtools-icon name=\"lightbulb-spark\" class=\"medium\">\n          </devtools-icon>\n        </div>\n        <div>\n          ${i18nTemplate(UIStrings.turnOnInSettings, {PH1: settingsLink})} ${\n          renderLearnMoreAboutInsights()}\n        </div>\n      </main>`;\n    }\n    case State.NOT_LOGGED_IN:\n    case State.SYNC_IS_PAUSED:\n      return html`\n        <main jslog=${jslog}>\n          <div class=\"error\">${Root.Runtime.hostConfig.isOffTheRecord ? i18nString(UIStrings.notAvailableInIncognitoMode) : i18nString(UIStrings.notLoggedIn)}</div>\n        </main>`;\n    case State.OFFLINE:\n      return html`\n        <main jslog=${jslog}>\n          <div class=\"error\">${i18nString(UIStrings.offline)}</div>\n        </main>`;\n  }\n  // clang-format on\n}\n\nfunction renderDisclaimer(input: ViewInput): Lit.LitTemplate {\n  // clang-format off\n  return html`<span>\n    AI tools may generate inaccurate info that doesn't represent Google's views. ${input.noLogging\n      ? 'The content you submit and that is generated by this feature will not be used to improve Google’s AI models.'\n      : 'Data sent to Google may be seen by human reviewers to improve this feature.'\n    } <button class=\"link\" role=\"link\" @click=${input.onDisclaimerSettingsLink}\n              jslog=${VisualLogging.action('open-ai-settings').track({click: true})}>\n      Open settings\n    </button> or <x-link href=${LEARN_MORE_URL}\n        class=\"link\" jslog=${VisualLogging.link('learn-more').track({click: true})}>\n      learn more\n    </x-link>\n  </span>`;\n  // clang-format on\n}\n\nfunction renderFooter(input: ViewInput): Lit.LitTemplate {\n  const disclaimer = renderDisclaimer(input);\n  // clang-format off\n  switch (input.state.type) {\n    case State.LOADING:\n    case State.SETTING_IS_NOT_TRUE:\n      return Lit.nothing;\n    case State.ERROR:\n    case State.OFFLINE:\n      return html`<footer jslog=${VisualLogging.section('footer')}>\n        <div class=\"disclaimer\">\n          ${disclaimer}\n        </div>\n      </footer>`;\n    case State.NOT_LOGGED_IN:\n    case State.SYNC_IS_PAUSED:\n      if (Root.Runtime.hostConfig.isOffTheRecord) {\n        return Lit.nothing;\n      }\n      return html`<footer jslog=${VisualLogging.section('footer')}>\n      <div class=\"filler\"></div>\n      <div>\n        <devtools-button\n          @click=${input.onGoToSignIn}\n          .data=${\n            {\n              variant: Buttons.Button.Variant.PRIMARY,\n              jslogContext: 'update-settings',\n            } as Buttons.Button.ButtonData\n          }\n        >\n          ${UIStrings.signIn}\n        </devtools-button>\n      </div>\n    </footer>`;\n    case State.CONSENT_REMINDER:\n      return html`<footer jslog=${VisualLogging.section('footer')}>\n        <div class=\"filler\"></div>\n        <div class=\"buttons\">\n          <devtools-button\n            @click=${input.onReminderSettingsLink}\n            .data=${\n              {\n                variant: Buttons.Button.Variant.TONAL,\n                jslogContext: 'settings',\n                title: 'Settings',\n              } as Buttons.Button.ButtonData\n            }\n          >\n            Settings\n          </devtools-button>\n          <devtools-button\n            class='continue-button'\n            @click=${input.onConsentReminderConfirmed}\n            .data=${\n              {\n                variant: Buttons.Button.Variant.PRIMARY,\n                jslogContext: 'continue',\n                title: 'continue',\n              } as Buttons.Button.ButtonData\n            }\n            >\n            Continue\n          </devtools-button>\n        </div>\n      </footer>`;\n    case State.INSIGHT:\n      return html`<footer jslog=${VisualLogging.section('footer')}>\n      <div class=\"disclaimer\">\n        ${disclaimer}\n      </div>\n      <div class=\"filler\"></div>\n      <div class=\"rating\">\n        <devtools-button\n          data-rating=\"true\"\n          .data=${\n            {\n              variant: Buttons.Button.Variant.ICON_TOGGLE,\n              size: Buttons.Button.Size.SMALL,\n              iconName: 'thumb-up',\n              toggledIconName: 'thumb-up',\n              toggleOnClick: false,\n              toggleType: Buttons.Button.ToggleType.PRIMARY,\n              disabled: input.selectedRating !== undefined,\n              toggled: input.selectedRating === true,\n              title: i18nString(UIStrings.goodResponse),\n              jslogContext: 'thumbs-up',\n            } as Buttons.Button.ButtonData\n          }\n          @click=${input.onRating}\n        ></devtools-button>\n        <devtools-button\n          data-rating=\"false\"\n          .data=${\n            {\n              variant: Buttons.Button.Variant.ICON_TOGGLE,\n              size: Buttons.Button.Size.SMALL,\n              iconName: 'thumb-down',\n              toggledIconName: 'thumb-down',\n              toggleOnClick: false,\n              toggleType: Buttons.Button.ToggleType.PRIMARY,\n              disabled: input.selectedRating !== undefined,\n              toggled: input.selectedRating === false,\n              title: i18nString(UIStrings.badResponse),\n              jslogContext: 'thumbs-down',\n            } as Buttons.Button.ButtonData\n          }\n          @click=${input.onRating}\n        ></devtools-button>\n        <devtools-button\n          .data=${\n            {\n              variant: Buttons.Button.Variant.ICON,\n              size: Buttons.Button.Size.SMALL,\n              iconName: 'report',\n              title: i18nString(UIStrings.report),\n              jslogContext: 'report',\n            } as Buttons.Button.ButtonData\n          }\n          @click=${input.onReport}\n        ></devtools-button>\n      </div>\n\n    </footer>`;\n  }\n  // clang-format on\n}\n\nfunction getHeader(state: StateData): string {\n  switch (state.type) {\n    case State.NOT_LOGGED_IN:\n    case State.SYNC_IS_PAUSED:\n      return i18nString(UIStrings.signInToUse);\n    case State.OFFLINE:\n      return i18nString(UIStrings.offlineHeader);\n    case State.LOADING:\n      return i18nString(UIStrings.generating);\n    case State.INSIGHT:\n      return i18nString(UIStrings.insight);\n    case State.ERROR:\n      return i18nString(UIStrings.error);\n    case State.CONSENT_REMINDER:\n      return 'Understand console messages with AI';\n    case State.SETTING_IS_NOT_TRUE:\n      return '';  // not reached\n  }\n}\n\nfunction renderSpinner(state: StateData): Lit.LitTemplate {\n  // clang-format off\n  if (state.type === State.INSIGHT && !state.completed) {\n    return html`<devtools-spinner></devtools-spinner>`;\n  }\n  return Lit.nothing;\n  // clang-format on\n}\n\nfunction renderHeader(input: ViewInput): Lit.LitTemplate {\n  if (input.state.type === State.SETTING_IS_NOT_TRUE) {\n    return Lit.nothing;\n  }\n  const hasIcon = input.state.type === State.CONSENT_REMINDER;\n  // clang-format off\n  return html`\n    <header>\n      ${hasIcon ? html`\n        <div class=\"header-icon-container\">\n          <devtools-icon name=\"lightbulb-spark\" class=\"large\">\n          </devtools-icon>\n        </div>`\n      : Lit.nothing}\n      <div class=\"filler\">\n        <h2 tabindex=\"-1\">\n          ${getHeader(input.state)}\n        </h2>\n        ${renderSpinner(input.state)}\n      </div>\n      <div class=\"close-button\">\n        <devtools-button\n          .data=${\n            {\n              variant: Buttons.Button.Variant.ICON,\n              size: Buttons.Button.Size.SMALL,\n              iconName: 'cross',\n              title: i18nString(UIStrings.closeInsight),\n            } as Buttons.Button.ButtonData\n          }\n          jslog=${VisualLogging.close().track({click: true})}\n          @click=${input.onClose}\n        ></devtools-button>\n      </div>\n    </header>\n  `;\n  // clang-format on\n}\n\nexport class ConsoleInsight extends HTMLElement {\n  static async create(promptBuilder: PublicPromptBuilder, aidaClient: PublicAidaClient): Promise<ConsoleInsight> {\n    const aidaPreconditions = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    return new ConsoleInsight(promptBuilder, aidaClient, aidaPreconditions);\n  }\n\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  disableAnimations = false;\n\n  #promptBuilder: PublicPromptBuilder;\n  #aidaClient: PublicAidaClient;\n  #renderer: MarkdownView.MarkdownView.MarkdownInsightRenderer;\n\n  // Main state.\n  #state: StateData;\n  #referenceDetailsRef = Lit.Directives.createRef<HTMLDetailsElement>();\n  #areReferenceDetailsOpen = false;\n\n  // Rating sub-form state.\n  #selectedRating?: boolean;\n\n  #consoleInsightsEnabledSetting: Common.Settings.Setting<boolean>|undefined;\n  #aidaPreconditions: Host.AidaClient.AidaAccessPreconditions;\n  #boundOnAidaAvailabilityChange: () => Promise<void>;\n  #marked: Marked.Marked.Marked;\n\n  constructor(\n      promptBuilder: PublicPromptBuilder, aidaClient: PublicAidaClient,\n      aidaPreconditions: Host.AidaClient.AidaAccessPreconditions) {\n    super();\n    this.#promptBuilder = promptBuilder;\n    this.#aidaClient = aidaClient;\n    this.#aidaPreconditions = aidaPreconditions;\n    this.#consoleInsightsEnabledSetting = this.#getConsoleInsightsEnabledSetting();\n    this.#renderer = new MarkdownView.MarkdownView.MarkdownInsightRenderer(this.#citationClickHandler.bind(this));\n    this.#marked = new Marked.Marked.Marked({extensions: [markedExtension]});\n\n    this.#state = this.#getStateFromAidaAvailability();\n    this.#boundOnAidaAvailabilityChange = this.#onAidaAvailabilityChange.bind(this);\n    this.#render();\n    // Stop keyboard event propagation to avoid Console acting on the events\n    // inside the insight component.\n    this.addEventListener('keydown', e => {\n      e.stopPropagation();\n    });\n    this.addEventListener('keyup', e => {\n      e.stopPropagation();\n    });\n    this.addEventListener('keypress', e => {\n      e.stopPropagation();\n    });\n    this.addEventListener('click', e => {\n      e.stopPropagation();\n    });\n    this.focus();\n  }\n\n  #citationClickHandler(index: number): void {\n    if (this.#state.type !== State.INSIGHT || !this.#referenceDetailsRef.value) {\n      return;\n    }\n    const areDetailsAlreadyExpanded = this.#referenceDetailsRef.value.open;\n    this.#areReferenceDetailsOpen = true;\n    this.#render();\n\n    const highlightedElement =\n        this.#shadow.querySelector(`.sources-list x-link[data-index=\"${index}\"]`) as HTMLElement | null;\n    if (highlightedElement) {\n      UI.UIUtils.runCSSAnimationOnce(highlightedElement, 'highlighted');\n      if (areDetailsAlreadyExpanded) {\n        highlightedElement.scrollIntoView({behavior: 'auto'});\n        highlightedElement.focus();\n      } else {  // Wait for the details element to open before scrolling.\n        this.#referenceDetailsRef.value.addEventListener('transitionend', () => {\n          highlightedElement.scrollIntoView({behavior: 'auto'});\n          highlightedElement.focus();\n        }, {once: true});\n      }\n    }\n  }\n\n  #getStateFromAidaAvailability(): StateData {\n    switch (this.#aidaPreconditions) {\n      case Host.AidaClient.AidaAccessPreconditions.AVAILABLE: {\n        // Allows skipping the consent reminder if the user enabled the feature via settings in the current session\n        const skipReminder =\n            Common.Settings.Settings.instance()\n                .createSetting('console-insights-skip-reminder', false, Common.Settings.SettingStorageType.SESSION)\n                .get();\n        return {\n          type: State.LOADING,\n          consentOnboardingCompleted: this.#getOnboardingCompletedSetting().get() || skipReminder,\n        };\n      }\n      case Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL:\n        return {\n          type: State.NOT_LOGGED_IN,\n        };\n      case Host.AidaClient.AidaAccessPreconditions.SYNC_IS_PAUSED:\n        return {\n          type: State.SYNC_IS_PAUSED,\n        };\n      case Host.AidaClient.AidaAccessPreconditions.NO_INTERNET:\n        return {\n          type: State.OFFLINE,\n        };\n    }\n  }\n\n  // off -> entrypoints are shown, and point to the AI setting panel where the setting can be turned on\n  // on -> entrypoints are shown, and console insights can be generated\n  #getConsoleInsightsEnabledSetting(): Common.Settings.Setting<boolean>|undefined {\n    try {\n      return Common.Settings.moduleSetting('console-insights-enabled') as Common.Settings.Setting<boolean>;\n    } catch {\n      return;\n    }\n  }\n\n  // off -> consent reminder is shown, unless the 'console-insights-enabled'-setting has been enabled in the current DevTools session\n  // on -> no consent reminder shown\n  #getOnboardingCompletedSetting(): Common.Settings.Setting<boolean> {\n    return Common.Settings.Settings.instance().createLocalSetting('console-insights-onboarding-finished', false);\n  }\n\n  connectedCallback(): void {\n    this.#consoleInsightsEnabledSetting?.addChangeListener(this.#onConsoleInsightsSettingChanged, this);\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (this.#state.type === State.LOADING && this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true &&\n        !blockedByAge && this.#state.consentOnboardingCompleted) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.GeneratingInsightWithoutDisclaimer);\n    }\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n    // If AIDA availability has changed while the component was disconnected, we need to update.\n    void this.#onAidaAvailabilityChange();\n    // The setting might have been turned on/off while the component was disconnected.\n    // Update the state, unless the current state is already terminal (`INSIGHT` or `ERROR`).\n    if (this.#state.type !== State.INSIGHT && this.#state.type !== State.ERROR) {\n      this.#state = this.#getStateFromAidaAvailability();\n    }\n    void this.#generateInsightIfNeeded();\n  }\n\n  disconnectedCallback(): void {\n    this.#consoleInsightsEnabledSetting?.removeChangeListener(this.#onConsoleInsightsSettingChanged, this);\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnAidaAvailabilityChange);\n  }\n\n  async #onAidaAvailabilityChange(): Promise<void> {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaPreconditions) {\n      this.#aidaPreconditions = currentAidaAvailability;\n      this.#state = this.#getStateFromAidaAvailability();\n      void this.#generateInsightIfNeeded();\n    }\n  }\n\n  #onConsoleInsightsSettingChanged(): void {\n    if (this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true) {\n      this.#getOnboardingCompletedSetting().set(true);\n    }\n    if (this.#state.type === State.SETTING_IS_NOT_TRUE &&\n        this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === true) {\n      this.#transitionTo({\n        type: State.LOADING,\n        consentOnboardingCompleted: true,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserConfirmedInSettings);\n      void this.#generateInsightIfNeeded();\n    }\n    if (this.#state.type === State.CONSENT_REMINDER &&\n        this.#consoleInsightsEnabledSetting?.getIfNotDisabled() === false) {\n      this.#transitionTo({\n        type: State.LOADING,\n        consentOnboardingCompleted: false,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserAbortedInSettings);\n      void this.#generateInsightIfNeeded();\n    }\n  }\n\n  #transitionTo(newState: StateData): void {\n    const previousState = this.#state;\n    this.#state = newState;\n    this.#render();\n    if (newState.type !== previousState.type) {\n      this.#focusHeader();\n    }\n  }\n\n  async #generateInsightIfNeeded(): Promise<void> {\n    if (this.#state.type !== State.LOADING) {\n      return;\n    }\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (this.#consoleInsightsEnabledSetting?.getIfNotDisabled() !== true || blockedByAge) {\n      this.#transitionTo({\n        type: State.SETTING_IS_NOT_TRUE,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserShown);\n      return;\n    }\n    if (!this.#state.consentOnboardingCompleted) {\n      const {sources, isPageReloadRecommended} = await this.#promptBuilder.buildPrompt();\n      this.#transitionTo({\n        type: State.CONSENT_REMINDER,\n        sources,\n        isPageReloadRecommended,\n      });\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserShown);\n      return;\n    }\n    await this.#generateInsight();\n  }\n\n  #onClose(): void {\n    if (this.#state.type === State.CONSENT_REMINDER) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserCanceled);\n    }\n    this.shadowRoot?.addEventListener('animationend', () => {\n      this.dispatchEvent(new CloseEvent());\n    }, {once: true});\n    this.classList.add('closing');\n  }\n\n  #onRating(event: Event): void {\n    if (this.#state.type !== State.INSIGHT) {\n      throw new Error('Unexpected state');\n    }\n    if (this.#state.metadata?.rpcGlobalId === undefined) {\n      throw new Error('RPC Id not in metadata');\n    }\n    // If it was rated, do not record again.\n    if (this.#selectedRating !== undefined) {\n      return;\n    }\n\n    this.#selectedRating = (event.target as HTMLElement).dataset.rating === 'true';\n    this.#render();\n    if (this.#selectedRating) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedPositive);\n    } else {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedNegative);\n    }\n    const disallowLogging = Root.Runtime.hostConfig.aidaAvailability?.disallowLogging ?? true;\n    void this.#aidaClient.registerClientEvent({\n      corresponding_aida_rpc_global_id: this.#state.metadata.rpcGlobalId,\n      disable_user_content_logging: disallowLogging,\n      do_conversation_client_event: {\n        user_feedback: {\n          sentiment: this.#selectedRating ? Host.AidaClient.Rating.POSITIVE : Host.AidaClient.Rating.NEGATIVE,\n        },\n      },\n    });\n  }\n\n  #onReport(): void {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(REPORT_URL);\n  }\n\n  #onSearch(): void {\n    const query = this.#promptBuilder.getSearchQuery();\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openSearchResultsInNewTab(query);\n  }\n\n  async #onConsentReminderConfirmed(): Promise<void> {\n    this.#getOnboardingCompletedSetting().set(true);\n    this.#transitionTo({\n      type: State.LOADING,\n      consentOnboardingCompleted: true,\n    });\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserConfirmed);\n    await this.#generateInsight();\n  }\n\n  #insertCitations(explanation: string, metadata: Host.AidaClient.ResponseMetadata):\n      {explanationWithCitations: string, directCitationUrls: string[]} {\n    const directCitationUrls: string[] = [];\n    if (!isSearchRagResponse(metadata) || !metadata.attributionMetadata) {\n      return {explanationWithCitations: explanation, directCitationUrls};\n    }\n\n    const {attributionMetadata} = metadata;\n    const sortedCitations =\n        attributionMetadata.citations\n            .filter(citation => citation.sourceType === Host.AidaClient.CitationSourceType.WORLD_FACTS)\n            .sort((a, b) => (b.endIndex || 0) - (a.endIndex || 0));\n    let explanationWithCitations = explanation;\n    for (const [index, citation] of sortedCitations.entries()) {\n      // Matches optional punctuation mark followed by whitespace.\n      // Ensures citation is placed at the end of a word.\n      const myRegex = /[.,:;!?]*\\s/g;\n      myRegex.lastIndex = citation.endIndex || 0;\n      const result = myRegex.exec(explanationWithCitations);\n      if (result && citation.uri) {\n        explanationWithCitations = explanationWithCitations.slice(0, result.index) +\n            `[^${sortedCitations.length - index}]` + explanationWithCitations.slice(result.index);\n        directCitationUrls.push(citation.uri);\n      }\n    }\n\n    directCitationUrls.reverse();\n    return {explanationWithCitations, directCitationUrls};\n  }\n\n  #modifyTokensToHandleCitationsInCode(tokens: Marked.Marked.TokensList): void {\n    for (const token of tokens) {\n      if (token.type === 'code') {\n        // Find and remove '[^number]' from within code block\n        const matches: String[]|null = token.text.match(/\\[\\^\\d+\\]/g);\n        token.text = token.text.replace(/\\[\\^\\d+\\]/g, '');\n        // And add as a citation for the whole code block\n        if (matches?.length) {\n          const citations = matches.map(match => {\n            const index = parseInt(match.slice(2, -1), 10);\n            return {\n              index,\n              clickHandler: this.#citationClickHandler.bind(this, index),\n            };\n          });\n          (token as MarkdownView.MarkdownView.CodeTokenWithCitation).citations = citations;\n        }\n      }\n    }\n  }\n\n  #deriveRelatedUrls(directCitationUrls: string[], metadata: Host.AidaClient.ResponseMetadata): string[] {\n    if (!metadata.factualityMetadata?.facts.length) {\n      return [];\n    }\n\n    const relatedUrls =\n        metadata.factualityMetadata.facts.filter(fact => fact.sourceUri && !directCitationUrls.includes(fact.sourceUri))\n            .map(fact => fact.sourceUri as string) ||\n        [];\n    const trainingDataUrls =\n        metadata.attributionMetadata?.citations\n            .filter(\n                citation => citation.sourceType === Host.AidaClient.CitationSourceType.TRAINING_DATA &&\n                    (citation.uri || citation.repository))\n            .map(citation => citation.uri || `https://www.github.com/${citation.repository}`) ||\n        [];\n    const dedupedTrainingDataUrls =\n        [...new Set(trainingDataUrls.filter(url => !relatedUrls.includes(url) && !directCitationUrls.includes(url)))];\n    relatedUrls.push(...dedupedTrainingDataUrls);\n    return relatedUrls;\n  }\n\n  async #generateInsight(): Promise<void> {\n    try {\n      for await (const {sources, isPageReloadRecommended, explanation, metadata, completed} of this.#getInsight()) {\n        const {explanationWithCitations, directCitationUrls} = this.#insertCitations(explanation, metadata);\n        const relatedUrls = this.#deriveRelatedUrls(directCitationUrls, metadata);\n        const tokens = this.#validateMarkdown(explanationWithCitations);\n        const valid = tokens !== false;\n        if (valid) {\n          this.#modifyTokensToHandleCitationsInCode(tokens);\n        }\n        this.#transitionTo({\n          type: State.INSIGHT,\n          tokens: valid ? tokens : [],\n          validMarkdown: valid,\n          explanation,\n          sources,\n          metadata,\n          isPageReloadRecommended,\n          completed,\n          directCitationUrls,\n          relatedUrls,\n        });\n      }\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightGenerated);\n    } catch (err) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErrored);\n      if (err.message === 'doAidaConversation timed out' && this.#state.type === State.INSIGHT) {\n        this.#state.timedOut = true;\n        this.#transitionTo({...this.#state, completed: true, timedOut: true});\n      } else {\n        this.#transitionTo({\n          type: State.ERROR,\n          error: err.message,\n        });\n      }\n    }\n  }\n\n  /**\n   * Validates the markdown by trying to render it.\n   */\n  #validateMarkdown(text: string): Marked.Marked.TokensList|false {\n    try {\n      const tokens = this.#marked.lexer(text);\n      for (const token of tokens) {\n        this.#renderer.renderToken(token);\n      }\n      return tokens;\n    } catch {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredMarkdown);\n      return false;\n    }\n  }\n\n  async *\n      #getInsight(): AsyncGenerator<\n          {sources: Console.PromptBuilder.Source[], isPageReloadRecommended: boolean}&\n          Host.AidaClient.DoConversationResponse,\n          void, void> {\n    const {prompt, sources, isPageReloadRecommended} = await this.#promptBuilder.buildPrompt();\n    try {\n      for await (const response of this.#aidaClient.doConversation(\n          Host.AidaClient.AidaClient.buildConsoleInsightsRequest(prompt))) {\n        yield {sources, isPageReloadRecommended, ...response};\n      }\n    } catch (err) {\n      if (err.message === 'Server responded: permission denied') {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredPermissionDenied);\n      } else if (err.message.startsWith('Cannot send request:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredCannotSend);\n      } else if (err.message.startsWith('Request failed:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredRequestFailed);\n      } else if (err.message.startsWith('Cannot parse chunk:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredCannotParseChunk);\n      } else if (err.message === 'Unknown chunk result') {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredUnknownChunk);\n      } else if (err.message.startsWith('Server responded:')) {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredApi);\n      } else {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErroredOther);\n      }\n      throw err;\n    }\n  }\n\n  #onGoToSignIn(): void {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(SIGN_IN_URL);\n  }\n\n  #focusHeader(): void {\n    this.addEventListener('animationend', () => {\n      (this.#shadow.querySelector('header h2') as HTMLElement | undefined)?.focus();\n    }, {once: true});\n  }\n\n  #onToggleReferenceDetails(): void {\n    if (this.#referenceDetailsRef.value) {\n      this.#areReferenceDetailsOpen = this.#referenceDetailsRef.value.open;\n    }\n  }\n\n  #onDisclaimerSettingsLink(): void {\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #onReminderSettingsLink(): void {\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsReminderTeaserSettingsLinkClicked);\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #onEnableInsightsInSettingsLink(): void {\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightsOptInTeaserSettingsLinkClicked);\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #render(): void {\n    const input: ViewInput = {\n      state: this.#state,\n      disableAnimations: this.disableAnimations,\n      renderer: this.#renderer,\n      selectedRating: this.#selectedRating,\n      noLogging: Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n          Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING,\n      onClose: this.#onClose.bind(this),\n      onSearch: this.#onSearch.bind(this),\n      onRating: this.#onRating.bind(this),\n      onReport: this.#onReport.bind(this),\n      onGoToSignIn: this.#onGoToSignIn.bind(this),\n      onConsentReminderConfirmed: this.#onConsentReminderConfirmed.bind(this),\n      onToggleReferenceDetails: this.#onToggleReferenceDetails.bind(this),\n      onDisclaimerSettingsLink: this.#onDisclaimerSettingsLink.bind(this),\n      onReminderSettingsLink: this.#onReminderSettingsLink.bind(this),\n      onEnableInsightsInSettingsLink: this.#onEnableInsightsInSettingsLink.bind(this),\n    };\n    const output: ViewOutput = {\n      referenceDetailsRef: this.#referenceDetailsRef,\n    };\n    // clang-format off\n    render(html`\n      <style>${styles}</style>\n      <style>${Input.checkboxStyles}</style>\n      <div class=\"wrapper\" jslog=${VisualLogging.pane('console-insights').track({resize: true})}>\n        <div class=\"animation-wrapper\">\n          ${renderHeader(input)}\n          ${renderMain(input, output)}\n          ${renderFooter(input)}\n        </div>\n      </div>\n    `, this.#shadow, {\n      host: this,\n    });\n    // clang-format on\n\n    if (this.#referenceDetailsRef.value) {\n      this.#referenceDetailsRef.value.open = this.#areReferenceDetailsOpen;\n    }\n  }\n}\n\nclass ConsoleInsightSourcesList extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #sources: Console.PromptBuilder.Source[] = [];\n  #isPageReloadRecommended = false;\n\n  #render(): void {\n    // clang-format off\n     render(html`\n      <style>${listStyles}</style>\n      <style>${Input.checkboxStyles}</style>\n      <ul>\n        ${Directives.repeat(this.#sources, item => item.value, item => {\n          return html`<li><x-link class=\"link\" title=\"${localizeType(item.type)} ${i18nString(UIStrings.opensInNewTab)}\" href=\"data:text/plain;charset=utf-8,${encodeURIComponent(item.value)}\" jslog=${VisualLogging.link('source-' + item.type).track({click: true})}>\n            <devtools-icon name=\"open-externally\"></devtools-icon>\n            ${localizeType(item.type)}\n          </x-link></li>`;\n        })}\n        ${this.#isPageReloadRecommended ? html`<li class=\"source-disclaimer\">\n          <devtools-icon name=\"warning\"></devtools-icon>\n          ${i18nString(UIStrings.reloadRecommendation)}</li>` : Lit.nothing}\n      </ul>\n    `, this.#shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  set sources(values: Console.PromptBuilder.Source[]) {\n    this.#sources = values;\n    this.#render();\n  }\n\n  set isPageReloadRecommended(isPageReloadRecommended: boolean) {\n    this.#isPageReloadRecommended = isPageReloadRecommended;\n    this.#render();\n  }\n}\n\ncustomElements.define('devtools-console-insight', ConsoleInsight);\ncustomElements.define('devtools-console-insight-sources-list', ConsoleInsightSourcesList);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-console-insight': ConsoleInsight;\n    'devtools-console-insight-sources-list': ConsoleInsightSourcesList;\n  }\n}\n"]}