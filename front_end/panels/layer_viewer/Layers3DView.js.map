{"version":3,"file":"Layers3DView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/layer_viewer/Layers3DView.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,oDAAoD;AAEpD,OAAO,KAAK,MAAM,MAAM,6BAA6B,CAAC;AACtD,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAChD,OAAO,KAAK,QAAQ,MAAM,iCAAiC,CAAC;AAG5D,OAAO,KAAK,QAAQ,MAAM,mCAAmC,CAAC;AAC9D,OAAO,KAAK,MAAM,MAAM,uBAAuB,CAAC;AAChD,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAChD,OAAO,KAAK,aAAa,MAAM,2CAA2C,CAAC;AAE3E,OAAO,kBAAkB,MAAM,uBAAuB,CAAC;AACvD,OAAO,EACL,cAAc,EAGd,mBAAmB,EACnB,SAAS,EACT,iBAAiB,GAElB,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAsC,mBAAmB,EAAC,MAAM,0BAA0B,CAAC;AAElG,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,kBAAkB,EAAE,wBAAwB;IAC5C;;OAEG;IACH,gBAAgB,EAAE,oEAAoE;IACtF;;OAEG;IACH,WAAW,EAAE,gBAAgB;IAC7B;;OAEG;IACH,iBAAiB,EAAE,uBAAuB;IAC1C;;OAEG;IACH,4BAA4B,EAAE,4CAA4C;IAC1E;;;OAGG;IACH,wBAAwB,EAAE,mCAAmC;IAC7D;;OAEG;IACH,eAAe,EAAE,mBAAmB;IACpC;;;;OAIG;IACH,MAAM,EAAE,QAAQ;IAChB;;OAEG;IACH,SAAS,EAAE,YAAY;IACvB;;OAEG;IACH,iBAAiB,EAAE,qBAAqB;CAChC,CAAC;AACX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,qCAAqC,EAAE,SAAS,CAAC,CAAC;AAC3F,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAEtE,MAAM,wBAAwB,GAAG,IAAI,GAAG,EAAwB,CAAC;AAEjE,MAAM,qBAAqB,GAAG,IAAI,GAAG,EAAwB,CAAC;AAE9D,MAAM,sBAAsB,GAAG,IAAI,GAAG,EAAwB,CAAC;AAE/D,MAAM,sBAAsB,GAAG,IAAI,GAAG,EAA2C,CAAC;AAElF,MAAM,uBAAuB,GAAG,IAAI,GAAG,EAA2C,CAAC;AAEnF,MAAM,eAAe,GAAG,IAAI,GAAG,EAAkC,CAAC;AAElE,MAAM,OAAO,YAAa,SAAQ,MAAM,CAAC,aAAa,CAAC,UAAU,CAAoC,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC;IAE1G,UAAU,CAA6B;IAC9B,aAAa,CAAgB;IACtC,mBAAmB,CAAsB;IACzC,aAAa,CAAoB;IACjC,aAAa,CAAiC;IAC9C,SAAS,CAAuC;IACvC,cAAc,CAAsB;IAC7C,cAAc,CAAgC;IAC9C,KAAK,CAAc;IACnB,cAAc,CAAkD;IAChE,aAAa,CAAqB;IAClC,eAAe,CAAoB;IACnC,cAAc,CAAuB;IACrC,aAAa,CAAgC;IAC7C,QAAQ,CAAU;IAClB,KAAK,CAAU;IACf,YAAY,CAAgE;IAC5E,gBAAgB,CAAa;IAC7B,YAAY,CAAqB;IACjC,EAAE,CAA8B;IAChC,sBAAsB,CAAmC;IACzD,WAAW,CAAW;IACtB,eAAe,CAAW;IAC1B,YAAY,CAAsB;IAClC,0BAA0B,CAAoC;IAC9D,iBAAiB,CAAoC;IACrD,UAAU,CAAU;IACpB,UAAU,CAAU;IAE5B,YAAY,aAA4B;QACtC,KAAK,CAAC;YACJ,KAAK,EAAE,GAAG,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,EAAE;YAChD,YAAY,EAAE,IAAI;SACnB,CAAC,CAAC;QACH,IAAI,CAAC,mBAAmB,CAAC,kBAAkB,CAAC,CAAC;QAE7C,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACpD,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,WAAW,CAC5C,UAAU,CAAC,SAAS,CAAC,kBAAkB,CAAC,EAAE,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC,CAAC;QAEtF,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QACtC,yGAAyG;QACzG,8CAA8C;QAC9C,IAAI,CAAC,mBAAmB;YACpB,IAAI,mBAAmB,CAAC,IAAI,CAAC,cAAc,EAAE,KAAK,EAAE,KAAK,CAAC,+BAA+B,CAAC,CAAC;QAE/F,IAAI,CAAC,mBAAmB,CAAC,gBAAgB,uEAA8C,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAE1G,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC/D,IAAI,CAAC,aAAa,CAAC,QAAQ,GAAG,CAAC,CAAC;QAChC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACtF,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACrF,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACjF,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,YAAY,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACtF,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,WAAW,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACrF,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QACzF,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,OAAO,EAAE,GAAG,aAAa,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,EAAC,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAC,CAAC,EAAE,CAAC,CAAC;QAC/G,EAAE,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,EAAE,UAAU,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC;QAE7E,IAAI,CAAC,aAAa,GAAG,EAAE,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;QAE7B,IAAI,CAAC,cAAc,GAAG,IAAI,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAEtE,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;QAEzB,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAEhB,IAAI,CAAC,cAAc,GAAG,IAAI,GAAG,EAAE,CAAC;QAChC,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5D,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IACtF,CAAC;IAED,YAAY,CAAC,SAA+C;QAC1D,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,OAAO,IAAI,CAAC,eAAe,CAAC;QAC5B,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC;YACtB,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;QAC9C,CAAC;QACD,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,iBAAiB,CAAC,KAA8B,EAAE,QAAiB;QACjE,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YACzB,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,OAAO;QACT,CAAC;QACD,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;YAC/C,MAAM,OAAO,GAAG,KAAK,IAAI,mBAAmB,CAAC,qBAAqB,CAAC,IAAI,CAAC,EAAE,IAAI,IAAI,EAAE,KAAK,CAAC,CAAC;YAC3F,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,CAAC,CAAC,EAAC,KAAK,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC,IAAI,CAAC;YACtD,IAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;IAEQ,QAAQ;QACf,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAEQ,QAAQ;QACf,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjB,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;IAChC,CAAC;IAEQ,QAAQ;QACf,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjB,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC;QAC7B,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACtB,OAAO;QACT,CAAC;QACD,IAAI,CAAC,YAAY,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,mBAAmB,CAAC,KAA8B;QAChD,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;IAC9C,CAAC;IAEO,UAAU,CAAC,IAAiB,EAAE,SAAyB;QAC7D,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;QACrC,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAED,WAAW,CAAC,SAAyB;QACnC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;IAClD,CAAC;IAED,YAAY,CAAC,SAAyB;QACpC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;QAC3C,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;IACnD,CAAC;IAED,oBAAoB,CAAC,SAAoB;QACvC,IAAI,SAAS,CAAC,IAAI,EAAE,mCAAkB,EAAE,CAAC;YACvC,MAAM,gBAAgB,GAAI,SAA+B,CAAC,QAAQ,EAAE,CAAC;YACrE,gBAAgB,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;YACzC,OAAO,OAAO,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC;QAC3C,CAAC;QACD,IAAI,SAAS,CAAC,KAAK,EAAE,EAAE,CAAC;YACtB,MAAM,OAAO,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;YACjD,IAAI,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC1B,OAAO,OAAO,CAAC;YACjB,CAAC;QACH,CAAC;QACD,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAC/B,CAAC;IAEO,MAAM,CAAC,MAAyB;QACtC,MAAM,EAAE,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACtC,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,OAAO,IAAI,CAAC;QACd,CAAC;QACD,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,mBAAmB,CAAC,CAAC;QACnD,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC;QACpB,EAAE,CAAC,UAAU,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAClC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;QACzB,OAAO,EAAE,CAAC;IACZ,CAAC;IAEO,YAAY,CAAC,IAAY,EAAE,MAAc;QAC/C,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,MAAM,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QAC1C,IAAI,MAAM,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACjC,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YACrC,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YAC9B,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAEO,WAAW;QACjB,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC;QAC7C,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YACxB,OAAO;QACT,CAAC;QACD,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,eAAe,EAAE,cAAc,CAAC,CAAC;QAC3D,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,YAAY,CAAC,CAAC;QACvD,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACxC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAEvC,MAAM,wBAAwB,GAAG,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,aAAa,EAAE,iBAAiB,CAAC,CAAC;QAClG,IAAI,CAAC,EAAE,CAAC,uBAAuB,CAAC,wBAAwB,CAAC,CAAC;QAC1D,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,wBAAwB,CAAC,CAAC;QAE3E,MAAM,qBAAqB,GAAG,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;QAC5F,IAAI,CAAC,EAAE,CAAC,uBAAuB,CAAC,qBAAqB,CAAC,CAAC;QACvD,qBAAqB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,qBAAqB,CAAC,CAAC;QAErE,MAAM,sBAAsB,GAAG,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC,IAAI,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC;QAC9F,IAAI,CAAC,EAAE,CAAC,uBAAuB,CAAC,sBAAsB,CAAC,CAAC;QACxD,sBAAsB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,sBAAsB,CAAC,CAAC;QAEvE,MAAM,eAAe,GAAG,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,IAAI,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACnF,sBAAsB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC;QAEhE,MAAM,gBAAgB,GAAG,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,IAAI,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;QACpF,uBAAuB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,gBAAgB,CAAC,CAAC;IACpE,CAAC;IAEO,YAAY;QAClB,IAAI,CAAC,aAAa,CAAC,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,WAAW,GAAG,MAAM,CAAC,gBAAgB,CAAC;QACpF,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,YAAY,GAAG,MAAM,CAAC,gBAAgB,CAAC;IACxF,CAAC;IAEO,6BAA6B;QACnC,MAAM,eAAe,GAAG,GAAG,CAAC;QAC5B,MAAM,sBAAsB,GAAG,IAAI,CAAC,sBAAsB,IAAI,EAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAC,CAAC;QACpF,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;QACvE,MAAM,SAAS,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,sBAAsB,CAAC,KAAK,CAAC;QAC3E,MAAM,UAAU,GAAG,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,sBAAsB,CAAC,MAAM,CAAC;QAC9E,MAAM,WAAW,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;QAC7C,MAAM,YAAY,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;QAC/C,MAAM,QAAQ,GAAG,WAAW,GAAG,eAAe,CAAC;QAC/C,MAAM,QAAQ,GAAG,YAAY,GAAG,eAAe,CAAC;QAChD,MAAM,MAAM,GAAG,CAAC,WAAW,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,SAAS,CAAC;QACxD,MAAM,MAAM,GAAG,CAAC,YAAY,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,UAAU,CAAC;QAC1D,MAAM,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAC3C,MAAM,kBAAkB,GACpB,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,sBAAsB,CAAC,KAAK,EAAE,UAAU,GAAG,sBAAsB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACtG,IAAI,CAAC,mBAAmB,CAAC,mBAAmB,CACxC,kBAAkB,EAClB,EAAE,GAAG,SAAS,CAAC,CAAC,CAAE,gFAAgF;QACtG,MAAM,KAAK,GAAG,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;QAC/C,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QACnD,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QAEnD,IAAI,CAAC,KAAK,GAAG,KAAK,GAAG,SAAS,CAAC;QAC/B,MAAM,YAAY,GAAG,QAAQ,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QACxE,IAAI,YAAY,KAAK,IAAI,CAAC,eAAe,EAAE,CAAC;YAC1C,IAAI,CAAC,eAAe,GAAG,YAAY,CAAC;YACpC,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAC3C,IAAI,CAAC,wBAAwB,4CAAuB,YAAY,CAAC,CAAC;QACpE,CAAC;QACD,MAAM,sBAAsB,GAAG,IAAI,eAAe,EAAE;aAChB,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC;aAC1B,SAAS,CAAC,WAAW,GAAG,CAAC,EAAE,YAAY,GAAG,CAAC,EAAE,CAAC,CAAC;aAC/C,MAAM,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC;aAC3B,KAAK,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;aACtC,SAAS,CAAC,CAAC,SAAS,GAAG,CAAC,EAAE,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;QAElF,IAAI,MAAM,CAAC;QACX,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YAC3C,MAAM,GAAG,QAAQ,CAAC,0BAA0B,CAAC,sBAAsB,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACvG,CAAC;QAED,IAAI,MAAM,EAAE,CAAC;YACX,IAAI,CAAC,mBAAmB,CAAC,YAAY,CACjC,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,EAClD,CAAC,WAAW,GAAG,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,EAChE,CAAC,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,EAClD,CAAC,YAAY,GAAG,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,CAAC,CAAC;QACzE,CAAC;QACD,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC7E,MAAM,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC7E,mHAAmH;QACnH,IAAI,CAAC,gBAAgB,GAAG,IAAI,eAAe,EAAE,CAAC,SAAS,CAAC,OAAO,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,sBAAsB,CAAC,CAAC;QAE9G,MAAM,kBAAkB,GAAG,IAAI,eAAe,EAAE;aAChB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAChB,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC;aACpB,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,CAAC,GAAG,OAAO,CAAC;aAC/E,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAEhE,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,MAAM,cAAc,GAAG,sBAAsB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACtE,IAAI,IAAI,CAAC,EAAE,IAAI,cAAc,EAAE,CAAC;gBAC9B,IAAI,CAAC,EAAE,CAAC,gBAAgB,CAAC,cAAc,EAAE,KAAK,EAAE,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAC5F,CAAC;QACH,CAAC;IACH,CAAC;IAEO,eAAe,CAAC,CAAY;QAClC,OAAO,IAAI,YAAY,CAAC;YACtB,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;YACL,CAAC,CAAC,GAAG;SACN,CAAC,CAAC;IACL,CAAC;IAEO,gBAAgB;QACtB,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC;QAC5C,IAAI,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QAC3D,MAAM,UAAU,GAAG,IAAI,UAAU,CAAC,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;QACxD,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,aAAa,EAAE,UAAU,CAAC,CAAC;IACpH,CAAC;IAEO,kBAAkB;QACxB,SAAS,iBAAiB,CAAqB,KAAoB,EAAE,GAAW;YAC9E,KAAK,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;gBAC1C,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC;oBACtB,KAAK,IAAI,mBAAmB,CAAC,qBAAqB,CAAC,IAAI,CAAC,EAAE,IAAI,IAAI,EAAE,KAAK,CAAC,IAAI,SAAS,CAAC;YAC9F,CAAC,CAAC,CAAC;QACL,CAAC;QACD,iBAAiB,CAAC,IAAI,CAAC,IAAI,8BAAsB,wBAAwB,CAAC,CAAC;QAC3E,iBAAiB,CAAC,IAAI,CAAC,IAAI,gCAAwB,0BAA0B,CAAC,CAAC;QAC/E,iBAAiB,CAAC,IAAI,CAAC,IAAI,+BAAuB,yBAAyB,CAAC,CAAC;IAC/E,CAAC;IAEO,iBAAiB;QACvB,IAAI,IAAI,CAAC,EAAE,EAAE,CAAC;YACZ,OAAO,IAAI,CAAC,EAAE,CAAC;QACjB,CAAC;QACD,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC1C,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO,IAAI,CAAC;QACd,CAAC;QACD,IAAI,CAAC,WAAW,EAAE,CAAC;QACnB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC,EAAE,CAAC;IACjB,CAAC;IAEO,4BAA4B;QAClC,IAAI,CAAC,cAAc,GAAG,IAAI,GAAG,EAAE,CAAC;QAChC,IAAI,KAAK,GAAG,CAAC,CAAC;QACd,MAAM,kBAAkB,GAAG,IAAI,CAAC,aAAa,CAAC,yBAAyB,EAAE,CAAC,GAAG,EAAE,CAAC;QAChF,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,OAAO;QACT,CAAC;QAED,MAAM,IAAI,GAAG,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC;QAClH,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO;QACT,CAAC;QAED,MAAM,KAAK,GAAG,CAAC,IAAI,CAAC,CAAC;QACrB,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QACtC,IAAI,CAAC,aAAa,GAAG,IAAI,GAAG,EAAE,CAAC;QAC/B,OAAO,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACxB,MAAM,KAAK,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;YAC5B,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,MAAM;YACR,CAAC;YAED,IAAI,kBAAkB,IAAI,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC;gBAC/C,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAChC,CAAC;YACD,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;YAClC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;gBACzC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,KAAK,CAAC,CAAC;gBACnD,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;YAC1B,CAAC;QACH,CAAC;QACD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IACxB,CAAC;IAEO,aAAa,CAAC,KAA8B;QAClD,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,CAAC,GAAG,YAAY,CAAC;IACnE,CAAC;IAEO,wBAAwB,CAAC,KAA8B,EAAE,KAAa;QAC5E,OAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,GAAG,KAAK,GAAG,iBAAiB,GAAG,CAAC,CAAC;IACnE,CAAC;IAEO,4BAA4B,CAAC,KAA8B;QACjE,2EAA2E;QAC3E,yEAAyE;QACzE,4EAA4E;QAC5E,wCAAwC;QACxC,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC;YACjC,IAAI,CAAC,sBAAsB,GAAG,EAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAC,CAAC;QACtD,CAAC;QAED,IAAI,CAAC,sBAAsB,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,EAAE,IAAI,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;QAC/F,IAAI,CAAC,sBAAsB,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,IAAI,CAAC,sBAAsB,CAAC,MAAM,CAAC,CAAC;IACpG,CAAC;IAEO,kBAAkB,CAAC,KAA8B;QACvD,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;YACnC,OAAO;QACT,CAAC;QACD,MAAM,SAAS,GAAG,IAAI,cAAc,CAAC,KAAK,CAAC,CAAC;QAC5C,MAAM,IAAI,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC;QACtC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;QAC1D,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACtB,IAAI,CAAC,4BAA4B,CAAC,KAAK,CAAC,CAAC;IAC3C,CAAC;IAEO,UAAU,CAAC,IAAe;QAChC,MAAM,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC;QACrC,MAAM,UAAU,GAAG,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,QAAQ,CAAC,EAAE,SAAS,CAAC,CAAC;QAC1F,MAAM,SAAS,GAAG,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,SAAS,CAAC,CAAC;QACxF,IAAI,UAAU,EAAE,CAAC;YACf,IAAI,CAAC,WAAW,GAAG,mBAAmB,CAAC;QACzC,CAAC;aAAM,IAAI,SAAS,EAAE,CAAC;YACrB,IAAI,CAAC,WAAW,GAAG,kBAAkB,CAAC;YACtC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;YACvD,MAAM,SAAS,GAAG,qBAAqB,CAAC;YACxC,IAAI,CAAC,SAAS,GAAG;gBACf,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG;gBACjC,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG;gBACjC,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG;gBACjC,SAAS,CAAC,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC;aAC5B,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,WAAW,GAAG,WAAW,CAAC;QACjC,CAAC;QACD,IAAI,CAAC,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,WAAW,CAAC;QAChE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACxB,CAAC;IAEO,yBAAyB,CAAC,KAA8B;QAC9D,MAAM,WAAW,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;QACxC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YAC5C,MAAM,SAAS,GAAG,IAAI,mBAAmB,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACpD,MAAM,IAAI,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC;YACtC,IAAI,CAAC,yBAAyB,CAAC,KAAK,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,IAAI,CAAC,wBAAwB,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;YACpG,IAAI,CAAC,SAAS,GAAG,yBAAyB,CAAC;YAC3C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACxB,CAAC;IACH,CAAC;IAEO,uBAAuB,CAAC,KAA8B;QAC5D,MAAM,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QACvD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YACtC,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;YACtB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;gBAClB,SAAS;YACX,CAAC;YACD,MAAM,SAAS,GAAG,IAAI,iBAAiB,CAAC,KAAK,EAAE,EAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAC,CAAC,CAAC;YAC3F,MAAM,IAAI,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC;YACtC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;gBACpC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YAC5C,CAAC;YAED,IAAI,CAAC,yBAAyB,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;YAChF,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;YAC5B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACxB,CAAC;IACH,CAAC;IAEO,cAAc;QACpB,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;QAC5B,IAAI,CAAC,sBAAsB,GAAG,EAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAE,CAAC,EAAC,CAAC;QACpD,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnB,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAClE,CAAC;QAED,IAAI,IAAI,CAAC,0BAA0B,IAAI,IAAI,CAAC,0BAA0B,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YAC/F,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACzE,CAAC;QAED,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE,CAAC;YACzE,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC;YACtC,MAAM,SAAS,GAAG,IAAI,cAAc,CAAC,KAAK,CAAC,CAAC;YAC5C,MAAM,IAAI,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,CAAC;YACtC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;YAC1D,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC;YACzC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;QACxB,CAAC;aAAM,IAAI,IAAI,CAAC,UAAU,EAAE,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YAC/C,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACvE,CAAC;IACH,CAAC;IAEO,eAAe,CAAC,KAAe;QACrC,IAAI,MAAM,GAAa,EAAE,CAAC;QAC1B,MAAM,eAAe,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;QACnF,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YAC3B,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;QAC1C,CAAC;QACD,OAAO,MAAM,CAAC;IAChB,CAAC;IAEO,kBAAkB,CAAC,SAAiB,EAAE,KAAe,EAAE,MAAc;QAC3E,MAAM,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;QACnB,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,OAAO;QACT,CAAC;QAED,MAAM,MAAM,GAAG,EAAE,CAAC,YAAY,EAAE,CAAC;QACjC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,MAAM,CAAC,CAAC;QACvC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,YAAY,CAAC,KAAK,CAAC,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC;QACxE,EAAE,CAAC,mBAAmB,CAAC,SAAS,EAAE,MAAM,EAAE,EAAE,CAAC,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACnE,CAAC;IAED,oDAAoD;IACpD,mFAAmF;IACnF,iCAAiC;IACjC,wFAAwF;IAChF,aAAa,CAAC,QAAkB,EAAE,IAAY,EAAE,KAAgB,EAAE,OAAgB;QACxF,MAAM,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;QACnB,MAAM,KAAK,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QACjC,KAAK,GAAG,KAAK,IAAI,KAAK,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;YACxB,OAAO;QACT,CAAC;QAED,MAAM,uBAAuB,GAAG,wBAAwB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACjF,MAAM,qBAAqB,GAAG,sBAAsB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC7E,MAAM,oBAAoB,GAAG,qBAAqB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC3E,IAAI,OAAO,uBAAuB,KAAK,WAAW,EAAE,CAAC;YACnD,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;QAChE,CAAC;QACD,IAAI,OAAO,qBAAqB,KAAK,WAAW,EAAE,CAAC;YACjD,IAAI,CAAC,kBAAkB,CAAC,qBAAqB,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC9E,CAAC;QACD,IAAI,OAAO,oBAAoB,KAAK,WAAW,EAAE,CAAC;YAChD,IAAI,CAAC,kBAAkB,CAAC,oBAAoB,EAAE,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;QAC3F,CAAC;QAED,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,OAAO;QACT,CAAC;QAED,MAAM,cAAc,GAAG,uBAAuB,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACvE,IAAI,OAAO,EAAE,CAAC;YACZ,IAAI,cAAc,EAAE,CAAC;gBACnB,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;gBAC9B,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;gBACvC,EAAE,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;YAClC,CAAC;QACH,CAAC;aAAM,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YAC7B,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QACnD,CAAC;QAED,MAAM,gBAAgB,GAAG,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;QAC7C,EAAE,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC,EAAE,gBAAgB,CAAC,CAAC;IAC3C,CAAC;IAEO,WAAW,CAAC,QAAkB,EAAE,OAAqB,EAAE,KAAgB;QAC7E,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;IACrE,CAAC;IAEO,qBAAqB;QAC3B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,OAAO;QACT,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QAC/C,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,OAAO;QACT,CAAC;QAED,MAAM,UAAU,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,iCAAiC,CAAC,CAAC,GAAG,EAAE;YAC1G,IAAI,CAAC,cAAc,CAAC,MAAM,IAAI,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QAClF,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,GAAG,YAAY,CAAC;QAC7C,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC;QAChE,IAAI,QAAQ,GAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACpH,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;QAC/B,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,mBAAmB,CAAC,CAAC;QAEvG,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,OAAO;QACT,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC;QACnD,IAAI,CAAC,YAAY,EAAE,CAAC;YAClB,OAAO;QACT,CAAC;QAED,MAAM,gBAAgB,GAAG,mBAAmB,GAAG,CAAC,CAAC;QACjD,MAAM,aAAa,GAAG,YAAY,CAAC,KAAK,GAAG,CAAC,GAAG,gBAAgB,CAAC;QAChE,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC;YACrD,MAAM,kBAAkB,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAC,aAAa,EAAE,CAAC,EAAE,YAAY,EAAE,CAAC,EAAC,CAAC;YAC9G,MAAM,YAAY,GAAG,kBAAkB,CAAC,aAAa,CAAC;YAEtD,MAAM,kBAAkB,GAAG,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,IAAI,EAAC,aAAa,EAAE,CAAC,EAAE,YAAY,EAAE,CAAC,EAAC,CAAC;YAC9G,MAAM,mBAAmB,GAAG,aAAa,GAAG,kBAAkB,CAAC,YAAY,GAAG,kBAAkB,CAAC,YAAY,CAAC;YAC9G,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC;YAC1B,MAAM,CAAC,GAAG,CAAC,YAAY,CAAC;YACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;gBACpD,MAAM,OAAO,GAAG,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;gBACvC,IAAI,CAAC,OAAO,EAAE,CAAC;oBACb,SAAS;gBACX,CAAC;gBAED,MAAM,KAAK,GAAG,eAAe,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;gBAC3C,IAAI,CAAC,KAAK,EAAE,CAAC;oBACX,SAAS;gBACX,CAAC;gBACD,MAAM,KAAK,GAAG,CAAC,iCAAyB,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,KAAK,CAAC,YAAY,CAAC;gBACpF,IAAI,KAAK,GAAG,CAAC,IAAI,CAAC,GAAG,KAAK,GAAG,aAAa,EAAE,CAAC;oBAC3C,MAAM;gBACR,CAAC;gBACD,QAAQ,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,KAAK,EAAE,CAAC,GAAG,YAAY,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,YAAY,EAAE,CAAC,CAAC,CAAC;gBAC9F,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC,CAAiB,CAAC,CAAC;gBACnE,CAAC,IAAI,KAAK,CAAC;YACb,CAAC;QACH,CAAC;IACH,CAAC;IAEO,YAAY,CAAC,IAAe;QAClC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,CAAC;QACxE,CAAC;aAAM,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YAC1B,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QACrE,CAAC;QACD,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAClC,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;YACrB,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACpE,CAAC;IACH,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACtB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,OAAO;QACT,CAAC;QACD,6CAA6C;QAC7C,kEAAkE;QAClE,2EAA2E;QAC3E,8CAA8C;QAC9C,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;YAC1B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC5B,qBAAqB,CAAC,GAAG,EAAE,CAAC,qBAAqB,CAAC,GAAG,EAAE;gBAC/B,IAAI,CAAC,eAAe,GAAG,KAAK,CAAC;gBAC7B,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,CAAC,CAAC,CAAC,CAAC;QAC5B,CAAC;IACH,CAAC;IAED,OAAO;QACL,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,EAAE,CAAC;YAC5B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC1C,OAAO;QACT,CAAC;QACD,MAAM,EAAE,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACpC,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;YACzB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC7C,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC1C,OAAO;QACT,CAAC;QACD,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;QACzB,MAAM,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;QAC/C,MAAM,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC;QAEjD,IAAI,CAAC,4BAA4B,EAAE,CAAC;QACpC,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,6BAA6B,EAAE,CAAC;QAErC,EAAE,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,aAAa,EAAE,cAAc,CAAC,CAAC;QACjD,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,GAAG,EAAE,CAAC,gBAAgB,CAAC,CAAC;QAEpD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACjD,IAAI,CAAC,qBAAqB,EAAE,CAAC;IAC/B,CAAC;IAEO,mBAAmB;QACzB,MAAM,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,WAAW,CAC9C,UAAU,CAAC,SAAS,CAAC,iBAAiB,CAAC,EAAE,UAAU,CAAC,SAAS,CAAC,4BAA4B,CAAC,CAAC,CAAC;QACjG,WAAW,CAAC,cAAc,CAAC,WAAW,CAAC,MAAM,CAAC,wBAAwB,CAClE,IAAI,EAAE,SAAS,CAAC,wBAAwB,EACxC,EAAC,GAAG,EAAE,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,WAAW,CAAC,EAAC,CAAC,CAAC,CAAC;QAC9F,OAAO,WAAW,CAAC;IACrB,CAAC;IAEO,uBAAuB,CAAC,KAAY;QAC1C,MAAM,UAAU,GAAG,KAAmB,CAAC;QACvC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;YACpB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,IAAI,wBAAwB,GAAG,QAAQ,CAAC;QACxC,IAAI,aAAa,GAAmB,IAAI,CAAC;QACzC,MAAM,gBAAgB,GAClB,IAAI,eAAe,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAChG,MAAM,EAAE,GAAG,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC5G,MAAM,EAAE,GAAG,CAAC,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,qBAAqB,EAAE,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAE5G,SAAS,iBAAiB,CAAC,IAAe;YACxC,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;gBACxB,OAAO;YACT,CAAC;YACD,MAAM,CAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YAC3D,IAAI,CAAC,IAAI,CAAC,GAAG,wBAAwB,EAAE,CAAC;gBACtC,wBAAwB,GAAG,CAAC,CAAC;gBAC7B,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;YACrC,CAAC;QACH,CAAC;QAED,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,iBAAiB,CAAC,CAAC;QACtC,OAAO,aAAa,CAAC;IACvB,CAAC;IAEO,uBAAuB,CAC3B,OAAwC,EAAE,IAAY,EAAE,KAAc,EACtE,OAA2B;QAC7B,MAAM,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QAC/E,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC1B,OAAO,CAAC,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAC7C,OAAO,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,OAAO,CAAC,CAAC,CAAC;QAC1E,OAAO,OAAO,CAAC;IACjB,CAAC;IAEO,WAAW;QACjB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QACvD,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACnD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,uBAAuB,CACjD,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE,0BAA0B,EAAE,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QACxF,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,uBAAuB,CAC1D,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC,EAAE,qCAAqC,EAAE,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;QAC3G,IAAI,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QAClE,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE;aAC9B,aAAa,CAAC,iCAAiC,CAAC;aAChD,iBAAiB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAC5C,CAAC;IAEO,aAAa,CAAC,KAAY;QAChC,MAAM,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC1D,WAAW,CAAC,cAAc,EAAE,CAAC,UAAU,CACnC,UAAU,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,mBAAmB,CAAC,cAAc,EAAE,EAAE;YAChF,YAAY,EAAE,kBAAkB;SACjC,CAAC,CAAC;QACP,MAAM,SAAS,GAAG,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC;QACtD,IAAI,SAAS,IAAI,SAAS,CAAC,IAAI,EAAE,mCAAkB,EAAE,CAAC;YACpD,WAAW,CAAC,cAAc,EAAE,CAAC,UAAU,CACnC,UAAU,CAAC,SAAS,CAAC,iBAAiB,CAAC,EACvC,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,iEAAkC,SAAS,CAAC,EAAE;gBAC/E,YAAY,EAAE,uBAAuB;aACtC,CAAC,CAAC;QACT,CAAC;QACD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;IAC7D,CAAC;IAEO,WAAW,CAAC,KAAY;QAC9B,MAAM,UAAU,GAAG,KAAmB,CAAC;QACvC,IAAI,UAAU,CAAC,KAAK,EAAE,CAAC;YACrB,OAAO;QACT,CAAC;QACD,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC,CAAC;IACtE,CAAC;IAEO,WAAW,CAAC,KAAY;QAC9B,MAAM,UAAU,GAAG,KAAmB,CAAC;QACvC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC;QACrC,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,OAAO,CAAC;IACvC,CAAC;IAEO,SAAS,CAAC,KAAY;QAC5B,MAAM,UAAU,GAAG,KAAmB,CAAC;QACvC,MAAM,mBAAmB,GAAG,CAAC,CAAC;QAC9B,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,mBAAmB;YACvF,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC,CAAC,GAAG,mBAAmB,EAAE,CAAC;YAChF,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;YAC3B,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC,CAAC;QACvE,CAAC;QACD,OAAO,IAAI,CAAC,UAAU,CAAC;QACvB,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IAEO,aAAa,CAAC,KAAY;QAChC,MAAM,SAAS,GAAG,IAAI,CAAC,uBAAuB,CAAC,KAAK,CAAC,CAAC;QACtD,IAAI,SAAS,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,mCAAkB,IAAI,SAAS,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC;YAC3E,IAAI,CAAC,wBAAwB,iEAAkC,SAAS,CAAC,CAAC;QAC5E,CAAC;QACD,KAAK,CAAC,eAAe,EAAE,CAAC;IAC1B,CAAC;IAEO,YAAY;QAClB,IAAI,IAAI,CAAC,UAAU,EAAE,EAAE,CAAC;YACtB,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YACjD,IAAI,CAAC,cAAc,CAAC,WAAW,EAAE,CAAC;QACpC,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;QAC9B,CAAC;QACD,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAEO,UAAU;QAChB,OAAO,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;IACvE,CAAC;CACF;AAED,MAAM,CAAN,IAAY,WAKX;AALD,WAAY,WAAW;IACrB,+EAA+E;IAC/E,kCAAmB,CAAA;IACnB,oCAAqB,CAAA;IACrB,wDAAwD;AAC1D,CAAC,EALW,WAAW,KAAX,WAAW,QAKtB;AAkBD,MAAM,CAAC,MAAM,cAAc,GAAG,EAAE;IAC5B,4BAA4B;IAC5B,wBAAwB;IACxB,+BAA+B;IAC/B,+BAA+B;IAC/B,mBAAmB;IACnB,KAAK;IACL,4FAA4F;IAC5F,GAAG,CAAC;AAER,MAAM,CAAC,MAAM,YAAY,GAAG,EAAE;IAC1B,mCAAmC;IACnC,iCAAiC;IACjC,gCAAgC;IAChC,0BAA0B;IAC1B,+BAA+B;IAC/B,wBAAwB;IACxB,mBAAmB;IACnB,KAAK;IACL,wDAAwD;IACxD,0BAA0B;IAC1B,kCAAkC;IAClC,GAAG,CAAC;AAER,MAAM,CAAC,MAAM,kBAAkB,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;AACjD,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAClD,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AACxC,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;AACtD,MAAM,CAAC,MAAM,yBAAyB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;AAC9D,MAAM,CAAC,MAAM,qBAAqB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;AACxD,MAAM,CAAC,MAAM,WAAW,GAAG,CAAC,CAAC;AAC7B,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,CAAC;AACrC,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,CAAC;AAErC,MAAM,CAAC,MAAM,YAAY,GAAG,EAAE,CAAC;AAC/B,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC,CAAC;AAEnC,MAAM,OAAO,mBAAmB;IACb,sBAAsB,CAAa;IACnC,SAAS,CAA6B;IAC/C,KAAK,CAAS;IACd,MAAM,CAAU;IAChB,KAAK,CAA6B;IAClC,YAAY,CAAwC;IACpD,EAAE,CAAyB;IACnC,YAAY,sBAAkC;QAC5C,IAAI,CAAC,sBAAsB,GAAG,sBAAsB,CAAC;QACrD,IAAI,CAAC,SAAS,GAAG,IAAI,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;QACnD,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED,MAAM,CAAC,qBAAqB,CAAC,EAA8B,EAAE,KAAuB;QAClF,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,MAAM,IAAI,KAAK,CAAC,oCAAoC,CAAC,CAAC;QACxD,CAAC;QACD,MAAM,OAAO,GAAG,EAAE,CAAC,aAAa,EAAE,CAAC;QACnC,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,0BAA0B,CAAC,CAAC;QAC9C,CAAC;QAED,eAAe,CAAC,GAAG,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;QACpC,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;QACvC,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,CAAC,CAAC;QAC1C,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;QAC3E,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,kBAAkB,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAClE,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,kBAAkB,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;QAClE,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,cAAc,EAAE,EAAE,CAAC,aAAa,CAAC,CAAC;QACrE,EAAE,CAAC,aAAa,CAAC,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,cAAc,EAAE,EAAE,CAAC,aAAa,CAAC,CAAC;QACrE,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;QACpC,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,KAAK;QACH,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YACtB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;QAC1B,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,IAAI,GAAG,EAAE,CAAC;QAC9B,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;IAClB,CAAC;IAED,UAAU,CAAC,SAAgC;QACzC,IAAI,CAAC,EAAE,GAAG,SAAS,CAAC;QACpB,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,cAAc,EAAE,CAAC;QACxB,CAAC;IACH,CAAC;IAED,OAAO;QACL,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACtB,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;YACtB,KAAK,IAAI,CAAC,MAAM,EAAE,CAAC;QACrB,CAAC;IACH,CAAC;IAED,YAAY,CAAC,SAA+C;QAC1D,MAAM,SAAS,GAAG,IAAI,GAAG,EAA2B,CAAC;QACrD,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC;QACvD,IAAI,SAAS,EAAE,CAAC;YACd,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE;gBAC7B,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC;oBAC1B,OAAO;gBACT,CAAC;gBACD,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACrB,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;oBAClC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;oBACjC,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;gBAC/B,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC;YACtB,IAAI,CAAC,WAAW,EAAE,CAAC;QACrB,CAAC;QACD,KAAK,MAAM,KAAK,IAAI,SAAS,EAAE,CAAC;YAC9B,IAAI,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;gBACzB,SAAS;YACX,CAAC;YACD,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAC3C,IAAI,KAAK,EAAE,CAAC;gBACV,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;YACxC,CAAC;YACD,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAClC,CAAC;IACH,CAAC;IAEO,oBAAoB,CAAC,KAA8B,EAAE,SAA+C;QAE1G,MAAM,mBAAmB,GAAG,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QAC7G,MAAM,QAAQ,GAAG,EAAE,CAAC;QACpB,MAAM,WAAW,GAAG,EAAE,CAAC;QACvB,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE,CAAC;YACjC,MAAM,OAAO,GAAG,mBAAmB,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAC3D,IAAI,OAAO,EAAE,CAAC;gBACZ,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;gBAC1B,mBAAmB,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAChD,CAAC;iBAAM,CAAC;gBACN,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACpC,CAAC;QACH,CAAC;QACD,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,EAAE,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC3D,KAAK,MAAM,IAAI,IAAI,mBAAmB,CAAC,MAAM,EAAE,EAAE,CAAC;YAChD,IAAI,CAAC,OAAO,EAAE,CAAC;QACjB,CAAC;QACD,MAAM,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;QACnB,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YACvB,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;QAC3B,CAAC;QACD,OAAO,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;IAC1G,CAAC;IAED,QAAQ,CAAC,KAAa;QACpB,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,EAAE,CAAC;YACtC,OAAO;QACT,CAAC;QACD,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,cAAc,EAAE,CAAC;IACxB,CAAC;IAED,aAAa,CAAC,KAA8B;QAC1C,OAAO,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;IAC5C,CAAC;IAED,gBAAgB,CAAC,KAA8B;QAC7C,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC;YAClC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACzB,CAAC;QACD,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACvD,CAAC;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;QACrD,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,KAAK,IAAI,CAAC,MAAM,EAAE,CAAC;IACrB,CAAC;IAEO,MAAM;QACZ,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,CAAC,KAAK,EAAE,CAAC;YACX,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;QAC3B,CAAC;QACD,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;YACtB,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QACvD,CAAC;QACD,OAAO,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAEO,WAAW,CAAC,KAA8B;QAChD,OAAO,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC;aAChC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC;IAC5G,CAAC;IAEO,cAAc;QACpB,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;YACb,OAAO;QACT,CAAC;QACD,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YAChB,OAAO;QACT,CAAC;QAED,KAAK,MAAM,KAAK,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,EAAE,CAAC;YAC/C,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;gBACzB,MAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;gBACtD,IAAI,OAAO,EAAE,CAAC;oBACZ,KAAK,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;gBACjD,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;CACF;AAED,MAAM,OAAO,SAAS;IACpB,aAAa,CAAiB;IAC9B,SAAS,CAAS;IAClB,WAAW,CAAgB;IAC3B,SAAS,CAAgB;IACzB,OAAO,CAAoB;IAC3B,QAAQ,CAAY;IACpB,YAAY,aAA6B;QACvC,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;QACnC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACtB,CAAC;IAED,WAAW,CAAC,IAAc,EAAE,CAAS;QACnC,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACvG,CAAC;IAED;;;OAGG;IACK,oBAAoB,CAAC,IAAc,EAAE,MAAc,EAAE,MAAc;QACzE,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,MAAM,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACnB,yCAAyC;QACzC,MAAM,eAAe,GAAG,EAAE,GAAG,MAAM,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAChD,MAAM,eAAe,GAAG,EAAE,GAAG,MAAM,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAChD,yCAAyC;QACzC,MAAM,eAAe,GAAG,EAAE,GAAG,MAAM,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAChD,MAAM,eAAe,GAAG,EAAE,GAAG,MAAM,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAChD,MAAM,CAAC,GAAG,eAAe,GAAG,MAAM,GAAG,CAAC,eAAe,GAAG,eAAe,CAAC,CAAC;QACzE,MAAM,CAAC,GAAG,eAAe,GAAG,MAAM,GAAG,CAAC,eAAe,GAAG,eAAe,CAAC,CAAC;QACzE,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAChB,CAAC;IAED,yBAAyB,CAAC,KAA8B,EAAE,IAAuB,EAAE,CAAS;QAC1F,MAAM,IAAI,GAAG,KAAK,CAAC,IAAI,EAAE,CAAC;QAC1B,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;QACnC,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC,KAAK,EAAE,CAAC;QAClD,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC;QACpC,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC;QACpD,MAAM,QAAQ,GAAG,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC;aACpC,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;aACjD,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;aACjD,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC,CAAC;QACxE,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACH,iBAAiB,CAAC,MAAiB,EAAE,EAAU,EAAE,EAAU;QACzD,IAAI,CAAC,CAAC;QACN,qDAAqD;QACrD,MAAM,MAAM,GAAG,EAAE,CAAC;QAClB,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC;YACvB,MAAM,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,kCAAkC,CACnD,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;QAC7G,CAAC;QACD,gCAAgC;QAChC,MAAM,MAAM,GACR,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5G,gFAAgF;QAChF,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;QACnB,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;QACnB,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;QACnB,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACjE,8BAA8B;QAC9B,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;QACrC,4BAA4B;QAC5B,MAAM,EAAE,GAAG,IAAI,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC;QAC1C,8DAA8D;QAC9D,MAAM,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;QAC5D,8FAA8F;QAC9F,8FAA8F;QAC9F,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YACnC,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,EAAE,QAAQ,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YAClH,IAAI,OAAO,GAAG,CAAC,EAAE,CAAC;gBAChB,OAAO,SAAS,CAAC;YACnB,CAAC;QACH,CAAC;QACD,OAAO,CAAC,CAAC;IACX,CAAC;CACF;AAED,MAAM,OAAO,IAAI;IACf,QAAQ,CAA0C;IAClD,IAAI,CAAoB;IACxB,KAAK,CAAS;IACd,OAAO,CAAoB;IACnB,EAAE,CAAyB;IACnC,YAAY,gBAAoD;QAC9D,IAAI,CAAC,QAAQ,GAAG,gBAAgB,CAAC,QAAQ,CAAC;QAC1C,IAAI,CAAC,IAAI,GAAG,gBAAgB,CAAC,IAAI,CAAC;QAClC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QACf,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;IACtB,CAAC;IAED,OAAO;QACL,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACxB,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YACpC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACtB,CAAC;IACH,CAAC;IAED,WAAW,CAAC,SAAgC,EAAE,KAAa;QACzD,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,KAAK,IAAI,KAAK,EAAE,CAAC;YACxC,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC;IACvC,CAAC;IAED,KAAK,CAAC,MAAM,CAAC,SAAgC,EAAE,KAAa;QAC1D,IAAI,CAAC,EAAE,GAAG,SAAS,CAAC;QACpB,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACnD,MAAM,KAAK,GAAG,QAAQ,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QACrE,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,mBAAmB,CAAC,qBAAqB,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;IAC5F,CAAC;CACF","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as Geometry from '../../models/geometry/geometry.js';\nimport * as uiI18n from '../../ui/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport layers3DViewStyles from './layers3DView.css.js';\nimport {\n  LayerSelection,\n  type LayerView,\n  type LayerViewHost,\n  ScrollRectSelection,\n  Selection,\n  SnapshotSelection,\n  Type,\n} from './LayerViewHost.js';\nimport {Events as TransformControllerEvents, TransformController} from './TransformController.js';\n\nconst UIStrings = {\n  /**\n   * @description Text of a DOM element in DView of the Layers panel\n   */\n  noLayerInformation: 'No layers detected yet',\n  /**\n   * @description Text of a DOM element in DView of the Layers panel that explains the panel\n   */\n  layerExplanation: 'On this page you will be able to view and inspect document layers.',\n  /**\n   * @description Accessibility label for canvas view in Layers tool\n   */\n  dLayersView: '3D Layers View',\n  /**\n   * @description Text in DView of the Layers panel\n   */\n  cantDisplayLayers: 'Can\\'t display layers',\n  /**\n   * @description Text in DView of the Layers panel\n   */\n  webglSupportIsDisabledInYour: 'WebGL support is disabled in your browser.',\n  /**\n   * @description Text in DView of the Layers panel\n   * @example {about:gpu} PH1\n   */\n  checkSForPossibleReasons: 'Check {PH1} for possible reasons.',\n  /**\n   * @description Text for a checkbox in the toolbar of the Layers panel to show the area of slow scroll rect\n   */\n  slowScrollRects: 'Slow scroll rects',\n  /**\n   * @description Text for a checkbox in the toolbar of the Layers panel. This is a noun, for a\n   * setting meaning 'display paints in the layers viewer'. 'Paints' here means 'paint events' i.e.\n   * when the browser draws pixels to the screen.\n   */\n  paints: 'Paints',\n  /**\n   * @description A context menu item in the DView of the Layers panel\n   */\n  resetView: 'Reset View',\n  /**\n   * @description A context menu item in the DView of the Layers panel\n   */\n  showPaintProfiler: 'Show Paint Profiler',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/layer_viewer/Layers3DView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst vertexPositionAttributes = new Map<WebGLProgram, number>();\n\nconst vertexColorAttributes = new Map<WebGLProgram, number>();\n\nconst textureCoordAttributes = new Map<WebGLProgram, number>();\n\nconst uniformMatrixLocations = new Map<WebGLProgram, WebGLUniformLocation|null>();\n\nconst uniformSamplerLocations = new Map<WebGLProgram, WebGLUniformLocation|null>();\n\nconst imageForTexture = new Map<WebGLTexture, HTMLImageElement>();\n\nexport class Layers3DView extends Common.ObjectWrapper.eventMixin<EventTypes, typeof UI.Widget.VBox>(UI.Widget.VBox)\n    implements LayerView {\n  private failBanner: UI.EmptyWidget.EmptyWidget;\n  private readonly layerViewHost: LayerViewHost;\n  private transformController: TransformController;\n  private canvasElement: HTMLCanvasElement;\n  private lastSelection: Record<string, Selection|null>;\n  private layerTree: SDK.LayerTreeBase.LayerTreeBase|null;\n  private readonly textureManager: LayerTextureManager;\n  private chromeTextures: Array<WebGLTexture|undefined>;\n  private rects: Rectangle[];\n  private snapshotLayers: Map<SDK.LayerTreeBase.Layer, SnapshotSelection>;\n  private shaderProgram!: WebGLProgram|null;\n  private oldTextureScale!: number|undefined;\n  private depthByLayerId!: Map<string, number>;\n  private visibleLayers!: Set<SDK.LayerTreeBase.Layer>;\n  private maxDepth!: number;\n  private scale!: number;\n  private layerTexture?: {layer: SDK.LayerTreeBase.Layer, texture: WebGLTexture}|null;\n  private projectionMatrix?: DOMMatrix;\n  private whiteTexture?: WebGLTexture|null;\n  private gl?: WebGLRenderingContext|null;\n  private dimensionsForAutoscale?: {width: number, height: number};\n  private needsUpdate?: boolean;\n  private updateScheduled?: boolean;\n  private panelToolbar?: UI.Toolbar.Toolbar;\n  private showSlowScrollRectsSetting?: Common.Settings.Setting<boolean>;\n  private showPaintsSetting?: Common.Settings.Setting<boolean>;\n  private mouseDownX?: number;\n  private mouseDownY?: number;\n\n  constructor(layerViewHost: LayerViewHost) {\n    super({\n      jslog: `${VisualLogging.pane('layers-3d-view')}`,\n      useShadowDom: true,\n    });\n    this.registerRequiredCSS(layers3DViewStyles);\n\n    this.contentElement.classList.add('layers-3d-view');\n    this.failBanner = new UI.EmptyWidget.EmptyWidget(\n        i18nString(UIStrings.noLayerInformation), i18nString(UIStrings.layerExplanation));\n\n    this.layerViewHost = layerViewHost;\n    this.layerViewHost.registerView(this);\n    // Install transform controller, but still allow drag events to set focus on the element, which is needed\n    // to correctly listen for keyboard shortcuts.\n    this.transformController =\n        new TransformController(this.contentElement, false, false /* preventDefaultOnMouseDown */);\n\n    this.transformController.addEventListener(TransformControllerEvents.TRANSFORM_CHANGED, this.update, this);\n\n    this.initToolbar();\n    this.canvasElement = this.contentElement.createChild('canvas');\n    this.canvasElement.tabIndex = 0;\n    this.canvasElement.addEventListener('dblclick', this.onDoubleClick.bind(this), false);\n    this.canvasElement.addEventListener('mousedown', this.onMouseDown.bind(this), false);\n    this.canvasElement.addEventListener('mouseup', this.onMouseUp.bind(this), false);\n    this.canvasElement.addEventListener('mouseleave', this.onMouseMove.bind(this), false);\n    this.canvasElement.addEventListener('mousemove', this.onMouseMove.bind(this), false);\n    this.canvasElement.addEventListener('contextmenu', this.onContextMenu.bind(this), false);\n    this.canvasElement.setAttribute('jslog', `${VisualLogging.canvas('layers').track({click: true, drag: true})}`);\n    UI.ARIAUtils.setLabel(this.canvasElement, i18nString(UIStrings.dLayersView));\n\n    this.lastSelection = {};\n    this.layerTree = null;\n    this.updateScheduled = false;\n\n    this.textureManager = new LayerTextureManager(this.update.bind(this));\n\n    this.chromeTextures = [];\n\n    this.rects = [];\n\n    this.snapshotLayers = new Map();\n    this.layerViewHost.setLayerSnapshotMap(this.snapshotLayers);\n\n    this.layerViewHost.showInternalLayersSetting().addChangeListener(this.update, this);\n  }\n\n  setLayerTree(layerTree: SDK.LayerTreeBase.LayerTreeBase|null): void {\n    this.layerTree = layerTree;\n    this.layerTexture = null;\n    delete this.oldTextureScale;\n    if (this.showPaints()) {\n      this.textureManager.setLayerTree(layerTree);\n    }\n    this.update();\n  }\n\n  showImageForLayer(layer: SDK.LayerTreeBase.Layer, imageURL?: string): void {\n    if (!imageURL) {\n      this.layerTexture = null;\n      this.update();\n      return;\n    }\n    void UI.UIUtils.loadImage(imageURL).then(image => {\n      const texture = image && LayerTextureManager.createTextureForImage(this.gl || null, image);\n      this.layerTexture = texture ? {layer, texture} : null;\n      this.update();\n    });\n  }\n\n  override onResize(): void {\n    this.resizeCanvas();\n    this.update();\n  }\n\n  override willHide(): void {\n    super.willHide();\n    this.textureManager.suspend();\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.textureManager.resume();\n    if (!this.needsUpdate) {\n      return;\n    }\n    this.resizeCanvas();\n    this.update();\n  }\n\n  updateLayerSnapshot(layer: SDK.LayerTreeBase.Layer): void {\n    this.textureManager.layerNeedsUpdate(layer);\n  }\n\n  private setOutline(type: OutlineType, selection: Selection|null): void {\n    this.lastSelection[type] = selection;\n    this.update();\n  }\n\n  hoverObject(selection: Selection|null): void {\n    this.setOutline(OutlineType.Hovered, selection);\n  }\n\n  selectObject(selection: Selection|null): void {\n    this.setOutline(OutlineType.Hovered, null);\n    this.setOutline(OutlineType.Selected, selection);\n  }\n\n  snapshotForSelection(selection: Selection): Promise<SDK.PaintProfiler.SnapshotWithRect|null> {\n    if (selection.type() === Type.SNAPSHOT) {\n      const snapshotWithRect = (selection as SnapshotSelection).snapshot();\n      snapshotWithRect.snapshot.addReference();\n      return Promise.resolve(snapshotWithRect);\n    }\n    if (selection.layer()) {\n      const promise = selection.layer().snapshots()[0];\n      if (promise !== undefined) {\n        return promise;\n      }\n    }\n    return Promise.resolve(null);\n  }\n\n  private initGL(canvas: HTMLCanvasElement): WebGLRenderingContext|null {\n    const gl = canvas.getContext('webgl');\n    if (!gl) {\n      return null;\n    }\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    gl.enable(gl.BLEND);\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n    gl.enable(gl.DEPTH_TEST);\n    return gl;\n  }\n\n  private createShader(type: number, script: string): void {\n    if (!this.gl) {\n      return;\n    }\n\n    const shader = this.gl.createShader(type);\n    if (shader && this.shaderProgram) {\n      this.gl.shaderSource(shader, script);\n      this.gl.compileShader(shader);\n      this.gl.attachShader(this.shaderProgram, shader);\n    }\n  }\n\n  private initShaders(): void {\n    if (!this.gl) {\n      return;\n    }\n\n    this.shaderProgram = this.gl.createProgram();\n    if (!this.shaderProgram) {\n      return;\n    }\n    this.createShader(this.gl.FRAGMENT_SHADER, FragmentShader);\n    this.createShader(this.gl.VERTEX_SHADER, VertexShader);\n    this.gl.linkProgram(this.shaderProgram);\n    this.gl.useProgram(this.shaderProgram);\n\n    const aVertexPositionAttribute = this.gl.getAttribLocation(this.shaderProgram, 'aVertexPosition');\n    this.gl.enableVertexAttribArray(aVertexPositionAttribute);\n    vertexPositionAttributes.set(this.shaderProgram, aVertexPositionAttribute);\n\n    const aVertexColorAttribute = this.gl.getAttribLocation(this.shaderProgram, 'aVertexColor');\n    this.gl.enableVertexAttribArray(aVertexColorAttribute);\n    vertexColorAttributes.set(this.shaderProgram, aVertexColorAttribute);\n\n    const aTextureCoordAttribute = this.gl.getAttribLocation(this.shaderProgram, 'aTextureCoord');\n    this.gl.enableVertexAttribArray(aTextureCoordAttribute);\n    textureCoordAttributes.set(this.shaderProgram, aTextureCoordAttribute);\n\n    const uMatrixLocation = this.gl.getUniformLocation(this.shaderProgram, 'uPMatrix');\n    uniformMatrixLocations.set(this.shaderProgram, uMatrixLocation);\n\n    const uSamplerLocation = this.gl.getUniformLocation(this.shaderProgram, 'uSampler');\n    uniformSamplerLocations.set(this.shaderProgram, uSamplerLocation);\n  }\n\n  private resizeCanvas(): void {\n    this.canvasElement.width = this.canvasElement.offsetWidth * window.devicePixelRatio;\n    this.canvasElement.height = this.canvasElement.offsetHeight * window.devicePixelRatio;\n  }\n\n  private updateTransformAndConstraints(): void {\n    const paddingFraction = 0.1;\n    const dimensionsForAutoscale = this.dimensionsForAutoscale || {width: 0, height: 0};\n    const viewport = this.layerTree ? this.layerTree.viewportSize() : null;\n    const baseWidth = viewport ? viewport.width : dimensionsForAutoscale.width;\n    const baseHeight = viewport ? viewport.height : dimensionsForAutoscale.height;\n    const canvasWidth = this.canvasElement.width;\n    const canvasHeight = this.canvasElement.height;\n    const paddingX = canvasWidth * paddingFraction;\n    const paddingY = canvasHeight * paddingFraction;\n    const scaleX = (canvasWidth - 2 * paddingX) / baseWidth;\n    const scaleY = (canvasHeight - 2 * paddingY) / baseHeight;\n    const viewScale = Math.min(scaleX, scaleY);\n    const minScaleConstraint =\n        Math.min(baseWidth / dimensionsForAutoscale.width, baseHeight / dimensionsForAutoscale.width) / 2;\n    this.transformController.setScaleConstraints(\n        minScaleConstraint,\n        10 / viewScale);  // 1/viewScale is 1:1 in terms of pixels, so allow zooming to 10x of native size\n    const scale = this.transformController.scale();\n    const rotateX = this.transformController.rotateX();\n    const rotateY = this.transformController.rotateY();\n\n    this.scale = scale * viewScale;\n    const textureScale = Platform.NumberUtilities.clamp(this.scale, 0.1, 1);\n    if (textureScale !== this.oldTextureScale) {\n      this.oldTextureScale = textureScale;\n      this.textureManager.setScale(textureScale);\n      this.dispatchEventToListeners(Events.SCALE_CHANGED, textureScale);\n    }\n    const scaleAndRotationMatrix = new WebKitCSSMatrix()\n                                       .scale(scale, scale, scale)\n                                       .translate(canvasWidth / 2, canvasHeight / 2, 0)\n                                       .rotate(rotateX, rotateY, 0)\n                                       .scale(viewScale, viewScale, viewScale)\n                                       .translate(-baseWidth / 2, -baseHeight / 2, 0);\n\n    let bounds;\n    for (let i = 0; i < this.rects.length; ++i) {\n      bounds = Geometry.boundsForTransformedPoints(scaleAndRotationMatrix, this.rects[i].vertices, bounds);\n    }\n\n    if (bounds) {\n      this.transformController.clampOffsets(\n          (paddingX - bounds.maxX) / window.devicePixelRatio,\n          (canvasWidth - paddingX - bounds.minX) / window.devicePixelRatio,\n          (paddingY - bounds.maxY) / window.devicePixelRatio,\n          (canvasHeight - paddingY - bounds.minY) / window.devicePixelRatio);\n    }\n    const offsetX = this.transformController.offsetX() * window.devicePixelRatio;\n    const offsetY = this.transformController.offsetY() * window.devicePixelRatio;\n    // Multiply to translation matrix on the right rather than translate (which would implicitly multiply on the left).\n    this.projectionMatrix = new WebKitCSSMatrix().translate(offsetX, offsetY, 0).multiply(scaleAndRotationMatrix);\n\n    const glProjectionMatrix = new WebKitCSSMatrix()\n                                   .scale(1, -1, -1)\n                                   .translate(-1, -1, 0)\n                                   .scale(2 / this.canvasElement.width, 2 / this.canvasElement.height, 1 / 1000000)\n                                   .multiply(this.projectionMatrix);\n\n    if (this.shaderProgram) {\n      const pMatrixUniform = uniformMatrixLocations.get(this.shaderProgram);\n      if (this.gl && pMatrixUniform) {\n        this.gl.uniformMatrix4fv(pMatrixUniform, false, this.arrayFromMatrix(glProjectionMatrix));\n      }\n    }\n  }\n\n  private arrayFromMatrix(m: DOMMatrix): Float32Array {\n    return new Float32Array([\n      m.m11,\n      m.m12,\n      m.m13,\n      m.m14,\n      m.m21,\n      m.m22,\n      m.m23,\n      m.m24,\n      m.m31,\n      m.m32,\n      m.m33,\n      m.m34,\n      m.m41,\n      m.m42,\n      m.m43,\n      m.m44,\n    ]);\n  }\n\n  private initWhiteTexture(): void {\n    if (!this.gl) {\n      return;\n    }\n\n    this.whiteTexture = this.gl.createTexture();\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.whiteTexture);\n    const whitePixel = new Uint8Array([255, 255, 255, 255]);\n    this.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, 1, 1, 0, this.gl.RGBA, this.gl.UNSIGNED_BYTE, whitePixel);\n  }\n\n  private initChromeTextures(): void {\n    function loadChromeTexture(this: Layers3DView, index: ChromeTexture, url: string): void {\n      void UI.UIUtils.loadImage(url).then(image => {\n        this.chromeTextures[index] =\n            image && LayerTextureManager.createTextureForImage(this.gl || null, image) || undefined;\n      });\n    }\n    loadChromeTexture.call(this, ChromeTexture.LEFT, 'Images/chromeLeft.avif');\n    loadChromeTexture.call(this, ChromeTexture.MIDDLE, 'Images/chromeMiddle.avif');\n    loadChromeTexture.call(this, ChromeTexture.RIGHT, 'Images/chromeRight.avif');\n  }\n\n  private initGLIfNecessary(): WebGLRenderingContext|null {\n    if (this.gl) {\n      return this.gl;\n    }\n    this.gl = this.initGL(this.canvasElement);\n    if (!this.gl) {\n      return null;\n    }\n    this.initShaders();\n    this.initWhiteTexture();\n    this.initChromeTextures();\n    this.textureManager.setContext(this.gl);\n    return this.gl;\n  }\n\n  private calculateDepthsAndVisibility(): void {\n    this.depthByLayerId = new Map();\n    let depth = 0;\n    const showInternalLayers = this.layerViewHost.showInternalLayersSetting().get();\n    if (!this.layerTree) {\n      return;\n    }\n\n    const root = showInternalLayers ? this.layerTree.root() : (this.layerTree.contentRoot() || this.layerTree.root());\n    if (!root) {\n      return;\n    }\n\n    const queue = [root];\n    this.depthByLayerId.set(root.id(), 0);\n    this.visibleLayers = new Set();\n    while (queue.length > 0) {\n      const layer = queue.shift();\n      if (!layer) {\n        break;\n      }\n\n      if (showInternalLayers || layer.drawsContent()) {\n        this.visibleLayers.add(layer);\n      }\n      const children = layer.children();\n      for (let i = 0; i < children.length; ++i) {\n        this.depthByLayerId.set(children[i].id(), ++depth);\n        queue.push(children[i]);\n      }\n    }\n    this.maxDepth = depth;\n  }\n\n  private depthForLayer(layer: SDK.LayerTreeBase.Layer): number {\n    return (this.depthByLayerId.get(layer.id()) || 0) * LayerSpacing;\n  }\n\n  private calculateScrollRectDepth(layer: SDK.LayerTreeBase.Layer, index: number): number {\n    return this.depthForLayer(layer) + index * ScrollRectSpacing + 1;\n  }\n\n  private updateDimensionsForAutoscale(layer: SDK.LayerTreeBase.Layer): void {\n    // We don't want to be precise, but rather pick something least affected by\n    // animationtransforms, so that we don't change scale too often. So let's\n    // disregard transforms, scrolling and relative layer positioning and choose\n    // the largest dimensions of all layers.\n    if (!this.dimensionsForAutoscale) {\n      this.dimensionsForAutoscale = {width: 0, height: 0};\n    }\n\n    this.dimensionsForAutoscale.width = Math.max(layer.width(), this.dimensionsForAutoscale.width);\n    this.dimensionsForAutoscale.height = Math.max(layer.height(), this.dimensionsForAutoscale.height);\n  }\n\n  private calculateLayerRect(layer: SDK.LayerTreeBase.Layer): void {\n    if (!this.visibleLayers.has(layer)) {\n      return;\n    }\n    const selection = new LayerSelection(layer);\n    const rect = new Rectangle(selection);\n    rect.setVertices(layer.quad(), this.depthForLayer(layer));\n    this.appendRect(rect);\n    this.updateDimensionsForAutoscale(layer);\n  }\n\n  private appendRect(rect: Rectangle): void {\n    const selection = rect.relatedObject;\n    const isSelected = Selection.isEqual(this.lastSelection[OutlineType.Selected], selection);\n    const isHovered = Selection.isEqual(this.lastSelection[OutlineType.Hovered], selection);\n    if (isSelected) {\n      rect.borderColor = SelectedBorderColor;\n    } else if (isHovered) {\n      rect.borderColor = HoveredBorderColor;\n      const fillColor = rect.fillColor || [255, 255, 255, 1];\n      const maskColor = HoveredImageMaskColor;\n      rect.fillColor = [\n        fillColor[0] * maskColor[0] / 255,\n        fillColor[1] * maskColor[1] / 255,\n        fillColor[2] * maskColor[2] / 255,\n        fillColor[3] * maskColor[3],\n      ];\n    } else {\n      rect.borderColor = BorderColor;\n    }\n    rect.lineWidth = isSelected ? SelectedBorderWidth : BorderWidth;\n    this.rects.push(rect);\n  }\n\n  private calculateLayerScrollRects(layer: SDK.LayerTreeBase.Layer): void {\n    const scrollRects = layer.scrollRects();\n    for (let i = 0; i < scrollRects.length; ++i) {\n      const selection = new ScrollRectSelection(layer, i);\n      const rect = new Rectangle(selection);\n      rect.calculateVerticesFromRect(layer, scrollRects[i].rect, this.calculateScrollRectDepth(layer, i));\n      rect.fillColor = ScrollRectBackgroundColor;\n      this.appendRect(rect);\n    }\n  }\n\n  private calculateLayerTileRects(layer: SDK.LayerTreeBase.Layer): void {\n    const tiles = this.textureManager.tilesForLayer(layer);\n    for (let i = 0; i < tiles.length; ++i) {\n      const tile = tiles[i];\n      if (!tile.texture) {\n        continue;\n      }\n      const selection = new SnapshotSelection(layer, {rect: tile.rect, snapshot: tile.snapshot});\n      const rect = new Rectangle(selection);\n      if (!this.snapshotLayers.has(layer)) {\n        this.snapshotLayers.set(layer, selection);\n      }\n\n      rect.calculateVerticesFromRect(layer, tile.rect, this.depthForLayer(layer) + 1);\n      rect.texture = tile.texture;\n      this.appendRect(rect);\n    }\n  }\n\n  private calculateRects(): void {\n    this.rects = [];\n    this.snapshotLayers.clear();\n    this.dimensionsForAutoscale = {width: 0, height: 0};\n    if (this.layerTree) {\n      this.layerTree.forEachLayer(this.calculateLayerRect.bind(this));\n    }\n\n    if (this.showSlowScrollRectsSetting && this.showSlowScrollRectsSetting.get() && this.layerTree) {\n      this.layerTree.forEachLayer(this.calculateLayerScrollRects.bind(this));\n    }\n\n    if (this.layerTexture && this.visibleLayers.has(this.layerTexture.layer)) {\n      const layer = this.layerTexture.layer;\n      const selection = new LayerSelection(layer);\n      const rect = new Rectangle(selection);\n      rect.setVertices(layer.quad(), this.depthForLayer(layer));\n      rect.texture = this.layerTexture.texture;\n      this.appendRect(rect);\n    } else if (this.showPaints() && this.layerTree) {\n      this.layerTree.forEachLayer(this.calculateLayerTileRects.bind(this));\n    }\n  }\n\n  private makeColorsArray(color: number[]): number[] {\n    let colors: number[] = [];\n    const normalizedColor = [color[0] / 255, color[1] / 255, color[2] / 255, color[3]];\n    for (let i = 0; i < 4; i++) {\n      colors = colors.concat(normalizedColor);\n    }\n    return colors;\n  }\n\n  private setVertexAttribute(attribute: number, array: number[], length: number): void {\n    const gl = this.gl;\n    if (!gl) {\n      return;\n    }\n\n    const buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(array), gl.STATIC_DRAW);\n    gl.vertexAttribPointer(attribute, length, gl.FLOAT, false, 0, 0);\n  }\n\n  // This view currently draws every rect, every frame\n  // It'd be far more effectient to retain the buffers created in setVertexAttribute,\n  // and manipulate them as needed.\n  // TODO(crbug.com/1473451): consider those optimizations or porting to 3D css transforms\n  private drawRectangle(vertices: number[], mode: number, color?: number[], texture?: Object): void {\n    const gl = this.gl;\n    const white = [255, 255, 255, 1];\n    color = color || white;\n    if (!this.shaderProgram) {\n      return;\n    }\n\n    const vertexPositionAttribute = vertexPositionAttributes.get(this.shaderProgram);\n    const textureCoordAttribute = textureCoordAttributes.get(this.shaderProgram);\n    const vertexColorAttribute = vertexColorAttributes.get(this.shaderProgram);\n    if (typeof vertexPositionAttribute !== 'undefined') {\n      this.setVertexAttribute(vertexPositionAttribute, vertices, 3);\n    }\n    if (typeof textureCoordAttribute !== 'undefined') {\n      this.setVertexAttribute(textureCoordAttribute, [0, 1, 1, 1, 1, 0, 0, 0], 2);\n    }\n    if (typeof vertexColorAttribute !== 'undefined') {\n      this.setVertexAttribute(vertexColorAttribute, this.makeColorsArray(color), color.length);\n    }\n\n    if (!gl) {\n      return;\n    }\n\n    const samplerUniform = uniformSamplerLocations.get(this.shaderProgram);\n    if (texture) {\n      if (samplerUniform) {\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.uniform1i(samplerUniform, 0);\n      }\n    } else if (this.whiteTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, this.whiteTexture);\n    }\n\n    const numberOfVertices = vertices.length / 3;\n    gl.drawArrays(mode, 0, numberOfVertices);\n  }\n\n  private drawTexture(vertices: number[], texture: WebGLTexture, color?: number[]): void {\n    if (!this.gl) {\n      return;\n    }\n\n    this.drawRectangle(vertices, this.gl.TRIANGLE_FAN, color, texture);\n  }\n\n  private drawViewportAndChrome(): void {\n    if (!this.layerTree) {\n      return;\n    }\n\n    const viewport = this.layerTree.viewportSize();\n    if (!viewport) {\n      return;\n    }\n\n    const drawChrome = !Common.Settings.Settings.instance().moduleSetting('frame-viewer-hide-chrome-window').get() &&\n        this.chromeTextures.length >= 3 && this.chromeTextures.indexOf(undefined) < 0;\n    const z = (this.maxDepth + 1) * LayerSpacing;\n    const borderWidth = Math.ceil(ViewportBorderWidth * this.scale);\n    let vertices: number[] = [viewport.width, 0, z, viewport.width, viewport.height, z, 0, viewport.height, z, 0, 0, z];\n    if (!this.gl) {\n      return;\n    }\n\n    this.gl.lineWidth(borderWidth);\n    this.drawRectangle(vertices, drawChrome ? this.gl.LINE_STRIP : this.gl.LINE_LOOP, ViewportBorderColor);\n\n    if (!drawChrome) {\n      return;\n    }\n\n    const viewportSize = this.layerTree.viewportSize();\n    if (!viewportSize) {\n      return;\n    }\n\n    const borderAdjustment = ViewportBorderWidth / 2;\n    const viewportWidth = viewportSize.width + 2 * borderAdjustment;\n    if (this.chromeTextures[0] && this.chromeTextures[2]) {\n      const chromeTextureImage = imageForTexture.get(this.chromeTextures[0]) || {naturalHeight: 0, naturalWidth: 0};\n      const chromeHeight = chromeTextureImage.naturalHeight;\n\n      const middleTextureImage = imageForTexture.get(this.chromeTextures[2]) || {naturalHeight: 0, naturalWidth: 0};\n      const middleFragmentWidth = viewportWidth - chromeTextureImage.naturalWidth - middleTextureImage.naturalWidth;\n      let x = -borderAdjustment;\n      const y = -chromeHeight;\n      for (let i = 0; i < this.chromeTextures.length; ++i) {\n        const texture = this.chromeTextures[i];\n        if (!texture) {\n          continue;\n        }\n\n        const image = imageForTexture.get(texture);\n        if (!image) {\n          continue;\n        }\n        const width = i === ChromeTexture.MIDDLE ? middleFragmentWidth : image.naturalWidth;\n        if (width < 0 || x + width > viewportWidth) {\n          break;\n        }\n        vertices = [x, y, z, x + width, y, z, x + width, y + chromeHeight, z, x, y + chromeHeight, z];\n        this.drawTexture(vertices, this.chromeTextures[i] as WebGLTexture);\n        x += width;\n      }\n    }\n  }\n\n  private drawViewRect(rect: Rectangle): void {\n    if (!this.gl) {\n      return;\n    }\n\n    const vertices = rect.vertices;\n    if (rect.texture) {\n      this.drawTexture(vertices, rect.texture, rect.fillColor || undefined);\n    } else if (rect.fillColor) {\n      this.drawRectangle(vertices, this.gl.TRIANGLE_FAN, rect.fillColor);\n    }\n    this.gl.lineWidth(rect.lineWidth);\n    if (rect.borderColor) {\n      this.drawRectangle(vertices, this.gl.LINE_LOOP, rect.borderColor);\n    }\n  }\n\n  update(): void {\n    if (!this.isShowing()) {\n      this.needsUpdate = true;\n      return;\n    }\n    // Debounce into the next frame (double rAF).\n    // Without this the GPU work can pile up without any backpressure.\n    // A single rAF might be fine, but the GPU work here is so heavy, we prefer\n    // the extra breathing room over lower latency\n    if (!this.updateScheduled) {\n      this.updateScheduled = true;\n      requestAnimationFrame(() => requestAnimationFrame(() => {\n                              this.updateScheduled = false;\n                              this.#update();\n                            }));\n    }\n  }\n\n  #update(): void {\n    if (!this.layerTree?.root()) {\n      this.failBanner.show(this.contentElement);\n      return;\n    }\n    const gl = this.initGLIfNecessary();\n    if (!gl) {\n      this.failBanner.detach();\n      this.failBanner = this.webglDisabledBanner();\n      this.failBanner.show(this.contentElement);\n      return;\n    }\n    this.failBanner.detach();\n    const viewportWidth = this.canvasElement.width;\n    const viewportHeight = this.canvasElement.height;\n\n    this.calculateDepthsAndVisibility();\n    this.calculateRects();\n    this.updateTransformAndConstraints();\n\n    gl.viewport(0, 0, viewportWidth, viewportHeight);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    this.rects.forEach(this.drawViewRect.bind(this));\n    this.drawViewportAndChrome();\n  }\n\n  private webglDisabledBanner(): UI.EmptyWidget.EmptyWidget {\n    const emptyWidget = new UI.EmptyWidget.EmptyWidget(\n        i18nString(UIStrings.cantDisplayLayers), i18nString(UIStrings.webglSupportIsDisabledInYour));\n    emptyWidget.contentElement.appendChild(uiI18n.getFormatLocalizedString(\n        str_, UIStrings.checkSForPossibleReasons,\n        {PH1: UI.XLink.XLink.create('about:gpu', undefined, undefined, undefined, 'about-gpu')}));\n    return emptyWidget;\n  }\n\n  private selectionFromEventPoint(event: Event): Selection|null {\n    const mouseEvent = event as MouseEvent;\n    if (!this.layerTree) {\n      return null;\n    }\n    let closestIntersectionPoint = Infinity;\n    let closestObject: Selection|null = null;\n    const projectionMatrix =\n        new WebKitCSSMatrix().scale(1, -1, -1).translate(-1, -1, 0).multiply(this.projectionMatrix);\n    const x0 = (mouseEvent.clientX - this.canvasElement.getBoundingClientRect().left) * window.devicePixelRatio;\n    const y0 = -(mouseEvent.clientY - this.canvasElement.getBoundingClientRect().top) * window.devicePixelRatio;\n\n    function checkIntersection(rect: Rectangle): void {\n      if (!rect.relatedObject) {\n        return;\n      }\n      const t = rect.intersectWithLine(projectionMatrix, x0, y0);\n      if (t && t < closestIntersectionPoint) {\n        closestIntersectionPoint = t;\n        closestObject = rect.relatedObject;\n      }\n    }\n\n    this.rects.forEach(checkIntersection);\n    return closestObject;\n  }\n\n  private createVisibilitySetting(\n      caption: Common.UIString.LocalizedString, name: string, value: boolean,\n      toolbar: UI.Toolbar.Toolbar): Common.Settings.Setting<boolean> {\n    const setting = Common.Settings.Settings.instance().createSetting(name, value);\n    setting.setTitle(caption);\n    setting.addChangeListener(this.update, this);\n    toolbar.appendToolbarItem(new UI.Toolbar.ToolbarSettingCheckbox(setting));\n    return setting;\n  }\n\n  private initToolbar(): void {\n    this.panelToolbar = this.transformController.toolbar();\n    this.contentElement.appendChild(this.panelToolbar);\n    this.showPaintsSetting = this.createVisibilitySetting(\n        i18nString(UIStrings.paints), 'frame-viewer-show-paints', false, this.panelToolbar);\n    this.showSlowScrollRectsSetting = this.createVisibilitySetting(\n        i18nString(UIStrings.slowScrollRects), 'frame-viewer-show-slow-scroll-rects', true, this.panelToolbar);\n    this.showPaintsSetting.addChangeListener(this.updatePaints, this);\n    Common.Settings.Settings.instance()\n        .moduleSetting('frame-viewer-hide-chrome-window')\n        .addChangeListener(this.update, this);\n  }\n\n  private onContextMenu(event: Event): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(\n        i18nString(UIStrings.resetView), () => this.transformController.resetAndNotify(), {\n          jslogContext: 'layers.3d-center',\n        });\n    const selection = this.selectionFromEventPoint(event);\n    if (selection && selection.type() === Type.SNAPSHOT) {\n      contextMenu.defaultSection().appendItem(\n          i18nString(UIStrings.showPaintProfiler),\n          () => this.dispatchEventToListeners(Events.PAINT_PROFILER_REQUESTED, selection), {\n            jslogContext: 'layers.paint-profiler',\n          });\n    }\n    this.layerViewHost.showContextMenu(contextMenu, selection);\n  }\n\n  private onMouseMove(event: Event): void {\n    const mouseEvent = event as MouseEvent;\n    if (mouseEvent.which) {\n      return;\n    }\n    this.layerViewHost.hoverObject(this.selectionFromEventPoint(event));\n  }\n\n  private onMouseDown(event: Event): void {\n    const mouseEvent = event as MouseEvent;\n    this.mouseDownX = mouseEvent.clientX;\n    this.mouseDownY = mouseEvent.clientY;\n  }\n\n  private onMouseUp(event: Event): void {\n    const mouseEvent = event as MouseEvent;\n    const maxDistanceInPixels = 6;\n    if (this.mouseDownX && Math.abs(mouseEvent.clientX - this.mouseDownX) < maxDistanceInPixels &&\n        Math.abs(mouseEvent.clientY - (this.mouseDownY || 0)) < maxDistanceInPixels) {\n      this.canvasElement.focus();\n      this.layerViewHost.selectObject(this.selectionFromEventPoint(event));\n    }\n    delete this.mouseDownX;\n    delete this.mouseDownY;\n  }\n\n  private onDoubleClick(event: Event): void {\n    const selection = this.selectionFromEventPoint(event);\n    if (selection && (selection.type() === Type.SNAPSHOT || selection.layer())) {\n      this.dispatchEventToListeners(Events.PAINT_PROFILER_REQUESTED, selection);\n    }\n    event.stopPropagation();\n  }\n\n  private updatePaints(): void {\n    if (this.showPaints()) {\n      this.textureManager.setLayerTree(this.layerTree);\n      this.textureManager.forceUpdate();\n    } else {\n      this.textureManager.reset();\n    }\n    this.update();\n  }\n\n  private showPaints(): boolean {\n    return this.showPaintsSetting ? this.showPaintsSetting.get() : false;\n  }\n}\n\nexport enum OutlineType {\n  /* eslint-disable @typescript-eslint/naming-convention -- Used by web_tests. */\n  Hovered = 'hovered',\n  Selected = 'selected',\n  /* eslint-enable @typescript-eslint/naming-convention */\n}\n\nexport const enum Events {\n  PAINT_PROFILER_REQUESTED = 'PaintProfilerRequested',\n  SCALE_CHANGED = 'ScaleChanged',\n}\n\nexport interface EventTypes {\n  [Events.PAINT_PROFILER_REQUESTED]: Selection;\n  [Events.SCALE_CHANGED]: number;\n}\n\nexport const enum ChromeTexture {\n  LEFT = 0,\n  MIDDLE = 1,\n  RIGHT = 2,\n}\n\nexport const FragmentShader = '' +\n    'precision mediump float;\\n' +\n    'varying vec4 vColor;\\n' +\n    'varying vec2 vTextureCoord;\\n' +\n    'uniform sampler2D uSampler;\\n' +\n    'void main(void)\\n' +\n    '{\\n' +\n    '    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * vColor;\\n' +\n    '}';\n\nexport const VertexShader = '' +\n    'attribute vec3 aVertexPosition;\\n' +\n    'attribute vec2 aTextureCoord;\\n' +\n    'attribute vec4 aVertexColor;\\n' +\n    'uniform mat4 uPMatrix;\\n' +\n    'varying vec2 vTextureCoord;\\n' +\n    'varying vec4 vColor;\\n' +\n    'void main(void)\\n' +\n    '{\\n' +\n    'gl_Position = uPMatrix * vec4(aVertexPosition, 1.0);\\n' +\n    'vColor = aVertexColor;\\n' +\n    'vTextureCoord = aTextureCoord;\\n' +\n    '}';\n\nexport const HoveredBorderColor = [0, 0, 255, 1];\nexport const SelectedBorderColor = [0, 255, 0, 1];\nexport const BorderColor = [0, 0, 0, 1];\nexport const ViewportBorderColor = [160, 160, 160, 1];\nexport const ScrollRectBackgroundColor = [178, 100, 100, 0.6];\nexport const HoveredImageMaskColor = [200, 200, 255, 1];\nexport const BorderWidth = 1;\nexport const SelectedBorderWidth = 2;\nexport const ViewportBorderWidth = 3;\n\nexport const LayerSpacing = 20;\nexport const ScrollRectSpacing = 4;\n\nexport class LayerTextureManager {\n  private readonly textureUpdatedCallback: () => void;\n  private readonly throttler: Common.Throttler.Throttler;\n  private scale: number;\n  private active: boolean;\n  private queue!: SDK.LayerTreeBase.Layer[];\n  private tilesByLayer!: Map<SDK.LayerTreeBase.Layer, Tile[]>;\n  private gl?: WebGLRenderingContext;\n  constructor(textureUpdatedCallback: () => void) {\n    this.textureUpdatedCallback = textureUpdatedCallback;\n    this.throttler = new Common.Throttler.Throttler(0);\n    this.scale = 0;\n    this.active = false;\n    this.reset();\n  }\n\n  static createTextureForImage(gl: WebGLRenderingContext|null, image: HTMLImageElement): WebGLTexture {\n    if (!gl) {\n      throw new Error('WebGLRenderingContext not provided');\n    }\n    const texture = gl.createTexture();\n    if (!texture) {\n      throw new Error('Unable to create texture');\n    }\n\n    imageForTexture.set(texture, image);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return texture;\n  }\n\n  reset(): void {\n    if (this.tilesByLayer) {\n      this.setLayerTree(null);\n    }\n\n    this.tilesByLayer = new Map();\n    this.queue = [];\n  }\n\n  setContext(glContext: WebGLRenderingContext): void {\n    this.gl = glContext;\n    if (this.scale) {\n      this.updateTextures();\n    }\n  }\n\n  suspend(): void {\n    this.active = false;\n  }\n\n  resume(): void {\n    this.active = true;\n    if (this.queue.length) {\n      void this.update();\n    }\n  }\n\n  setLayerTree(layerTree: SDK.LayerTreeBase.LayerTreeBase|null): void {\n    const newLayers = new Set<SDK.LayerTreeBase.Layer>();\n    const oldLayers = Array.from(this.tilesByLayer.keys());\n    if (layerTree) {\n      layerTree.forEachLayer(layer => {\n        if (!layer.drawsContent()) {\n          return;\n        }\n        newLayers.add(layer);\n        if (!this.tilesByLayer.has(layer)) {\n          this.tilesByLayer.set(layer, []);\n          this.layerNeedsUpdate(layer);\n        }\n      });\n    }\n    if (!oldLayers.length) {\n      this.forceUpdate();\n    }\n    for (const layer of oldLayers) {\n      if (newLayers.has(layer)) {\n        continue;\n      }\n      const tiles = this.tilesByLayer.get(layer);\n      if (tiles) {\n        tiles.forEach(tile => tile.dispose());\n      }\n      this.tilesByLayer.delete(layer);\n    }\n  }\n\n  private setSnapshotsForLayer(layer: SDK.LayerTreeBase.Layer, snapshots: SDK.PaintProfiler.SnapshotWithRect[]):\n      Promise<void> {\n    const oldSnapshotsToTiles = new Map((this.tilesByLayer.get(layer) || []).map(tile => [tile.snapshot, tile]));\n    const newTiles = [];\n    const reusedTiles = [];\n    for (const snapshot of snapshots) {\n      const oldTile = oldSnapshotsToTiles.get(snapshot.snapshot);\n      if (oldTile) {\n        reusedTiles.push(oldTile);\n        oldSnapshotsToTiles.delete(snapshot.snapshot);\n      } else {\n        newTiles.push(new Tile(snapshot));\n      }\n    }\n    this.tilesByLayer.set(layer, reusedTiles.concat(newTiles));\n    for (const tile of oldSnapshotsToTiles.values()) {\n      tile.dispose();\n    }\n    const gl = this.gl;\n    if (!gl || !this.scale) {\n      return Promise.resolve();\n    }\n    return Promise.all(newTiles.map(tile => tile.update(gl, this.scale))).then(this.textureUpdatedCallback);\n  }\n\n  setScale(scale: number): void {\n    if (this.scale && this.scale >= scale) {\n      return;\n    }\n    this.scale = scale;\n    this.updateTextures();\n  }\n\n  tilesForLayer(layer: SDK.LayerTreeBase.Layer): Tile[] {\n    return this.tilesByLayer.get(layer) || [];\n  }\n\n  layerNeedsUpdate(layer: SDK.LayerTreeBase.Layer): void {\n    if (this.queue.indexOf(layer) < 0) {\n      this.queue.push(layer);\n    }\n    if (this.active) {\n      void this.throttler.schedule(this.update.bind(this));\n    }\n  }\n\n  forceUpdate(): void {\n    this.queue.forEach(layer => this.updateLayer(layer));\n    this.queue = [];\n    void this.update();\n  }\n\n  private update(): Promise<void> {\n    const layer = this.queue.shift();\n    if (!layer) {\n      return Promise.resolve();\n    }\n    if (this.queue.length) {\n      void this.throttler.schedule(this.update.bind(this));\n    }\n    return this.updateLayer(layer);\n  }\n\n  private updateLayer(layer: SDK.LayerTreeBase.Layer): Promise<void> {\n    return Promise.all(layer.snapshots())\n        .then(snapshots => this.setSnapshotsForLayer(layer, snapshots.filter(snapshot => snapshot !== null)));\n  }\n\n  private updateTextures(): void {\n    if (!this.gl) {\n      return;\n    }\n    if (!this.scale) {\n      return;\n    }\n\n    for (const tiles of this.tilesByLayer.values()) {\n      for (const tile of tiles) {\n        const promise = tile.updateScale(this.gl, this.scale);\n        if (promise) {\n          void promise.then(this.textureUpdatedCallback);\n        }\n      }\n    }\n  }\n}\n\nexport class Rectangle {\n  relatedObject: Selection|null;\n  lineWidth: number;\n  borderColor: number[]|null;\n  fillColor: number[]|null;\n  texture: WebGLTexture|null;\n  vertices!: number[];\n  constructor(relatedObject: Selection|null) {\n    this.relatedObject = relatedObject;\n    this.lineWidth = 1;\n    this.borderColor = null;\n    this.fillColor = null;\n    this.texture = null;\n  }\n\n  setVertices(quad: number[], z: number): void {\n    this.vertices = [quad[0], quad[1], z, quad[2], quad[3], z, quad[4], quad[5], z, quad[6], quad[7], z];\n  }\n\n  /**\n   * Finds coordinates of point on layer quad, having offsets (ratioX * width) and (ratioY * height)\n   * from the left corner of the initial layer rect, where width and heigth are layer bounds.\n   */\n  private calculatePointOnQuad(quad: number[], ratioX: number, ratioY: number): number[] {\n    const x0 = quad[0];\n    const y0 = quad[1];\n    const x1 = quad[2];\n    const y1 = quad[3];\n    const x2 = quad[4];\n    const y2 = quad[5];\n    const x3 = quad[6];\n    const y3 = quad[7];\n    // Point on the first quad side clockwise\n    const firstSidePointX = x0 + ratioX * (x1 - x0);\n    const firstSidePointY = y0 + ratioX * (y1 - y0);\n    // Point on the third quad side clockwise\n    const thirdSidePointX = x3 + ratioX * (x2 - x3);\n    const thirdSidePointY = y3 + ratioX * (y2 - y3);\n    const x = firstSidePointX + ratioY * (thirdSidePointX - firstSidePointX);\n    const y = firstSidePointY + ratioY * (thirdSidePointY - firstSidePointY);\n    return [x, y];\n  }\n\n  calculateVerticesFromRect(layer: SDK.LayerTreeBase.Layer, rect: Protocol.DOM.Rect, z: number): void {\n    const quad = layer.quad();\n    const rx1 = rect.x / layer.width();\n    const rx2 = (rect.x + rect.width) / layer.width();\n    const ry1 = rect.y / layer.height();\n    const ry2 = (rect.y + rect.height) / layer.height();\n    const rectQuad = this.calculatePointOnQuad(quad, rx1, ry1)\n                         .concat(this.calculatePointOnQuad(quad, rx2, ry1))\n                         .concat(this.calculatePointOnQuad(quad, rx2, ry2))\n                         .concat(this.calculatePointOnQuad(quad, rx1, ry2));\n    this.setVertices(rectQuad, z);\n  }\n\n  /**\n   * Intersects quad with given transform matrix and line l(t) = (x0, y0, t)\n   */\n  intersectWithLine(matrix: DOMMatrix, x0: number, y0: number): number|undefined {\n    let i;\n    // Vertices of the quad with transform matrix applied\n    const points = [];\n    for (i = 0; i < 4; ++i) {\n      points[i] = Geometry.multiplyVectorByMatrixAndNormalize(\n          new Geometry.Vector(this.vertices[i * 3], this.vertices[i * 3 + 1], this.vertices[i * 3 + 2]), matrix);\n    }\n    // Calculating quad plane normal\n    const normal =\n        Geometry.crossProduct(Geometry.subtract(points[1], points[0]), Geometry.subtract(points[2], points[1]));\n    // General form of the equation of the quad plane: A * x + B * y + C * z + D = 0\n    const A = normal.x;\n    const B = normal.y;\n    const C = normal.z;\n    const D = -(A * points[0].x + B * points[0].y + C * points[0].z);\n    // Finding t from the equation\n    const t = -(D + A * x0 + B * y0) / C;\n    // Point of the intersection\n    const pt = new Geometry.Vector(x0, y0, t);\n    // Vectors from the intersection point to vertices of the quad\n    const tVects = points.map(Geometry.subtract.bind(null, pt));\n    // Intersection point lies inside of the polygon if scalar products of normal of the plane and\n    // cross products of successive tVects are all nonstrictly above or all nonstrictly below zero\n    for (i = 0; i < tVects.length; ++i) {\n      const product = Geometry.scalarProduct(normal, Geometry.crossProduct(tVects[i], tVects[(i + 1) % tVects.length]));\n      if (product < 0) {\n        return undefined;\n      }\n    }\n    return t;\n  }\n}\n\nexport class Tile {\n  snapshot: SDK.PaintProfiler.PaintProfilerSnapshot;\n  rect: Protocol.DOM.Rect;\n  scale: number;\n  texture: WebGLTexture|null;\n  private gl!: WebGLRenderingContext;\n  constructor(snapshotWithRect: SDK.PaintProfiler.SnapshotWithRect) {\n    this.snapshot = snapshotWithRect.snapshot;\n    this.rect = snapshotWithRect.rect;\n    this.scale = 0;\n    this.texture = null;\n  }\n\n  dispose(): void {\n    this.snapshot.release();\n    if (this.texture) {\n      this.gl.deleteTexture(this.texture);\n      this.texture = null;\n    }\n  }\n\n  updateScale(glContext: WebGLRenderingContext, scale: number): Promise<void>|null {\n    if (this.texture && this.scale >= scale) {\n      return null;\n    }\n    return this.update(glContext, scale);\n  }\n\n  async update(glContext: WebGLRenderingContext, scale: number): Promise<void> {\n    this.gl = glContext;\n    this.scale = scale;\n    const imageURL = await this.snapshot.replay(scale);\n    const image = imageURL ? await UI.UIUtils.loadImage(imageURL) : null;\n    this.texture = image ? LayerTextureManager.createTextureForImage(glContext, image) : null;\n  }\n}\n"]}