{"version":3,"file":"LinearMemoryValueInterpreter.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/linear_memory_inspector/components/LinearMemoryValueInterpreter.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../ui/kit/kit.js';\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport linearMemoryValueInterpreterStyles from './linearMemoryValueInterpreter.css.js';\nimport {ValueInterpreterDisplay} from './ValueInterpreterDisplay.js';\nimport {Endianness, type ValueType, type ValueTypeMode} from './ValueInterpreterDisplayUtils.js';\nimport {ValueInterpreterSettings} from './ValueInterpreterSettings.js';\n\nconst UIStrings = {\n  /**\n   * @description Tooltip text that appears when hovering over the gear button to open and close settings in the Linear memory inspector. These settings\n   *             allow the user to change the value type to view, such as 32-bit Integer, or 32-bit Float.\n   */\n  toggleValueTypeSettings: 'Toggle value type settings',\n  /**\n   * @description Tooltip text that appears when hovering over the 'Little Endian' or 'Big Endian' setting in the Linear memory inspector.\n   */\n  changeEndianness: 'Change `Endianness`',\n} as const;\nconst str_ =\n    i18n.i18n.registerUIStrings('panels/linear_memory_inspector/components/LinearMemoryValueInterpreter.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst {render, html} = Lit;\nconst {widgetConfig} = UI.Widget;\n\nexport interface LinearMemoryValueInterpreterData {\n  value: ArrayBuffer;\n  valueTypes: Set<ValueType>;\n  endianness: Endianness;\n  valueTypeModes?: Map<ValueType, ValueTypeMode>;\n  memoryLength: number;\n  onValueTypeModeChange: (type: ValueType, mode: ValueTypeMode) => void;\n  onJumpToAddressClicked: (address: number) => void;\n  onEndiannessChanged: (endianness: Endianness) => void;\n  onValueTypeToggled: (type: ValueType, checked: boolean) => void;\n}\n\nexport class LinearMemoryValueInterpreter extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #onValueTypeModeChange: (type: ValueType, mode: ValueTypeMode) => void = () => {};\n  #onJumpToAddressClicked: (address: number) => void = () => {};\n  #onEndiannessChanged: (endianness: Endianness) => void = () => {};\n  #onValueTypeToggled: (type: ValueType, checked: boolean) => void = () => {};\n  #endianness = Endianness.LITTLE;\n  #buffer = new ArrayBuffer(0);\n  #valueTypes = new Set<ValueType>();\n  #valueTypeModeConfig = new Map<ValueType, ValueTypeMode>();\n  #memoryLength = 0;\n  #showSettings = false;\n\n  set data(data: LinearMemoryValueInterpreterData) {\n    this.#endianness = data.endianness;\n    this.#buffer = data.value;\n    this.#valueTypes = data.valueTypes;\n    this.#valueTypeModeConfig = data.valueTypeModes || new Map();\n    this.#memoryLength = data.memoryLength;\n    this.#onValueTypeModeChange = data.onValueTypeModeChange;\n    this.#onJumpToAddressClicked = data.onJumpToAddressClicked;\n    this.#onEndiannessChanged = data.onEndiannessChanged;\n    this.#onValueTypeToggled = data.onValueTypeToggled;\n    this.#render();\n  }\n\n  get onValueTypeModeChange(): (type: ValueType, mode: ValueTypeMode) => void {\n    return this.#onValueTypeModeChange;\n  }\n\n  set onValueTypeModeChange(value: (type: ValueType, mode: ValueTypeMode) => void) {\n    this.#onValueTypeModeChange = value;\n    this.#render();\n  }\n\n  get onJumpToAddressClicked(): (address: number) => void {\n    return this.#onJumpToAddressClicked;\n  }\n\n  set onJumpToAddressClicked(value: (address: number) => void) {\n    this.#onJumpToAddressClicked = value;\n    this.#render();\n  }\n\n  get onEndiannessChanged(): (endianness: Endianness) => void {\n    return this.#onEndiannessChanged;\n  }\n\n  set onEndiannessChanged(value: (endianness: Endianness) => void) {\n    this.#onEndiannessChanged = value;\n    this.#render();\n  }\n\n  get onValueTypeToggled(): (type: ValueType, checked: boolean) => void {\n    return this.#onValueTypeToggled;\n  }\n\n  set onValueTypeToggled(value: (type: ValueType, checked: boolean) => void) {\n    this.#onValueTypeToggled = value;\n    this.#render();\n  }\n\n  #render(): void {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <style>${UI.inspectorCommonStyles}</style>\n      <style>${linearMemoryValueInterpreterStyles}</style>\n      <div class=\"value-interpreter\">\n        <div class=\"settings-toolbar\">\n          ${this.#renderEndiannessSetting()}\n          <devtools-button data-settings=\"true\" class=\"toolbar-button ${this.#showSettings ? '' : 'disabled'}\"\n              title=${i18nString(UIStrings.toggleValueTypeSettings)} @click=${this.#onSettingsToggle}\n              jslog=${VisualLogging.toggleSubpane('linear-memory-inspector.toggle-value-settings').track({click: true})}\n              .iconName=${'gear'}\n              .toggledIconName=${'gear-filled'}\n              .toggleType=${Buttons.Button.ToggleType.PRIMARY}\n              .variant=${Buttons.Button.Variant.ICON_TOGGLE}\n          ></devtools-button>\n        </div>\n        <span class=\"divider\"></span>\n        <div>\n          ${this.#showSettings ?\n            html`\n              <devtools-widget .widgetConfig=${widgetConfig(ValueInterpreterSettings, {\n                valueTypes: this.#valueTypes, onToggle: this.#onValueTypeToggled })}>\n              </devtools-widget>` :\n            html`\n              <devtools-widget .widgetConfig=${widgetConfig(ValueInterpreterDisplay, {\n                  buffer: this.#buffer,\n                  valueTypes: this.#valueTypes,\n                  endianness: this.#endianness,\n                  valueTypeModes: this.#valueTypeModeConfig,\n                  memoryLength: this.#memoryLength,\n                  onValueTypeModeChange: this.#onValueTypeModeChange,\n                  onJumpToAddressClicked: this.#onJumpToAddressClicked,\n                })}>\n              </devtools-widget>`}\n        </div>\n      </div>\n    `,\n      this.#shadow, { host: this },\n    );\n    // clang-format on\n  }\n\n  #renderEndiannessSetting(): Lit.TemplateResult {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return html`\n    <label data-endianness-setting=\"true\" title=${i18nString(UIStrings.changeEndianness)}>\n      <select\n        jslog=${VisualLogging.dropDown('linear-memory-inspector.endianess').track({change: true})}\n        style=\"border: none;\"\n        data-endianness=\"true\" @change=${(e: Event) => this.#onEndiannessChanged((e.target as HTMLSelectElement).value as Endianness)}>\n        ${[Endianness.LITTLE, Endianness.BIG].map(endianness => {\n            return html`<option value=${endianness} .selected=${this.#endianness === endianness}\n            jslog=${VisualLogging.item(Platform.StringUtilities.toKebabCase(endianness)).track({click: true})}>${\n                i18n.i18n.lockedString(endianness)}</option>`;\n        })}\n      </select>\n    </label>\n    `;\n    // clang-format on\n  }\n\n  #onSettingsToggle(): void {\n    this.#showSettings = !this.#showSettings;\n    this.#render();\n  }\n}\n\ncustomElements.define('devtools-linear-memory-inspector-interpreter', LinearMemoryValueInterpreter);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-linear-memory-inspector-interpreter': LinearMemoryValueInterpreter;\n  }\n}\n"]}