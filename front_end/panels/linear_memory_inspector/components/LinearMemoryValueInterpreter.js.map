{"version":3,"file":"LinearMemoryValueInterpreter.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/linear_memory_inspector/components/LinearMemoryValueInterpreter.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/kit/kit.js';\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport linearMemoryValueInterpreterStyles from './linearMemoryValueInterpreter.css.js';\nimport {ValueInterpreterDisplay} from './ValueInterpreterDisplay.js';\nimport {Endianness, type ValueType, type ValueTypeMode} from './ValueInterpreterDisplayUtils.js';\nimport {ValueInterpreterSettings} from './ValueInterpreterSettings.js';\n\nconst UIStrings = {\n  /**\n   * @description Tooltip text that appears when hovering over the gear button to open and close settings in the Linear memory inspector. These settings\n   *             allow the user to change the value type to view, such as 32-bit Integer, or 32-bit Float.\n   */\n  toggleValueTypeSettings: 'Toggle value type settings',\n  /**\n   * @description Tooltip text that appears when hovering over the 'Little Endian' or 'Big Endian' setting in the Linear memory inspector.\n   */\n  changeEndianness: 'Change `Endianness`',\n} as const;\nconst str_ =\n    i18n.i18n.registerUIStrings('panels/linear_memory_inspector/components/LinearMemoryValueInterpreter.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst {render, html} = Lit;\nconst {widgetConfig} = UI.Widget;\n\nexport interface ViewInput {\n  endianness: Endianness;\n  buffer: ArrayBuffer;\n  valueTypes: Set<ValueType>;\n  valueTypeModes: Map<ValueType, ValueTypeMode>;\n  memoryLength: number;\n  showSettings: boolean;\n  onValueTypeModeChange: (type: ValueType, mode: ValueTypeMode) => void;\n  onJumpToAddressClicked: (address: number) => void;\n  onEndiannessChanged: (endianness: Endianness) => void;\n  onValueTypeToggled: (type: ValueType, checked: boolean) => void;\n  onSettingsToggle: () => void;\n}\n\nfunction renderEndiannessSetting(\n    onEndiannessChanged: (endianness: Endianness) => void, currentEndiannes: Endianness): Lit.TemplateResult {\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n    return html`\n    <label data-endianness-setting=\"true\" title=${i18nString(UIStrings.changeEndianness)}>\n      <select\n        jslog=${VisualLogging.dropDown('linear-memory-inspector.endianess').track({change: true})}\n        style=\"border: none;\"\n        data-endianness=\"true\" @change=${(e: Event) => onEndiannessChanged((e.target as HTMLSelectElement).value as Endianness)}>\n        ${[Endianness.LITTLE, Endianness.BIG].map(endianness => {\n            return html`<option value=${endianness} .selected=${currentEndiannes === endianness}\n            jslog=${VisualLogging.item(Platform.StringUtilities.toKebabCase(endianness)).track({click: true})}>${\n                i18n.i18n.lockedString(endianness)}</option>`;\n        })}\n      </select>\n    </label>\n    `;\n  // clang-format on\n}\n\nexport const DEFAULT_VIEW = (input: ViewInput, _output: undefined, target: HTMLElement): void => {\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n  render(html`\n    <style>${UI.inspectorCommonStyles}</style>\n    <style>${linearMemoryValueInterpreterStyles}</style>\n    <div class=\"value-interpreter\">\n      <div class=\"settings-toolbar\">\n        ${renderEndiannessSetting(input.onEndiannessChanged, input.endianness)}\n        <devtools-button data-settings=\"true\" class=\"toolbar-button ${input.showSettings ? '' : 'disabled'}\"\n            title=${i18nString(UIStrings.toggleValueTypeSettings)} @click=${input.onSettingsToggle}\n            jslog=${VisualLogging.toggleSubpane('linear-memory-inspector.toggle-value-settings').track({ click: true })}\n            .iconName=${'gear'}\n            .toggledIconName=${'gear-filled'}\n            .toggleType=${Buttons.Button.ToggleType.PRIMARY}\n            .variant=${Buttons.Button.Variant.ICON_TOGGLE}\n        ></devtools-button>\n      </div>\n      <span class=\"divider\"></span>\n      <div>\n        ${input.showSettings ?\n      html`\n            <devtools-widget .widgetConfig=${widgetConfig(ValueInterpreterSettings, {\n              valueTypes: input.valueTypes, onToggle: input.onValueTypeToggled\n            })}>\n            </devtools-widget>` :\n      html`\n            <devtools-widget .widgetConfig=${widgetConfig(ValueInterpreterDisplay, {\n              buffer: input.buffer,\n              valueTypes: input.valueTypes,\n              endianness: input.endianness,\n              valueTypeModes: input.valueTypeModes,\n              memoryLength: input.memoryLength,\n              onValueTypeModeChange: input.onValueTypeModeChange,\n              onJumpToAddressClicked: input.onJumpToAddressClicked,\n            })}>\n            </devtools-widget>`}\n      </div>\n    </div>\n  `,\n    target,\n  );\n  // clang-format on\n};\n\nexport type View = typeof DEFAULT_VIEW;\n\nexport class LinearMemoryValueInterpreter extends UI.Widget.Widget {\n  readonly #view: View;\n  #endianness = Endianness.LITTLE;\n  #buffer = new ArrayBuffer(0);\n  #valueTypes = new Set<ValueType>();\n  #valueTypeModeConfig = new Map<ValueType, ValueTypeMode>();\n  #memoryLength = 0;\n  #showSettings = false;\n  #onValueTypeModeChange: (type: ValueType, mode: ValueTypeMode) => void = () => {};\n  #onJumpToAddressClicked: (address: number) => void = () => {};\n  #onEndiannessChanged: (endianness: Endianness) => void = () => {};\n  #onValueTypeToggled: (type: ValueType, checked: boolean) => void = () => {};\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element);\n    this.#view = view;\n  }\n\n  set buffer(value: ArrayBuffer) {\n    this.#buffer = value;\n    this.requestUpdate();\n  }\n\n  get buffer(): ArrayBuffer {\n    return this.#buffer;\n  }\n\n  set valueTypes(value: Set<ValueType>) {\n    this.#valueTypes = value;\n    this.requestUpdate();\n  }\n\n  get valueTypes(): Set<ValueType> {\n    return this.#valueTypes;\n  }\n\n  set valueTypeModes(value: Map<ValueType, ValueTypeMode>) {\n    this.#valueTypeModeConfig = value;\n    this.requestUpdate();\n  }\n\n  get valueTypeModes(): Map<ValueType, ValueTypeMode> {\n    return this.#valueTypeModeConfig;\n  }\n\n  set endianness(value: Endianness) {\n    this.#endianness = value;\n    this.requestUpdate();\n  }\n\n  get endianness(): Endianness {\n    return this.#endianness;\n  }\n\n  set memoryLength(value: number) {\n    this.#memoryLength = value;\n    this.requestUpdate();\n  }\n\n  get memoryLength(): number {\n    return this.#memoryLength;\n  }\n\n  get onValueTypeModeChange(): (type: ValueType, mode: ValueTypeMode) => void {\n    return this.#onValueTypeModeChange;\n  }\n\n  set onValueTypeModeChange(value: (type: ValueType, mode: ValueTypeMode) => void) {\n    this.#onValueTypeModeChange = value;\n    this.requestUpdate();\n  }\n\n  get onJumpToAddressClicked(): (address: number) => void {\n    return this.#onJumpToAddressClicked;\n  }\n\n  set onJumpToAddressClicked(value: (address: number) => void) {\n    this.#onJumpToAddressClicked = value;\n    this.requestUpdate();\n  }\n\n  get onEndiannessChanged(): (endianness: Endianness) => void {\n    return this.#onEndiannessChanged;\n  }\n\n  set onEndiannessChanged(value: (endianness: Endianness) => void) {\n    this.#onEndiannessChanged = value;\n    this.performUpdate();\n  }\n\n  get onValueTypeToggled(): (type: ValueType, checked: boolean) => void {\n    return this.#onValueTypeToggled;\n  }\n\n  set onValueTypeToggled(value: (type: ValueType, checked: boolean) => void) {\n    this.#onValueTypeToggled = value;\n    this.performUpdate();\n  }\n\n  override performUpdate(): void {\n    const viewInput: ViewInput = {\n      endianness: this.#endianness,\n      buffer: this.#buffer,\n      valueTypes: this.#valueTypes,\n      valueTypeModes: this.#valueTypeModeConfig,\n      memoryLength: this.#memoryLength,\n      showSettings: this.#showSettings,\n      onValueTypeModeChange: this.#onValueTypeModeChange,\n      onJumpToAddressClicked: this.#onJumpToAddressClicked,\n      onEndiannessChanged: this.#onEndiannessChanged,\n      onValueTypeToggled: this.#onValueTypeToggled,\n      onSettingsToggle: this.#onSettingsToggle.bind(this),\n    };\n    this.#view(viewInput, undefined, this.contentElement);\n  }\n\n  #onSettingsToggle(): void {\n    this.#showSettings = !this.#showSettings;\n    this.requestUpdate();\n  }\n}\n"]}