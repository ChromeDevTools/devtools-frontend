{"version":3,"file":"RequestHeaderSection.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/network/components/RequestHeaderSection.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport * as NetworkForward from '../forward/forward.js';\n\nimport {EditingAllowedStatus, type HeaderDescriptor} from './HeaderSectionRow.js';\nimport requestHeaderSectionStyles from './RequestHeaderSection.css.js';\n\nconst {render, html} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Text that is usually a hyperlink to more documentation\n   */\n  learnMore: 'Learn more',\n  /**\n   * @description Message to explain lack of raw headers for a particular network request\n   */\n  provisionalHeadersAreShownDisableCache: 'Provisional headers are shown. Disable cache to see full headers.',\n  /**\n   * @description Tooltip to explain lack of raw headers for a particular network request\n   */\n  onlyProvisionalHeadersAre:\n      'Only provisional headers are available because this request was not sent over the network and instead was served from a local cache, which doesnâ€™t store the original request headers. Disable cache to see full request headers.',\n  /**\n   * @description Message to explain lack of raw headers for a particular network request\n   */\n  provisionalHeadersAreShown: 'Provisional headers are shown.',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/network/components/RequestHeaderSection.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface ViewInput {\n  headers: HeaderDescriptor[];\n  isProvisionalHeaders: boolean;\n  isRequestCached: boolean;\n}\n\nexport type View = (input: ViewInput, output: undefined, target: HTMLElement|ShadowRoot) => void;\n\nexport const DEFAULT_VIEW: View = (input, output, target) => {\n  const headers = input.headers;\n\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n  render(html`\n    <style>${requestHeaderSectionStyles}</style>\n    ${input.isProvisionalHeaders ? renderProvisionalHeadersWarning(input.isRequestCached) : Lit.nothing}\n    ${headers.map(header => html`\n      <devtools-header-section-row\n        .data=${{ header }}\n        jslog=${VisualLogging.item('request-header')}\n      ></devtools-header-section-row>\n    `)}\n  `, target);\n  // clang-format on\n};\n\nfunction renderProvisionalHeadersWarning(isRequestCached: boolean): Lit.LitTemplate {\n  let cautionText;\n  let cautionTitle = '';\n  if (isRequestCached) {\n    cautionText = i18nString(UIStrings.provisionalHeadersAreShownDisableCache);\n    cautionTitle = i18nString(UIStrings.onlyProvisionalHeadersAre);\n  } else {\n    cautionText = i18nString(UIStrings.provisionalHeadersAreShown);\n  }\n  // Disabled until https://crbug.com/1079231 is fixed.\n  // clang-format off\n  return html`\n    <div class=\"call-to-action\">\n      <div class=\"call-to-action-body\">\n        <div class=\"explanation\" title=${cautionTitle}>\n          <devtools-icon class=\"inline-icon medium\" name='warning-filled'>\n          </devtools-icon>\n          ${cautionText} <x-link href=\"https://developer.chrome.com/docs/devtools/network/reference/#provisional-headers\" class=\"link\">${i18nString(UIStrings.learnMore)}</x-link>\n        </div>\n      </div>\n    </div>\n  `;\n  // clang-format on\n}\n\nexport class RequestHeaderSection extends UI.Widget.Widget {\n  #request: Readonly<SDK.NetworkRequest.NetworkRequest>|null = null;\n  #headers: HeaderDescriptor[] = [];\n  #view: View;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  set toReveal(toReveal: {section: NetworkForward.UIRequestLocation.UIHeaderSection, header?: string}|undefined) {\n    if (!toReveal) {\n      return;\n    }\n    if (toReveal.section === NetworkForward.UIRequestLocation.UIHeaderSection.REQUEST) {\n      this.#headers.filter(header => header.name === toReveal.header?.toLowerCase()).forEach(header => {\n        header.highlight = true;\n      });\n    }\n\n    this.requestUpdate();\n  }\n\n  set request(request: Readonly<SDK.NetworkRequest.NetworkRequest>) {\n    this.#request = request;\n    this.#headers = this.#request.requestHeaders().map(header => ({\n                                                         name: Platform.StringUtilities.toLowerCaseString(header.name),\n                                                         value: header.value,\n                                                         valueEditable: EditingAllowedStatus.FORBIDDEN,\n                                                       }));\n    this.#headers.sort((a, b) => Platform.StringUtilities.compare(a.name, b.name));\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    if (!this.#request) {\n      return;\n    }\n    this.#view(\n        {\n          headers: this.#headers,\n          isProvisionalHeaders: this.#request.requestHeadersText() === undefined,\n          isRequestCached: this.#request.cached() || this.#request.cachedInMemory(),\n        },\n        undefined, this.contentElement);\n  }\n}\n"]}