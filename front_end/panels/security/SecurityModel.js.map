{"version":3,"file":"SecurityModel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/security/SecurityModel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as ProtocolProxyApi from '../../generated/protocol-proxy-api.js';\nimport * as Protocol from '../../generated/protocol.js';\n\nconst UIStrings = {\n  /**\n   * @description Text in Security Panel of the Security panel\n   */\n  theSecurityOfThisPageIsUnknown: 'The security of this page is unknown.',\n  /**\n   * @description Text in Security Panel of the Security panel\n   */\n  thisPageIsNotSecure: 'This page is not secure.',\n  /**\n   * @description Text in Security Panel of the Security panel\n   */\n  thisPageIsSecureValidHttps: 'This page is secure (valid HTTPS).',\n  /**\n   * @description Text in Security Panel of the Security panel\n   */\n  thisPageIsNotSecureBrokenHttps: 'This page is not secure (broken HTTPS).',\n  /**\n   * @description Description of an SSL cipher that contains a separate (bulk) cipher and MAC.\n   * @example {AES_256_CBC} PH1\n   * @example {HMAC-SHA1} PH2\n   */\n  cipherWithMAC: '{PH1} with {PH2}',\n  /**\n   * @description Description of an SSL Key and its Key Exchange Group.\n   * @example {ECDHE_RSA} PH1\n   * @example {X25519} PH2\n   */\n  keyExchangeWithGroup: '{PH1} with {PH2}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/security/SecurityModel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst i18nLazyString = i18n.i18n.getLazilyComputedLocalizedString.bind(undefined, str_);\n\nexport class SecurityModel extends SDK.SDKModel.SDKModel<EventTypes> {\n  private readonly dispatcher: SecurityDispatcher;\n  private readonly securityAgent: ProtocolProxyApi.SecurityApi;\n  constructor(target: SDK.Target.Target) {\n    super(target);\n    this.dispatcher = new SecurityDispatcher(this);\n    this.securityAgent = target.securityAgent();\n    target.registerSecurityDispatcher(this.dispatcher);\n    void this.securityAgent.invoke_enable();\n  }\n\n  resourceTreeModel(): SDK.ResourceTreeModel.ResourceTreeModel {\n    return this.target().model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n  }\n\n  networkManager(): SDK.NetworkManager.NetworkManager {\n    return this.target().model(SDK.NetworkManager.NetworkManager) as SDK.NetworkManager.NetworkManager;\n  }\n}\n\nexport function securityStateCompare(a: Protocol.Security.SecurityState, b: Protocol.Security.SecurityState): number {\n  const SECURITY_STATE_ORDER = [\n    Protocol.Security.SecurityState.Info,\n    Protocol.Security.SecurityState.InsecureBroken,\n    Protocol.Security.SecurityState.Insecure,\n    Protocol.Security.SecurityState.Neutral,\n    Protocol.Security.SecurityState.Secure,\n    // Unknown is max so that failed/cancelled requests don't overwrite the origin security state for successful requests,\n    // and so that failed/cancelled requests appear at the bottom of the origins list.\n    Protocol.Security.SecurityState.Unknown,\n  ];\n\n  return SECURITY_STATE_ORDER.indexOf(a) - SECURITY_STATE_ORDER.indexOf(b);\n}\n\nSDK.SDKModel.SDKModel.register(SecurityModel, {capabilities: SDK.Target.Capability.SECURITY, autostart: false});\n\nexport enum Events {\n  /* eslint-disable @typescript-eslint/naming-convention -- Used by web_tests. */\n  VisibleSecurityStateChanged = 'VisibleSecurityStateChanged',\n  /* eslint-enable @typescript-eslint/naming-convention */\n}\n\nexport interface EventTypes {\n  [Events.VisibleSecurityStateChanged]: PageVisibleSecurityState;\n}\n\nexport const SummaryMessages: Record<string, () => string> = {\n  [Protocol.Security.SecurityState.Unknown]: i18nLazyString(UIStrings.theSecurityOfThisPageIsUnknown),\n  [Protocol.Security.SecurityState.Insecure]: i18nLazyString(UIStrings.thisPageIsNotSecure),\n  [Protocol.Security.SecurityState.Neutral]: i18nLazyString(UIStrings.thisPageIsNotSecure),\n  [Protocol.Security.SecurityState.Secure]: i18nLazyString(UIStrings.thisPageIsSecureValidHttps),\n  [Protocol.Security.SecurityState.InsecureBroken]: i18nLazyString(UIStrings.thisPageIsNotSecureBrokenHttps),\n};\n\nexport class PageVisibleSecurityState {\n  securityState: Protocol.Security.SecurityState;\n  certificateSecurityState: CertificateSecurityState|null;\n  safetyTipInfo: SafetyTipInfo|null;\n  securityStateIssueIds: string[];\n  constructor(\n      securityState: Protocol.Security.SecurityState,\n      certificateSecurityState: Protocol.Security.CertificateSecurityState|null,\n      safetyTipInfo: Protocol.Security.SafetyTipInfo|null, securityStateIssueIds: string[]) {\n    this.securityState = securityState;\n    this.certificateSecurityState =\n        certificateSecurityState ? new CertificateSecurityState(certificateSecurityState) : null;\n    this.safetyTipInfo = safetyTipInfo ? new SafetyTipInfo(safetyTipInfo) : null;\n    this.securityStateIssueIds = securityStateIssueIds;\n  }\n}\n\nexport class CertificateSecurityState {\n  protocol: string;\n  keyExchange: string;\n  keyExchangeGroup: string|null;\n  cipher: string;\n  mac: string|null;\n  certificate: string[];\n  subjectName: string;\n  issuer: string;\n  validFrom: number;\n  validTo: number;\n  certificateNetworkError: string|null;\n  certificateHasWeakSignature: boolean;\n  certificateHasSha1Signature: boolean;\n  modernSSL: boolean;\n  obsoleteSslProtocol: boolean;\n  obsoleteSslKeyExchange: boolean;\n  obsoleteSslCipher: boolean;\n  obsoleteSslSignature: boolean;\n  constructor(certificateSecurityState: Protocol.Security.CertificateSecurityState) {\n    this.protocol = certificateSecurityState.protocol;\n    this.keyExchange = certificateSecurityState.keyExchange;\n    this.keyExchangeGroup = certificateSecurityState.keyExchangeGroup || null;\n    this.cipher = certificateSecurityState.cipher;\n    this.mac = certificateSecurityState.mac || null;\n    this.certificate = certificateSecurityState.certificate;\n    this.subjectName = certificateSecurityState.subjectName;\n    this.issuer = certificateSecurityState.issuer;\n    this.validFrom = certificateSecurityState.validFrom;\n    this.validTo = certificateSecurityState.validTo;\n    this.certificateNetworkError = certificateSecurityState.certificateNetworkError || null;\n    this.certificateHasWeakSignature = certificateSecurityState.certificateHasWeakSignature;\n    this.certificateHasSha1Signature = certificateSecurityState.certificateHasSha1Signature;\n    this.modernSSL = certificateSecurityState.modernSSL;\n    this.obsoleteSslProtocol = certificateSecurityState.obsoleteSslProtocol;\n    this.obsoleteSslKeyExchange = certificateSecurityState.obsoleteSslKeyExchange;\n    this.obsoleteSslCipher = certificateSecurityState.obsoleteSslCipher;\n    this.obsoleteSslSignature = certificateSecurityState.obsoleteSslSignature;\n  }\n\n  isCertificateExpiringSoon(): boolean {\n    const expiryDate = new Date(this.validTo * 1000).getTime();\n    return (expiryDate < new Date(Date.now()).setHours(48)) && (expiryDate > Date.now());\n  }\n\n  getKeyExchangeName(): string {\n    if (this.keyExchangeGroup) {\n      return this.keyExchange ?\n          i18nString(UIStrings.keyExchangeWithGroup, {PH1: this.keyExchange, PH2: this.keyExchangeGroup}) :\n          this.keyExchangeGroup;\n    }\n    return this.keyExchange;\n  }\n\n  getCipherFullName(): string {\n    return this.mac ? i18nString(UIStrings.cipherWithMAC, {PH1: this.cipher, PH2: this.mac}) : this.cipher;\n  }\n}\n\nclass SafetyTipInfo {\n  safetyTipStatus: string;\n  safeUrl: string|null;\n  constructor(safetyTipInfo: Protocol.Security.SafetyTipInfo) {\n    this.safetyTipStatus = safetyTipInfo.safetyTipStatus;\n    this.safeUrl = safetyTipInfo.safeUrl || null;\n  }\n}\n\nexport class SecurityStyleExplanation {\n  securityState: Protocol.Security.SecurityState;\n  title: string|undefined;\n  summary: string;\n  description: string;\n  certificate: string[];\n  mixedContentType: Protocol.Security.MixedContentType;\n  recommendations: string[];\n  constructor(\n      securityState: Protocol.Security.SecurityState, title: string|undefined, summary: string, description: string,\n      certificate: string[]|undefined = [],\n      mixedContentType: Protocol.Security.MixedContentType|undefined = Protocol.Security.MixedContentType.None,\n      recommendations: string[]|undefined = []) {\n    this.securityState = securityState;\n    this.title = title;\n    this.summary = summary;\n    this.description = description;\n    this.certificate = certificate;\n    this.mixedContentType = mixedContentType;\n    this.recommendations = recommendations;\n  }\n}\n\nclass SecurityDispatcher implements ProtocolProxyApi.SecurityDispatcher {\n  private readonly model: SecurityModel;\n  constructor(model: SecurityModel) {\n    this.model = model;\n  }\n\n  securityStateChanged(_event: Protocol.Security.SecurityStateChangedEvent): void {\n  }\n\n  visibleSecurityStateChanged({visibleSecurityState}: Protocol.Security.VisibleSecurityStateChangedEvent): void {\n    const pageVisibleSecurityState = new PageVisibleSecurityState(\n        visibleSecurityState.securityState, visibleSecurityState.certificateSecurityState || null,\n        visibleSecurityState.safetyTipInfo || null, visibleSecurityState.securityStateIssueIds);\n    this.model.dispatchEventToListeners(Events.VisibleSecurityStateChanged, pageVisibleSecurityState);\n  }\n\n  certificateError(_event: Protocol.Security.CertificateErrorEvent): void {\n  }\n}\n"]}