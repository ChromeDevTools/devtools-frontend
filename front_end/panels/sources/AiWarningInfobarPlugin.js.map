{"version":3,"file":"AiWarningInfobarPlugin.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/AiWarningInfobarPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport type * as TextEditor from '../../ui/components/text_editor/text_editor.js';\nimport * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {Plugin} from './Plugin.js';\n\nconst UIStrings = {\n  /**\n   * @description Infobar text announcing that the file contents have been changed by AI\n   */\n  aiContentWarning: 'This file contains AI-generated content',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/AiWarningInfobarPlugin.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AiWarningInfobarPlugin extends Plugin {\n  #editor: TextEditor.TextEditor.TextEditor|undefined = undefined;\n  #aiWarningInfobar: UI.Infobar.Infobar|null = null;\n\n  constructor(uiSourceCode: Workspace.UISourceCode.UISourceCode) {\n    super(uiSourceCode);\n    this.uiSourceCode.addEventListener(\n        Workspace.UISourceCode.Events.WorkingCopyCommitted, this.#onWorkingCopyCommitted, this);\n  }\n\n  override dispose(): void {\n    this.#aiWarningInfobar?.dispose();\n    this.#aiWarningInfobar = null;\n    this.uiSourceCode.removeEventListener(\n        Workspace.UISourceCode.Events.WorkingCopyCommitted, this.#onWorkingCopyCommitted, this);\n    super.dispose();\n  }\n\n  static override accepts(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return uiSourceCode.contentType().hasScripts() || uiSourceCode.contentType().hasStyleSheets();\n  }\n\n  override editorInitialized(editor: TextEditor.TextEditor.TextEditor): void {\n    this.#editor = editor;\n    if (this.uiSourceCode.containsAiChanges()) {\n      this.#showAiWarningInfobar();\n    }\n  }\n\n  #onWorkingCopyCommitted(): void {\n    if (!this.uiSourceCode.containsAiChanges()) {\n      this.#aiWarningInfobar?.dispose();\n      this.#aiWarningInfobar = null;\n    }\n  }\n\n  #showAiWarningInfobar(): void {\n    const infobar = new UI.Infobar.Infobar(\n        UI.Infobar.Type.WARNING, i18nString(UIStrings.aiContentWarning), undefined, undefined,\n        'contains-ai-content-warning');\n    this.#aiWarningInfobar = infobar;\n    infobar.setCloseCallback(() => this.removeInfobar(this.#aiWarningInfobar));\n    this.attachInfobar(this.#aiWarningInfobar);\n  }\n\n  attachInfobar(bar: UI.Infobar.Infobar): void {\n    if (this.#editor) {\n      this.#editor.dispatch({effects: SourceFrame.SourceFrame.addSourceFrameInfobar.of({element: bar.element})});\n    }\n  }\n\n  removeInfobar(bar: UI.Infobar.Infobar|null): void {\n    if (this.#editor && bar) {\n      this.#editor.dispatch({effects: SourceFrame.SourceFrame.removeSourceFrameInfobar.of({element: bar.element})});\n    }\n  }\n}\n"]}