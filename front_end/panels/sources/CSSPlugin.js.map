{"version":3,"file":"CSSPlugin.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/CSSPlugin.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAC7B,oDAAoD;AAEpD,OAAO,KAAK,MAAM,MAAM,6BAA6B,CAAC;AACtD,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAEhD,OAAO,EAAC,wBAAwB,EAAC,MAAM,iCAAiC,CAAC;AACzE,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAE7C,OAAO,KAAK,QAAQ,MAAM,mCAAmC,CAAC;AAC9D,OAAO,KAAK,QAAQ,MAAM,mCAAmC,CAAC;AAC9D,OAAO,KAAK,SAAS,MAAM,qCAAqC,CAAC;AACjE,OAAO,KAAK,UAAU,MAAM,sDAAsD,CAAC;AACnF,OAAO,KAAK,UAAU,MAAM,gDAAgD,CAAC;AAC7E,OAAO,KAAK,WAAW,MAAM,yDAAyD,CAAC;AACvF,OAAO,KAAK,YAAY,MAAM,2DAA2D,CAAC;AAE1F,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAChD,OAAO,KAAK,aAAa,MAAM,2CAA2C,CAAC;AAE3E,OAAO,EAAC,qBAAqB,EAAC,MAAM,4BAA4B,CAAC;AACjE,OAAO,EAAC,MAAM,EAAC,MAAM,aAAa,CAAC;AAEnC,oEAAoE;AACpE,+BAA+B;AAE/B,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,eAAe,EAAE,oBAAoB;IACrC;;OAEG;IACH,qBAAqB,EAAE,2BAA2B;IAClD;;OAEG;IACH,YAAY,EAAE,iBAAiB;CACvB,CAAC;AACX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,6BAA6B,EAAE,SAAS,CAAC,CAAC;AACnF,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAEtE,MAAM,eAAe,GAAG,IAAI,GAAG,CAAC,CAAC,cAAc,EAAE,eAAe,EAAE,eAAe,EAAE,SAAS,EAAE,WAAW,CAAC,CAAC,CAAC;AAE5G,SAAS,cAAc,CAAC,IAA2B,EAAE,GAAW;IAC9D,IAAI,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;QACnC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,KAAK,IAAI,GAAG,GAA+B,IAAI,EAAE,GAAG,EAAE,GAAG,GAAG,GAAG,CAAC,MAAM,EAAE,CAAC;QACvE,IAAI,GAAG,CAAC,IAAI,KAAK,YAAY,IAAI,GAAG,CAAC,IAAI,KAAK,QAAQ,IAAI,GAAG,CAAC,IAAI,KAAK,gBAAgB,EAAE,CAAC;YACxF,MAAM;QACR,CAAC;aAAM,IAAI,GAAG,CAAC,IAAI,KAAK,aAAa,EAAE,CAAC;YACtC,MAAM,IAAI,GAAG,GAAG,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YACrE,OAAO,IAAI,IAAI,KAAK,IAAI,KAAK,CAAC,EAAE,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC;QACxD,CAAC;IACH,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,SAAS,oBAAoB,CACzB,GAAoC,EAAE,QAA+B;IACvE,MAAM,iBAAiB,GAAG,QAAQ,CAAC,sBAAsB,CAAC,GAAG,CAAC,CAAC;IAC/D,IAAI,iBAAiB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACnC,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAC;IAChE,CAAC;IAED,OAAO,iBAAiB,CAAC,CAAC,CAAC,CAAC;AAC9B,CAAC;AAED,KAAK,UAAU,qBAAqB,CAChC,EAAgC,EAAE,YAAiD,EACnF,QAAyC;IAC3C,MAAM,IAAI,GAAG,UAAU,CAAC,UAAU,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC;IACtE,IAAI,IAAI,CAAC,IAAI,KAAK,WAAW,EAAE,CAAC;QAC9B,uDAAuD;QACvD,wBAAwB,CAAC,QAAQ,CAAC,CAAC;QAEnC,MAAM,iBAAiB,GAAG,oBAAoB,CAAC,YAAY,CAAC,GAAG,EAAE,EAAE,QAAQ,CAAC,CAAC;QAC7E,MAAM,kBAAkB,GAAG,MAAM,QAAQ,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;QAE3E,OAAO;YACL,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,OAAO,EAAE,kBAAkB,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAC,CAAC,CAAC;SAC7E,CAAC;IACJ,CAAC;IACD,MAAM,QAAQ,GAAG,cAAc,CAAC,IAAI,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;IAC9C,IAAI,QAAQ,EAAE,CAAC;QACb,MAAM,cAAc,GAChB,GAAG,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,iBAAiB,CAAC,EAAE,CAAC,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;QACnG,OAAO;YACL,IAAI,EAAE,IAAI,CAAC,IAAI,KAAK,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG;YACpD,OAAO,EAAE,cAAc,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,EAAC,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,KAAK,EAAC,CAAC,CAAC;YACxE,QAAQ,EAAE,qBAAqB;SAChC,CAAC;IACJ,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,SAAS,mBAAmB,CACxB,KAA6B,EAC7B,IAAY,EACZ,EAAU,EACV,OAA6E,EAC7E,OAAyE;IAE3E,IAAI,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAClC,SAAS,QAAQ,CAAC,IAAY,EAAE,EAAU;QACxC,IAAI,IAAI,IAAI,IAAI,CAAC,EAAE,EAAE,CAAC;YACpB,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;QACD,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC;IAC3D,CAAC;IAED,MAAM,IAAI,GAAG,UAAU,CAAC,gBAAgB,CAAC,KAAK,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;IACzD,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO;IACT,CAAC;IACD,IAAI,CAAC,OAAO,CAAC;QACX,IAAI;QACJ,EAAE;QACF,KAAK,EAAE,IAAI,CAAC,EAAE;YACZ,IAAI,OAAO,CAAC;YACZ,IAAI,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,IAAI,CAAC,IAAI,KAAK,cAAc,EAAE,CAAC;gBAC9D,OAAO,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;YACzC,CAAC;iBAAM,IACH,IAAI,CAAC,IAAI,KAAK,QAAQ;gBACtB,oEAAoE,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;gBAC5G,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAG,IAAI,CAAC,IAAI,CAAC,MAAgC,CAAC,EAAE,CAAC,CAAC;YACtF,CAAC;YACD,IAAI,OAAO,EAAE,CAAC;gBACZ,MAAM,WAAW,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;gBAChD,IAAI,WAAW,EAAE,CAAC;oBAChB,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,WAAW,EAAE,OAAO,CAAC,CAAC;gBAC3C,CAAC;qBAAM,CAAC;oBACN,MAAM,WAAW,GAAG,QAAQ,CAAC,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBACxD,IAAI,WAAW,EAAE,CAAC;wBAChB,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,WAAW,EAAE,OAAO,CAAC,CAAC;oBAC3C,CAAC;gBACH,CAAC;YACH,CAAC;QACH,CAAC;KACF,CAAC,CAAC;AACL,CAAC;AAED,MAAM,iBAAkB,SAAQ,UAAU,CAAC,UAAU;IACnD,KAAK,CAAS;IACd,MAAM,CAAqB;IAClB,KAAK,CAAS;IAEvB,YAAY,KAAyB,EAAE,IAAY,EAAE,IAAY;QAC/D,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACpB,CAAC;IAEQ,EAAE,CAAC,KAAwB;QAClC,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,CAAC,KAAK,CAAC;IACrG,CAAC;IAED,KAAK,CAAC,IAA2B;QAC/B,MAAM,MAAM,GAAG,IAAI,YAAY,CAAC,WAAW,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,CAAC;QAC/F,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAChC,MAAM,KAAK,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QACzC,KAAK,CAAC,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC;QAC/B,KAAK,CAAC,YAAY,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACrC,MAAM,CAAC,gBAAgB,CAAC,YAAY,CAAC,WAAW,CAAC,iBAAiB,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE;YACpF,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YACjF,IAAI,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,EAAC,EAAC,CAAC,CAAC;YACzF,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;YACpB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,EAAwB,CAAC;QACxD,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,gBAAgB,CAAC,YAAY,CAAC,WAAW,CAAC,uBAAuB,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE;YAC1F,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,EAAE,IAAI,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC;YACjF,IAAI,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE,EAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,EAAC,EAAC,CAAC,CAAC;YACzF,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;YACpB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,EAAwB,CAAC;QACxD,CAAC,CAAC,CAAC;QACH,MAAM,CAAC,gBAAgB,CAAC,YAAY,CAAC,WAAW,CAAC,UAAU,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE;YAC7E,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACpB,IAAI,CAAC,QAAQ,CAAC;gBACZ,OAAO,EAAE,UAAU,CAAC,EAAE,CAAC;oBACrB,IAAI,2BAAmB;oBACvB,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;oBAC1B,IAAI,EAAE,IAAI,CAAC,KAAK;oBAChB,MAAM;oBACN,KAAK,EAAE,IAAI,CAAC,MAAM;iBACnB,CAAC;aACH,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QACH,OAAO,MAAM,CAAC;IAChB,CAAC;IAEQ,WAAW;QAClB,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAED,MAAM,iBAAkB,SAAQ,UAAU,CAAC,UAAU;IAC9B;IAAsC;IAA3D,YAAqB,KAA2B,EAAW,IAAY;QACrE,KAAK,EAAE,CAAC;QADW,UAAK,GAAL,KAAK,CAAsB;QAAW,SAAI,GAAJ,IAAI,CAAQ;IAEvE,CAAC;IAEQ,EAAE,CAAC,KAAwB;QAClC,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,KAAK,CAAC,KAAK,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,CAAC;IACxF,CAAC;IAED,KAAK,CAAC,IAA2B;QAC/B,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACjD,MAAM,UAAU,GAAG,SAAS,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QACjD,MAAM,IAAI,GAAG,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,oBAAoB,CAAC,CAAC;QACjF,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,GAAG,aAAa,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QACzE,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7B,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,UAAU,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC,CAAC;QAC9E,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC,KAAiB,EAAE,EAAE;YACnD,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YACpB,IAAI,CAAC,QAAQ,CAAC;gBACZ,OAAO,EAAE,UAAU,CAAC,EAAE,CAAC;oBACrB,IAAI,2BAAmB;oBACvB,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;oBACxB,IAAI,EAAE,IAAI,CAAC,IAAI;oBACf,MAAM,EAAE,IAAI;oBACZ,KAAK,EAAE,IAAI,CAAC,KAAK;iBAClB,CAAC;aACH,CAAC,CAAC;QACL,CAAC,EAAE,KAAK,CAAC,CAAC;QACV,OAAO,IAAI,CAAC;IACd,CAAC;IAEQ,WAAW;QAClB,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAqBD,SAAS,gBAAgB,CAAC,MAAqB;IAC7C,OAAO;QACL,GAAG,EAAE,MAAM,CAAC,GAAG;QACf,KAAK,EAAE,KAAK;QACZ,MAAM,CAAC,IAAI;YACT,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;YACvB,IAAI,MAAsB,EAAE,WAA+D,CAAC;YAC5F,IAAI,MAAM,CAAC,IAAI,8BAAsB,EAAE,CAAC;gBACtC,MAAM,QAAQ,GAAG,IAAI,WAAW,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;gBACrD,WAAW,GAAG,OAAO,CAAC,EAAE;oBACtB,QAAQ,CAAC,gBAAgB,iEAA4C,OAAO,CAAC,CAAC;gBAChF,CAAC,CAAC;gBACF,QAAQ,CAAC,gBAAgB,+DAA2C,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC;gBACjG,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAChC,MAAM,GAAG,QAAQ,CAAC;YACpB,CAAC;iBAAM,CAAC;gBACN,MAAM,QAAQ,GAAG,IAAI,YAAY,CAAC,YAAY,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC1E,MAAM,GAAG,QAAQ,CAAC;gBAClB,WAAW,GAAG,OAAO,CAAC,EAAE;oBACtB,QAAQ,CAAC,gBAAgB,wEAAkD,OAAO,CAAC,CAAC;gBACtF,CAAC,CAAC;YACJ,CAAC;YACD,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC1C,GAAG,CAAC,SAAS,GAAG,uBAAuB,CAAC;YACxC,MAAM,CAAC,UAAU,EAAE,CAAC;YACpB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACjB,MAAM,CAAC,UAAU,EAAE,CAAC;YACpB,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE;gBACjD,IAAI,KAAK,CAAC,GAAG,KAAK,QAAQ,EAAE,CAAC;oBAC3B,KAAK,CAAC,OAAO,EAAE,CAAC;oBAChB,IAAI,CAAC,QAAQ,CAAC;wBACZ,OAAO,EAAE,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC;wBAC5B,OAAO,EAAE,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;4BACX,EAAC,IAAI,EAAE,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC,IAAI,EAAC;qBACtG,CAAC,CAAC;oBACH,MAAM,CAAC,UAAU,EAAE,CAAC;oBACpB,IAAI,CAAC,KAAK,EAAE,CAAC;gBACf,CAAC;YACH,CAAC,CAAC,CAAC;YACH,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,UAAU,EAAE,KAAK,CAAC,EAAE;gBAClD,IAAI,KAAK,CAAC,aAAa,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,aAAqB,CAAC,EAAE,CAAC;oBACjF,IAAI,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,EAAC,CAAC,CAAC;oBAC9C,MAAM,CAAC,UAAU,EAAE,CAAC;gBACtB,CAAC;YACH,CAAC,EAAE,KAAK,CAAC,CAAC;YACV,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,WAAW,EAAE,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;YACvE,OAAO;gBACL,GAAG;gBACH,MAAM,EAAE,KAAK;gBACb,MAAM,EAAE,EAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAC;gBACrB,KAAK,EAAE,GAAG,EAAE;oBACV,MAAM,CAAC,KAAK,EAAE,CAAC;oBACf,MAAM,CAAC,QAAQ,EAAE,CAAC;oBAClB,WAAW,CAAC,CAAC,KAAqB,EAAE,EAAE;wBACpC,IAAI,CAAC,QAAQ,CAAC;4BACZ,OAAO,EAAE,EAAC,IAAI,EAAE,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,KAAK,CAAC,IAAI,EAAC;4BAC7E,WAAW,EAAE,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC;yBACnC,CAAC,CAAC;wBACH,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;oBACpB,CAAC,CAAC,CAAC;gBACL,CAAC;aACF,CAAC;QACJ,CAAC;KACF,CAAC;AACJ,CAAC;AAED,MAAM,UAAU,GAAG,UAAU,CAAC,WAAW,CAAC,MAAM,EAAsB,CAAC;AAEvE,MAAM,YAAY,GAAG,UAAU,CAAC,UAAU,CAAC,MAAM,EAAW,CAAC;AAE7D,MAAM,eAAe,GAAG,UAAU,CAAC,UAAU,CAAC,MAAM,CAAqB;IACvE,MAAM;QACJ,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,CAAC,KAAyB,EAAE,EAA0B;QAEtD,IAAI,CAAC,EAAE,CAAC,UAAU,IAAI,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE,CAAC;YACpE,KAAK,GAAG,IAAI,CAAC;QACf,CAAC;QACD,KAAK,MAAM,MAAM,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;YAChC,IAAI,MAAM,CAAC,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC;gBAC1B,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;YACvB,CAAC;QACH,CAAC;QACD,OAAO,KAAK,CAAC;IACf,CAAC;IAEL,OAAO,EAAE,KAAK,CAAC,EAAE,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,IAAI,gBAAgB,CAAC,MAAM,CAAC,CAAC;CACnG,CAAC,CAAC;AAEH,SAAS,iBAAiB,CAAC,KAA6B,EAAE,IAAY,EAAE,EAAU;IAChF,MAAM,OAAO,GAAG,IAAI,UAAU,CAAC,eAAe,EAAyB,CAAC;IACxE,mBAAmB,CACf,KAAK,EAAE,IAAI,EAAE,EAAE,EACf,CAAC,GAAG,EAAE,WAAW,EAAE,SAAS,EAAE,EAAE;QAC9B,OAAO,CAAC,GAAG,CACP,GAAG,EAAE,GAAG,EAAE,UAAU,CAAC,UAAU,CAAC,MAAM,CAAC,EAAC,MAAM,EAAE,IAAI,iBAAiB,CAAC,WAAW,EAAE,SAAS,EAAE,GAAG,CAAC,EAAC,CAAC,CAAC,CAAC;IAC5G,CAAC,EACD,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,EAAE,EAAE;QACnB,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,UAAU,CAAC,UAAU,CAAC,MAAM,CAAC,EAAC,MAAM,EAAE,IAAI,iBAAiB,CAAC,KAAK,EAAE,IAAI,CAAC,EAAC,CAAC,CAAC,CAAC;IACpG,CAAC,CAAC,CAAC;IACP,OAAO,OAAO,CAAC,MAAM,EAAE,CAAC;AAC1B,CAAC;AAED,MAAM,eAAe,GAAG,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC;IACtD,WAAW,CAA2B;IAEtC,YAAY,IAA2B;QACrC,IAAI,CAAC,WAAW,GAAG,iBAAiB,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IACzF,CAAC;IAED,MAAM,CAAC,MAA6B;QAClC,IAAI,MAAM,CAAC,eAAe,IAAI,MAAM,CAAC,UAAU,EAAE,CAAC;YAChD,IAAI,CAAC,WAAW,GAAG,iBAAiB,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QACzG,CAAC;IACH,CAAC;CACF,EAAE;IACD,WAAW,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,WAAW;CAChC,CAAC,CAAC;AAEH,SAAS,WAAW;IAClB,OAAO,CAAC,eAAe,EAAE,eAAe,EAAE,KAAK,CAAC,CAAC;AACnD,CAAC;AAED,SAAS,WAAW,CAAC,IAA2B;IAC9C,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;QACzB,IAAI,GAAG,IAAI,CAAC,MAA+B,CAAC;IAC9C,CAAC;IACD,IAAI,IAAI,CAAC,IAAI,KAAK,eAAe,EAAE,CAAC;QAClC,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QACjC,OAAO,EAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,EAAE,SAAS,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,EAAC,CAAC;IAClG,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED,SAAS,UAAU,CAAC,IAA2B,EAAE,EAAU;IACzD,MAAM,EAAC,IAAI,EAAC,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC;IACzC,MAAM,OAAO,GAAG,UAAU,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;IACzE,MAAM,WAAW,GAAG,WAAW,CAAC,OAAO,CAAC,IAAI,WAAW,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;IAClF,IAAI,CAAC,WAAW,EAAE,CAAC;QACjB,OAAO,KAAK,CAAC;IACf,CAAC;IAED,MAAM,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;IACpF,IAAI,KAAK,CAAC,aAAa,CAAC,EAAE,CAAC;QACzB,OAAO,KAAK,CAAC;IACf,CAAC;IAED,IAAI,CAAC,QAAQ,CAAC;QACZ,OAAO,EAAE,EAAC,IAAI,EAAE,WAAW,CAAC,IAAI,EAAE,EAAE,EAAE,WAAW,CAAC,EAAE,EAAE,MAAM,EAAE,MAAM,CAAC,aAAa,GAAG,EAAE,CAAC,EAAC;QACzF,cAAc,EAAE,IAAI;QACpB,SAAS,EAAE,mBAAmB;KAC/B,CAAC,CAAC;IACH,OAAO,IAAI,CAAC;AACd,CAAC;AAED,MAAM,UAAU,WAAW;IACzB,kEAAkE;IAClE,iEAAiE;IACjE,IAAI,WAAW,GAA0B,IAAwC,CAAC;IAClF,MAAM,QAAQ,GAAG,EAAE,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,QAAQ,EAAE,CAAC,mBAAmB,CAAC;QACnF,uBAAuB,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAC1E,8BAA8B,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;QAClF,uBAAuB,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;QAC3E,8BAA8B,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC,EAAE,CAAC,CAAC;KACpF,CAAC,CAAC;IAEH,OAAO,UAAU,CAAC,UAAU,CAAC,gBAAgB,CAAC;QAC5C,OAAO,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE,EAAE;YACvB,MAAM,QAAQ,GAAG,WAAW,CAAC;YAC7B,WAAW,GAAG,IAAI,CAAC;YACnB,QAAQ,CAAC,KAAK,CAAC,CAAC;YAChB,WAAW,GAAG,QAAQ,CAAC;YACvB,OAAO,KAAK,CAAC,gBAAgB,CAAC;QAChC,CAAC;KACF,CAAC,CAAC;AACL,CAAC;AAED,MAAM,OAAO,SAAU,SAAQ,MAAM;IACnC,SAAS,CAAyB;IAElC,YAAY,YAAiD,EAAE,YAAkD;QAC/G,KAAK,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;QAClC,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IACxF,CAAC;IAED,MAAM,CAAU,OAAO,CAAC,YAAiD;QACvE,OAAO,YAAY,CAAC,WAAW,EAAE,CAAC,cAAc,EAAE,CAAC;IACrD,CAAC;IAED,UAAU,CAAC,QAA+B;QACxC,IAAI,QAAQ,CAAC,MAAM,EAAE,KAAK,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC,iBAAiB,EAAE,EAAE,CAAC;YACzF,OAAO;QACT,CAAC;QACD,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;IAC5B,CAAC;IACD,YAAY,CAAC,QAA+B;QAC1C,IAAI,IAAI,CAAC,SAAS,KAAK,QAAQ,EAAE,CAAC;YAChC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC7B,CAAC;IACH,CAAC;IAEQ,eAAe;QACtB,OAAO,CAAC,WAAW,EAAE,EAAE,IAAI,CAAC,cAAc,EAAE,EAAE,WAAW,EAAE,CAAC,CAAC;IAC/D,CAAC;IAED,cAAc;QACZ,MAAM,EAAC,mBAAmB,EAAC,GAAG,UAAU,CAAC,GAAG,CAAC;QAE7C,2DAA2D;QAC3D,2EAA2E;QAC3E,uEAAuE;QACvE,MAAM,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;QACvC,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;QAEhC,OAAO,UAAU,CAAC,cAAc,CAAC;YAC/B,QAAQ,EACJ,CAAC,KAAK,EAAC,EAAgC,EACQ,EAAE;oBAC1C,OAAO,MAAM,CAAC,CAAC,MAAM,qBAAqB,CAAC,EAAE,EAAE,YAAY,EAAE,QAAQ,CAAC,CAAC,IAAI,mBAAmB,CAAC,EAAE,CAAC,CAAC,CAAC;gBACtG,CAAC,CAAC;SACZ,CAAC,CAAC;IACL,CAAC;IAEQ,2BAA2B,CAAC,WAAuC;QAC1E,SAAS,eAAe,CAAC,QAA+B,EAAE,SAA0C;YAClG,MAAM,MAAM,GAAG,qBAAqB,CAAC,2BAA2B,CAAC,YAAY,CAAC,EAAE;gBAC9E,QAAQ,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,YAAY,CAC/F,SAAS,EAAE,YAAY,CAAC,CAAC;YAC/B,CAAC,CAAC,CAAC;YACH,MAAM,CAAC,IAAI,EAAE,CAAC;QAChB,CAAC;QAED,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,MAAM,GAAG,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,CAAC;QACpC,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,IAAI,EAAE,KAAK,SAAS,CAAC,SAAS,CAAC,YAAY,CAAC,OAAO,IAAI,QAAQ;YAC3F,CAAC,SAAS,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC,qBAAqB,CAAC,GAAG,CAAC,EAAE,CAAC;YACzF,MAAM,oBAAoB,GAAG,UAAU,CAAC,SAAS,CAAC,YAAY,CAAC,CAAC;YAChE,WAAW,CAAC,YAAY,EAAE,CAAC,UAAU,CACjC,oBAAoB,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,QAAQ,EAAE,GAAG,CAAC,EAAE,EAAC,YAAY,EAAE,gBAAgB,EAAC,CAAC,CAAC;QACpG,CAAC;IACH,CAAC;CACF;AAED,MAAM,KAAK,GAAG,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC;IAC5C,mCAAmC,EAAE;QACnC,YAAY,EAAE,6BAA6B;QAC3C,kBAAkB,EAAE,0CAA0C;QAC9D,eAAe,EAAE,qCAAqC;KACvD;CACF,CAAC,CAAC","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Geometry from '../../models/geometry/geometry.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as CodeMirror from '../../third_party/codemirror.next/codemirror.next.js';\nimport * as IconButton from '../../ui/components/icon_button/icon_button.js';\nimport * as ColorPicker from '../../ui/legacy/components/color_picker/color_picker.js';\nimport * as InlineEditor from '../../ui/legacy/components/inline_editor/inline_editor.js';\nimport type * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {AddDebugInfoURLDialog} from './AddSourceMapURLDialog.js';\nimport {Plugin} from './Plugin.js';\n\n// Plugin to add CSS completion, shortcuts, and color/curve swatches\n// to editors with CSS content.\n\nconst UIStrings = {\n  /**\n   * @description Swatch icon element title in CSSPlugin of the Sources panel\n   */\n  openColorPicker: 'Open color picker.',\n  /**\n   * @description Text to open the cubic bezier editor\n   */\n  openCubicBezierEditor: 'Open cubic bezier editor.',\n  /**\n   * @description Text for a context menu item for attaching a sourcemap to the currently open css file\n   */\n  addSourceMap: 'Add source mapâ€¦',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/CSSPlugin.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst doNotCompleteIn = new Set(['ColorLiteral', 'NumberLiteral', 'StringLiteral', 'Comment', 'Important']);\n\nfunction findPropertyAt(node: CodeMirror.SyntaxNode, pos: number): CodeMirror.SyntaxNode|null {\n  if (doNotCompleteIn.has(node.name)) {\n    return null;\n  }\n  for (let cur: CodeMirror.SyntaxNode|null = node; cur; cur = cur.parent) {\n    if (cur.name === 'StyleSheet' || cur.name === 'Styles' || cur.name === 'CallExpression') {\n      break;\n    } else if (cur.name === 'Declaration') {\n      const name = cur.getChild('PropertyName'), colon = cur.getChild(':');\n      return name && colon && colon.to <= pos ? name : null;\n    }\n  }\n  return null;\n}\n\nfunction getCurrentStyleSheet(\n    url: Platform.DevToolsPath.UrlString, cssModel: SDK.CSSModel.CSSModel): Protocol.CSS.StyleSheetId {\n  const currentStyleSheet = cssModel.getStyleSheetIdsForURL(url);\n  if (currentStyleSheet.length === 0) {\n    throw new Error('Can\\'t find style sheet ID for current URL');\n  }\n\n  return currentStyleSheet[0];\n}\n\nasync function specificCssCompletion(\n    cx: CodeMirror.CompletionContext, uiSourceCode: Workspace.UISourceCode.UISourceCode,\n    cssModel: SDK.CSSModel.CSSModel|undefined): Promise<CodeMirror.CompletionResult|null> {\n  const node = CodeMirror.syntaxTree(cx.state).resolveInner(cx.pos, -1);\n  if (node.name === 'ClassName') {\n    // Should never happen, but let's code defensively here\n    assertNotNullOrUndefined(cssModel);\n\n    const currentStyleSheet = getCurrentStyleSheet(uiSourceCode.url(), cssModel);\n    const existingClassNames = await cssModel.getClassNames(currentStyleSheet);\n\n    return {\n      from: node.from,\n      options: existingClassNames.map(value => ({type: 'constant', label: value})),\n    };\n  }\n  const property = findPropertyAt(node, cx.pos);\n  if (property) {\n    const propertyValues =\n        SDK.CSSMetadata.cssMetadata().getPropertyValues(cx.state.sliceDoc(property.from, property.to));\n    return {\n      from: node.name === 'ValueName' ? node.from : cx.pos,\n      options: propertyValues.map(value => ({type: 'constant', label: value})),\n      validFor: /^[\\w\\P{ASCII}\\-]+$/u,\n    };\n  }\n  return null;\n}\n\nfunction findColorsAndCurves(\n    state: CodeMirror.EditorState,\n    from: number,\n    to: number,\n    onColor: (pos: number, parsedColor: Common.Color.Color, text: string) => void,\n    onCurve: (pos: number, curve: Geometry.CubicBezier, text: string) => void,\n    ): void {\n  let line = state.doc.lineAt(from);\n  function getToken(from: number, to: number): string {\n    if (from >= line.to) {\n      line = state.doc.lineAt(from);\n    }\n    return line.text.slice(from - line.from, to - line.from);\n  }\n\n  const tree = CodeMirror.ensureSyntaxTree(state, to, 100);\n  if (!tree) {\n    return;\n  }\n  tree.iterate({\n    from,\n    to,\n    enter: node => {\n      let content;\n      if (node.name === 'ValueName' || node.name === 'ColorLiteral') {\n        content = getToken(node.from, node.to);\n      } else if (\n          node.name === 'Callee' &&\n          /^(?:(?:rgba?|hsla?|hwba?|lch|oklch|lab|oklab|color)|cubic-bezier)$/.test(getToken(node.from, node.to))) {\n        content = state.sliceDoc(node.from, (node.node.parent as CodeMirror.SyntaxNode).to);\n      }\n      if (content) {\n        const parsedColor = Common.Color.parse(content);\n        if (parsedColor) {\n          onColor(node.from, parsedColor, content);\n        } else {\n          const parsedCurve = Geometry.CubicBezier.parse(content);\n          if (parsedCurve) {\n            onCurve(node.from, parsedCurve, content);\n          }\n        }\n      }\n    },\n  });\n}\n\nclass ColorSwatchWidget extends CodeMirror.WidgetType {\n  #text: string;\n  #color: Common.Color.Color;\n  readonly #from: number;\n\n  constructor(color: Common.Color.Color, text: string, from: number) {\n    super();\n    this.#color = color;\n    this.#text = text;\n    this.#from = from;\n  }\n\n  override eq(other: ColorSwatchWidget): boolean {\n    return this.#color.equal(other.#color) && this.#text === other.#text && this.#from === other.#from;\n  }\n\n  toDOM(view: CodeMirror.EditorView): HTMLElement {\n    const swatch = new InlineEditor.ColorSwatch.ColorSwatch(i18nString(UIStrings.openColorPicker));\n    swatch.renderColor(this.#color);\n    const value = swatch.createChild('span');\n    value.textContent = this.#text;\n    value.setAttribute('hidden', 'true');\n    swatch.addEventListener(InlineEditor.ColorSwatch.ColorChangedEvent.eventName, event => {\n      const insert = event.data.color.getAuthoredText() ?? event.data.color.asString();\n      view.dispatch({changes: {from: this.#from, to: this.#from + this.#text.length, insert}});\n      this.#text = insert;\n      this.#color = swatch.getColor() as Common.Color.Color;\n    });\n    swatch.addEventListener(InlineEditor.ColorSwatch.ColorFormatChangedEvent.eventName, event => {\n      const insert = event.data.color.getAuthoredText() ?? event.data.color.asString();\n      view.dispatch({changes: {from: this.#from, to: this.#from + this.#text.length, insert}});\n      this.#text = insert;\n      this.#color = swatch.getColor() as Common.Color.Color;\n    });\n    swatch.addEventListener(InlineEditor.ColorSwatch.ClickEvent.eventName, event => {\n      event.consume(true);\n      view.dispatch({\n        effects: setTooltip.of({\n          type: TooltipType.COLOR,\n          pos: view.posAtDOM(swatch),\n          text: this.#text,\n          swatch,\n          color: this.#color,\n        }),\n      });\n    });\n    return swatch;\n  }\n\n  override ignoreEvent(): boolean {\n    return true;\n  }\n}\n\nclass CurveSwatchWidget extends CodeMirror.WidgetType {\n  constructor(readonly curve: Geometry.CubicBezier, readonly text: string) {\n    super();\n  }\n\n  override eq(other: CurveSwatchWidget): boolean {\n    return this.curve.asCSSText() === other.curve.asCSSText() && this.text === other.text;\n  }\n\n  toDOM(view: CodeMirror.EditorView): HTMLElement {\n    const container = document.createElement('span');\n    const bezierText = container.createChild('span');\n    const icon = IconButton.Icon.create('bezier-curve-filled', 'bezier-swatch-icon');\n    icon.setAttribute('jslog', `${VisualLogging.showStyleEditor('bezier')}`);\n    bezierText.append(this.text);\n    UI.Tooltip.Tooltip.install(icon, i18nString(UIStrings.openCubicBezierEditor));\n    icon.addEventListener('click', (event: MouseEvent) => {\n      event.consume(true);\n      view.dispatch({\n        effects: setTooltip.of({\n          type: TooltipType.CURVE,\n          pos: view.posAtDOM(icon),\n          text: this.text,\n          swatch: icon,\n          curve: this.curve,\n        }),\n      });\n    }, false);\n    return icon;\n  }\n\n  override ignoreEvent(): boolean {\n    return true;\n  }\n}\n\nconst enum TooltipType {\n  COLOR = 0,\n  CURVE = 1,\n}\n\ntype ActiveTooltip = {\n  type: TooltipType.COLOR,\n  pos: number,\n  text: string,\n  color: Common.Color.Color,\n  swatch: InlineEditor.ColorSwatch.ColorSwatch,\n}|{\n  type: TooltipType.CURVE,\n  pos: number,\n  text: string,\n  curve: Geometry.CubicBezier,\n  swatch: IconButton.Icon.Icon,\n};\n\nfunction createCSSTooltip(active: ActiveTooltip): CodeMirror.Tooltip {\n  return {\n    pos: active.pos,\n    arrow: false,\n    create(view): CodeMirror.TooltipView {\n      let text = active.text;\n      let widget: UI.Widget.VBox, addListener: (handler: (event: {data: string}) => void) => void;\n      if (active.type === TooltipType.COLOR) {\n        const spectrum = new ColorPicker.Spectrum.Spectrum();\n        addListener = handler => {\n          spectrum.addEventListener(ColorPicker.Spectrum.Events.COLOR_CHANGED, handler);\n        };\n        spectrum.addEventListener(ColorPicker.Spectrum.Events.SIZE_CHANGED, () => view.requestMeasure());\n        spectrum.setColor(active.color);\n        widget = spectrum;\n      } else {\n        const spectrum = new InlineEditor.BezierEditor.BezierEditor(active.curve);\n        widget = spectrum;\n        addListener = handler => {\n          spectrum.addEventListener(InlineEditor.BezierEditor.Events.BEZIER_CHANGED, handler);\n        };\n      }\n      const dom = document.createElement('div');\n      dom.className = 'cm-tooltip-swatchEdit';\n      widget.markAsRoot();\n      widget.show(dom);\n      widget.showWidget();\n      widget.element.addEventListener('keydown', event => {\n        if (event.key === 'Escape') {\n          event.consume();\n          view.dispatch({\n            effects: setTooltip.of(null),\n            changes: text === active.text ? undefined :\n                                            {from: active.pos, to: active.pos + text.length, insert: active.text},\n          });\n          widget.hideWidget();\n          view.focus();\n        }\n      });\n      widget.element.addEventListener('focusout', event => {\n        if (event.relatedTarget && !widget.element.contains(event.relatedTarget as Node)) {\n          view.dispatch({effects: setTooltip.of(null)});\n          widget.hideWidget();\n        }\n      }, false);\n      widget.element.addEventListener('mousedown', event => event.consume());\n      return {\n        dom,\n        resize: false,\n        offset: {x: -8, y: 0},\n        mount: () => {\n          widget.focus();\n          widget.wasShown();\n          addListener((event: {data: string}) => {\n            view.dispatch({\n              changes: {from: active.pos, to: active.pos + text.length, insert: event.data},\n              annotations: isSwatchEdit.of(true),\n            });\n            text = event.data;\n          });\n        },\n      };\n    },\n  };\n}\n\nconst setTooltip = CodeMirror.StateEffect.define<ActiveTooltip|null>();\n\nconst isSwatchEdit = CodeMirror.Annotation.define<boolean>();\n\nconst cssTooltipState = CodeMirror.StateField.define<ActiveTooltip|null>({\n  create() {\n    return null;\n  },\n\n  update(value: ActiveTooltip|null, tr: CodeMirror.Transaction): ActiveTooltip |\n      null {\n        if ((tr.docChanged || tr.selection) && !tr.annotation(isSwatchEdit)) {\n          value = null;\n        }\n        for (const effect of tr.effects) {\n          if (effect.is(setTooltip)) {\n            value = effect.value;\n          }\n        }\n        return value;\n      },\n\n  provide: field => CodeMirror.showTooltip.from(field, active => active && createCSSTooltip(active)),\n});\n\nfunction computeSwatchDeco(state: CodeMirror.EditorState, from: number, to: number): CodeMirror.DecorationSet {\n  const builder = new CodeMirror.RangeSetBuilder<CodeMirror.Decoration>();\n  findColorsAndCurves(\n      state, from, to,\n      (pos, parsedColor, colorText) => {\n        builder.add(\n            pos, pos, CodeMirror.Decoration.widget({widget: new ColorSwatchWidget(parsedColor, colorText, pos)}));\n      },\n      (pos, curve, text) => {\n        builder.add(pos, pos, CodeMirror.Decoration.widget({widget: new CurveSwatchWidget(curve, text)}));\n      });\n  return builder.finish();\n}\n\nconst cssSwatchPlugin = CodeMirror.ViewPlugin.fromClass(class {\n  decorations: CodeMirror.DecorationSet;\n\n  constructor(view: CodeMirror.EditorView) {\n    this.decorations = computeSwatchDeco(view.state, view.viewport.from, view.viewport.to);\n  }\n\n  update(update: CodeMirror.ViewUpdate): void {\n    if (update.viewportChanged || update.docChanged) {\n      this.decorations = computeSwatchDeco(update.state, update.view.viewport.from, update.view.viewport.to);\n    }\n  }\n}, {\n  decorations: v => v.decorations,\n});\n\nfunction cssSwatches(): CodeMirror.Extension {\n  return [cssSwatchPlugin, cssTooltipState, theme];\n}\n\nfunction getNumberAt(node: CodeMirror.SyntaxNode): {from: number, to: number}|null {\n  if (node.name === 'Unit') {\n    node = node.parent as CodeMirror.SyntaxNode;\n  }\n  if (node.name === 'NumberLiteral') {\n    const lastChild = node.lastChild;\n    return {from: node.from, to: lastChild && lastChild.name === 'Unit' ? lastChild.from : node.to};\n  }\n  return null;\n}\n\nfunction modifyUnit(view: CodeMirror.EditorView, by: number): boolean {\n  const {head} = view.state.selection.main;\n  const context = CodeMirror.syntaxTree(view.state).resolveInner(head, -1);\n  const numberRange = getNumberAt(context) || getNumberAt(context.resolve(head, 1));\n  if (!numberRange) {\n    return false;\n  }\n\n  const currentNumber = Number(view.state.sliceDoc(numberRange.from, numberRange.to));\n  if (isNaN(currentNumber)) {\n    return false;\n  }\n\n  view.dispatch({\n    changes: {from: numberRange.from, to: numberRange.to, insert: String(currentNumber + by)},\n    scrollIntoView: true,\n    userEvent: 'insert.modifyUnit',\n  });\n  return true;\n}\n\nexport function cssBindings(): CodeMirror.Extension {\n  // This is an awkward way to pass the argument given to the editor\n  // event handler through the ShortcutRegistry calling convention.\n  let currentView: CodeMirror.EditorView = null as unknown as CodeMirror.EditorView;\n  const listener = UI.ShortcutRegistry.ShortcutRegistry.instance().getShortcutListener({\n    'sources.increment-css': () => Promise.resolve(modifyUnit(currentView, 1)),\n    'sources.increment-css-by-ten': () => Promise.resolve(modifyUnit(currentView, 10)),\n    'sources.decrement-css': () => Promise.resolve(modifyUnit(currentView, -1)),\n    'sources.decrement-css-by-ten': () => Promise.resolve(modifyUnit(currentView, -10)),\n  });\n\n  return CodeMirror.EditorView.domEventHandlers({\n    keydown: (event, view) => {\n      const prevView = currentView;\n      currentView = view;\n      listener(event);\n      currentView = prevView;\n      return event.defaultPrevented;\n    },\n  });\n}\n\nexport class CSSPlugin extends Plugin implements SDK.TargetManager.SDKModelObserver<SDK.CSSModel.CSSModel> {\n  #cssModel?: SDK.CSSModel.CSSModel;\n\n  constructor(uiSourceCode: Workspace.UISourceCode.UISourceCode, _transformer?: SourceFrame.SourceFrame.Transformer) {\n    super(uiSourceCode, _transformer);\n    SDK.TargetManager.TargetManager.instance().observeModels(SDK.CSSModel.CSSModel, this);\n  }\n\n  static override accepts(uiSourceCode: Workspace.UISourceCode.UISourceCode): boolean {\n    return uiSourceCode.contentType().hasStyleSheets();\n  }\n\n  modelAdded(cssModel: SDK.CSSModel.CSSModel): void {\n    if (cssModel.target() !== SDK.TargetManager.TargetManager.instance().primaryPageTarget()) {\n      return;\n    }\n    this.#cssModel = cssModel;\n  }\n  modelRemoved(cssModel: SDK.CSSModel.CSSModel): void {\n    if (this.#cssModel === cssModel) {\n      this.#cssModel = undefined;\n    }\n  }\n\n  override editorExtension(): CodeMirror.Extension {\n    return [cssBindings(), this.#cssCompletion(), cssSwatches()];\n  }\n\n  #cssCompletion(): CodeMirror.Extension {\n    const {cssCompletionSource} = CodeMirror.css;\n\n    // CodeMirror binds the function below to the state object.\n    // Therefore, we can't access `this` and retrieve the following properties.\n    // Instead, retrieve them up front to bind them to the correct closure.\n    const uiSourceCode = this.uiSourceCode;\n    const cssModel = this.#cssModel;\n\n    return CodeMirror.autocompletion({\n      override:\n          [async(cx: CodeMirror.CompletionContext):\n               Promise<CodeMirror.CompletionResult|null> => {\n                 return await ((await specificCssCompletion(cx, uiSourceCode, cssModel)) || cssCompletionSource(cx));\n               }],\n    });\n  }\n\n  override populateTextAreaContextMenu(contextMenu: UI.ContextMenu.ContextMenu): void {\n    function addSourceMapURL(cssModel: SDK.CSSModel.CSSModel, sourceUrl: Platform.DevToolsPath.UrlString): void {\n      const dialog = AddDebugInfoURLDialog.createAddSourceMapURLDialog(sourceMapUrl => {\n        Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance().modelToInfo.get(cssModel)?.addSourceMap(\n            sourceUrl, sourceMapUrl);\n      });\n      dialog.show();\n    }\n\n    const cssModel = this.#cssModel;\n    const url = this.uiSourceCode.url();\n    if (this.uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network && cssModel &&\n        !Workspace.IgnoreListManager.IgnoreListManager.instance().isUserIgnoreListedURL(url)) {\n      const addSourceMapURLLabel = i18nString(UIStrings.addSourceMap);\n      contextMenu.debugSection().appendItem(\n          addSourceMapURLLabel, () => addSourceMapURL(cssModel, url), {jslogContext: 'add-source-map'});\n    }\n  }\n}\n\nconst theme = CodeMirror.EditorView.baseTheme({\n  '.cm-tooltip.cm-tooltip-swatchEdit': {\n    'box-shadow': 'var(--sys-elevation-level2)',\n    'background-color': 'var(--sys-color-base-container-elevated)',\n    'border-radius': 'var(--sys-shape-corner-extra-small)',\n  },\n});\n"]}