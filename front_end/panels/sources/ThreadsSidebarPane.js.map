{"version":3,"file":"ThreadsSidebarPane.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/ThreadsSidebarPane.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport threadsSidebarPaneStyles from './threadsSidebarPane.css.js';\n\nconst {html, render, nothing} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Text in Threads Sidebar Pane of the Sources panel\n   */\n  paused: 'paused',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/ThreadsSidebarPane.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\ninterface Thread {\n  name: string;\n  paused: boolean;\n  selected: boolean;\n  onSelect: () => void;\n}\n\ninterface ViewInput {\n  threads: Thread[];\n}\n\n// clang-format off\nconst DEFAULT_VIEW = (input: ViewInput, _output: undefined, target: HTMLElement): void => {\n  render(html`\n    <style>${threadsSidebarPaneStyles}</style>\n    <div role=\"listbox\">\n    ${input.threads.map(thread => html`\n      <button\n        class=\"thread-item\"\n        @click=${thread.onSelect}\n        tabindex=\"0\"\n        aria-selected=${thread.selected}\n        role=\"option\"\n      >\n        <div class=\"thread-item-title\">${thread.name}</div>\n        <div class=\"thread-item-paused-state\">${thread.paused ? i18nString(UIStrings.paused) : ''}</div>\n        ${thread.selected ? html`<devtools-icon name=\"large-arrow-right-filled\" class=\"selected-thread-icon\"></devtools-icon>` : nothing}\n      </button>\n    `)}\n    </div>\n  `, target);\n};\n// clang-format on\n\ntype View = typeof DEFAULT_VIEW;\n\nexport class ThreadsSidebarPane extends UI.Widget.VBox implements\n    SDK.TargetManager.SDKModelObserver<SDK.DebuggerModel.DebuggerModel> {\n  #debuggerModels = new Set<SDK.DebuggerModel.DebuggerModel>();\n  #selectedModel: SDK.DebuggerModel.DebuggerModel|null;\n  #view: View;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {\n      jslog: `${VisualLogging.section('sources.threads')}`,\n    });\n    this.#view = view;\n\n    const currentTarget = UI.Context.Context.instance().flavor(SDK.Target.Target);\n    this.#selectedModel = currentTarget?.model(SDK.DebuggerModel.DebuggerModel) ?? null;\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.Target.Target, this.targetFlavorChanged, this);\n    SDK.TargetManager.TargetManager.instance().observeModels(SDK.DebuggerModel.DebuggerModel, this);\n  }\n\n  static shouldBeShown(): boolean {\n    return SDK.TargetManager.TargetManager.instance().models(SDK.DebuggerModel.DebuggerModel).length >= 2;\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.requestUpdate();\n  }\n\n  #getThreadName(debuggerModel: SDK.DebuggerModel.DebuggerModel): string {\n    const executionContext = debuggerModel.runtimeModel().defaultExecutionContext();\n    return executionContext?.label() || debuggerModel.target().name();\n  }\n\n  #handleThreadSelect(debuggerModel: SDK.DebuggerModel.DebuggerModel): void {\n    UI.Context.Context.instance().setFlavor(SDK.Target.Target, debuggerModel.target());\n  }\n\n  #updatePausedState = (): void => {\n    this.requestUpdate();\n  };\n\n  #targetNameChanged = (event: Common.EventTarget.EventTargetEvent<SDK.Target.Target>): void => {\n    const target = event.data;\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n    if (debuggerModel && this.#debuggerModels.has(debuggerModel)) {\n      this.requestUpdate();\n    }\n  };\n\n  override performUpdate(): void {\n    const threads: Thread[] =\n        Array.from(this.#debuggerModels).map(debuggerModel => ({\n                                               name: this.#getThreadName(debuggerModel),\n                                               paused: debuggerModel.isPaused(),\n                                               selected: this.#selectedModel === debuggerModel,\n                                               onSelect: () => this.#handleThreadSelect(debuggerModel),\n                                             }));\n    this.#view({threads}, undefined, this.contentElement);\n  }\n\n  modelAdded(debuggerModel: SDK.DebuggerModel.DebuggerModel): void {\n    this.#debuggerModels.add(debuggerModel);\n    debuggerModel.addEventListener(SDK.DebuggerModel.Events.DebuggerPaused, this.#updatePausedState);\n    debuggerModel.addEventListener(SDK.DebuggerModel.Events.DebuggerResumed, this.#updatePausedState);\n    debuggerModel.runtimeModel().addEventListener(\n        SDK.RuntimeModel.Events.ExecutionContextChanged, this.requestUpdate, this);\n    SDK.TargetManager.TargetManager.instance().addEventListener(\n        SDK.TargetManager.Events.NAME_CHANGED, this.#targetNameChanged);\n\n    this.requestUpdate();\n  }\n\n  modelRemoved(debuggerModel: SDK.DebuggerModel.DebuggerModel): void {\n    this.#debuggerModels.delete(debuggerModel);\n    debuggerModel.removeEventListener(SDK.DebuggerModel.Events.DebuggerPaused, this.#updatePausedState);\n    debuggerModel.removeEventListener(SDK.DebuggerModel.Events.DebuggerResumed, this.#updatePausedState);\n    debuggerModel.runtimeModel().removeEventListener(\n        SDK.RuntimeModel.Events.ExecutionContextChanged, this.requestUpdate, this);\n    SDK.TargetManager.TargetManager.instance().removeEventListener(\n        SDK.TargetManager.Events.NAME_CHANGED, this.#targetNameChanged);\n\n    this.requestUpdate();\n  }\n\n  private targetFlavorChanged({data: target}: Common.EventTarget.EventTargetEvent<SDK.Target.Target>): void {\n    this.#selectedModel = target.model(SDK.DebuggerModel.DebuggerModel);\n    this.requestUpdate();\n  }\n}\n"]}