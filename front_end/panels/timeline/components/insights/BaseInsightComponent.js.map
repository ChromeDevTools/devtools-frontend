{"version":3,"file":"BaseInsightComponent.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/BaseInsightComponent.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport '../../../../ui/components/markdown_view/markdown_view.js';\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Root from '../../../../core/root/root.js';\nimport * as AIAssistance from '../../../../models/ai_assistance/ai_assistance.js';\nimport * as Badges from '../../../../models/badges/badges.js';\nimport type {InsightModel} from '../../../../models/trace/insights/types.js';\nimport type * as Trace from '../../../../models/trace/trace.js';\nimport * as Buttons from '../../../../ui/components/buttons/buttons.js';\nimport * as ComponentHelpers from '../../../../ui/components/helpers/helpers.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../../ui/visual_logging/visual_logging.js';\nimport type * as Overlays from '../../overlays/overlays.js';\n\nimport baseInsightComponentStyles from './baseInsightComponent.css.js';\nimport {md} from './Helpers.js';\nimport * as SidebarInsight from './SidebarInsight.js';\nimport type {TableState} from './Table.js';\n\nconst {html} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Text to tell the user the estimated time or size savings for this insight. \"&\" means \"and\" - space is limited to prefer abbreviated terms if possible. Text will still fit if not short, it just won't look very good, so using no abbreviations is fine if necessary.\n   * @example {401 ms} PH1\n   * @example {112 kB} PH1\n   */\n  estimatedSavings: 'Est savings: {PH1}',\n  /**\n   * @description Text to tell the user the estimated time and size savings for this insight. \"&\" means \"and\", \"Est\" means \"Estimated\" - space is limited to prefer abbreviated terms if possible. Text will still fit if not short, it just won't look very good, so using no abbreviations is fine if necessary.\n   * @example {401 ms} PH1\n   * @example {112 kB} PH2\n   */\n  estimatedSavingsTimingAndBytes: 'Est savings: {PH1} & {PH2}',\n  /**\n   * @description Text to tell the user the estimated time savings for this insight that is used for screen readers.\n   * @example {401 ms} PH1\n   * @example {112 kB} PH1\n   */\n  estimatedSavingsAriaTiming: 'Estimated savings for this insight: {PH1}',\n  /**\n   * @description Text to tell the user the estimated size savings for this insight that is used for screen readers. Value is in terms of \"transfer size\", aka encoded/compressed data length.\n   * @example {401 ms} PH1\n   * @example {112 kB} PH1\n   */\n  estimatedSavingsAriaBytes: 'Estimated savings for this insight: {PH1} transfer size',\n  /**\n   * @description Text to tell the user the estimated time and size savings for this insight that is used for screen readers.\n   * @example {401 ms} PH1\n   * @example {112 kB} PH2\n   */\n  estimatedSavingsTimingAndBytesAria: 'Estimated savings for this insight: {PH1} and {PH2} transfer size',\n  /**\n   * @description Used for screen-readers as a label on the button to expand an insight to view details\n   * @example {LCP breakdown} PH1\n   */\n  viewDetails: 'View details for {PH1} insight.',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/components/insights/BaseInsightComponent.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface BaseInsightData {\n  /** The trace bounds for the insight set that contains this insight. */\n  bounds: Trace.Types.Timing.TraceWindowMicro|null;\n  /** The key into `insights` that contains this particular insight. */\n  insightSetKey: string|null;\n}\n\nexport abstract class BaseInsightComponent<T extends InsightModel> extends HTMLElement {\n  abstract internalName: string;\n\n  // So we can use the TypeScript BaseInsight class without getting warnings\n  // about litTagName. Every child should overwrite this.\n  static readonly litTagName = Lit.StaticHtml.literal``;\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n\n  // This flag tracks if the Insights AI feature is enabled within Chrome for\n  // the active user.\n  #askAiEnabled = false;\n\n  #selected = false;\n  #model: T|null = null;\n  #agentFocus: AIAssistance.AIContext.AgentFocus|null = null;\n  #fieldMetrics: Trace.Insights.Common.CrUXFieldMetricResults|null = null;\n\n  get model(): T|null {\n    return this.#model;\n  }\n  protected data: BaseInsightData = {\n    bounds: null,\n    insightSetKey: null,\n  };\n\n  readonly sharedTableState: TableState = {\n    selectedRowEl: null,\n    selectionIsSticky: false,\n  };\n  #initialOverlays: Trace.Types.Overlays.Overlay[]|null = null;\n\n  protected scheduleRender(): void {\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  // Insights that do support the AI feature can override this to return true.\n  // The \"Ask AI\" button will only be shown for an Insight if this\n  // is true and if the feature has been enabled by the user and they meet the\n  // requirements to use AI.\n  protected hasAskAiSupport(): boolean {\n    return false;\n  }\n\n  connectedCallback(): void {\n    this.setAttribute('jslog', `${VisualLogging.section(`timeline.insights.${this.internalName}`)}`);\n    // Used for unit test purposes when querying the DOM.\n    this.dataset.insightName = this.internalName;\n\n    const {devToolsAiAssistancePerformanceAgent} = Root.Runtime.hostConfig;\n    this.#askAiEnabled = Boolean(devToolsAiAssistancePerformanceAgent?.enabled);\n  }\n\n  set selected(selected: boolean) {\n    if (!this.#selected && selected) {\n      const options = this.getOverlayOptionsForInitialOverlays();\n      this.dispatchEvent(new SidebarInsight.InsightProvideOverlays(this.getInitialOverlays(), options));\n    }\n\n    this.#selected = selected;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  get selected(): boolean {\n    return this.#selected;\n  }\n\n  set model(model: T) {\n    this.#model = model;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  set insightSetKey(insightSetKey: string|null) {\n    this.data.insightSetKey = insightSetKey;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  get bounds(): Trace.Types.Timing.TraceWindowMicro|null {\n    return this.data.bounds;\n  }\n\n  set bounds(bounds: Trace.Types.Timing.TraceWindowMicro|null) {\n    this.data.bounds = bounds;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  set agentFocus(agentFocus: AIAssistance.AIContext.AgentFocus) {\n    this.#agentFocus = agentFocus;\n  }\n\n  set fieldMetrics(fieldMetrics: Trace.Insights.Common.CrUXFieldMetricResults) {\n    this.#fieldMetrics = fieldMetrics;\n  }\n\n  get fieldMetrics(): Trace.Insights.Common.CrUXFieldMetricResults|null {\n    return this.#fieldMetrics;\n  }\n\n  getOverlayOptionsForInitialOverlays(): Overlays.Overlays.TimelineOverlaySetOptions {\n    return {updateTraceWindow: true};\n  }\n\n  #dispatchInsightToggle(): void {\n    if (!this.data.insightSetKey || !this.model) {\n      // Shouldn't happen, but needed to satisfy TS.\n      return;\n    }\n\n    const focus = UI.Context.Context.instance().flavor(AIAssistance.AIContext.AgentFocus);\n    if (this.#selected) {\n      this.dispatchEvent(new SidebarInsight.InsightDeactivated());\n\n      // Clear agent (but only if currently focused on an insight).\n      if (focus) {\n        UI.Context.Context.instance().setFlavor(AIAssistance.AIContext.AgentFocus, focus.withInsight(null));\n      }\n      return;\n    }\n\n    if (focus) {\n      UI.Context.Context.instance().setFlavor(AIAssistance.AIContext.AgentFocus, focus.withInsight(this.model));\n    }\n\n    Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n\n    this.sharedTableState.selectedRowEl?.classList.remove('selected');\n    this.sharedTableState.selectedRowEl = null;\n    this.sharedTableState.selectionIsSticky = false;\n\n    this.dispatchEvent(new SidebarInsight.InsightActivated(this.model, this.data.insightSetKey));\n  }\n\n  #renderHoverIcon(insightIsActive: boolean): Lit.TemplateResult {\n    // clang-format off\n    const containerClasses = Lit.Directives.classMap({\n      'insight-hover-icon': true,\n      active: insightIsActive,\n    });\n    return html`\n      <div class=${containerClasses} inert>\n        <devtools-button .data=${{\n          variant: Buttons.Button.Variant.ICON,\n          iconName: 'chevron-down',\n          size: Buttons.Button.Size.SMALL,\n        } as Buttons.Button.ButtonData}\n      ></devtools-button>\n      </div>\n\n    `;\n    // clang-format on\n  }\n\n  /**\n   * Ensure that if the user presses enter or space on a header, we treat it\n   * like a click and toggle the insight.\n   */\n  #handleHeaderKeyDown(event: KeyboardEvent): void {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      event.stopPropagation();\n      this.#dispatchInsightToggle();\n    }\n  }\n\n  /**\n   * Replaces the initial insight overlays with the ones provided.\n   *\n   * If `overlays` is null, reverts back to the initial overlays.\n   *\n   * This allows insights to provide an initial set of overlays,\n   * and later temporarily replace all of those insights with a different set.\n   * This enables the hover/click table interactions.\n   */\n  toggleTemporaryOverlays(\n      overlays: Trace.Types.Overlays.Overlay[]|null, options: Overlays.Overlays.TimelineOverlaySetOptions): void {\n    if (!this.#selected) {\n      return;\n    }\n\n    if (!overlays) {\n      this.dispatchEvent(new SidebarInsight.InsightProvideOverlays(\n          this.getInitialOverlays(), this.getOverlayOptionsForInitialOverlays()));\n      return;\n    }\n\n    this.dispatchEvent(new SidebarInsight.InsightProvideOverlays(overlays, options));\n  }\n\n  getInitialOverlays(): Trace.Types.Overlays.Overlay[] {\n    if (this.#initialOverlays) {\n      return this.#initialOverlays;\n    }\n\n    this.#initialOverlays = this.createOverlays();\n    return this.#initialOverlays;\n  }\n\n  protected createOverlays(): Trace.Types.Overlays.Overlay[] {\n    return this.model?.createOverlays?.() ?? [];\n  }\n\n  protected abstract renderContent(): Lit.LitTemplate;\n\n  #render(): void {\n    if (!this.model) {\n      return;\n    }\n\n    this.#renderWithContent();\n  }\n\n  getEstimatedSavingsTime(): Trace.Types.Timing.Milli|null {\n    return null;\n  }\n\n  getEstimatedSavingsBytes(): number|null {\n    return this.model?.wastedBytes ?? null;\n  }\n\n  #getEstimatedSavingsTextParts(): {bytesString?: string, timeString?: string} {\n    const savingsTime = this.getEstimatedSavingsTime();\n    const savingsBytes = this.getEstimatedSavingsBytes();\n\n    let timeString, bytesString;\n    if (savingsTime) {\n      timeString = i18n.TimeUtilities.millisToString(savingsTime);\n    }\n    if (savingsBytes) {\n      bytesString = i18n.ByteUtilities.bytesToString(savingsBytes);\n    }\n    return {\n      timeString,\n      bytesString,\n    };\n  }\n\n  #getEstimatedSavingsAriaLabel(): string|null {\n    const {bytesString, timeString} = this.#getEstimatedSavingsTextParts();\n\n    if (timeString && bytesString) {\n      return i18nString(UIStrings.estimatedSavingsTimingAndBytesAria, {\n        PH1: timeString,\n        PH2: bytesString,\n      });\n    }\n    if (timeString) {\n      return i18nString(UIStrings.estimatedSavingsAriaTiming, {\n        PH1: timeString,\n      });\n    }\n    if (bytesString) {\n      return i18nString(UIStrings.estimatedSavingsAriaBytes, {\n        PH1: bytesString,\n      });\n    }\n\n    return null;\n  }\n\n  #getEstimatedSavingsString(): string|null {\n    const {bytesString, timeString} = this.#getEstimatedSavingsTextParts();\n\n    if (timeString && bytesString) {\n      return i18nString(UIStrings.estimatedSavingsTimingAndBytes, {\n        PH1: timeString,\n        PH2: bytesString,\n      });\n    }\n    if (timeString) {\n      return i18nString(UIStrings.estimatedSavings, {\n        PH1: timeString,\n      });\n    }\n    if (bytesString) {\n      return i18nString(UIStrings.estimatedSavings, {\n        PH1: bytesString,\n      });\n    }\n\n    return null;\n  }\n\n  #askAIButtonClick(): void {\n    if (!this.#agentFocus) {\n      return;\n    }\n\n    // matches the one in ai_assistance-meta.ts\n    const actionId = 'drjones.performance-panel-context';\n    if (!UI.ActionRegistry.ActionRegistry.instance().hasAction(actionId)) {\n      return;\n    }\n\n    let focus = UI.Context.Context.instance().flavor(AIAssistance.AIContext.AgentFocus);\n    if (focus) {\n      focus = focus.withInsight(this.model);\n    } else {\n      focus = this.#agentFocus;\n    }\n    UI.Context.Context.instance().setFlavor(AIAssistance.AIContext.AgentFocus, focus);\n\n    // Trigger the AI Assistance panel to open.\n    const action = UI.ActionRegistry.ActionRegistry.instance().getAction(actionId);\n    void action.execute();\n  }\n\n  #canShowAskAI(): boolean {\n    const aiAvailable = Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue !==\n            Root.Runtime.GenAiEnterprisePolicyValue.DISABLE &&\n        this.#askAiEnabled && Root.Runtime.hostConfig.aidaAvailability?.enabled === true;\n\n    return aiAvailable && this.hasAskAiSupport();\n  }\n\n  #renderInsightContent(insightModel: T): Lit.LitTemplate {\n    if (!this.#selected) {\n      return Lit.nothing;\n    }\n\n    const aiLabel = Root.Runtime.hostConfig.devToolsAiDebugWithAi?.enabled ||\n            Root.Runtime.hostConfig.devToolsAiSubmenuPrompts?.enabled ?\n        'Debug with AI' :\n        'Ask AI';\n    const ariaLabel = `${aiLabel} about ${insightModel.title} insight`;\n    // Only render the insight body content if it is selected.\n    // To avoid re-rendering triggered from elsewhere.\n    const content = this.renderContent();\n    // clang-format off\n    return html`\n      <div class=\"insight-body\">\n        <div class=\"insight-description\">${md(insightModel.description)}</div>\n        <div class=\"insight-content\">${content}</div>\n        ${this.#canShowAskAI() ? html`\n          <div class=\"ask-ai-btn-wrap\">\n            <devtools-button class=\"ask-ai\"\n              .variant=${Buttons.Button.Variant.OUTLINED}\n              .iconName=${'smart-assistant'}\n              data-insights-ask-ai\n              jslog=${VisualLogging.action(`timeline.insight-ask-ai.${this.internalName}`).track({click: true})}\n              @click=${this.#askAIButtonClick}\n              aria-label=${ariaLabel}\n            >${aiLabel}</devtools-button>\n          </div>\n        `: Lit.nothing}\n      </div>`;\n    // clang-format on\n  }\n\n  #renderWithContent(): void {\n    if (!this.#model) {\n      Lit.render(Lit.nothing, this.shadow, {host: this});\n      return;\n    }\n\n    const containerClasses = Lit.Directives.classMap({\n      insight: true,\n      closed: !this.#selected,\n    });\n    const estimatedSavingsString = this.#getEstimatedSavingsString();\n    const estimatedSavingsAriaLabel = this.#getEstimatedSavingsAriaLabel();\n\n    let ariaLabel = `${i18nString(UIStrings.viewDetails, {PH1: this.#model.title})}`;\n    if (estimatedSavingsAriaLabel) {\n      // space prefix is deliberate to add a gap after the view details text\n      ariaLabel += ` ${estimatedSavingsAriaLabel}`;\n    }\n\n    // clang-format off\n    const output = html`\n      <style>${baseInsightComponentStyles}</style>\n      <div class=${containerClasses}>\n        <header @click=${this.#dispatchInsightToggle}\n          @keydown=${this.#handleHeaderKeyDown}\n          jslog=${VisualLogging.action(`timeline.toggle-insight.${this.internalName}`).track({click: true})}\n          data-insight-header-title=${this.#model?.title}\n          tabIndex=\"0\"\n          role=\"button\"\n          aria-expanded=${this.#selected}\n          aria-label=${ariaLabel}\n        >\n          ${this.#renderHoverIcon(this.#selected)}\n          <h3 class=\"insight-title\">${this.#model?.title}</h3>\n          ${estimatedSavingsString ?\n            html`\n            <slot name=\"insight-savings\" class=\"insight-savings\">\n              <span title=${estimatedSavingsAriaLabel ?? ''}>${estimatedSavingsString}</span>\n            </slot>\n          </div>`\n          : Lit.nothing}\n        </header>\n        ${this.#renderInsightContent(this.#model)}\n      </div>\n    `;\n    // clang-format on\n\n    Lit.render(output, this.shadow, {host: this});\n\n    if (this.#selected) {\n      requestAnimationFrame(() => requestAnimationFrame(() => this.scrollIntoViewIfNeeded()));\n    }\n  }\n}\n"]}