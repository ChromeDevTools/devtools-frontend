{"version":3,"file":"EventRef.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/EventRef.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Trace from '../../../../models/trace/trace.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\nimport * as Utils from '../../utils/utils.js';\n\nimport baseInsightComponentStyles from './baseInsightComponent.css.js';\n\nconst {html, Directives: {ifDefined}} = Lit;\nconst {widgetConfig} = UI.Widget;\n\nexport class EventReferenceClick extends Event {\n  static readonly eventName = 'eventreferenceclick';\n\n  constructor(public event: Trace.Types.Events.Event) {\n    super(EventReferenceClick.eventName, {bubbles: true, composed: true});\n  }\n}\n\ninterface ViewInput {\n  text: string;\n  event: Trace.Types.Events.Event;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, output, target) => {\n  const {\n    text,\n    event,\n  } = input;\n\n  // clang-format off\n  Lit.render(html`\n    <style>${baseInsightComponentStyles}</style>\n    <button type=\"button\" class=\"timeline-link\" @click=${(e: Event) => {\n      e.stopPropagation();\n      if (event) {\n        target.dispatchEvent(new EventReferenceClick(event));\n      }\n    }}>${text}</button>\n  `, target);\n  // clang-format on\n};\n\nclass EventRef extends UI.Widget.Widget {\n  #view: View;\n  #text: string|null = null;\n  #event: Trace.Types.Events.Event|null = null;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  set text(text: string) {\n    this.#text = text;\n    this.requestUpdate();\n  }\n\n  set event(event: Trace.Types.Events.Event) {\n    this.#event = event;\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    if (!this.#text || !this.#event) {\n      return;\n    }\n\n    const input: ViewInput = {\n      text: this.#text,\n      event: this.#event,\n    };\n    this.#view(input, undefined, this.contentElement);\n  }\n}\n\nexport function eventRef(\n    event: Trace.Types.Events.Event, options?: {text?: string, title?: string}): Lit.TemplateResult {\n  let title = options?.title;\n  let text = options?.text;\n  if (Trace.Types.Events.isSyntheticNetworkRequest(event)) {\n    text = text ?? Utils.Helpers.shortenUrl(new URL(event.args.data.url));\n    title = title ?? event.args.data.url;\n  } else if (!text) {\n    console.warn('No text given for eventRef');\n    text = event.name;\n  }\n\n  return html`<devtools-widget title=${ifDefined(title)} .widgetConfig=${widgetConfig(EventRef, {\n    event,\n    text,\n  })}></devtools-widget>`;\n}\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    [EventReferenceClick.eventName]: EventReferenceClick;\n  }\n}\n"]}