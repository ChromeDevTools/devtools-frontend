{"version":3,"file":"ImageRef.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/ImageRef.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Trace from '../../../../models/trace/trace.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport baseInsightComponentStyles from './baseInsightComponent.css.js';\nimport {eventRef} from './EventRef.js';\n\nconst {html} = Lit;\nconst {widgetConfig} = UI.Widget;\n\ninterface ViewInput {\n  request: Trace.Types.Events.SyntheticNetworkRequest;\n  imageDataUrl: string|null;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, output, target) => {\n  const {\n    request,\n    imageDataUrl,\n  } = input;\n\n  const img = imageDataUrl ? html`<img src=${imageDataUrl} class=\"element-img\"/>` : Lit.nothing;\n\n  // clang-format off\n  Lit.render(html`\n    <style>${baseInsightComponentStyles}</style>\n    <div class=\"image-ref\">\n      ${img}\n      <span class=\"element-img-details\">\n        ${eventRef(request)}\n        <span class=\"element-img-details-size\">${\n          i18n.ByteUtilities.bytesToString(request.args.data.decodedBodyLength ?? 0)\n        }</span>\n      </span>\n    </div>\n`, target);\n  // clang-format on\n};\n\nclass ImageRef extends UI.Widget.Widget {\n  #view: View;\n  #request?: Trace.Types.Events.SyntheticNetworkRequest;\n  #imageDataUrl?: string|null;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  set request(request: Trace.Types.Events.SyntheticNetworkRequest) {\n    this.#request = request;\n    this.#imageDataUrl = undefined;\n    this.requestUpdate();\n  }\n\n  /**\n   * This only returns a data url if the resource is currently present from the active\n   * inspected page.\n   */\n  async #getOrCreateImageDataUrl(): Promise<string|null> {\n    if (!this.#request) {\n      return null;\n    }\n\n    if (this.#imageDataUrl !== undefined) {\n      return this.#imageDataUrl;\n    }\n\n    const originalUrl = this.#request.args.data.url as Platform.DevToolsPath.UrlString;\n    const resource = SDK.ResourceTreeModel.ResourceTreeModel.resourceForURL(originalUrl);\n    if (!resource) {\n      this.#imageDataUrl = null;\n      return this.#imageDataUrl;\n    }\n\n    const content = await resource.requestContentData();\n    if ('error' in content) {\n      this.#imageDataUrl = null;\n      return this.#imageDataUrl;\n    }\n\n    this.#imageDataUrl = content.asDataUrl();\n    return this.#imageDataUrl;\n  }\n\n  override async performUpdate(): Promise<void> {\n    if (!this.#request) {\n      return;\n    }\n\n    const input: ViewInput = {\n      request: this.#request,\n      imageDataUrl: await this.#getOrCreateImageDataUrl(),\n    };\n    this.#view(input, undefined, this.contentElement);\n  }\n}\n\nexport function imageRef(request: Trace.Types.Events.SyntheticNetworkRequest): Lit.TemplateResult {\n  return html`<devtools-widget .widgetConfig=${widgetConfig(ImageRef, {\n    request,\n  })}></devtools-widget>`;\n}\n"]}