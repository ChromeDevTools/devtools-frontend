{"version":3,"file":"LCPDiscovery.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/LCPDiscovery.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type {LCPDiscoveryInsightModel} from '../../../../models/trace/insights/LCPDiscovery.js';\nimport * as Trace from '../../../../models/trace/trace.js';\nimport * as uiI18n from '../../../../ui/i18n/i18n.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport {BaseInsightComponent} from './BaseInsightComponent.js';\nimport {Checklist} from './Checklist.js';\nimport {imageRef} from './ImageRef.js';\n\nconst {widgetConfig} = UI.Widget;\n\nconst {UIStrings, i18nString, getImageData} = Trace.Insights.Models.LCPDiscovery;\n\nconst {html} = Lit;\n\n// eslint-disable-next-line @devtools/l10n-filename-matches\nconst str_ = i18n.i18n.registerUIStrings('models/trace/insights/LCPDiscovery.ts', UIStrings);\n\nexport class LCPDiscovery extends BaseInsightComponent<LCPDiscoveryInsightModel> {\n  override internalName = 'lcp-discovery';\n\n  protected override hasAskAiSupport(): boolean {\n    return true;\n  }\n\n  protected override createOverlays(): Trace.Types.Overlays.Overlay[] {\n    if (!this.model) {\n      return [];\n    }\n\n    const overlays = this.model.createOverlays?.();\n    if (!overlays) {\n      return [];\n    }\n\n    const imageResults = getImageData(this.model);\n    if (!imageResults?.discoveryDelay) {\n      return [];\n    }\n\n    const timespanOverlaySection = overlays.find(overlay => overlay.type === 'TIMESPAN_BREAKDOWN')?.sections[0];\n    if (timespanOverlaySection) {\n      timespanOverlaySection.label = this.#renderDiscoveryDelay(imageResults.discoveryDelay);\n    }\n\n    return overlays;\n  }\n\n  override getEstimatedSavingsTime(): Trace.Types.Timing.Milli|null {\n    if (!this.model) {\n      return null;\n    }\n\n    return getImageData(this.model)?.estimatedSavings ?? null;\n  }\n\n  #renderDiscoveryDelay(delay: Trace.Types.Timing.Micro): HTMLElement {\n    // Trace.Types.Overlays.TimespanBreakdownEntryBreakdown needs an HTMLElement, which we have to localize here.\n    /* eslint-disable @devtools/no-imperative-dom-api */\n    const timeWrapper = document.createElement('span');\n    timeWrapper.classList.add('discovery-time-ms');\n    timeWrapper.innerText = i18n.TimeUtilities.formatMicroSecondsAsMillisFixed(delay);\n    return uiI18n.getFormatLocalizedString(str_, UIStrings.lcpLoadDelay, {PH1: timeWrapper});\n    /* eslint-enable @devtools/no-imperative-dom-api */\n  }\n\n  override renderContent(): Lit.LitTemplate {\n    if (!this.model) {\n      return Lit.nothing;\n    }\n\n    const imageData = getImageData(this.model);\n    if (!imageData) {\n      if (!this.model.lcpEvent) {\n        return html`<div class=\"insight-section\">${i18nString(UIStrings.noLcp)}</div>`;\n      }\n      return html`<div class=\"insight-section\">${i18nString(UIStrings.noLcpResource)}</div>`;\n    }\n\n    let delayEl;\n    if (imageData.discoveryDelay) {\n      delayEl = html`<div>${this.#renderDiscoveryDelay(imageData.discoveryDelay)}</div>`;\n    }\n\n    // clang-format off\n    return html`\n      <div class=\"insight-section\">\n        <devtools-widget .widgetConfig=${widgetConfig(Checklist, {\n          checklist: imageData.checklist,\n        })}></devtools-widget>\n        <div class=\"insight-section\">${imageRef(imageData.request)}${delayEl}</div>\n      </div>`;\n    // clang-format on\n  }\n}\n"]}