{"version":3,"file":"LegacyJavaScript.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/LegacyJavaScript.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as Bindings from '../../../../models/bindings/bindings.js';\nimport type {\n  LegacyJavaScriptInsightModel, PatternMatchResult} from '../../../../models/trace/insights/LegacyJavaScript.js';\nimport * as Trace from '../../../../models/trace/trace.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport {BaseInsightComponent} from './BaseInsightComponent.js';\nimport {scriptRef} from './ScriptRef.js';\nimport {Table, type TableDataRow} from './Table.js';\n\nconst {UIStrings, i18nString} = Trace.Insights.Models.LegacyJavaScript;\n\nconst {html} = Lit;\nconst {widgetConfig} = UI.Widget;\n\nexport class LegacyJavaScript extends BaseInsightComponent<LegacyJavaScriptInsightModel> {\n  override internalName = 'legacy-javascript';\n\n  override getEstimatedSavingsTime(): Trace.Types.Timing.Milli|null {\n    return this.model?.metricSavings?.FCP ?? null;\n  }\n\n  protected override hasAskAiSupport(): boolean {\n    return true;\n  }\n\n  async #revealLocation(script: Trace.Handlers.ModelHandlers.Scripts.Script, match: PatternMatchResult): Promise<void> {\n    const target = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!target) {\n      return;\n    }\n\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n    if (!debuggerModel) {\n      return;\n    }\n\n    const location = new SDK.DebuggerModel.Location(debuggerModel, script.scriptId, match.line, match.column);\n    if (!location) {\n      return;\n    }\n\n    const uiLocation =\n        await Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(location);\n    await Common.Revealer.reveal(uiLocation);\n  }\n\n  override renderContent(): Lit.LitTemplate {\n    if (!this.model) {\n      return Lit.nothing;\n    }\n\n    const rows: TableDataRow[] =\n        [...this.model.legacyJavaScriptResults.entries()].slice(0, 10).map(([script, result]) => {\n          const overlays: Trace.Types.Overlays.Overlay[] = [];\n          if (script.request) {\n            overlays.push({\n              type: 'ENTRY_OUTLINE',\n              entry: script.request,\n              outlineReason: 'ERROR',\n            });\n          }\n\n          return {\n            values: [scriptRef(script), i18n.ByteUtilities.bytesToString(result.estimatedByteSavings)],\n            overlays,\n            subRows: result.matches.map(match => {\n              return {\n                values: [html`<span @click=${\n                    () => this.#revealLocation(\n                        script, match)} title=${`${script.url}:${match.line}:${match.column}`}>${match.name}</span>`],\n              };\n            })\n          };\n        });\n\n    // clang-format off\n    return html`\n      <div class=\"insight-section\">\n        <devtools-widget .widgetConfig=${widgetConfig(Table, {\n           data: {\n            insight: this,\n            headers: [i18nString(UIStrings.columnScript), i18nString(UIStrings.columnWastedBytes)],\n            rows,\n          }})}>\n        </devtools-widget>\n      </div>\n    `;\n    // clang-format on\n  }\n}\n"]}