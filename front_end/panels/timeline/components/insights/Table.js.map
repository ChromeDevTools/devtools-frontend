{"version":3,"file":"Table.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/Table.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,+BAA+B,CAAC;AAEtD,OAAO,KAAK,EAAE,MAAM,iCAAiC,CAAC;AACtD,OAAO,KAAK,GAAG,MAAM,2BAA2B,CAAC;AAGjD,OAAO,EAAC,mBAAmB,EAAC,MAAM,eAAe,CAAC;AAClD,OAAO,WAAW,MAAM,gBAAgB,CAAC;AAEzC,MAAM,SAAS,GAAG;IAChB;;;OAGG;IACH,MAAM,EAAE,cAAc;CACd,CAAC;AAEX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,8CAA8C,EAAE,SAAS,CAAC,CAAC;AACpG,MAAM,CAAC,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAE7E,MAAM,EAAC,IAAI,EAAC,GAAG,GAAG,CAAC;AA0CnB,MAAM,UAAU,iBAAiB,CAAC,SAAiB;IACjD,OAAO,UAAU,CAAC,SAAS,CAAC,MAAM,EAAE,EAAC,GAAG,EAAE,SAAS,EAAC,CAAC,CAAC;AACxD,CAAC;AAOD;;;;;;;;GAQG;AACH,MAAM,UAAU,iBAAiB,CAAI,GAAQ,EAAE,UAAiC,EAAE,KAAK,GAAG,EAAE;IAC1F,IAAI,GAAG,CAAC,MAAM,KAAK,CAAC,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;QACpC,OAAO,EAAE,CAAC;IACZ,CAAC;IAED,MAAM,mBAAmB,GAAG,KAAK,GAAG,CAAC,CAAC;IACtC,MAAM,KAAK,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,mBAAmB,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;IAC1F,IAAI,GAAG,CAAC,MAAM,GAAG,KAAK,EAAE,CAAC;QACvB,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,wBAAwB,CAAC,GAAG,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC;SAAM,IAAI,GAAG,CAAC,MAAM,KAAK,KAAK,EAAE,CAAC;QAChC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;IAC5D,CAAC;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAcD,MAAM,CAAC,MAAM,YAAY,GAAS,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,EAAE;IAC1D,MAAM,EACJ,WAAW,EACX,OAAO,EACP,aAAa,EACb,UAAU,EACV,UAAU,EACV,YAAY,GACb,GAAG,KAAK,CAAC;IAEV,MAAM,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC;IAElC,SAAS,SAAS,CAAC,EAAC,GAAG,EAAE,KAAK,EAAwB;QACpD,MAAM,QAAQ,GAAG,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC;YACvC,WAAW,EAAE,QAAQ,KAAK,uBAAuB;YACjD,eAAe,EAAE;;;;YAIX;YACN,kBAAkB,EAAE,KAAK;YACzB,gBAAgB,EAAE,WAAW;YAC7B,cAAc,EAAE,QAAQ,KAAK,uBAAuB;SACrD,CAAC,CAAC;QACH,MAAM,QAAQ,GAAG,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC;YACvC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,oCAAoC,CAAC,CAAC,CAAC,EAAE;SACzD,CAAC,CAAC;QACH,MAAM,SAAS,GAAG,GAAG,CAAC,MAAM,CAAC,GAAG,CAC5B,CAAC,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAA;;wBAEZ,CAAC,KAAK,GAAG,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;sBAClD,QAAQ,IAAI,KAAK;kBACrB,CAAC,CAAC;YACY,IAAI,CAAA,OAAO,KAAK,OAAO,CAAC,CAAC;QACrD,OAAO,IAAI,CAAA,aAAa,QAAQ,IAAI,SAAS,OAAO,CAAC;IACvD,CAAC;IAED,MAAM,YAAY,GAAG,CAAC,EAAe,EAA2C,EAAE;QAChF,MAAM,KAAK,GAAG,EAAE,CAAC,OAAO,CAAC,IAAI,CAAwB,CAAC;QACtD,MAAM,GAAG,GAAG,aAAa,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,GAAG,CAAC;QACrD,OAAO,EAAC,GAAG,EAAE,KAAK,EAAC,CAAC;IACtB,CAAC,CAAC;IAEF,mBAAmB;IACnB,GAAG,CAAC,MAAM,CAAC,IAAI,CAAA;aACJ,WAAW;;gBAER,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC;QAChC,WAAW;KACZ,CAAC;sBACc,WAAW,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI;;;YAG3C,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAA,mBAAmB,CAAC,OAAO,CAAC;;;;qBAIxC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAQ,EAAE,EAAE;QACtC,MAAM,EAAC,GAAG,EAAE,KAAK,EAAC,GAAG,YAAY,CAAC,CAAC,CAAC,MAAqB,CAAC,CAAC;QAC3D,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IACzB,CAAC,CAAC,CAAC,CAAC,IAAI;iBACC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAQ,EAAE,EAAE;QAClC,MAAM,EAAC,GAAG,EAAE,KAAK,EAAC,GAAG,YAAY,CAAC,CAAC,CAAC,MAAqB,CAAC,CAAC;QAC3D,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IACzB,CAAC,CAAC,CAAC,CAAC,IAAI;SACP,aAAa,CAAC,GAAG,CAAC,SAAS,CAAC;aACxB,EACT,MAAM,CAAC,CAAC;IACV,kBAAkB;AACpB,CAAC,CAAC;AAEF,MAAM,OAAO,KAAM,SAAQ,EAAE,CAAC,MAAM,CAAC,MAAM;IACzC,KAAK,CAAO;IACZ,QAAQ,CAAwB;IAChC,MAAM,CAAc;IACpB,QAAQ,CAAY;IACpB,sFAAsF;IACtF,KAAK,CAAkB;IACvB,gIAAgI;IAChI,cAAc,CAA2B;IACzC,eAAe,GAAG,IAAI,GAAG,EAA8B,CAAC;IACxD,YAAY,GAAG,KAAK,CAAC;IACrB,gBAAgB,GAAsB,IAAI,CAAC;IAE3C,YAAY,OAAqB,EAAE,OAAa,YAAY;QAC1D,KAAK,CAAC,OAAO,EAAE,EAAC,YAAY,EAAE,IAAI,EAAC,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;IACpB,CAAC;IAED,IAAI,IAAI,CAAC,IAAe;QACtB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC;QAC5C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC;QAC7B,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC;QACvB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAClD,mFAAmF;QACnF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QAChF,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,oBAAoB;QAClB,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;YAChB,OAAO,EAAE,CAAC;QACZ,CAAC;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,eAAe,CAAC;QAC5C,cAAc,CAAC,KAAK,EAAE,CAAC;QAEvB,MAAM,aAAa,GAA4B,EAAE,CAAC;QAClD,SAAS,QAAQ,CAAC,MAAyB,EAAE,GAAiB,EAAE,KAAK,GAAG,CAAC;YACvE,IAAI,MAAM,EAAE,CAAC;gBACX,cAAc,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YAClC,CAAC;YAED,aAAa,CAAC,IAAI,CAAC,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC,CAAC;YAEjC,KAAK,MAAM,MAAM,IAAI,GAAG,CAAC,OAAO,IAAI,EAAE,EAAE,CAAC;gBACvC,QAAQ,CAAC,GAAG,EAAE,MAAM,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC;YACnC,CAAC;QACH,CAAC;QAED,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;YAC7B,QAAQ,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QACtB,CAAC;QAED,OAAO,aAAa,CAAC;IACvB,CAAC;IAED,WAAW,CAAC,GAAiB,EAAE,KAAkB;QAC/C,IAAI,GAAG,KAAK,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAClC,OAAO;QACT,CAAC;QAED,KAAK,MAAM,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE,CAAC;YACzD,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAC/B,CAAC;QAED,wCAAwC;QACxC,IAAI,MAAM,GAA2B,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACnE,OAAO,MAAM,EAAE,CAAC;YACd,KAAK,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACzC,CAAC;QAED,IAAI,CAAC,gBAAgB,GAAG,GAAG,CAAC;QAC5B,oFAAoF;QACpF,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;IAC1D,CAAC;IAED,WAAW,CAAC,GAAiB,EAAE,KAAkB;QAC/C,uEAAuE;QACvE,wDAAwD;QACxD,MAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;QAC9B,IAAI,QAAQ,EAAE,MAAM,KAAK,CAAC,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,eAAe,EAAE,CAAC;YACnE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,IAAI,mBAAmB,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;YACvE,OAAO;QACT,CAAC;QAED,qCAAqC;QACrC,IAAI,CAAC,qBAAqB,CAAC,GAAG,EAAE,KAAK,EAAE,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;IACzD,CAAC;IAED,aAAa;QACX,KAAK,MAAM,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,gBAAgB,CAAC,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC;YAC3E,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAC/B,CAAC;QAED,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;QAC7B,wCAAwC;QACxC,IAAI,CAAC,qBAAqB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACzC,CAAC;IAED,qBAAqB,CAAC,GAAsB,EAAE,KAAuB,EAAE,OAGnE,EAAE;QACJ,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YACnC,OAAO;QACT,CAAC;QAED,IAAI,IAAI,CAAC,MAAM,CAAC,iBAAiB,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAClD,OAAO;QACT,CAAC;QAED,kEAAkE;QAClE,IAAI,IAAI,CAAC,MAAM,CAAC,iBAAiB,IAAI,KAAK,KAAK,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;YACzE,KAAK,GAAG,IAAI,CAAC;YACb,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACtB,CAAC;QAED,IAAI,KAAK,IAAI,GAAG,EAAE,CAAC;YACjB,MAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;YAC9B,IAAI,QAAQ,EAAE,CAAC;gBACb,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CAAC,QAAQ,EAAE,EAAC,iBAAiB,EAAE,CAAC,IAAI,CAAC,OAAO,EAAC,CAAC,CAAC;YACtF,CAAC;QACH,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,EAAE,EAAC,iBAAiB,EAAE,KAAK,EAAC,CAAC,CAAC;QAC1E,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,SAAS,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACxD,KAAK,EAAE,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACjC,IAAI,CAAC,MAAM,CAAC,aAAa,GAAG,KAAK,CAAC;QAClC,IAAI,CAAC,MAAM,CAAC,iBAAiB,GAAG,IAAI,CAAC,MAAM,IAAI,KAAK,CAAC;IACvD,CAAC;IAEQ,aAAa;QACpB,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;YAC3C,OAAO;QACT,CAAC;QAED,MAAM,KAAK,GAAc;YACvB,WAAW,EAAE,IAAI,CAAC,YAAY;YAC9B,OAAO,EAAE,IAAI,CAAC,QAAQ;YACtB,aAAa,EAAE,IAAI,CAAC,cAAc;YAClC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC;YACvC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC;YACvC,YAAY,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC;SAC5C,CAAC;QACF,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;IACpD,CAAC;CACF","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Trace from '../../../../models/trace/trace.js';\nimport * as UI from '../../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport type * as BaseInsightComponent from './BaseInsightComponent.js';\nimport {EventReferenceClick} from './EventRef.js';\nimport tableStyles from './table.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Table row value representing the remaining items not shown in the table due to size constraints. This row will always represent at least 2 items.\n   * @example {5} PH1\n   */\n  others: '{PH1} others',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/components/insights/Table.ts', UIStrings);\nexport const i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst {html} = Lit;\n\ntype BaseInsightComponent = BaseInsightComponent.BaseInsightComponent<Trace.Insights.Types.InsightModel>;\n\n/**\n * @file An interactive table component.\n *\n * On hover:\n *           desaturates the relevant events (in both the minimap and the flamegraph), and\n *           replaces the current insight's overlays with the overlays attached to that row.\n *           The currently selected trace bounds does not change.\n *\n *           Removing the mouse from the table without clicking on any row restores the original\n *           overlays.\n *\n * On click:\n *           \"sticks\" the selection, replaces overlays like hover does, and additionally updates\n *           the current trace bounds to fit the bounds of the row's overlays.\n */\n\nexport interface TableState {\n  selectedRowEl: HTMLElement|null;\n  selectionIsSticky: boolean;\n}\n\ninterface TableData {\n  insight: BaseInsightComponent;\n  headers: string[];\n  rows: TableDataRow[];\n}\n\nexport interface TableDataRow {\n  values: Array<number|string|Lit.LitTemplate>;\n  overlays?: Trace.Types.Overlays.Overlay[];\n  subRows?: TableDataRow[];\n}\n\ninterface FlattenedTableDataRow {\n  row: TableDataRow;\n  depth: number;\n}\n\nexport function renderOthersLabel(numOthers: number): string {\n  return i18nString(UIStrings.others, {PH1: numOthers});\n}\n\nexport interface RowLimitAggregator<T> {\n  mapToRow: (item: T) => TableDataRow;\n  createAggregatedTableRow: (remaining: T[]) => TableDataRow;\n}\n\n/**\n * Maps `arr` to a list of `TableDataRow`s  using `aggregator.mapToRow`, but limits the number of `TableDataRow`s to `limit`.\n * If the length of `arr` is larger than `limit`, any excess rows will be aggregated into the final `TableDataRow` using `aggregator.createAggregatedTableRow`.\n *\n * Useful for creating a \"N others\" row in a data table.\n *\n * Example: `arr` is a list of 15 items & `limit` is 10. The first 9 items in `arr` would be mapped to `TableDataRow`s using `aggregator.mapToRow` and\n * the 10th `TableDataRow` would be created by using `aggregator.createAggregatedTableRow` on the 6 items that were not sent through `aggregator.mapToRow`.\n */\nexport function createLimitedRows<T>(arr: T[], aggregator: RowLimitAggregator<T>, limit = 10): TableDataRow[] {\n  if (arr.length === 0 || limit === 0) {\n    return [];\n  }\n\n  const aggregateStartIndex = limit - 1;\n  const items = arr.slice(0, aggregateStartIndex).map(aggregator.mapToRow.bind(aggregator));\n  if (arr.length > limit) {\n    items.push(aggregator.createAggregatedTableRow(arr.slice(aggregateStartIndex)));\n  } else if (arr.length === limit) {\n    items.push(aggregator.mapToRow(arr[aggregateStartIndex]));\n  }\n\n  return items;\n}\n\ninterface ViewInput {\n  interactive: boolean;\n  headers: string[];\n  flattenedRows: FlattenedTableDataRow[];\n\n  onHoverRow: (row: TableDataRow, rowEl: HTMLElement) => void;\n  onClickRow: (row: TableDataRow, rowEl: HTMLElement) => void;\n  onMouseLeave: () => void;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, output, target) => {\n  const {\n    interactive,\n    headers,\n    flattenedRows,\n    onHoverRow,\n    onClickRow,\n    onMouseLeave,\n  } = input;\n\n  const numColumns = headers.length;\n\n  function renderRow({row, depth}: FlattenedTableDataRow): Lit.TemplateResult {\n    const thStyles = Lit.Directives.styleMap({\n      paddingLeft: `calc(${depth} * var(--sys-size-5))`,\n      backgroundImage: `repeating-linear-gradient(\n            to right,\n            var(--sys-color-tonal-outline) 0 var(--sys-size-1),\n            transparent var(--sys-size-1) var(--sys-size-5)\n          )`,\n      backgroundPosition: '0 0',\n      backgroundRepeat: 'no-repeat',\n      backgroundSize: `calc(${depth} * var(--sys-size-5))`,\n    });\n    const trStyles = Lit.Directives.styleMap({\n      color: depth ? 'var(--sys-color-on-surface-subtle)' : '',\n    });\n    const columnEls = row.values.map(\n        (value, i) => i === 0 ? html`<th\n              scope=\"row\"\n              colspan=${i === row.values.length - 1 ? numColumns - i : 1}\n              style=${thStyles}>${value}\n            </th>` :\n                                html`<td>${value}</td>`);\n    return html`<tr style=${trStyles}>${columnEls}</tr>`;\n  }\n\n  const findRowAndEl = (el: HTMLElement): {row: TableDataRow, rowEl: HTMLElement} => {\n    const rowEl = el.closest('tr') as HTMLTableRowElement;\n    const row = flattenedRows[rowEl.sectionRowIndex].row;\n    return {row, rowEl};\n  };\n\n  // clang-format off\n  Lit.render(html`\n    <style>${tableStyles}</style>\n    <table\n        class=${Lit.Directives.classMap({\n        interactive,\n      })}\n        @mouseleave=${interactive ? onMouseLeave : null}>\n      <thead>\n        <tr>\n          ${headers.map(h => html`<th scope=\"col\">${h}</th>`)}\n        </tr>\n      </thead>\n      <tbody\n        @mouseover=${interactive ? (e: Event) => {\n          const {row, rowEl} = findRowAndEl(e.target as HTMLElement);\n          onHoverRow(row, rowEl);\n        } : null}\n        @click=${interactive ? (e: Event) => {\n          const {row, rowEl} = findRowAndEl(e.target as HTMLElement);\n          onClickRow(row, rowEl);\n        } : null}\n      >${flattenedRows.map(renderRow)}</tbody>\n    </table>`,\n    target);\n  // clang-format on\n};\n\nexport class Table extends UI.Widget.Widget {\n  #view: View;\n  #insight?: BaseInsightComponent;\n  #state?: TableState;\n  #headers?: string[];\n  /** The rows as given as by the user, which may include recursive rows via subRows. */\n  #rows?: TableDataRow[];\n  /** All rows/subRows, in the order that they appear visually. This is the result of traversing `#rows` and any subRows found. */\n  #flattenedRows?: FlattenedTableDataRow[];\n  #rowToParentRow = new Map<TableDataRow, TableDataRow>();\n  #interactive = false;\n  #currentHoverRow: TableDataRow|null = null;\n\n  constructor(element?: HTMLElement, view: View = DEFAULT_VIEW) {\n    super(element, {useShadowDom: true});\n    this.#view = view;\n  }\n\n  set data(data: TableData) {\n    this.#insight = data.insight;\n    this.#state = data.insight.sharedTableState;\n    this.#headers = data.headers;\n    this.#rows = data.rows;\n    this.#flattenedRows = this.#createFlattenedRows();\n    // If this table isn't interactive, don't attach mouse listeners or use CSS :hover.\n    this.#interactive = this.#rows.some(row => row.overlays || row.subRows?.length);\n    this.requestUpdate();\n  }\n\n  #createFlattenedRows(): FlattenedTableDataRow[] {\n    if (!this.#rows) {\n      return [];\n    }\n\n    const rowToParentRow = this.#rowToParentRow;\n    rowToParentRow.clear();\n\n    const flattenedRows: FlattenedTableDataRow[] = [];\n    function traverse(parent: TableDataRow|null, row: TableDataRow, depth = 0): void {\n      if (parent) {\n        rowToParentRow.set(row, parent);\n      }\n\n      flattenedRows.push({depth, row});\n\n      for (const subRow of row.subRows ?? []) {\n        traverse(row, subRow, depth + 1);\n      }\n    }\n\n    for (const row of this.#rows) {\n      traverse(null, row);\n    }\n\n    return flattenedRows;\n  }\n\n  #onHoverRow(row: TableDataRow, rowEl: HTMLElement): void {\n    if (row === this.#currentHoverRow) {\n      return;\n    }\n\n    for (const el of this.element.querySelectorAll('.hover')) {\n      el.classList.remove('hover');\n    }\n\n    // Add 'hover' class to all parent rows.\n    let curRow: TableDataRow|undefined = this.#rowToParentRow.get(row);\n    while (curRow) {\n      rowEl.classList.add('hover');\n      curRow = this.#rowToParentRow.get(row);\n    }\n\n    this.#currentHoverRow = row;\n    // Temporarily selects the row, but only if there is not already a sticky selection.\n    this.#onSelectedRowChanged(row, rowEl, {isHover: true});\n  }\n\n  #onClickRow(row: TableDataRow, rowEl: HTMLElement): void {\n    // If the desired overlays consist of just a single ENTRY_OUTLINE, then\n    // it is more intuitive to just select the target event.\n    const overlays = row.overlays;\n    if (overlays?.length === 1 && overlays[0].type === 'ENTRY_OUTLINE') {\n      this.element.dispatchEvent(new EventReferenceClick(overlays[0].entry));\n      return;\n    }\n\n    // Select the row and make it sticky.\n    this.#onSelectedRowChanged(row, rowEl, {sticky: true});\n  }\n\n  #onMouseLeave(): void {\n    for (const el of this.element.shadowRoot?.querySelectorAll('.hover') ?? []) {\n      el.classList.remove('hover');\n    }\n\n    this.#currentHoverRow = null;\n    // Unselect the row, unless it's sticky.\n    this.#onSelectedRowChanged(null, null);\n  }\n\n  #onSelectedRowChanged(row: TableDataRow|null, rowEl: HTMLElement|null, opts: {\n    sticky?: boolean,\n    isHover?: boolean,\n  } = {}): void {\n    if (!this.#state || !this.#insight) {\n      return;\n    }\n\n    if (this.#state.selectionIsSticky && !opts.sticky) {\n      return;\n    }\n\n    // Unselect a sticky-selection when clicking it for a second time.\n    if (this.#state.selectionIsSticky && rowEl === this.#state.selectedRowEl) {\n      rowEl = null;\n      opts.sticky = false;\n    }\n\n    if (rowEl && row) {\n      const overlays = row.overlays;\n      if (overlays) {\n        this.#insight.toggleTemporaryOverlays(overlays, {updateTraceWindow: !opts.isHover});\n      }\n    } else {\n      this.#insight.toggleTemporaryOverlays(null, {updateTraceWindow: false});\n    }\n\n    this.#state.selectedRowEl?.classList.remove('selected');\n    rowEl?.classList.add('selected');\n    this.#state.selectedRowEl = rowEl;\n    this.#state.selectionIsSticky = opts.sticky ?? false;\n  }\n\n  override performUpdate(): void {\n    if (!this.#headers || !this.#flattenedRows) {\n      return;\n    }\n\n    const input: ViewInput = {\n      interactive: this.#interactive,\n      headers: this.#headers,\n      flattenedRows: this.#flattenedRows,\n      onHoverRow: this.#onHoverRow.bind(this),\n      onClickRow: this.#onClickRow.bind(this),\n      onMouseLeave: this.#onMouseLeave.bind(this),\n    };\n    this.#view(input, undefined, this.contentElement);\n  }\n}\n"]}