{"version":3,"file":"ConsoleInsightHelpers.js","sourceRoot":"","sources":["../../../../../front_end/testing/ConsoleInsightHelpers.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,sBAAsB,CAAC;AAC7C,OAAO,KAAK,OAAO,MAAM,8BAA8B,CAAC;AACxD,OAAO,KAAK,OAAO,MAAM,8BAA8B,CAAC;AACxD,OAAO,KAAK,GAAG,MAAM,kBAAkB,CAAC;AAExC,OAAO,EAAC,sBAAsB,EAAC,MAAM,0BAA0B,CAAC;AAEhE,SAAS,iBAAiB;IACxB,OAAO;QACL,KAAK,CAAC,CACF,cAAc;YACZ,MAAM,EAAC,WAAW,EAAE,MAAM,EAAE,QAAQ,EAAE,EAAC,WAAW,EAAE,CAAC,EAAC,EAAE,SAAS,EAAE,IAAI,EAAC,CAAC;QAC3E,CAAC;QACL,mBAAmB,EAAE,KAAK,CAAC,GAAG,EAAE;KACjC,CAAC;AACJ,CAAC;AAED,SAAS,oBAAoB;IAC3B,OAAO;QACL,KAAK,CAAC,WAAW;YACf,OAAO;gBACL,MAAM,EAAE,EAAE;gBACV,OAAO,EAAE;oBACP;wBACE,IAAI,EAAE,OAAO,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO;wBAC9C,KAAK,EAAE,eAAe;qBACvB;iBACF;gBACD,uBAAuB,EAAE,IAAI;aAC9B,CAAC;QACJ,CAAC;QACD,cAAc;YACZ,OAAO,EAAE,CAAC;QACZ,CAAC;KACF,CAAC;AACJ,CAAC;AAED;;;GAGG;AACH,MAAM,CAAC,KAAK,UAAU,0BAA0B,CAAC,OAIhD;IACC,MAAM,MAAM,GAAG;QACb,SAAS,EAAE,OAAO,EAAE,SAAS,IAAI,GAAG,CAAC,UAAU,CAAC,SAAS,EAAsB;QAC/E,aAAa,EAAE,OAAO,EAAE,aAAa,IAAI,EAAE;KAC5C,CAAC;IAEF,MAAM,IAAI,GAAG,sBAAsB,CAAC,OAAO,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;IAEpE,IAAI,uBAAuB,GAAG,OAAO,EAAE,gBAAgB,uEAAqD,CAAC;IAC7G,MAAM,4BAA4B,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,0BAA0B,CAAC;SAC7D,SAAS,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC,CAAC;IAEpG,MAAM,gCAAgC,GAAG,CAAC,gBAAyD,EAAE,EAAE;QACrG,uBAAuB,GAAG,gBAAgB,CAAC;QAC3C,OAAO,4BAA4B,CAAC;IACtC,CAAC,CAAC;IAEF,MAAM,iBAAiB,GAAG,oBAAoB,EAAE,CAAC;IACjD,MAAM,cAAc,GAAG,iBAAiB,EAAE,CAAC;IAE3C,MAAM,SAAS,GAAG,IAAI,OAAO,CAAC,cAAc,CACxC,OAAO,EAAE,aAAa,IAAI,iBAAiB,EAC3C,OAAO,EAAE,UAAU,IAAI,cAAc,EACrC,OAAO,EAAE,gBAAgB,uEAAqD,EAC9E,SAAS,EACT,IAAI,CACP,CAAC;IAEF,MAAM,IAAI,CAAC,SAAS,CAAC;IAErB,OAAO;QACL,SAAS;QACT,IAAI;QACJ,MAAM;QACN,gCAAgC;QAChC,iBAAiB;QACjB,cAAc;KACf,CAAC;AACJ,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../core/host/host.js';\nimport * as Console from '../panels/console/console.js';\nimport * as Explain from '../panels/explain/explain.js';\nimport * as Lit from '../ui/lit/lit.js';\n\nimport {createViewFunctionStub} from './ViewFunctionHelpers.js';\n\nfunction getTestAidaClient() {\n  return {\n    async *\n        doConversation() {\n          yield {explanation: 'test', metadata: {rpcGlobalId: 0}, completed: true};\n        },\n    registerClientEvent: sinon.spy(),\n  };\n}\n\nfunction getTestPromptBuilder() {\n  return {\n    async buildPrompt() {\n      return {\n        prompt: '',\n        sources: [\n          {\n            type: Console.PromptBuilder.SourceType.MESSAGE,\n            value: 'error message',\n          },\n        ],\n        isPageReloadRecommended: true,\n      };\n    },\n    getSearchQuery() {\n      return '';\n    },\n  };\n}\n\n/**\n * Creates and shows an ConsoleInsight instance returning the view\n * stubs and the initial view input caused by Widget.show().\n */\nexport async function createConsoleInsightWidget(options?: Partial<Explain.ViewOutput>&{\n  aidaAvailability?: Host.AidaClient.AidaAccessPreconditions,\n  promptBuilder?: Explain.PublicPromptBuilder,\n  aidaClient?: Explain.PublicAidaClient,\n}) {\n  const output = {\n    headerRef: options?.headerRef ?? Lit.Directives.createRef<HTMLHeadingElement>(),\n    citationLinks: options?.citationLinks ?? [],\n  };\n\n  const view = createViewFunctionStub(Explain.ConsoleInsight, output);\n\n  let aidaAvailabilityForStub = options?.aidaAvailability ?? Host.AidaClient.AidaAccessPreconditions.AVAILABLE;\n  const checkAccessPreconditionsStub = sinon.stub(Host.AidaClient.AidaClient, 'checkAccessPreconditions')\n                                           .callsFake(() => Promise.resolve(aidaAvailabilityForStub));\n\n  const stubAidaCheckAccessPreconditions = (aidaAvailability: Host.AidaClient.AidaAccessPreconditions) => {\n    aidaAvailabilityForStub = aidaAvailability;\n    return checkAccessPreconditionsStub;\n  };\n\n  const testPromptBuilder = getTestPromptBuilder();\n  const testAidaClient = getTestAidaClient();\n\n  const component = new Explain.ConsoleInsight(\n      options?.promptBuilder ?? testPromptBuilder,\n      options?.aidaClient ?? testAidaClient,\n      options?.aidaAvailability ?? Host.AidaClient.AidaAccessPreconditions.AVAILABLE,\n      undefined,\n      view,\n  );\n\n  await view.nextInput;\n\n  return {\n    component,\n    view,\n    output,\n    stubAidaCheckAccessPreconditions,\n    testPromptBuilder,\n    testAidaClient,\n  };\n}\n"]}