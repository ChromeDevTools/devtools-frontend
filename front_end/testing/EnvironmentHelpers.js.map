{"version":3,"file":"EnvironmentHelpers.js","sourceRoot":"","sources":["../../../../../front_end/testing/EnvironmentHelpers.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../core/common/common.js';\nimport * as Host from '../core/host/host.js';\nimport type * as Platform from '../core/platform/platform.js';\nimport * as ProtocolClient from '../core/protocol_client/protocol_client.js';\nimport * as Root from '../core/root/root.js';\nimport * as SDK from '../core/sdk/sdk.js';\nimport type * as Protocol from '../generated/protocol.js';\nimport * as Bindings from '../models/bindings/bindings.js';\nimport * as Formatter from '../models/formatter/formatter.js';\nimport * as IssuesManager from '../models/issues_manager/issues_manager.js';\nimport * as Logs from '../models/logs/logs.js';\nimport * as Persistence from '../models/persistence/persistence.js';\nimport * as ProjectSettings from '../models/project_settings/project_settings.js';\nimport * as Workspace from '../models/workspace/workspace.js';\nimport type * as UIModule from '../ui/legacy/legacy.js';\n\nimport {deinitializeGlobalLocaleVars, initializeGlobalLocaleVars} from './LocaleHelpers.js';\nimport {MockCDPConnection} from './MockCDPConnection.js';\nimport {cleanupRuntime, setupRuntime} from './RuntimeHelpers.js';\nimport {cleanupSettings, setupSettings} from './SettingsHelpers.js';\n\n// Don't import UI at this stage because it will fail without\n// the environment. Instead we do the import at the end of the\n// initialization phase.\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet UI: typeof UIModule;\n\nlet uniqueTargetId = 0;\n\nexport function createTarget({\n  id,\n  name,\n  type = SDK.Target.Type.FRAME,\n  parentTarget,\n  subtype,\n  url = 'http://example.com',\n  connection,\n  targetManager = SDK.TargetManager.TargetManager.instance(),\n}: {\n  id?: Protocol.Target.TargetID,\n  name?: string,\n  type?: SDK.Target.Type,\n  parentTarget?: SDK.Target.Target,\n  subtype?: string,\n  url?: string,\n  connection?: ProtocolClient.CDPConnection.CDPConnection,\n  targetManager?: SDK.TargetManager.TargetManager,\n} = {}) {\n  if (!id) {\n    if (!uniqueTargetId++) {\n      id = 'test' as Protocol.Target.TargetID;\n    } else {\n      id = ('test' + uniqueTargetId) as Protocol.Target.TargetID;\n    }\n  }\n  if (!ProtocolClient.ConnectionTransport.ConnectionTransport.getFactory()) {\n    // We are not running with `describeWithMockConnection` so create a fresh mock connection.\n    // Because child targets inherit the SessionRouter/CDPConnection from the parent, we'll throw if a\n    // connection is passed together with a parent target as it would have no effect.\n    if (parentTarget && connection) {\n      throw new Error(\n          'Can\\'t create child targets with it\\'s own connection. Child targets share the connection with their parent.');\n    }\n    if (!connection && !parentTarget) {\n      connection = new MockCDPConnection([]);\n    }\n  }\n  return targetManager.createTarget(\n      id, name ?? id, type, parentTarget ? parentTarget : null, /* sessionId=*/ parentTarget ? id : undefined,\n      /* suspended=*/ false, connection, {targetId: id, url, subtype} as Protocol.Target.TargetInfo);\n}\n\nexport {stubNoopSettings} from './SettingsHelpers.js';\n\nexport function registerActions(actions: UIModule.ActionRegistration.ActionRegistration[]): void {\n  for (const action of actions) {\n    UI.ActionRegistration.maybeRemoveActionExtension(action.actionId);\n    UI.ActionRegistration.registerActionExtension(action);\n  }\n  const actionRegistryInstance = UI.ActionRegistry.ActionRegistry.instance({forceNew: true});\n  UI.ShortcutRegistry.ShortcutRegistry.instance({forceNew: true, actionRegistry: actionRegistryInstance});\n}\n\nexport function registerNoopActions(actionIds: string[]): void {\n  for (const actionId of actionIds) {\n    UI.ActionRegistration.maybeRemoveActionExtension(actionId);\n    UI.ActionRegistration.registerActionExtension({\n      actionId,\n      category: UI.ActionRegistration.ActionCategory.NONE,\n      title: () => 'mock' as Platform.UIString.LocalizedString,\n    });\n  }\n  const actionRegistryInstance = UI.ActionRegistry.ActionRegistry.instance({forceNew: true});\n  UI.ShortcutRegistry.ShortcutRegistry.instance({forceNew: true, actionRegistry: actionRegistryInstance});\n}\n\nexport async function initializeGlobalVars({reset = true} = {}) {\n  await initializeGlobalLocaleVars();\n\n  setupSettings(reset);\n  setupRuntime();\n\n  // Dynamically import UI after the rest of the environment is set up, otherwise it will fail.\n  UI = await import('../ui/legacy/legacy.js');\n  UI.ZoomManager.ZoomManager.instance(\n      {forceNew: true, win: window, frontendHost: Host.InspectorFrontendHost.InspectorFrontendHostInstance});\n\n  // Initialize context menus.\n  UI.UIUtils.initializeUIUtils(document);\n}\n\nexport async function deinitializeGlobalVars() {\n  // Remove the global SDK.\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  const globalObject = (globalThis as unknown as {SDK?: unknown, ls?: unknown});\n  delete globalObject.SDK;\n  delete globalObject.ls;\n\n  for (const target of SDK.TargetManager.TargetManager.instance().targets()) {\n    target.dispose('deinitializeGlobalVars');\n  }\n\n  // Remove instances.\n  deinitializeGlobalLocaleVars();\n  Logs.NetworkLog.NetworkLog.removeInstance();\n  SDK.TargetManager.TargetManager.removeInstance();\n  SDK.FrameManager.FrameManager.removeInstance();\n  Common.Settings.Settings.removeInstance();\n  Common.Revealer.RevealerRegistry.removeInstance();\n  Common.Console.Console.removeInstance();\n  Workspace.Workspace.WorkspaceImpl.removeInstance();\n  Workspace.IgnoreListManager.IgnoreListManager.removeInstance();\n  Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.removeInstance();\n  Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.removeInstance();\n  IssuesManager.IssuesManager.IssuesManager.removeInstance();\n  Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.removeInstance();\n  ProjectSettings.ProjectSettingsModel.ProjectSettingsModel.removeInstance();\n  Formatter.FormatterWorkerPool.FormatterWorkerPool.removeInstance();\n\n  cleanupSettings();\n\n  // Protect against the dynamic import not having happened.\n  if (UI) {\n    UI.ZoomManager.ZoomManager.removeInstance();\n    UI.ViewManager.ViewManager.removeInstance();\n    UI.ViewManager.resetViewRegistration();\n    UI.Context.Context.removeInstance();\n    UI.InspectorView.InspectorView.removeInstance();\n    UI.ActionRegistry.ActionRegistry.reset();\n  }\n\n  cleanupRuntime();\n}\n\nexport function describeWithEnvironment(title: string, fn: (this: Mocha.Suite) => void, opts: {reset: boolean} = {\n  reset: true,\n}) {\n  return describe(title, function() {\n    before(async () => await initializeGlobalVars(opts));\n    fn.call(this);\n    after(async () => await deinitializeGlobalVars());\n  });\n}\n\ndescribeWithEnvironment.only = function(title: string, fn: (this: Mocha.Suite) => void, opts: {reset: boolean} = {\n  reset: true,\n}) {\n  // eslint-disable-next-line mocha/no-exclusive-tests\n  return describe.only(title, function() {\n    before(async () => await initializeGlobalVars(opts));\n    fn.call(this);\n    after(async () => await deinitializeGlobalVars());\n  });\n};\ndescribeWithEnvironment.skip = function(title: string, fn: (this: Mocha.Suite) => void, _opts: {reset: boolean} = {\n  reset: true,\n}) {\n  // eslint-disable-next-line @devtools/check-test-definitions\n  return describe.skip(title, function() {\n    fn.call(this);\n  });\n};\n\nexport function createFakeSetting<T>(name: string, defaultValue: T): Common.Settings.Setting<T> {\n  const storage = new Common.Settings.SettingsStorage({}, undefined, 'test');\n  return new Common.Settings.Setting(name, defaultValue, new Common.ObjectWrapper.ObjectWrapper(), storage);\n}\n\nexport function createFakeRegExpSetting(name: string, defaultValue: string): Common.Settings.RegExpSetting {\n  const storage = new Common.Settings.SettingsStorage({}, undefined, 'test');\n  return new Common.Settings.RegExpSetting(name, defaultValue, new Common.ObjectWrapper.ObjectWrapper(), storage);\n}\n\nexport function setupActionRegistry() {\n  before(function() {\n    const actionRegistry = UI.ActionRegistry.ActionRegistry.instance();\n    UI.ShortcutRegistry.ShortcutRegistry.instance({\n      forceNew: true,\n      actionRegistry,\n    });\n  });\n  after(function() {\n    if (UI) {\n      UI.ShortcutRegistry.ShortcutRegistry.removeInstance();\n      UI.ActionRegistry.ActionRegistry.removeInstance();\n    }\n  });\n}\n\n/** This needs to be invoked within a describe block, rather than within an it() block. **/\nexport function expectConsoleLogs(expectedLogs: {warn?: string[], log?: string[], error?: string[]}) {\n  const {error, warn, log} = console;\n  before(() => {\n    if (expectedLogs.log) {\n      // eslint-disable-next-line no-console\n      console.log = (...data: unknown[]) => {\n        if (!expectedLogs.log?.includes(data.join(' '))) {\n          log(...data);\n        }\n      };\n    }\n    if (expectedLogs.warn) {\n      console.warn = (...data: unknown[]) => {\n        if (!expectedLogs.warn?.includes(data.join(' '))) {\n          warn(...data);\n        }\n      };\n    }\n    if (expectedLogs.error) {\n      console.error = (...data: unknown[]) => {\n        if (!expectedLogs.error?.includes(data.join(' '))) {\n          error(...data);\n        }\n      };\n    }\n  });\n  after(() => {\n    if (expectedLogs.log) {\n      // eslint-disable-next-line no-console\n      console.log = log;\n    }\n    if (expectedLogs.warn) {\n      console.warn = warn;\n    }\n    if (expectedLogs.error) {\n      console.error = error;\n    }\n  });\n}\n\nlet originalUserAgent: string;\n\nexport function setUserAgentForTesting(): void {\n  originalUserAgent = window.navigator.userAgent;\n  Object.defineProperty(window.navigator, 'userAgent', {value: 'Chrome/unit_test', configurable: true});\n}\n\nexport function restoreUserAgentForTesting(): void {\n  Object.defineProperty(window.navigator, 'userAgent', {value: originalUserAgent});\n}\n\nexport function resetHostConfig() {\n  for (const key of Object.keys(Root.Runtime.hostConfig)) {\n    // @ts-expect-error TypeScript does not deduce the correct type\n    delete Root.Runtime.hostConfig[key];\n  }\n}\n\n/**\n * Update `Root.Runtime.hostConfig` for testing.\n * `Root.Runtime.hostConfig` is automatically cleaned-up between unit\n * tests.\n */\nexport function updateHostConfig(config: Root.Runtime.HostConfig) {\n  Object.assign(Root.Runtime.hostConfig, config);\n}\n"]}