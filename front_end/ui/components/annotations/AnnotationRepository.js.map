{"version":3,"file":"AnnotationRepository.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/annotations/AnnotationRepository.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,gCAAgC,CAAC;AACzD,OAAO,KAAK,IAAI,MAAM,4BAA4B,CAAC;AAGnD,OAAO,EAAC,cAAc,EAAC,MAAM,qBAAqB,CAAC;AA0BnD,MAAM,OAAO,oBAAoB;IAC/B,MAAM,CAAC,SAAS,GAA8B,IAAI,CAAC;IACnD,OAAO,GAAG,IAAI,MAAM,CAAC,aAAa,CAAC,aAAa,EAAc,CAAC;IAC/D,YAAY,GAAyB,EAAE,CAAC;IACxC,OAAO,GAAG,CAAC,CAAC;IAEZ,MAAM,CAAC,QAAQ;QACb,IAAI,CAAC,oBAAoB,CAAC,SAAS,EAAE,CAAC;YACpC,oBAAoB,CAAC,SAAS,GAAG,IAAI,oBAAoB,EAAE,CAAC;QAC9D,CAAC;QACD,OAAO,oBAAoB,CAAC,SAAS,CAAC;IACxC,CAAC;IAED,MAAM,CAAC,kBAAkB;QACvB,OAAO,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,kBAAkB,EAAE,OAAO,CAAC,CAAC;IACtE,CAAC;IAED,gBAAgB,CACZ,SAAY,EAAE,QAA4E,EAC1F,UAAmB;QACrB,IAAI,CAAC,oBAAoB,CAAC,kBAAkB,EAAE,EAAE,CAAC;YAC/C,OAAO,CAAC,IAAI,CAAC,kEAAkE,CAAC,CAAC;QACnF,CAAC;QACD,OAAO,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC;IACxE,CAAC;IAED,oBAAoB,CAAC,IAAoB;QACvC,IAAI,CAAC,oBAAoB,CAAC,kBAAkB,EAAE,EAAE,CAAC;YAC/C,OAAO,CAAC,IAAI,CAAC,+DAA+D,CAAC,CAAC;YAC9E,OAAO,EAAE,CAAC;QACZ,CAAC;QAED,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC;QACrF,OAAO,WAAW,CAAC;IACrB,CAAC;IAED,qBAAqB,CACjB,KAAa,EACb,QAAiB,EACjB,MAA6B,EAC7B,cAAuB;QAEzB,IAAI,CAAC,oBAAoB,CAAC,kBAAkB,EAAE,EAAE,CAAC;YAC/C,OAAO,CAAC,IAAI,CAAC,4DAA4D,CAAC,CAAC;YAC3E,OAAO;QACT,CAAC;QAED,MAAM,cAAc,GAA2B;YAC7C,EAAE,EAAE,IAAI,CAAC,OAAO,EAAE;YAClB,IAAI,EAAE,cAAc,CAAC,YAAY;YACjC,OAAO,EAAE,KAAK;YACd,QAAQ,EAAE,QAAQ,IAAI,EAAE;YACxB,MAAM;YACN,cAAc;SACf,CAAC;QACF,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACvC,sCAAsC;QACtC,OAAO,CAAC,GAAG,CAAC,0CAA0C,EAAE,KAAK,EAAE;YAC7D,cAAc;YACd,WAAW,EAAE,IAAI,CAAC,YAAY,CAAC,MAAM;SACtC,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,wBAAwB,kDAA0B,cAAc,CAAC,CAAC;IACjF,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Root from '../../../core/root/root.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\n\nimport {AnnotationType} from './AnnotationType.js';\n\ninterface BaseAnnotationData {\n  id: number;\n  type: AnnotationType;\n  message: string;\n  // Sometimes the anchor for an annotation is not known, but is provided using a\n  // string id instead (which can be converted to an `anchor` later).\n  lookupId: string;\n  // Sometimes we want annotations to anchor to a particular string on the page.\n  anchorToString?: string;\n}\n\nexport interface ElementsAnnotationData extends BaseAnnotationData {\n  type: AnnotationType.ELEMENT_NODE;\n  anchor?: SDK.DOMModel.DOMNode;\n}\n\nexport const enum Events {\n  ANNOTATION_ADDED = 'AnnotationAdded',\n}\n\nexport interface EventTypes {\n  [Events.ANNOTATION_ADDED]: BaseAnnotationData;\n}\n\nexport class AnnotationRepository {\n  static #instance: AnnotationRepository|null = null;\n  #events = new Common.ObjectWrapper.ObjectWrapper<EventTypes>();\n  #annotations: BaseAnnotationData[] = [];\n  #nextId = 0;\n\n  static instance(): AnnotationRepository {\n    if (!AnnotationRepository.#instance) {\n      AnnotationRepository.#instance = new AnnotationRepository();\n    }\n    return AnnotationRepository.#instance;\n  }\n\n  static annotationsEnabled(): boolean {\n    return Boolean(Root.Runtime.hostConfig.devToolsGreenDevUi?.enabled);\n  }\n\n  addEventListener<T extends keyof EventTypes>(\n      eventType: T, listener: (arg0: Common.EventTarget.EventTargetEvent<EventTypes[T]>) => void,\n      thisObject?: Object): Common.EventTarget.EventDescriptor<EventTypes, T> {\n    if (!AnnotationRepository.annotationsEnabled()) {\n      console.warn('Received request to add event listener with annotations disabled');\n    }\n    return this.#events.addEventListener(eventType, listener, thisObject);\n  }\n\n  getAnnotationsByType(type: AnnotationType): BaseAnnotationData[] {\n    if (!AnnotationRepository.annotationsEnabled()) {\n      console.warn('Received query for annotation types with annotations disabled');\n      return [];\n    }\n\n    const annotations = this.#annotations.filter(annotation => annotation.type === type);\n    return annotations;\n  }\n\n  addElementsAnnotation(\n      label: string,\n      lookupId?: string,\n      anchor?: SDK.DOMModel.DOMNode,\n      anchorToString?: string,\n      ): void {\n    if (!AnnotationRepository.annotationsEnabled()) {\n      console.warn('Received annotation registration with annotations disabled');\n      return;\n    }\n\n    const annotationData: ElementsAnnotationData = {\n      id: this.#nextId++,\n      type: AnnotationType.ELEMENT_NODE,\n      message: label,\n      lookupId: lookupId || '',\n      anchor,\n      anchorToString\n    };\n    this.#annotations.push(annotationData);\n    // eslint-disable-next-line no-console\n    console.log('[AnnotationRepository] Added annotation:', label, {\n      annotationData,\n      annotations: this.#annotations.length,\n    });\n    this.#events.dispatchEventToListeners(Events.ANNOTATION_ADDED, annotationData);\n  }\n}\n"]}