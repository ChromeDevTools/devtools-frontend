{"version":3,"file":"AccessiblePlaceholder.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AccessiblePlaceholder.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAC7B,oDAAoD;AAEpD,OAAO,KAAK,EAAE,MAAM,yDAAyD,CAAC;AAG9E,MAAM,UAAU,WAAW,CAAC,IAAa,EAAE,IAAa;IAMtD,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;IACxC,OAAO,EAAC,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC;AACjE,CAAC;AAED;;;;;;;GAOG;AACH,MAAM,OAAO,qBAAsB,SAAQ,EAAE,CAAC,UAAU;IACjC;IAArB,YAAqB,MAAwB;QAC3C,KAAK,EAAE,CAAC;QADW,WAAM,GAAN,MAAM,CAAkB;IAE7C,CAAC;IAED,KAAK;QACH,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC5C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,CAAC,aAAa,GAAG,MAAM,CAAC;QAClC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACM,QAAQ,CAAC,GAAgB;QAMhC,MAAM,kBAAkB,GAAG,GAAG,CAAC,iBAAiB,EAAE,qBAAqB,EAAE,CAAC;QAC1E,IAAI,CAAC,kBAAkB,EAAE,CAAC;YACxB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAyB,CAAC,CAAC;QACrE,MAAM,IAAI,GAAG,WAAW,CAAC,kBAAkB,EAAE,KAAK,CAAC,SAAS,KAAK,KAAK,CAAC,CAAC;QACxE,MAAM,UAAU,GAAG,QAAQ,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;QAClD,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,GAAG,UAAU,GAAG,GAAG,EAAE,CAAC;YAC9C,OAAO,EAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,GAAG,GAAG,UAAU,EAAC,CAAC;QAC5F,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAEQ,WAAW,CAAC,CAAQ;QAC3B,OAAO,KAAK,CAAC;IACf,CAAC;IAEQ,OAAO,CAAC,GAAgB;QAC/B,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,CAAC;IAC5B,CAAC;IAEQ,EAAE,CAAC,KAA4B;QACtC,OAAO,IAAI,CAAC,MAAM,KAAK,KAAK,CAAC,MAAM,CAAC;IACtC,CAAC;CACF","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as CM from '../../../third_party/codemirror.next/codemirror.next.js';\nimport type * as UI from '../../legacy/legacy.js';\n\nexport function flattenRect(rect: DOMRect, left: boolean): {\n  left: number,\n  right: number,\n  top: number,\n  bottom: number,\n} {\n  const x = left ? rect.left : rect.right;\n  return {left: x, right: x, top: rect.top, bottom: rect.bottom};\n}\n\n/**\n * A CodeMirror WidgetType that displays a UI.Widget.Widget as a placeholder.\n *\n * This custom placeholder implementation is used in place of the default\n * CodeMirror placeholder to provide better accessibility. Specifically,\n * it ensures that screen readers can properly announce the content within\n * the encapsulated widget.\n */\nexport class AccessiblePlaceholder extends CM.WidgetType {\n  constructor(readonly teaser: UI.Widget.Widget) {\n    super();\n  }\n\n  toDOM(): HTMLElement {\n    const wrap = document.createElement('span');\n    wrap.classList.add('cm-placeholder');\n    wrap.style.pointerEvents = 'none';\n    wrap.tabIndex = 0;\n    this.teaser.show(wrap, undefined, true);\n    return wrap;\n  }\n\n  /**\n   * Controls the cursor's height by reporting this widget's bounds as a\n   * single line. This prevents the cursor from expanding vertically when the\n   * placeholder content wraps across multiple lines.\n   */\n  override coordsAt(dom: HTMLElement): {\n    left: number,\n    right: number,\n    top: number,\n    bottom: number,\n  }|null {\n    const boundingClientRect = dom.firstElementChild?.getBoundingClientRect();\n    if (!boundingClientRect) {\n      return null;\n    }\n    const style = window.getComputedStyle(dom.parentNode as HTMLElement);\n    const rect = flattenRect(boundingClientRect, style.direction !== 'rtl');\n    const lineHeight = parseInt(style.lineHeight, 10);\n    if (rect.bottom - rect.top > lineHeight * 1.5) {\n      return {left: rect.left, right: rect.right, top: rect.top, bottom: rect.top + lineHeight};\n    }\n    return rect;\n  }\n\n  override ignoreEvent(_: Event): boolean {\n    return false;\n  }\n\n  override destroy(dom: HTMLElement): void {\n    super.destroy(dom);\n    this.teaser?.hideWidget();\n  }\n\n  override eq(other: AccessiblePlaceholder): boolean {\n    return this.teaser === other.teaser;\n  }\n}\n"]}