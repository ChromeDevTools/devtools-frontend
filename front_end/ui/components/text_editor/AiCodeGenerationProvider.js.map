{"version":3,"file":"AiCodeGenerationProvider.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AiCodeGenerationProvider.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as AiCodeCompletion from '../../../models/ai_code_completion/ai_code_completion.js';\nimport * as AiCodeGeneration from '../../../models/ai_code_generation/ai_code_generation.js';\nimport * as PanelCommon from '../../../panels/common/common.js';\nimport * as CodeMirror from '../../../third_party/codemirror.next/codemirror.next.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../visual_logging/visual_logging.js';\n\nimport {AccessiblePlaceholder} from './AccessiblePlaceholder.js';\nimport {AiCodeGenerationParser} from './AiCodeGenerationParser.js';\nimport {\n  acceptAiAutoCompleteSuggestion,\n  aiAutoCompleteSuggestion,\n  aiAutoCompleteSuggestionState,\n  hasActiveAiSuggestion,\n  setAiAutoCompleteSuggestion,\n} from './config.js';\nimport type {TextEditor} from './TextEditor.js';\n\nexport enum AiCodeGenerationTeaserMode {\n  ACTIVE = 'active',\n  DISMISSED = 'dismissed',\n}\n\nexport const setAiCodeGenerationTeaserMode = CodeMirror.StateEffect.define<AiCodeGenerationTeaserMode>();\n\nconst aiCodeGenerationTeaserModeState = CodeMirror.StateField.define<AiCodeGenerationTeaserMode>({\n  create: () => AiCodeGenerationTeaserMode.ACTIVE,\n  update(value, tr) {\n    return tr.effects.find(effect => effect.is(setAiCodeGenerationTeaserMode))?.value ?? value;\n  },\n});\n\nexport interface AiCodeGenerationConfig {\n  generationContext: {\n    inferenceLanguage?: Host.AidaClient.AidaInferenceLanguage,\n  };\n  onSuggestionAccepted: (citations: Host.AidaClient.Citation[]) => void;\n  onRequestTriggered: () => void;\n  onResponseReceived: () => void;\n  panel: AiCodeCompletion.AiCodeCompletion.ContextFlavor;\n}\n\nexport class AiCodeGenerationProvider {\n  #devtoolsLocale: string;\n  #aiCodeCompletionSetting = Common.Settings.Settings.instance().createSetting('ai-code-completion-enabled', false);\n  #generationTeaserCompartment = new CodeMirror.Compartment();\n  #generationTeaser: PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser;\n  #editor?: TextEditor;\n  #aiCodeGenerationConfig: AiCodeGenerationConfig;\n  #aiCodeGeneration?: AiCodeGeneration.AiCodeGeneration.AiCodeGeneration;\n  #aiCodeGenerationCitations: Host.AidaClient.Citation[] = [];\n\n  #aidaClient: Host.AidaClient.AidaClient = new Host.AidaClient.AidaClient();\n  #boundOnUpdateAiCodeGenerationState = this.#updateAiCodeGenerationState.bind(this);\n  #controller = new AbortController();\n\n  private constructor(aiCodeGenerationConfig: AiCodeGenerationConfig) {\n    this.#devtoolsLocale = i18n.DevToolsLocale.DevToolsLocale.instance().locale;\n    if (!AiCodeGeneration.AiCodeGeneration.AiCodeGeneration.isAiCodeGenerationEnabled(this.#devtoolsLocale)) {\n      throw new Error('AI code generation feature is not enabled.');\n    }\n    this.#generationTeaser = new PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser();\n    this.#generationTeaser.disclaimerTooltipId =\n        aiCodeGenerationConfig.panel + '-ai-code-generation-disclaimer-tooltip';\n    this.#generationTeaser.panel = aiCodeGenerationConfig.panel;\n    this.#aiCodeGenerationConfig = aiCodeGenerationConfig;\n  }\n\n  static createInstance(aiCodeGenerationConfig: AiCodeGenerationConfig): AiCodeGenerationProvider {\n    return new AiCodeGenerationProvider(aiCodeGenerationConfig);\n  }\n\n  extension(): CodeMirror.Extension[] {\n    return [\n      CodeMirror.EditorView.updateListener.of(update => this.#activateTeaser(update)),\n      CodeMirror.EditorView.updateListener.of(update => this.#abortOrDismissGenerationDuringUpdate(update)),\n      aiAutoCompleteSuggestion,\n      aiAutoCompleteSuggestionState,\n      aiCodeGenerationTeaserModeState,\n      CodeMirror.Prec.highest(this.#generationTeaserCompartment.of([])),\n      CodeMirror.Prec.highest(CodeMirror.keymap.of(this.#editorKeymap())),\n    ];\n  }\n\n  dispose(): void {\n    this.#controller.abort();\n    this.#cleanupAiCodeGeneration();\n  }\n\n  editorInitialized(editor: TextEditor): void {\n    this.#editor = editor;\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#boundOnUpdateAiCodeGenerationState);\n    this.#aiCodeCompletionSetting.addChangeListener(this.#boundOnUpdateAiCodeGenerationState);\n    void this.#updateAiCodeGenerationState();\n  }\n\n  #setupAiCodeGeneration(): void {\n    if (this.#aiCodeGeneration) {\n      return;\n    }\n    this.#aiCodeGeneration = new AiCodeGeneration.AiCodeGeneration.AiCodeGeneration({aidaClient: this.#aidaClient});\n    this.#editor?.dispatch({\n      effects:\n          [this.#generationTeaserCompartment.reconfigure([aiCodeGenerationTeaserExtension(this.#generationTeaser)])],\n    });\n  }\n\n  #cleanupAiCodeGeneration(): void {\n    if (!this.#aiCodeGeneration) {\n      return;\n    }\n    this.#aiCodeGeneration = undefined;\n    this.#editor?.dispatch({\n      effects: [this.#generationTeaserCompartment.reconfigure([])],\n    });\n  }\n\n  async #updateAiCodeGenerationState(): Promise<void> {\n    const aidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    const isAvailable = aidaAvailability === Host.AidaClient.AidaAccessPreconditions.AVAILABLE;\n    const isEnabled = this.#aiCodeCompletionSetting.get();\n    if (isAvailable && isEnabled) {\n      this.#setupAiCodeGeneration();\n    } else {\n      this.#cleanupAiCodeGeneration();\n    }\n  }\n\n  #editorKeymap(): readonly CodeMirror.KeyBinding[] {\n    return [\n      {\n        key: 'Escape',\n        run: (): boolean => {\n          if (!this.#editor || !this.#aiCodeGeneration) {\n            return false;\n          }\n          if (hasActiveAiSuggestion(this.#editor.state)) {\n            this.#dismissTeaserAndSuggestion();\n            return true;\n          }\n          const generationTeaserIsLoading = this.#generationTeaser.displayState ===\n              PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING;\n          if (this.#generationTeaser.isShowing() && generationTeaserIsLoading) {\n            this.#controller.abort();\n            this.#controller = new AbortController();\n            this.#dismissTeaserAndSuggestion();\n            return true;\n          }\n          return false;\n        },\n      },\n      {\n        key: 'Tab',\n        run: (): boolean => {\n          if (!this.#aiCodeGeneration || !this.#editor || !hasActiveAiSuggestion(this.#editor.state)) {\n            return false;\n          }\n          const {accepted, suggestion} = acceptAiAutoCompleteSuggestion(this.#editor.editor);\n          if (!accepted) {\n            return false;\n          }\n          if (suggestion?.rpcGlobalId) {\n            this.#aiCodeGeneration.registerUserAcceptance(suggestion.rpcGlobalId, suggestion.sampleId);\n          }\n          this.#aiCodeGenerationConfig?.onSuggestionAccepted(this.#aiCodeGenerationCitations);\n          return true;\n        },\n      },\n      {\n        any: (_view: unknown, event: KeyboardEvent) => {\n          if (!this.#editor || !this.#aiCodeGeneration || !this.#generationTeaser.isShowing()) {\n            return false;\n          }\n          if (UI.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(event)) {\n            if (event.key === 'i') {\n              event.consume(true);\n              void VisualLogging.logKeyDown(event.currentTarget, event, 'ai-code-generation.triggered');\n              void this.#triggerAiCodeGeneration({signal: this.#controller.signal});\n              return true;\n            }\n          }\n          return false;\n        }\n      }\n    ];\n  }\n\n  #dismissTeaserAndSuggestion(): void {\n    this.#generationTeaser.displayState = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.TRIGGER;\n    this.#editor?.dispatch({\n      effects: [\n        setAiCodeGenerationTeaserMode.of(AiCodeGenerationTeaserMode.DISMISSED),\n        setAiAutoCompleteSuggestion.of(null),\n      ]\n    });\n  }\n\n  #activateTeaser(update: CodeMirror.ViewUpdate): void {\n    const currentTeaserMode = update.state.field(aiCodeGenerationTeaserModeState);\n    if (currentTeaserMode === AiCodeGenerationTeaserMode.ACTIVE) {\n      return;\n    }\n    if (!update.docChanged && update.state.selection.main.head === update.startState.selection.main.head) {\n      return;\n    }\n    update.view.dispatch({effects: setAiCodeGenerationTeaserMode.of(AiCodeGenerationTeaserMode.ACTIVE)});\n  }\n\n  /**\n   * Monitors editor changes to cancel an ongoing AI generation or dismiss one\n   * if it already exists.\n   * We abort the request (or dismiss suggestion) and dismiss the teaser if the\n   * user modifies the document or moves their cursor/selection. These actions\n   * indicate the user is no longer focused on the current generation point or\n   * has manually resumed editing, making the suggestion irrelevant.\n   */\n  #abortOrDismissGenerationDuringUpdate(update: CodeMirror.ViewUpdate): void {\n    if (!update.docChanged && update.state.selection.main.head === update.startState.selection.main.head) {\n      return;\n    }\n    const currentTeaserMode = update.state.field(aiCodeGenerationTeaserModeState);\n    if (currentTeaserMode === AiCodeGenerationTeaserMode.DISMISSED) {\n      return;\n    }\n    if (this.#generationTeaser.displayState ===\n        PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING) {\n      this.#controller.abort();\n      this.#controller = new AbortController();\n      this.#dismissTeaserAndSuggestion();\n      return;\n    }\n    if (this.#generationTeaser.displayState ===\n        PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.GENERATED) {\n      update.view.dispatch({effects: setAiAutoCompleteSuggestion.of(null)});\n      this.#generationTeaser.displayState =\n          PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.TRIGGER;\n      return;\n    }\n  }\n\n  async #triggerAiCodeGeneration(options?: {signal?: AbortSignal}): Promise<void> {\n    if (!this.#editor || !this.#aiCodeGeneration) {\n      return;\n    }\n\n    this.#aiCodeGenerationCitations = [];\n    this.#generationTeaser.displayState = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING;\n    const cursor = this.#editor.state.selection.main.head;\n    const query = AiCodeGenerationParser.extractCommentText(this.#editor.state, cursor);\n    if (!query || query.trim().length === 0) {\n      return;\n    }\n\n    try {\n      const startTime = performance.now();\n      this.#aiCodeGenerationConfig?.onRequestTriggered();\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiCodeGenerationRequestTriggered);\n\n      const generationResponse = await this.#aiCodeGeneration.generateCode(\n          query, AiCodeGeneration.AiCodeGeneration.basePreamble,\n          this.#aiCodeGenerationConfig?.generationContext.inferenceLanguage, options);\n\n      if (this.#generationTeaser) {\n        this.#dismissTeaserAndSuggestion();\n      }\n\n      if (!generationResponse || generationResponse.samples.length === 0) {\n        this.#aiCodeGenerationConfig?.onResponseReceived();\n        return;\n      }\n      const topSample = generationResponse.samples[0];\n\n      const shouldBlock = topSample.attributionMetadata?.attributionAction === Host.AidaClient.RecitationAction.BLOCK;\n      if (shouldBlock) {\n        return;\n      }\n\n      const backtickRegex = /^```(?:\\w+)?\\n([\\s\\S]*?)\\n```$/;\n      const matchArray = topSample.generationString.match(backtickRegex);\n      const suggestionText = matchArray ? matchArray[1].trim() : topSample.generationString;\n\n      this.#editor.dispatch({\n        effects: [\n          setAiAutoCompleteSuggestion.of({\n            text: '\\n' + suggestionText,\n            from: cursor,\n            rpcGlobalId: generationResponse.metadata.rpcGlobalId,\n            sampleId: topSample.sampleId,\n            startTime,\n            onImpression: this.#aiCodeGeneration?.registerUserImpression.bind(this.#aiCodeGeneration),\n          }),\n          setAiCodeGenerationTeaserMode.of(AiCodeGenerationTeaserMode.ACTIVE)\n        ]\n      });\n      this.#generationTeaser.displayState =\n          PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.GENERATED;\n\n      AiCodeGeneration.debugLog('Suggestion dispatched to the editor', suggestionText);\n      const citations = topSample.attributionMetadata?.citations ?? [];\n      this.#aiCodeGenerationCitations = citations;\n      this.#aiCodeGenerationConfig?.onResponseReceived();\n      return;\n    } catch (e) {\n      AiCodeGeneration.debugLog('Error while fetching code generation suggestions from AIDA', e);\n      this.#aiCodeGenerationConfig?.onResponseReceived();\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiCodeGenerationError);\n    }\n\n    if (this.#generationTeaser) {\n      this.#dismissTeaserAndSuggestion();\n    }\n  }\n}\n\nfunction aiCodeGenerationTeaserExtension(teaser: PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser):\n    CodeMirror.Extension {\n  return CodeMirror.ViewPlugin.fromClass(class {\n    #view: CodeMirror.EditorView;\n\n    constructor(view: CodeMirror.EditorView) {\n      this.#view = view;\n      this.#updateTeaserState(view.state);\n    }\n\n    update(update: CodeMirror.ViewUpdate): void {\n      if (!update.docChanged && update.state.selection.main.head === update.startState.selection.main.head) {\n        return;\n      }\n      this.#updateTeaserState(update.state);\n    }\n\n    get decorations(): CodeMirror.DecorationSet {\n      const teaserMode = this.#view.state.field(aiCodeGenerationTeaserModeState);\n      if (teaserMode === AiCodeGenerationTeaserMode.DISMISSED) {\n        return CodeMirror.Decoration.none;\n      }\n\n      const cursorPosition = this.#view.state.selection.main.head;\n      const line = this.#view.state.doc.lineAt(cursorPosition);\n\n      const isEmptyLine = line.length === 0;\n      const isComment = Boolean(AiCodeGenerationParser.extractCommentText(this.#view.state, cursorPosition));\n      const isCursorAtEndOfLine = cursorPosition >= line.to;\n\n      if ((isEmptyLine) || (isComment && isCursorAtEndOfLine)) {\n        return CodeMirror.Decoration.set([\n          CodeMirror.Decoration.widget({widget: new AccessiblePlaceholder(teaser), side: 1}).range(cursorPosition),\n        ]);\n      }\n      return CodeMirror.Decoration.none;\n    }\n\n    #updateTeaserState(state: CodeMirror.EditorState): void {\n      // Only handle non loading and non generated states, as updates during and after generation are handled by\n      // #abortOrDismissGenerationDuringUpdate in AiCodeGenerationProvider\n      if (teaser.displayState === PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING ||\n          teaser.displayState === PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.GENERATED) {\n        return;\n      }\n      const cursorPosition = state.selection.main.head;\n      const line = state.doc.lineAt(cursorPosition);\n      const isEmptyLine = line.length === 0;\n      if (isEmptyLine) {\n        teaser.displayState = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.DISCOVERY;\n      } else {\n        teaser.displayState = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.TRIGGER;\n      }\n    }\n  }, {\n    decorations: v => v.decorations,\n    eventHandlers: {\n      mousemove(event: MouseEvent): boolean {\n        // Required for mouse hover to propagate to the info button in teaser.\n        return (event.target instanceof Node && teaser.contentElement.contains(event.target));\n      },\n      mousedown(event: MouseEvent): boolean {\n        // Required for mouse click to propagate to the info tooltip in teaser.\n        return (event.target instanceof Node && teaser.contentElement.contains(event.target));\n      },\n    },\n  });\n}\n"]}