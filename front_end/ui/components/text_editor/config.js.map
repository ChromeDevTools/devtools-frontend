{"version":3,"file":"config.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/config.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Common from '../../../core/common/common.js';\nimport type * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as TextUtils from '../../../models/text_utils/text_utils.js';\nimport * as CM from '../../../third_party/codemirror.next/codemirror.next.js';\nimport * as UI from '../../legacy/legacy.js';\nimport * as VisualLogging from '../../visual_logging/visual_logging.js';\nimport * as CodeHighlighter from '../code_highlighter/code_highlighter.js';\nimport * as Icon from '../icon_button/icon_button.js';\n\nimport {editorTheme} from './theme.js';\n\nconst LINES_TO_SCAN_FOR_INDENTATION_GUESSING = 1000;\nconst RECOMPUTE_INDENT_MAX_SIZE = 200;\n\nconst UIStrings = {\n  /**\n   * @description Label text for the editor\n   */\n  codeEditor: 'Code editor',\n  /**\n   * @description Aria alert to read the suggestion for the suggestion box when typing in text editor\n   * @example {name} PH1\n   * @example {2} PH2\n   * @example {5} PH3\n   */\n  sSuggestionSOfS: '{PH1}, suggestion {PH2} of {PH3}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/components/text_editor/config.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst empty: CM.Extension = [];\n\nexport const dynamicSetting = CM.Facet.define<DynamicSetting<unknown>>();\n\n// The code below is used to wire up dynamic settings to editors. When\n// you include the result of calling `instance()` in an editor\n// configuration, the TextEditor class will take care of listening to\n// changes in the setting, and updating the configuration as\n// appropriate.\n\nexport class DynamicSetting<T> {\n  compartment = new CM.Compartment();\n\n  constructor(\n      readonly settingName: string,\n      private readonly getExtension: (value: T) => CM.Extension,\n  ) {\n  }\n\n  settingValue(): T {\n    return Common.Settings.Settings.instance().moduleSetting(this.settingName).get() as T;\n  }\n\n  instance(): CM.Extension {\n    return [\n      this.compartment.of(this.getExtension(this.settingValue())),\n      dynamicSetting.of(this as DynamicSetting<unknown>),\n    ];\n  }\n\n  sync(state: CM.EditorState, value: T): CM.StateEffect<unknown>|null {\n    const cur = this.compartment.get(state);\n    const needed = this.getExtension(value);\n    return cur === needed ? null : this.compartment.reconfigure(needed);\n  }\n\n  static bool(name: string, enabled: CM.Extension, disabled: CM.Extension = empty): DynamicSetting<boolean> {\n    return new DynamicSetting<boolean>(name, val => val ? enabled : disabled);\n  }\n\n  static none: ReadonlyArray<DynamicSetting<unknown>> = [];\n}\n\nexport const tabMovesFocus = DynamicSetting.bool('text-editor-tab-moves-focus', [], CM.keymap.of([{\n  key: 'Tab',\n  run: (view: CM.EditorView) => view.state.doc.length ? CM.indentMore(view) : false,\n  shift: (view: CM.EditorView) => view.state.doc.length ? CM.indentLess(view) : false,\n}]));\n\nconst disableConservativeCompletion = CM.StateEffect.define();\n\n/**\n * When enabled, this suppresses the behavior of showCompletionHint\n * and accepting of completions with Enter until the user selects a\n * completion beyond the initially selected one. Used in the console.\n **/\nexport const conservativeCompletion = CM.StateField.define<boolean>({\n  create() {\n    return true;\n  },\n  update(value, tr) {\n    if (CM.completionStatus(tr.state) !== 'active') {\n      return true;\n    }\n    if ((CM.selectedCompletionIndex(tr.startState) ?? 0) !== (CM.selectedCompletionIndex(tr.state) ?? 0) ||\n        tr.effects.some(e => e.is(disableConservativeCompletion))) {\n      return false;\n    }\n    return value;\n  },\n});\n\nfunction acceptCompletionIfNotConservative(view: CM.EditorView): boolean {\n  return !view.state.field(conservativeCompletion, false) && CM.acceptCompletion(view);\n}\n\nfunction acceptCompletionIfAtEndOfLine(view: CM.EditorView): boolean {\n  const cursorPosition = view.state.selection.main.head;\n  const line = view.state.doc.lineAt(cursorPosition);\n  const column = cursorPosition - line.from;\n  const isCursorAtEndOfLine = column >= line.length;\n  if (isCursorAtEndOfLine) {\n    return CM.acceptCompletion(view);\n  }\n\n  // We didn't handle this key press\n  // so it will be handled by default behavior.\n  return false;\n}\n\n/**\n * This is a wrapper around CodeMirror's own moveCompletionSelection command, which\n * selects the first selection if the state of the selection is conservative, and\n * otherwise behaves as normal.\n **/\nfunction moveCompletionSelectionIfNotConservative(\n    forward: boolean, by: 'option'|'page' = 'option'): ((view: CM.EditorView) => boolean) {\n  return view => {\n    if (CM.completionStatus(view.state) !== 'active') {\n      return false;\n    }\n    if (view.state.field(conservativeCompletion, false)) {\n      view.dispatch({effects: disableConservativeCompletion.of(null)});\n      announceSelectedCompletionInfo(view);\n      return true;\n    }\n    const moveSelectionResult = CM.moveCompletionSelection(forward, by)(view);\n    announceSelectedCompletionInfo(view);\n    return moveSelectionResult;\n  };\n}\n\nfunction moveCompletionSelectionBackwardWrapper(): ((view: CM.EditorView) => boolean) {\n  return view => {\n    if (CM.completionStatus(view.state) !== 'active') {\n      return false;\n    }\n    CM.moveCompletionSelection(false)(view);\n    announceSelectedCompletionInfo(view);\n    return true;\n  };\n}\n\nfunction announceSelectedCompletionInfo(view: CM.EditorView): void {\n  const ariaMessage = i18nString(UIStrings.sSuggestionSOfS, {\n    PH1: CM.selectedCompletion(view.state)?.label || '',\n    PH2: (CM.selectedCompletionIndex(view.state) || 0) + 1,\n    PH3: CM.currentCompletions(view.state).length,\n  });\n\n  UI.ARIAUtils.LiveAnnouncer.alert(ariaMessage);\n}\n\nexport const autocompletion = new DynamicSetting<boolean>(\n    'text-editor-autocompletion',\n    (activateOnTyping: boolean) =>\n        [CM.autocompletion({\n          activateOnTyping,\n          icons: false,\n          optionClass: (option: CM.Completion) => option.type === 'secondary' ? 'cm-secondaryCompletion' : '',\n          tooltipClass: (state: CM.EditorState) => {\n            return state.field(conservativeCompletion, false) ? 'cm-conservativeCompletion' : '';\n          },\n          defaultKeymap: false,\n          updateSyncTime: 100,\n        }),\n         CM.Prec.highest(CM.keymap.of([\n           {key: 'End', run: acceptCompletionIfAtEndOfLine},\n           {key: 'ArrowRight', run: acceptCompletionIfAtEndOfLine},\n           {key: 'Ctrl-Space', run: CM.startCompletion},\n           {key: 'Escape', run: CM.closeCompletion},\n           {key: 'ArrowDown', run: moveCompletionSelectionIfNotConservative(true)},\n           {key: 'ArrowUp', run: moveCompletionSelectionBackwardWrapper()},\n           {mac: 'Ctrl-n', run: moveCompletionSelectionIfNotConservative(true)},\n           {mac: 'Ctrl-p', run: moveCompletionSelectionBackwardWrapper()},\n           {key: 'PageDown', run: CM.moveCompletionSelection(true, 'page')},\n           {key: 'PageUp', run: CM.moveCompletionSelection(false, 'page')},\n           {key: 'Enter', run: acceptCompletionIfNotConservative},\n         ]))]);\n\nexport const bracketMatching = DynamicSetting.bool('text-editor-bracket-matching', CM.bracketMatching());\n\nexport const codeFolding = DynamicSetting.bool('text-editor-code-folding', [\n  CM.foldGutter({\n    markerDOM(open: boolean): HTMLElement {\n      const iconName = open ? 'triangle-down' : 'triangle-right';\n      const icon = new Icon.Icon.Icon();\n      icon.setAttribute('class', open ? 'cm-foldGutterElement' : 'cm-foldGutterElement cm-foldGutterElement-folded');\n      icon.setAttribute('jslog', `${VisualLogging.expand().track({click: true})}`);\n      icon.name = iconName;\n      icon.classList.add('small');\n      return icon;\n    },\n  }),\n  CM.keymap.of(CM.foldKeymap),\n]);\n\nconst AutoDetectIndent = CM.StateField.define<string>({\n  create: state => detectIndentation(state.doc),\n  update: (indent, tr) => {\n    return tr.docChanged && preservedLength(tr.changes) <= RECOMPUTE_INDENT_MAX_SIZE ? detectIndentation(tr.state.doc) :\n                                                                                       indent;\n  },\n  provide: f => CM.Prec.highest(CM.indentUnit.from(f)),\n});\n\nfunction preservedLength(ch: CM.ChangeDesc): number {\n  let len = 0;\n  ch.iterGaps((_from, _to, l) => {\n    len += l;\n  });\n  return len;\n}\n\nfunction detectIndentation(doc: CM.Text): string {\n  const lines = doc.iterLines(1, Math.min(doc.lines + 1, LINES_TO_SCAN_FOR_INDENTATION_GUESSING));\n  const indentUnit = TextUtils.TextUtils.detectIndentation(lines);\n  return indentUnit ?? Common.Settings.Settings.instance().moduleSetting('text-editor-indent').get();\n}\n\nexport const autoDetectIndent = DynamicSetting.bool('text-editor-auto-detect-indent', AutoDetectIndent);\n\nfunction matcher(decorator: CM.MatchDecorator): CM.Extension {\n  return CM.ViewPlugin.define(\n      view => ({\n        decorations: decorator.createDeco(view),\n        update(u): void {\n          this.decorations = decorator.updateDeco(u, this.decorations);\n        },\n      }),\n      {\n        decorations: v => v.decorations,\n      });\n}\n\nconst WhitespaceDeco = new Map<string, CM.Decoration>();\n\nfunction getWhitespaceDeco(space: string): CM.Decoration {\n  const cached = WhitespaceDeco.get(space);\n  if (cached) {\n    return cached;\n  }\n  const result = CM.Decoration.mark({\n    attributes: space === '\\t' ? {\n      class: 'cm-highlightedTab',\n    } :\n                                 {class: 'cm-highlightedSpaces', 'data-display': 'Â·'.repeat(space.length)},\n  });\n  WhitespaceDeco.set(space, result);\n  return result;\n}\n\nconst showAllWhitespace = matcher(new CM.MatchDecorator({\n  regexp: /\\t| +/g,\n  decoration: (match: RegExpExecArray) => getWhitespaceDeco(match[0]),\n  boundary: /\\S/,\n}));\n\nconst showTrailingWhitespace = matcher(new CM.MatchDecorator({\n  regexp: /\\s+$/g,\n  decoration: CM.Decoration.mark({class: 'cm-trailingWhitespace'}),\n  boundary: /\\S/,\n}));\n\nexport const showWhitespace = new DynamicSetting<string>('show-whitespaces-in-editor', value => {\n  if (value === 'all') {\n    return showAllWhitespace;\n  }\n  if (value === 'trailing') {\n    return showTrailingWhitespace;\n  }\n  return empty;\n});\n\nexport const allowScrollPastEof = DynamicSetting.bool('allow-scroll-past-eof', CM.scrollPastEnd());\n\nconst cachedIndentUnit: Record<string, CM.Extension> = Object.create(null);\n\nfunction getIndentUnit(indent: string): CM.Extension {\n  let value = cachedIndentUnit[indent];\n  if (!value) {\n    value = cachedIndentUnit[indent] = CM.indentUnit.of(indent);\n  }\n  return value;\n}\n\nexport const indentUnit = new DynamicSetting<string>('text-editor-indent', getIndentUnit);\n\nexport const domWordWrap = DynamicSetting.bool('dom-word-wrap', CM.EditorView.lineWrapping);\n\nexport const sourcesWordWrap = DynamicSetting.bool('sources.word-wrap', CM.EditorView.lineWrapping);\n\nfunction detectLineSeparator(text: string): CM.Extension {\n  if (/\\r\\n/.test(text) && !/(^|[^\\r])\\n/.test(text)) {\n    return CM.EditorState.lineSeparator.of('\\r\\n');\n  }\n  return [];\n}\n\nconst baseKeymap = CM.keymap.of([\n  {key: 'Tab', run: CM.acceptCompletion},\n  {key: 'Ctrl-m', run: CM.cursorMatchingBracket, shift: CM.selectMatchingBracket},\n  {key: 'Mod-/', run: CM.toggleComment},\n  {key: 'Mod-d', run: CM.selectNextOccurrence},\n  {key: 'Alt-ArrowLeft', mac: 'Ctrl-ArrowLeft', run: CM.cursorSyntaxLeft, shift: CM.selectSyntaxLeft},\n  {key: 'Alt-ArrowRight', mac: 'Ctrl-ArrowRight', run: CM.cursorSyntaxRight, shift: CM.selectSyntaxRight},\n  {key: 'Ctrl-ArrowLeft', mac: 'Alt-ArrowLeft', run: CM.cursorGroupLeft, shift: CM.selectGroupLeft},\n  {key: 'Ctrl-ArrowRight', mac: 'Alt-ArrowRight', run: CM.cursorGroupRight, shift: CM.selectGroupRight},\n  ...CM.standardKeymap,\n  ...CM.historyKeymap,\n]);\n\nfunction themeIsDark(): boolean {\n  const setting = Common.Settings.Settings.instance().moduleSetting('ui-theme').get();\n  return setting === 'systemPreferred' ? window.matchMedia('(prefers-color-scheme: dark)').matches : setting === 'dark';\n}\n\nexport const dummyDarkTheme = CM.EditorView.theme({}, {dark: true});\nexport const themeSelection = new CM.Compartment();\n\nexport function theme(): CM.Extension {\n  return [editorTheme, themeIsDark() ? themeSelection.of(dummyDarkTheme) : themeSelection.of([])];\n}\n\nlet sideBarElement: HTMLElement|null = null;\n\nfunction getTooltipSpace(): DOMRect {\n  if (!sideBarElement) {\n    sideBarElement = UI.UIUtils.getDevToolsBoundingElement();\n  }\n  return sideBarElement.getBoundingClientRect();\n}\n\nexport function baseConfiguration(text: string|CM.Text): CM.Extension {\n  return [\n    theme(),\n    CM.highlightSpecialChars(),\n    CM.highlightSelectionMatches(),\n    CM.history(),\n    CM.drawSelection(),\n    CM.EditorState.allowMultipleSelections.of(true),\n    CM.indentOnInput(),\n    CM.syntaxHighlighting(CodeHighlighter.CodeHighlighter.highlightStyle),\n    baseKeymap,\n    CM.EditorView.clickAddsSelectionRange.of(mouseEvent => mouseEvent.altKey || mouseEvent.ctrlKey),\n    tabMovesFocus.instance(),\n    bracketMatching.instance(),\n    indentUnit.instance(),\n    CM.Prec.lowest(CM.EditorView.contentAttributes.of({'aria-label': i18nString(UIStrings.codeEditor)})),\n    text instanceof CM.Text ? [] : detectLineSeparator(text),\n    CM.tooltips({\n      parent: getTooltipHost() as unknown as HTMLElement,\n      tooltipSpace: getTooltipSpace,\n    }),\n    CM.bidiIsolates(),\n  ];\n}\n\nexport const closeBrackets = DynamicSetting.bool('text-editor-bracket-closing', [\n  CM.html.autoCloseTags,\n  CM.closeBrackets(),\n  CM.keymap.of(CM.closeBracketsKeymap),\n]);\n\n// Root editor tooltips at the top of the document, creating a special\n// element with the editor styles mounted in it for them. This is\n// annoying, but necessary because a scrollable parent node clips them\n// otherwise, `position: fixed` doesn't work due to `contain` styles,\n// and appending them directly to `document.body` doesn't work because\n// the necessary style sheets aren't available there.\nlet tooltipHost: ShadowRoot|null = null;\n\nfunction getTooltipHost(): ShadowRoot {\n  if (!tooltipHost) {\n    const styleModules = CM.EditorState\n                             .create({\n                               extensions: [\n                                 editorTheme,\n                                 themeIsDark() ? dummyDarkTheme : [],\n                                 CM.syntaxHighlighting(CodeHighlighter.CodeHighlighter.highlightStyle),\n                                 CM.showTooltip.of({\n                                   pos: 0,\n                                   create() {\n                                     return {dom: document.createElement('div')};\n                                   },\n                                 }),\n                               ],\n                             })\n                             .facet<readonly CM.StyleModule[]>(CM.EditorView.styleModule);\n    const host = document.body.appendChild(document.createElement('div'));\n    host.className = 'editor-tooltip-host';\n    tooltipHost = host.attachShadow({mode: 'open'});\n    CM.StyleModule.mount(tooltipHost, styleModules);\n  }\n  return tooltipHost;\n}\n\nclass CompletionHint extends CM.WidgetType {\n  constructor(readonly text: string) {\n    super();\n  }\n\n  override eq(other: CompletionHint): boolean {\n    return this.text === other.text;\n  }\n\n  toDOM(): HTMLElement {\n    const span = document.createElement('span');\n    span.className = 'cm-completionHint';\n    span.textContent = this.text;\n    return span;\n  }\n}\n\nexport const showCompletionHint = CM.ViewPlugin.fromClass(class {\n  decorations: CM.DecorationSet = CM.Decoration.none;\n  currentHint: string|null = null;\n\n  update(update: CM.ViewUpdate): void {\n    const top = this.currentHint = this.topCompletion(update.state);\n    if (!top || update.state.field(conservativeCompletion, false)) {\n      this.decorations = CM.Decoration.none;\n    } else {\n      this.decorations = CM.Decoration.set(\n          [CM.Decoration.widget({widget: new CompletionHint(top), side: 1}).range(update.state.selection.main.head)]);\n    }\n  }\n\n  topCompletion(state: CM.EditorState): string|null {\n    const completion = CM.selectedCompletion(state);\n    if (!completion) {\n      return null;\n    }\n    let {label, apply} = completion;\n    if (typeof apply === 'string') {\n      label = apply;\n      apply = undefined;\n    }\n    if (apply || label.length > 100 || label.indexOf('\\n') > -1 || completion.type === 'secondary') {\n      return null;\n    }\n    const pos = state.selection.main.head;\n    const lineBefore = state.doc.lineAt(pos);\n    if (pos !== lineBefore.to) {\n      return null;\n    }\n    const partBefore = (label[0] === '\\''    ? /'(\\\\.|[^'\\\\])*$/ :\n                            label[0] === '\"' ? /\"(\\\\.|[^\"\\\\])*$/ :\n                                               /#?[\\w$]+$/)\n                           .exec(lineBefore.text);\n    if (partBefore && !label.startsWith(partBefore[0])) {\n      return null;\n    }\n    return label.slice(partBefore ? partBefore[0].length : 0);\n  }\n}, {decorations: p => p.decorations});\n\nexport function contentIncludingHint(view: CM.EditorView): string {\n  const plugin = view.plugin(showCompletionHint);\n  let content = view.state.doc.toString();\n  if (plugin?.currentHint) {\n    const {head} = view.state.selection.main;\n    content = content.slice(0, head) + plugin.currentHint + content.slice(head);\n  }\n  return content;\n}\n\nexport const setAiAutoCompleteSuggestion = CM.StateEffect.define<ActiveSuggestion|null>();\n\ninterface ActiveSuggestion {\n  text: string;\n  from: number;\n  sampleId?: number;\n  rpcGlobalId?: Host.AidaClient.RpcGlobalId;\n  startTime: number;\n  onImpression: (rpcGlobalId: Host.AidaClient.RpcGlobalId, latency: number, sampleId?: number) => void;\n  clearCachedRequest: () => void;\n}\n\nexport const aiAutoCompleteSuggestionState = CM.StateField.define<ActiveSuggestion|null>({\n  create: () => null,\n  update(value, tr) {\n    for (const effect of tr.effects) {\n      if (effect.is(setAiAutoCompleteSuggestion)) {\n        if (effect.value) {\n          return effect.value;\n        }\n        value?.clearCachedRequest();\n        return null;\n      }\n    }\n\n    if (!value) {\n      return value;\n    }\n\n    // A suggestion from an effect can be stale if the document was changed\n    // between when the request was sent and the response was received.\n    // We check if the position is still valid before trying to map it.\n    if (value.from > tr.state.doc.length) {\n      value.clearCachedRequest();\n      return null;\n    }\n\n    // If deletion occurs, set to null. Otherwise, the mapping might fail if\n    // the position is inside the deleted range.\n    if (tr.docChanged && tr.state.doc.length < tr.startState.doc.length) {\n      value.clearCachedRequest();\n      return null;\n    }\n\n    const from = tr.changes.mapPos(value.from);\n    const {head} = tr.state.selection.main;\n\n    // If a change happened before the position from which suggestion was generated, set to null.\n    if (tr.docChanged && head < from) {\n      value.clearCachedRequest();\n      return null;\n    }\n\n    // Check if what's typed after the AI suggestion is a prefix of the AI suggestion.\n    const typedText = tr.state.doc.sliceString(from, head);\n    return value.text.startsWith(typedText) ? value : null;\n  },\n});\n\nexport function hasActiveAiSuggestion(state: CM.EditorState): boolean {\n  return state.field(aiAutoCompleteSuggestionState) !== null;\n}\n\nexport function acceptAiAutoCompleteSuggestion(view: CM.EditorView):\n    {accepted: boolean, suggestion?: ActiveSuggestion} {\n  const selectedCompletion = CM.selectedCompletion(view.state);\n  if (selectedCompletion) {\n    return {accepted: false};\n  }\n\n  const suggestion = view.state.field(aiAutoCompleteSuggestionState);\n  if (!suggestion) {\n    return {accepted: false};\n  }\n\n  const {text, from} = suggestion;\n  const {head} = view.state.selection.main;\n  const typedText = view.state.doc.sliceString(from, head);\n  if (!text.startsWith(typedText)) {\n    return {accepted: false};\n  }\n\n  const remainingText = text.slice(typedText.length);\n  view.dispatch({\n    changes: {from: head, insert: remainingText},\n    selection: {anchor: head + remainingText.length},\n    effects: setAiAutoCompleteSuggestion.of(null),\n    userEvent: 'input.complete',\n  });\n\n  suggestion.clearCachedRequest();\n  return {accepted: true, suggestion};\n}\n\nexport const aiAutoCompleteSuggestion: CM.Extension = [\n  aiAutoCompleteSuggestionState,\n  CM.ViewPlugin.fromClass(\n      class {\n        decorations: CM.DecorationSet = CM.Decoration.none;\n        #lastLoggedSuggestion: ActiveSuggestion|null = null;\n\n        update(update: CM.ViewUpdate): void {\n          // If there is no text on the document, we don't want to show the AI suggestion.\n          if (update.state.doc.length === 0) {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          // Hide decorations if there is no active AI suggestion.\n          const activeSuggestion = update.state.field(aiAutoCompleteSuggestionState);\n          if (!activeSuggestion) {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          // Hide AI suggestion while the user is interacting with the traditional\n          // autocomplete menu to avoid conflicting suggestions.\n          if (CM.completionStatus(update.view.state) === 'pending') {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          // Hide AI suggestion if the user has selected an item from the\n          // traditional autocomplete menu that is not the first one.\n          const selectedCompletionIndex = CM.selectedCompletionIndex(update.state);\n          if (selectedCompletionIndex && selectedCompletionIndex > 0) {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          const {head} = update.state.selection.main;\n          // Hide AI suggestion if the user moves the cursor to a location\n          // before the position from which suggestion was generated.\n          if (head < activeSuggestion.from) {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          const selectedCompletion = CM.selectedCompletion(update.state);\n          const additionallyTypedText = update.state.doc.sliceString(activeSuggestion.from, head);\n          // The user might have typed text after the suggestion is triggered.\n          // If the suggestion no longer starts with the typed text, hide it.\n          if (!activeSuggestion.text.startsWith(additionallyTypedText)) {\n            this.decorations = CM.Decoration.none;\n            return;\n          }\n\n          let ghostText = activeSuggestion.text.slice(additionallyTypedText.length);\n          if (selectedCompletion) {\n            // Do not show AI generated suggestion if top traditional suggestion is of type\n            // 'keyword' - `do`, `while` etc.\n            if (selectedCompletion.type?.includes('keyword')) {\n              this.decorations = CM.Decoration.none;\n              return;\n            }\n            // If a traditional autocomplete menu is shown, the AI suggestion is only\n            // shown if it builds upon the currently selected item. If there is no\n            // overlap, we hide the AI suggestion. For example, for the text `console`\n            // if the traditional autocomplete suggests `log` and the AI\n            // suggests `warn`, there is no overlap and the AI suggestion is hidden.\n            const overlappingText = TextUtils.TextUtils.getOverlap(selectedCompletion.label, ghostText) ?? '';\n            const lineAtAiSuggestion = update.state.doc.lineAt(activeSuggestion.from).text;\n            const overlapsWithSelectedCompletion =\n                (lineAtAiSuggestion + overlappingText).endsWith(selectedCompletion.label);\n            if (!overlapsWithSelectedCompletion) {\n              this.decorations = CM.Decoration.none;\n              return;\n            }\n          }\n\n          // When `conservativeCompletion` is disabled in Console, the editor shows a ghost\n          // text for the first item in the traditional autocomplete menu and this ghost text\n          // is reflected in `currentHint`. In this case, we need to remove\n          // the overlapping part from our AI suggestion's ghost text to avoid\n          // showing a double suggestion.\n          const currentMenuHint = update.view.plugin(showCompletionHint)?.currentHint;\n          const conservativeCompletionEnabled = update.state.field(conservativeCompletion, false);\n          if (!conservativeCompletionEnabled && currentMenuHint) {\n            ghostText = ghostText.slice(currentMenuHint.length);\n          }\n\n          this.decorations =\n              CM.Decoration.set([CM.Decoration.widget({widget: new CompletionHint(ghostText), side: 1}).range(head)]);\n          this.#registerImpressionIfNeeded(activeSuggestion);\n        }\n\n        #registerImpressionIfNeeded(activeSuggestion: ActiveSuggestion): void {\n          if (!activeSuggestion.rpcGlobalId) {\n            return;\n          }\n          if (this.#lastLoggedSuggestion?.rpcGlobalId === activeSuggestion?.rpcGlobalId &&\n              this.#lastLoggedSuggestion?.sampleId === activeSuggestion?.sampleId) {\n            return;\n          }\n          const latency = performance.now() - activeSuggestion.startTime;\n          // only register impression for the first time AI generated suggestion is shown to the user.\n          activeSuggestion.onImpression(activeSuggestion.rpcGlobalId, latency, activeSuggestion.sampleId);\n          this.#lastLoggedSuggestion = activeSuggestion;\n        }\n      },\n      {decorations: p => p.decorations}),\n];\n"]}