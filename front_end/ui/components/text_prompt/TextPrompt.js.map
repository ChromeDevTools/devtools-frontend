{"version":3,"file":"TextPrompt.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_prompt/TextPrompt.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view, @devtools/enforce-custom-element-definitions-location */\n\nimport * as Platform from '../../../core/platform/platform.js';\nimport {html, render} from '../../lit/lit.js';\n\nimport textPromptStyles from './textPrompt.css.js';\n\nexport interface TextPromptData {\n  ariaLabel: string;\n  prefix: string;\n  suggestion: string;\n}\n\nexport class PromptInputEvent extends Event {\n  static readonly eventName = 'promptinputchanged';\n  data: string;\n\n  constructor(value: string) {\n    super(PromptInputEvent.eventName);\n    this.data = value;\n  }\n}\n\nexport class TextPrompt extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #ariaLabelText = '';\n  #prefixText = '';\n  #suggestionText = '';\n\n  set data(data: TextPromptData) {\n    this.#ariaLabelText = data.ariaLabel;\n    this.#prefixText = data.prefix;\n    this.#suggestionText = data.suggestion;\n    this.#render();\n  }\n\n  get data(): TextPromptData {\n    return {\n      ariaLabel: this.#ariaLabelText,\n      prefix: this.#prefixText,\n      suggestion: this.#suggestionText,\n    };\n  }\n\n  override focus(): void {\n    this.#input().focus();\n  }\n\n  #input(): HTMLInputElement {\n    const inputElement = this.#shadow.querySelector<HTMLInputElement>('.input');\n    if (!inputElement) {\n      throw new Error('Expected an input element!');\n    }\n    return inputElement;\n  }\n\n  moveCaretToEndOfInput(): void {\n    this.setSelectedRange(this.#text().length, this.#text().length);\n  }\n\n  onKeyDown(event: KeyboardEvent): void {\n    if (event.key === Platform.KeyboardUtilities.ENTER_KEY) {\n      event.preventDefault();\n    }\n  }\n\n  setSelectedRange(startIndex: number, endIndex: number): void {\n    if (startIndex < 0) {\n      throw new RangeError('Selected range start must be a nonnegative integer');\n    }\n    const textContentLength = this.#text().length;\n    if (endIndex > textContentLength) {\n      endIndex = textContentLength;\n    }\n    if (endIndex < startIndex) {\n      endIndex = startIndex;\n    }\n    this.#input().setSelectionRange(startIndex, endIndex);\n  }\n\n  setPrefix(prefix: string): void {\n    this.#prefixText = prefix;\n    this.#render();\n  }\n\n  setSuggestion(suggestion: string): void {\n    this.#suggestionText = suggestion;\n    this.#suggestion().value = this.#suggestionText;\n    this.#render();\n  }\n\n  setText(text: string): void {\n    this.#input().value = text;\n\n    if (this.#input().hasFocus()) {\n      this.moveCaretToEndOfInput();\n      this.#input().scrollIntoView();\n    }\n  }\n\n  #suggestion(): HTMLInputElement {\n    const suggestionElement = this.#shadow.querySelector<HTMLInputElement>('.suggestion');\n    if (!suggestionElement) {\n      throw new Error('Expected an suggestion element!');\n    }\n    return suggestionElement;\n  }\n\n  #text(): string {\n    return this.#input().value || '';\n  }\n\n  connectedCallback(): void {\n    const observer = new MutationObserver(mutations => {\n      for (const mutation of mutations) {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'dir') {\n          const writingDirection = this.#input().getAttribute('dir');\n          if (!writingDirection) {\n            this.#suggestion().removeAttribute('dir');\n            return;\n          }\n          this.#suggestion().setAttribute('dir', writingDirection);\n        }\n      }\n    });\n    observer.observe(this.#input(), {attributeFilter: ['dir']});\n  }\n\n  #render(): void {\n    // clang-format off\n    const output = html`\n      <style>${textPromptStyles}</style>\n      <span class=\"prefix\">${this.#prefixText} </span>\n      <span class=\"text-prompt-input\">\n        <input\n            class=\"input\" aria-label=${this.#ariaLabelText} spellcheck=\"false\"\n            @input=${() => this.dispatchEvent(new PromptInputEvent(this.#text()))}\n            @keydown=${this.onKeyDown}>\n        <input class=\"suggestion\" tabindex=-1 aria-label=${this.#ariaLabelText + ' Suggestion'}>\n      </span>`;\n    // clang-format on\n    render(output, this.#shadow, {host: this});\n  }\n}\n\ncustomElements.define('devtools-text-prompt', TextPrompt);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-text-prompt': TextPrompt;\n  }\n\n  interface HTMLElementEventMap {\n    promptinputchanged: PromptInputEvent;\n  }\n}\n"]}