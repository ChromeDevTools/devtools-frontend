{"version":3,"file":"Dialog.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Dialog.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2012 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Common from '../../core/common/common.js';\nimport * as VisualLogging from '../visual_logging/visual_logging.js';\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport dialogStyles from './dialog.css.js';\nimport {GlassPane, PointerEventsBehavior} from './GlassPane.js';\nimport {InspectorView} from './InspectorView.js';\nimport {KeyboardShortcut, Keys} from './KeyboardShortcut.js';\nimport type {SplitWidget} from './SplitWidget.js';\nimport {WidgetFocusRestorer} from './Widget.js';\n\nexport class Dialog extends Common.ObjectWrapper.eventMixin<EventTypes, typeof GlassPane>(GlassPane) {\n  private tabIndexBehavior = OutsideTabIndexBehavior.DISABLE_ALL_OUTSIDE_TAB_INDEX;\n  private tabIndexMap = new Map<HTMLElement, number>();\n  private focusRestorer: WidgetFocusRestorer|null = null;\n  private closeOnEscape = true;\n  private targetDocument: Document|null = null;\n  private readonly targetDocumentKeyDownHandler: (event: KeyboardEvent) => void;\n  private escapeKeyCallback: ((arg0: KeyboardEvent) => void)|null = null;\n\n  constructor(jslogContext?: string) {\n    super();\n    this.registerRequiredCSS(dialogStyles);\n    this.contentElement.tabIndex = 0;\n    this.contentElement.addEventListener('focus', () => this.widget().focus(), false);\n    if (jslogContext) {\n      this.contentElement.setAttribute(\n          'jslog', `${VisualLogging.dialog(jslogContext).track({resize: true, keydown: 'Escape'})}`);\n    }\n    this.setPointerEventsBehavior(PointerEventsBehavior.BLOCKED_BY_GLASS_PANE);\n    this.setOutsideClickCallback(event => {\n      // If there are stacked dialogs, we only want to\n      // handle the outside click for the top most dialog.\n      if (Dialog.getInstance() !== this) {\n        return;\n      }\n\n      this.hide();\n      event.consume(true);\n    });\n    ARIAUtils.markAsModalDialog(this.contentElement);\n    this.targetDocumentKeyDownHandler = this.onKeyDown.bind(this);\n  }\n\n  static hasInstance(): boolean {\n    return Dialog.dialogs.length > 0;\n  }\n\n  /**\n   * If there is only one dialog, returns that.\n   * If there are stacked dialogs, returns the topmost one.\n   */\n  static getInstance(): Dialog|null {\n    return Dialog.dialogs[Dialog.dialogs.length - 1] || null;\n  }\n\n  /**\n   * `stack` parameter is needed for being able to open a dialog on top\n   * of an existing dialog. The main reason is, Settings Tab is\n   * implemented as a Dialog. So, if we want to open a dialog on the\n   * Settings Tab, we need to stack it on top of that dialog.\n   *\n   * @param where Container element of the dialog.\n   * @param stack Whether to open this dialog on top of an existing dialog.\n   */\n  override show(where?: Document|Element, stack?: boolean): void {\n    const document = (where instanceof Document ? where : (where || InspectorView.instance().element).ownerDocument);\n    this.targetDocument = document;\n    this.targetDocument.addEventListener('keydown', this.targetDocumentKeyDownHandler, true);\n\n    if (!stack && Dialog.dialogs.length) {\n      Dialog.dialogs.forEach(dialog => dialog.hide());\n    }\n    Dialog.dialogs.push(this);\n    this.disableTabIndexOnElements(document);\n    super.show(document);\n    this.focusRestorer = new WidgetFocusRestorer(this.widget());\n  }\n\n  override hide(): void {\n    if (this.focusRestorer) {\n      this.focusRestorer.restore();\n    }\n    super.hide();\n\n    if (this.targetDocument) {\n      this.targetDocument.removeEventListener('keydown', this.targetDocumentKeyDownHandler, true);\n    }\n    this.restoreTabIndexOnElements();\n    this.dispatchEventToListeners(Events.HIDDEN);\n    const index = Dialog.dialogs.indexOf(this);\n    if (index !== -1) {\n      Dialog.dialogs.splice(index, 1);\n    }\n  }\n\n  setAriaLabel(label: string): void {\n    ARIAUtils.setLabel(this.contentElement, label);\n  }\n\n  setCloseOnEscape(close: boolean): void {\n    this.closeOnEscape = close;\n  }\n\n  setEscapeKeyCallback(callback: (arg0: KeyboardEvent) => void): void {\n    this.escapeKeyCallback = callback;\n  }\n\n  addCloseButton(): void {\n    const closeButton = this.contentElement.createChild('dt-close-button', 'dialog-close-button');\n    closeButton.addEventListener('click', this.hide.bind(this), false);\n  }\n\n  setOutsideTabIndexBehavior(tabIndexBehavior: OutsideTabIndexBehavior): void {\n    this.tabIndexBehavior = tabIndexBehavior;\n  }\n\n  private disableTabIndexOnElements(document: Document): void {\n    if (this.tabIndexBehavior === OutsideTabIndexBehavior.PRESERVE_TAB_INDEX) {\n      return;\n    }\n\n    let exclusionSet: Set<HTMLElement>|(Set<HTMLElement>| null) = (null as Set<HTMLElement>| null);\n    if (this.tabIndexBehavior === OutsideTabIndexBehavior.PRESERVE_MAIN_VIEW_TAB_INDEX) {\n      exclusionSet = this.getMainWidgetTabIndexElements(InspectorView.instance().ownerSplit());\n    }\n\n    this.tabIndexMap.clear();\n    let node: (Node|null)|Document = document;\n    for (; node; node = node.traverseNextNode(document)) {\n      if (node instanceof HTMLElement) {\n        const element = (node);\n        const tabIndex = element.tabIndex;\n        if (!exclusionSet?.has(element)) {\n          if (tabIndex >= 0) {\n            this.tabIndexMap.set(element, tabIndex);\n            element.tabIndex = -1;\n          } else if (element.hasAttribute('contenteditable')) {\n            this.tabIndexMap.set(element, element.hasAttribute('tabindex') ? tabIndex : 0);\n            element.tabIndex = -1;\n          }\n        }\n      }\n    }\n  }\n\n  private getMainWidgetTabIndexElements(splitWidget: SplitWidget|null): Set<HTMLElement> {\n    const elementSet = new Set<HTMLElement>();\n    if (!splitWidget) {\n      return elementSet;\n    }\n\n    const mainWidget = splitWidget.mainWidget();\n    if (!mainWidget?.element) {\n      return elementSet;\n    }\n\n    let node: Node|null = mainWidget.element;\n    for (; node; node = node.traverseNextNode(mainWidget.element)) {\n      if (!(node instanceof HTMLElement)) {\n        continue;\n      }\n\n      const element = (node);\n      const tabIndex = element.tabIndex;\n      if (tabIndex < 0) {\n        continue;\n      }\n\n      elementSet.add(element);\n    }\n\n    return elementSet;\n  }\n\n  private restoreTabIndexOnElements(): void {\n    for (const element of this.tabIndexMap.keys()) {\n      element.tabIndex = (this.tabIndexMap.get(element) as number);\n    }\n    this.tabIndexMap.clear();\n  }\n\n  private onKeyDown(event: KeyboardEvent): void {\n    const keyboardEvent = event;\n    if (Dialog.getInstance() !== this) {\n      return;\n    }\n    if (keyboardEvent.keyCode === Keys.Esc.code && KeyboardShortcut.hasNoModifiers(event)) {\n      if (this.escapeKeyCallback) {\n        this.escapeKeyCallback(event);\n      }\n\n      if (event.handled) {\n        return;\n      }\n\n      if (this.closeOnEscape) {\n        event.consume(true);\n        this.hide();\n      }\n    }\n  }\n\n  private static dialogs: Dialog[] = [];\n}\n\nexport const enum Events {\n  HIDDEN = 'hidden',\n}\n\nexport interface EventTypes {\n  [Events.HIDDEN]: void;\n}\n\nexport const enum OutsideTabIndexBehavior {\n  DISABLE_ALL_OUTSIDE_TAB_INDEX = 'DisableAllTabIndex',\n  PRESERVE_MAIN_VIEW_TAB_INDEX = 'PreserveMainViewTabIndex',\n  PRESERVE_TAB_INDEX = 'PreserveTabIndex',\n}\n"]}