{"version":3,"file":"Fragment.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Fragment.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nfunction getNodeData(node: Node): string {\n  return (node as unknown as {\n           data: string,\n         })\n      .data;\n}\n\nfunction setNodeData<T>(node: Node, value: T): void {\n  (node as unknown as {\n    data: T,\n  }).data = value;\n}\n\nexport class Fragment {\n  readonly #element: Element;\n  private readonly elementsById = new Map<string, Element>();\n\n  constructor(element: Element) {\n    this.#element = element;\n  }\n\n  element(): Element {\n    return this.#element;\n  }\n\n  $(elementId: string): Element {\n    return this.elementsById.get(elementId) as Element;\n  }\n\n  static build(strings: TemplateDefinition, ...values: any[]): Fragment {\n    return Fragment.render(Fragment.template(strings), values);\n  }\n\n  static cached(strings: TemplateDefinition, ...values: any[]): Fragment {\n    let template = templateCache.get(strings);\n    if (!template) {\n      template = Fragment.template(strings);\n      templateCache.set(strings, template);\n    }\n    return Fragment.render(template, values);\n  }\n\n  private static template(strings: TemplateDefinition): Template {\n    let html = '';\n    let insideText = true;\n    for (let i = 0; i < strings.length - 1; i++) {\n      html += strings[i];\n      const close = strings[i].lastIndexOf('>');\n      const open = strings[i].indexOf('<', close + 1);\n      if (close !== -1 && open === -1) {\n        insideText = true;\n      } else if (open !== -1) {\n        insideText = false;\n      }\n      html += insideText ? textMarker : attributeMarker(i);\n    }\n    html += strings[strings.length - 1];\n\n    const template = document.createElement('template');\n    template.innerHTML = html;\n    const walker =\n        template.ownerDocument.createTreeWalker(template.content, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, null);\n    let valueIndex = 0;\n    const emptyTextNodes = [];\n    const binds: Bind[] = [];\n    const nodesToMark = [];\n    while (walker.nextNode()) {\n      const node = (walker.currentNode as HTMLElement);\n      if (node.nodeType === Node.ELEMENT_NODE && node.hasAttributes()) {\n        if (node.hasAttribute('$')) {\n          nodesToMark.push(node);\n          binds.push({replaceNodeIndex: undefined, attr: undefined, elementId: node.getAttribute('$') || ''});\n          node.removeAttribute('$');\n        }\n\n        const attributesToRemove = [];\n        for (let i = 0; i < node.attributes.length; i++) {\n          const name = node.attributes[i].name;\n\n          if (!attributeMarkerRegex.test(name) && !attributeMarkerRegex.test(node.attributes[i].value)) {\n            continue;\n          }\n\n          attributesToRemove.push(name);\n          nodesToMark.push(node);\n\n          const attr = {\n            index: valueIndex,\n            names: name.split(attributeMarkerRegex),\n            values: node.attributes[i].value.split(attributeMarkerRegex),\n          };\n          valueIndex += attr.names.length - 1;\n          valueIndex += attr.values.length - 1;\n          const bind: Bind = {\n            elementId: undefined,\n            replaceNodeIndex: undefined,\n            attr,\n          };\n          binds.push(bind);\n        }\n        for (let i = 0; i < attributesToRemove.length; i++) {\n          node.removeAttribute(attributesToRemove[i]);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE && getNodeData(node).indexOf(textMarker) !== -1) {\n        const texts = getNodeData(node).split(textMarkerRegex);\n        setNodeData(node, texts[texts.length - 1]);\n        const parentNode = (node.parentNode as HTMLElement);\n        for (let i = 0; i < texts.length - 1; i++) {\n          if (texts[i]) {\n            parentNode.insertBefore(document.createTextNode(texts[i]), node);\n          }\n          const nodeToReplace = document.createElement('span');\n          nodesToMark.push(nodeToReplace);\n          binds.push({attr: undefined, elementId: undefined, replaceNodeIndex: valueIndex++});\n          parentNode.insertBefore(nodeToReplace, node);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE &&\n          (!node.previousSibling || node.previousSibling.nodeType === Node.ELEMENT_NODE) &&\n          (!node.nextSibling || node.nextSibling.nodeType === Node.ELEMENT_NODE) && /^\\s*$/.test(getNodeData(node))) {\n        emptyTextNodes.push(node);\n      }\n    }\n\n    for (let i = 0; i < nodesToMark.length; i++) {\n      nodesToMark[i].classList.add(generateClassName(i));\n    }\n\n    for (const emptyTextNode of emptyTextNodes) {\n      emptyTextNode.remove();\n    }\n    return {template, binds};\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private static render(template: Template, values: any[]): Fragment {\n    const content = template.template.ownerDocument.importNode(template.template.content, true);\n    const resultElement = (content.firstChild === content.lastChild ? content.firstChild : content) as Element;\n    const result = new Fragment(resultElement);\n\n    const boundElements = [];\n    for (let i = 0; i < template.binds.length; i++) {\n      const className = generateClassName(i);\n      const element = (content.querySelector('.' + className) as Element);\n      element.classList.remove(className);\n      boundElements.push(element);\n    }\n\n    for (let bindIndex = 0; bindIndex < template.binds.length; bindIndex++) {\n      const bind = template.binds[bindIndex];\n      const element = boundElements[bindIndex];\n      if (bind.elementId !== undefined) {\n        result.elementsById.set(bind.elementId, element);\n      } else if (bind.replaceNodeIndex !== undefined) {\n        const value = values[bind.replaceNodeIndex];\n        (element.parentNode as HTMLElement).replaceChild(this.nodeForValue(value), element);\n      } else if (bind.attr !== undefined) {\n        if (bind.attr.names.length === 2 && bind.attr.values.length === 1 &&\n            typeof values[bind.attr.index] === 'function') {\n          values[bind.attr.index].call(null, element);\n        } else {\n          let name = bind.attr.names[0];\n          for (let i = 1; i < bind.attr.names.length; i++) {\n            name += values[bind.attr.index + i - 1];\n            name += bind.attr.names[i];\n          }\n          if (name) {\n            let value = bind.attr.values[0];\n            for (let i = 1; i < bind.attr.values.length; i++) {\n              value += values[bind.attr.index + bind.attr.names.length - 1 + i - 1];\n              value += bind.attr.values[i];\n            }\n            element.setAttribute(name, value);\n          }\n        }\n      } else {\n        throw new Error('Unexpected bind');\n      }\n    }\n    return result;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private static nodeForValue(value: any): Node {\n    if (value instanceof Node) {\n      return value;\n    }\n    if (value instanceof Fragment) {\n      return value.#element;\n    }\n    if (Array.isArray(value)) {\n      const node = document.createDocumentFragment();\n      for (const v of value) {\n        node.appendChild(this.nodeForValue(v));\n      }\n      return node;\n    }\n    return document.createTextNode(String(value));\n  }\n}\n\nexport const textMarker = '{{template-text}}';\nconst textMarkerRegex = /{{template-text}}/;\nexport const attributeMarker = (index: number): string => 'template-attribute' + index;\nconst attributeMarkerRegex = /template-attribute\\d+/;\nconst generateClassName = (index: number): string => 'template-class-' + index;\nconst templateCache = new Map<TemplateDefinition, Template>();\n\nexport const html = (strings: TemplateDefinition, ...vararg: any[]): Element => {\n  return Fragment.cached(strings, ...vararg).element();\n};\n\nexport type TemplateDefinition = string[]|TemplateStringsArray;\n\nexport interface Bind {\n  elementId?: string;\n  attr?: {\n    index: number,\n    names: string[],\n    values: string[],\n  };\n  replaceNodeIndex?: number;\n}\n\nexport interface Template {\n  template: HTMLTemplateElement;\n  binds: Bind[];\n}\n"]}