{"version":3,"file":"PopoverHelper.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/PopoverHelper.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2009 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as VisualLogging from '../visual_logging/visual_logging.js';\n\nimport {GlassPane, MarginBehavior, SizeBehavior} from './GlassPane.js';\nimport popoverStyles from './popover.css.js';\n\nexport class PopoverHelper {\n  static createPopover = (jslogContext?: string): GlassPane => {\n    const popover = new GlassPane(`${VisualLogging.popover(jslogContext).parent('mapped')}`);\n    popover.registerRequiredCSS(popoverStyles);\n    popover.setSizeBehavior(SizeBehavior.MEASURE_CONTENT);\n    popover.setMarginBehavior(MarginBehavior.DEFAULT_MARGIN);\n    return popover;\n  };\n  private disableOnClick: boolean;\n  private getRequest: (arg0: MouseEvent|KeyboardEvent) => PopoverRequest | null;\n  private scheduledRequest: PopoverRequest|null;\n  private hidePopoverCallback: (() => void)|null;\n  readonly container: HTMLElement;\n  private showTimeout: number;\n  private hideTimeout: number;\n  private hidePopoverTimer: number|null;\n  private showPopoverTimer: number|null;\n  private readonly boundMouseDown: (event: MouseEvent) => void;\n  private readonly boundMouseMove: (ev: MouseEvent) => void;\n  private readonly boundMouseOut: (event: MouseEvent) => void;\n  private readonly boundKeyUp: (ev: KeyboardEvent) => void;\n  jslogContext?: string;\n  constructor(\n      container: HTMLElement, getRequest: (arg0: MouseEvent|KeyboardEvent) => PopoverRequest | null,\n      jslogContext?: string) {\n    this.disableOnClick = false;\n    this.getRequest = getRequest;\n    this.jslogContext = jslogContext;\n    this.scheduledRequest = null;\n    this.hidePopoverCallback = null;\n    this.container = container;\n    this.showTimeout = 0;\n    this.hideTimeout = 0;\n    this.hidePopoverTimer = null;\n    this.showPopoverTimer = null;\n    this.boundMouseDown = this.mouseDown.bind(this);\n    this.boundMouseMove = this.mouseMove.bind(this);\n    this.boundMouseOut = this.mouseOut.bind(this);\n    this.boundKeyUp = this.keyUp.bind(this);\n    this.container.addEventListener('mousedown', this.boundMouseDown, false);\n    this.container.addEventListener('mousemove', this.boundMouseMove, false);\n    this.container.addEventListener('mouseout', this.boundMouseOut, false);\n    this.container.addEventListener('keyup', this.boundKeyUp, false);\n    this.setTimeout(1000);\n  }\n\n  setTimeout(showTimeout: number, hideTimeout?: number): void {\n    this.showTimeout = showTimeout;\n    this.hideTimeout = typeof hideTimeout === 'number' ? hideTimeout : showTimeout / 2;\n  }\n\n  setDisableOnClick(disableOnClick: boolean): void {\n    this.disableOnClick = disableOnClick;\n  }\n\n  private eventInScheduledContent(event: MouseEvent): boolean {\n    return this.scheduledRequest ? this.scheduledRequest.box.contains(event.clientX, event.clientY) : false;\n  }\n\n  private mouseDown(event: MouseEvent): void {\n    if (this.disableOnClick) {\n      this.hidePopover();\n      return;\n    }\n    if (this.eventInScheduledContent(event)) {\n      return;\n    }\n\n    this.startHidePopoverTimer(0);\n    this.stopShowPopoverTimer();\n    this.startShowPopoverTimer(event, 0);\n  }\n\n  private keyUp(event: KeyboardEvent): void {\n    if (event.altKey && event.key === 'ArrowDown') {\n      if (this.isPopoverVisible()) {\n        this.hidePopover();\n      } else {\n        this.stopShowPopoverTimer();\n        this.startHidePopoverTimer(0);\n        this.startShowPopoverTimer(event, 0);\n      }\n      event.stopPropagation();\n    } else if (event.key === 'Escape' && this.isPopoverVisible()) {\n      this.hidePopover();\n      event.stopPropagation();\n    }\n  }\n\n  private mouseMove(event: MouseEvent): void {\n    if (this.eventInScheduledContent(event)) {\n      // Reschedule showing popover since mouse moved and\n      // we only want to show the popover when the mouse is\n      // standing still on the container for some amount of time.\n      this.stopShowPopoverTimer();\n      this.startShowPopoverTimer(event, this.isPopoverVisible() ? this.showTimeout * 0.6 : this.showTimeout);\n      return;\n    }\n\n    this.startHidePopoverTimer(this.hideTimeout);\n    this.stopShowPopoverTimer();\n    if (event.buttons && this.disableOnClick) {\n      return;\n    }\n    this.startShowPopoverTimer(event, this.isPopoverVisible() ? this.showTimeout * 0.6 : this.showTimeout);\n  }\n\n  private popoverMouseMove(_event: Event): void {\n    this.stopHidePopoverTimer();\n  }\n\n  private popoverMouseOut(popover: GlassPane, event: MouseEvent): void {\n    if (!popover.isShowing()) {\n      return;\n    }\n    const node = (event.relatedTarget as Node | null);\n    if (node && !node.isSelfOrDescendant(popover.contentElement)) {\n      this.startHidePopoverTimer(this.hideTimeout);\n    }\n  }\n\n  private mouseOut(event: MouseEvent): void {\n    if (!this.isPopoverVisible()) {\n      return;\n    }\n    if (!this.eventInScheduledContent(event)) {\n      this.startHidePopoverTimer(this.hideTimeout);\n    }\n  }\n\n  private startHidePopoverTimer(timeout: number): void {\n    // User has |timeout| ms to reach the popup.\n    if (!this.hidePopoverCallback || this.hidePopoverTimer) {\n      return;\n    }\n\n    this.hidePopoverTimer = window.setTimeout(() => {\n      this.#hidePopover();\n      this.hidePopoverTimer = null;\n    }, timeout);\n  }\n\n  private startShowPopoverTimer(event: MouseEvent|KeyboardEvent, timeout: number): void {\n    this.scheduledRequest = this.getRequest.call(null, event);\n    if (!this.scheduledRequest) {\n      return;\n    }\n\n    this.showPopoverTimer = window.setTimeout(() => {\n      this.showPopoverTimer = null;\n      this.stopHidePopoverTimer();\n      this.#hidePopover();\n      const document = ((event.target as Node).ownerDocument) as Document;\n      this.showPopover(document);\n    }, timeout);\n  }\n\n  private stopShowPopoverTimer(): void {\n    if (!this.showPopoverTimer) {\n      return;\n    }\n    clearTimeout(this.showPopoverTimer);\n    this.showPopoverTimer = null;\n  }\n\n  isPopoverVisible(): boolean {\n    return Boolean(this.hidePopoverCallback);\n  }\n\n  hidePopover(): void {\n    this.stopShowPopoverTimer();\n    this.#hidePopover();\n  }\n\n  #hidePopover(): void {\n    if (!this.hidePopoverCallback) {\n      return;\n    }\n    this.hidePopoverCallback.call(null);\n    this.hidePopoverCallback = null;\n  }\n\n  private showPopover(document: Document): void {\n    const popover = PopoverHelper.createPopover(this.jslogContext);\n    const request = this.scheduledRequest;\n    if (!request) {\n      return;\n    }\n    void request.show.call(null, popover).then(success => {\n      if (!success) {\n        return;\n      }\n\n      if (this.scheduledRequest !== request) {\n        if (request.hide) {\n          request.hide.call(null);\n        }\n        return;\n      }\n\n      // This should not happen, but we hide previous popover to be on the safe side.\n      if (popoverHelperInstance) {\n        popoverHelperInstance.hidePopover();\n      }\n      popoverHelperInstance = this;\n\n      VisualLogging.setMappedParent(popover.contentElement, this.container);\n      popover.contentElement.style.scrollbarGutter = 'stable';\n      popover.contentElement.addEventListener('mousemove', this.popoverMouseMove.bind(this), true);\n      popover.contentElement.addEventListener('mouseout', this.popoverMouseOut.bind(this, popover), true);\n      popover.setContentAnchorBox(request.box);\n      popover.show(document);\n\n      this.hidePopoverCallback = () => {\n        if (request.hide) {\n          request.hide.call(null);\n        }\n        popover.hide();\n        popoverHelperInstance = null;\n      };\n    });\n  }\n\n  private stopHidePopoverTimer(): void {\n    if (!this.hidePopoverTimer) {\n      return;\n    }\n    clearTimeout(this.hidePopoverTimer);\n    this.hidePopoverTimer = null;\n\n    // We know that we reached the popup, but we might have moved over other elements.\n    // Discard pending command.\n    this.stopShowPopoverTimer();\n  }\n\n  dispose(): void {\n    this.container.removeEventListener('mousedown', this.boundMouseDown, false);\n    this.container.removeEventListener('mousemove', this.boundMouseMove, false);\n    this.container.removeEventListener('mouseout', this.boundMouseOut, false);\n  }\n}\n\nlet popoverHelperInstance: PopoverHelper|null = null;\nexport interface PopoverRequest {\n  box: AnchorBox;\n  show: (arg0: GlassPane) => Promise<boolean>;\n  hide?: (() => void);\n}\n"]}