{"version":3,"file":"Widget.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Widget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\n/*\n * Copyright (C) 2008 Apple Inc. All Rights Reserved.\n * Copyright (C) 2011 Google Inc. All Rights Reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport '../../core/dom_extension/dom_extension.js';\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Geometry from '../../models/geometry/geometry.js';\nimport * as Lit from '../../ui/lit/lit.js';\n\nimport {appendStyle, deepActiveElement} from './DOMUtilities.js';\nimport {cloneCustomElement, createShadowRootWithCoreStyles} from './UIUtils.js';\n\n// Remember the original DOM mutation methods here, since we\n// will override them below to sanity check the Widget system.\nconst originalAppendChild = Element.prototype.appendChild;\nconst originalInsertBefore = Element.prototype.insertBefore;\nconst originalRemoveChild = Element.prototype.removeChild;\nconst originalRemoveChildren = Element.prototype.removeChildren;\n\nfunction assert(condition: unknown, message: string): void {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n\ntype WidgetConstructor<WidgetT extends Widget> = new (element: WidgetElement<WidgetT>) => WidgetT;\ntype WidgetProducer<WidgetT extends Widget> = (element: WidgetElement<WidgetT>) => WidgetT;\ntype WidgetFactory<WidgetT extends Widget> = WidgetConstructor<WidgetT>|WidgetProducer<WidgetT>;\ntype InferWidgetTFromFactory<F> = F extends WidgetFactory<infer WidgetT>? WidgetT : never;\n\nexport class WidgetConfig<WidgetT extends Widget> {\n  constructor(readonly widgetClass: WidgetFactory<WidgetT>, readonly widgetParams?: Partial<WidgetT>) {\n  }\n}\n\nexport function widgetConfig<F extends WidgetFactory<Widget>, ParamKeys extends keyof InferWidgetTFromFactory<F>>(\n    widgetClass: F, widgetParams?: Pick<InferWidgetTFromFactory<F>, ParamKeys>&Partial<InferWidgetTFromFactory<F>>):\n    // This is a workaround for https://github.com/runem/lit-analyzer/issues/163\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    WidgetConfig<any> {\n  return new WidgetConfig(widgetClass, widgetParams);\n}\n\nlet currentUpdateQueue: Map<Widget, PromiseWithResolvers<void>>|null = null;\nconst currentlyProcessed = new Set<Widget>();\nlet nextUpdateQueue = new Map<Widget, PromiseWithResolvers<void>>();\nlet pendingAnimationFrame: number|null = null;\n\nfunction enqueueIntoNextUpdateQueue(widget: Widget): Promise<void> {\n  const scheduledUpdate = nextUpdateQueue.get(widget) ?? Promise.withResolvers<void>();\n  nextUpdateQueue.delete(widget);\n  nextUpdateQueue.set(widget, scheduledUpdate);\n  if (pendingAnimationFrame === null) {\n    pendingAnimationFrame = requestAnimationFrame(runNextUpdate);\n  }\n  return scheduledUpdate.promise;\n}\n\nfunction enqueueWidgetUpdate(widget: Widget): Promise<void> {\n  if (currentUpdateQueue) {\n    if (currentlyProcessed.has(widget)) {\n      return enqueueIntoNextUpdateQueue(widget);\n    }\n    const scheduledUpdate = currentUpdateQueue.get(widget) ?? Promise.withResolvers<void>();\n    currentUpdateQueue.delete(widget);\n    currentUpdateQueue.set(widget, scheduledUpdate);\n    return scheduledUpdate.promise;\n  }\n  return enqueueIntoNextUpdateQueue(widget);\n}\n\nfunction cancelUpdate(widget: Widget): void {\n  if (currentUpdateQueue) {\n    const scheduledUpdate = currentUpdateQueue.get(widget);\n    if (scheduledUpdate) {\n      scheduledUpdate.resolve();\n      currentUpdateQueue.delete(widget);\n    }\n  }\n  const scheduledUpdate = nextUpdateQueue.get(widget);\n  if (scheduledUpdate) {\n    scheduledUpdate.resolve();\n    nextUpdateQueue.delete(widget);\n  }\n}\n\nfunction runNextUpdate(): void {\n  pendingAnimationFrame = null;\n  if (!currentUpdateQueue) {\n    currentUpdateQueue = nextUpdateQueue;\n    nextUpdateQueue = new Map();\n  }\n  for (const [widget, {resolve}] of currentUpdateQueue) {\n    currentlyProcessed.add(widget);\n    void (async () => {\n      await widget.performUpdate();\n      resolve();\n    })();\n  }\n  currentUpdateQueue.clear();\n  queueMicrotask(() => {\n    if (currentUpdateQueue && currentUpdateQueue.size > 0) {\n      runNextUpdate();\n    } else {\n      currentUpdateQueue = null;\n      currentlyProcessed.clear();\n    }\n  });\n}\n\nexport class WidgetElement<WidgetT extends Widget> extends HTMLElement {\n  #widgetClass?: WidgetFactory<WidgetT>;\n  #widgetParams?: Partial<WidgetT>;\n\n  createWidget(): WidgetT {\n    const widget = this.#instantiateWidget();\n    if (this.#widgetParams) {\n      Object.assign(widget, this.#widgetParams);\n    }\n    widget.requestUpdate();\n    return widget;\n  }\n\n  #instantiateWidget(): WidgetT {\n    if (!this.#widgetClass) {\n      throw new Error('No widgetClass defined');\n    }\n\n    if (Widget.isPrototypeOf(this.#widgetClass)) {\n      const ctor = this.#widgetClass as WidgetConstructor<WidgetT>;\n      return new ctor(this);\n    }\n\n    const factory = this.#widgetClass as WidgetProducer<WidgetT>;\n    return factory(this);\n  }\n\n  set widgetConfig(config: WidgetConfig<WidgetT>) {\n    const widget = Widget.get(this);\n    if (widget) {\n      let needsUpdate = false;\n      for (const key in config.widgetParams) {\n        if (config.widgetParams.hasOwnProperty(key) && config.widgetParams[key] !== this.#widgetParams?.[key]) {\n          needsUpdate = true;\n        }\n      }\n      if (needsUpdate) {\n        Object.assign(widget, config.widgetParams);\n        widget.requestUpdate();\n      }\n    }\n    this.#widgetClass = config.widgetClass;\n    this.#widgetParams = config.widgetParams;\n  }\n\n  getWidget(): WidgetT|undefined {\n    return Widget.get(this) as WidgetT | undefined;\n  }\n\n  connectedCallback(): void {\n    const widget = Widget.getOrCreateWidget(this);\n    if (!widget.element.parentElement) {\n      widget.markAsRoot();\n    }\n    widget.show(this.parentElement as HTMLElement, undefined, /* suppressOrphanWidgetError= */ true);\n  }\n\n  disconnectedCallback(): void {\n    const widget = Widget.get(this);\n    if (widget) {\n      widget.setHideOnDetach();\n      widget.detach();\n    }\n  }\n\n  override appendChild<T extends Node>(child: T): T {\n    if (child instanceof HTMLElement && child.tagName !== 'STYLE') {\n      Widget.getOrCreateWidget(child).show(this);\n      return child;\n    }\n    return super.appendChild(child);\n  }\n\n  override insertBefore<T extends Node>(child: T, referenceChild: Node): T {\n    if (child instanceof HTMLElement && child.tagName !== 'STYLE') {\n      Widget.getOrCreateWidget(child).show(this, referenceChild, true);\n      return child;\n    }\n    return super.insertBefore(child, referenceChild);\n  }\n\n  override removeChild<T extends Node>(child: T): T {\n    const childWidget = Widget.get(child as unknown as HTMLElement);\n    if (childWidget) {\n      childWidget.detach();\n      return child;\n    }\n    return super.removeChild(child);\n  }\n\n  override removeChildren(): void {\n    for (const child of this.children) {\n      const childWidget = Widget.get(child as unknown as HTMLElement);\n      if (childWidget) {\n        childWidget.detach();\n      }\n    }\n    super.removeChildren();\n  }\n\n  override cloneNode(deep: boolean): Node {\n    const clone = cloneCustomElement(this, deep);\n    if (!this.#widgetClass) {\n      throw new Error('No widgetClass defined');\n    }\n    clone.widgetConfig = {\n      widgetClass: this.#widgetClass,\n      widgetParams: this.#widgetParams,\n    };\n    return clone;\n  }\n}\n\ncustomElements.define('devtools-widget', WidgetElement);\n\nexport function widgetRef<T extends Widget, Args extends unknown[]>(\n    type: Platform.Constructor.Constructor<T, Args>, callback: (_: T) => void): ReturnType<typeof Lit.Directives.ref> {\n  return Lit.Directives.ref((e?: Element) => {\n    if (!(e instanceof HTMLElement)) {\n      return;\n    }\n    const widget = Widget.getOrCreateWidget(e);\n    if (!(widget instanceof type)) {\n      throw new Error(`Expected an element with a widget of type ${type.name} but got ${e?.constructor?.name}`);\n    }\n    callback(widget);\n  });\n}\n\nconst widgetCounterMap = new WeakMap<Node, number>();\nconst widgetMap = new WeakMap<Node, Widget>();\n\nfunction incrementWidgetCounter(parentElement: Element, childElement: Element): void {\n  const count = (widgetCounterMap.get(childElement) || 0) + (widgetMap.get(childElement) ? 1 : 0);\n  for (let el: Element|null = parentElement; el; el = el.parentElementOrShadowHost()) {\n    widgetCounterMap.set(el, (widgetCounterMap.get(el) || 0) + count);\n  }\n}\n\nfunction decrementWidgetCounter(parentElement: Element, childElement: Element): void {\n  const count = (widgetCounterMap.get(childElement) || 0) + (widgetMap.get(childElement) ? 1 : 0);\n  for (let el: Element|null = parentElement; el; el = el.parentElementOrShadowHost()) {\n    const elCounter = widgetCounterMap.get(el);\n    if (elCounter) {\n      widgetCounterMap.set(el, elCounter - count);\n    }\n  }\n}\n\n// The resolved `updateComplete` promise, which is used as a marker for the\n// Widget's `#updateComplete` private property to indicate that there's no\n// pending update.\nconst UPDATE_COMPLETE = Promise.resolve();\n\n/**\n * Additional options passed to the `Widget` constructor to configure the\n * behavior of the resulting instance.\n */\nexport interface WidgetOptions {\n  /**\n   * If you pass `true` here, the `contentElement` of the resulting `Widget`\n   * will be placed into the shadow DOM of its `element`. If the `element`\n   * doesn't already have a `shadowRoot`, a new one will be created.\n   *\n   * Otherwise, the `contentElement` will be a regular child of the `element`.\n   *\n   * Its default value is `false`.\n   */\n  useShadowDom?: boolean;\n\n  /**\n   * A boolean that, when set to `true`, specifies behavior that mitigates\n   * custom element issues around focusability. When a non-focusable part of\n   * the shadow DOM is clicked, the first focusable part is given focus, and\n   * the shadow host is given any available `:focus` styling.\n   *\n   * Its default value is `false`.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attachShadow\n   */\n  delegatesFocus?: boolean;\n\n  /**\n   * The Visual Logging configuration to put onto the `element` of the resulting\n   * `Widget`.\n   */\n  jslog?: string;\n  /**\n   * The additional classes to put onto the `element` of the resulting `Widget`.\n   */\n  classes?: string[];\n}\nexport class Widget {\n  readonly element: HTMLElement;\n  contentElement: HTMLElement;\n  #shadowRoot: typeof Element.prototype.shadowRoot;\n  #visible = false;\n  #isRoot = false;\n  #isShowing = false;\n  readonly #children: Widget[] = [];\n  #hideOnDetach = false;\n  #notificationDepth = 0;\n  #invalidationsSuspended = 0;\n  #parentWidget: Widget|null = null;\n  #cachedConstraints?: Geometry.Constraints;\n  #constraints?: Geometry.Constraints;\n  #invalidationsRequested?: boolean;\n  #externallyManaged?: boolean;\n  #updateComplete = UPDATE_COMPLETE;\n\n  /**\n   * Constructs a new `Widget` with the given `options`.\n   *\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(options?: WidgetOptions);\n\n  /**\n   * Constructs a new `Widget` with the given `options` and attached to the\n   * given `element`.\n   *\n   * If `element` is `undefined`, a new `<div>` element will be created instead\n   * and the widget will be attached to that.\n   *\n   * @param element an (optional) `HTMLElement` to attach the `Widget` to.\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(element?: HTMLElement, options?: WidgetOptions);\n\n  constructor(elementOrOptions?: HTMLElement|WidgetOptions, options?: WidgetOptions) {\n    if (elementOrOptions instanceof HTMLElement) {\n      this.element = elementOrOptions;\n    } else {\n      this.element = document.createElement('div');\n      if (elementOrOptions !== undefined) {\n        options = elementOrOptions;\n      }\n    }\n    this.#shadowRoot = this.element.shadowRoot;\n    if (options?.useShadowDom && !this.#shadowRoot) {\n      this.element.classList.add('vbox');\n      this.element.classList.add('flex-auto');\n      this.#shadowRoot = createShadowRootWithCoreStyles(this.element, {\n        delegatesFocus: options?.delegatesFocus,\n      });\n      this.contentElement = document.createElement('div');\n      this.#shadowRoot.appendChild(this.contentElement);\n    } else {\n      this.contentElement = this.element;\n    }\n    if (options?.classes) {\n      this.element.classList.add(...options.classes);\n    }\n    if (options?.jslog) {\n      this.contentElement.setAttribute('jslog', options.jslog);\n    }\n    this.contentElement.classList.add('widget');\n    widgetMap.set(this.element, this);\n  }\n\n  /**\n   * Returns the {@link Widget} whose element is the given `node`, or `undefined`\n   * if the `node` is not an element for a widget.\n   *\n   * @param node a DOM node.\n   * @returns the {@link Widget} that is attached to the `node` or `undefined`.\n   */\n  static get(node: Node): Widget|undefined {\n    return widgetMap.get(node);\n  }\n\n  static getOrCreateWidget(element: HTMLElement): Widget {\n    const widget = Widget.get(element);\n    if (widget) {\n      return widget;\n    }\n    if (element instanceof WidgetElement) {\n      return element.createWidget();\n    }\n    return new Widget(element);\n  }\n\n  markAsRoot(): void {\n    assert(!this.element.parentElement, 'Attempt to mark as root attached node');\n    this.#isRoot = true;\n  }\n\n  parentWidget(): Widget|null {\n    return this.#parentWidget;\n  }\n\n  children(): Widget[] {\n    return this.#children;\n  }\n\n  childWasDetached(_widget: Widget): void {\n  }\n\n  isShowing(): boolean {\n    return this.#isShowing;\n  }\n\n  shouldHideOnDetach(): boolean {\n    if (!this.element.parentElement) {\n      return false;\n    }\n    if (this.#hideOnDetach) {\n      return true;\n    }\n    for (const child of this.#children) {\n      if (child.shouldHideOnDetach()) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  setHideOnDetach(): void {\n    this.#hideOnDetach = true;\n  }\n\n  private inNotification(): boolean {\n    return Boolean(this.#notificationDepth) || Boolean(this.#parentWidget?.inNotification());\n  }\n\n  private parentIsShowing(): boolean {\n    if (this.#isRoot) {\n      return true;\n    }\n    return this.#parentWidget?.isShowing() ?? false;\n  }\n\n  protected callOnVisibleChildren(method: (this: Widget) => void): void {\n    const copy = this.#children.slice();\n    for (let i = 0; i < copy.length; ++i) {\n      if (copy[i].#parentWidget === this && copy[i].#visible) {\n        method.call(copy[i]);\n      }\n    }\n  }\n\n  private processWillShow(): void {\n    this.callOnVisibleChildren(this.processWillShow);\n    this.#isShowing = true;\n  }\n\n  private processWasShown(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    this.restoreScrollPositions();\n    this.notify(this.wasShown);\n    this.callOnVisibleChildren(this.processWasShown);\n  }\n\n  private processWillHide(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    this.storeScrollPositions();\n\n    this.callOnVisibleChildren(this.processWillHide);\n    this.notify(this.willHide);\n    this.#isShowing = false;\n  }\n\n  private processWasHidden(): void {\n    this.callOnVisibleChildren(this.processWasHidden);\n    this.notify(this.wasHidden);\n  }\n\n  private processOnResize(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    if (!this.isShowing()) {\n      return;\n    }\n    this.notify(this.onResize);\n    this.callOnVisibleChildren(this.processOnResize);\n  }\n\n  private notify(notification: (this: Widget) => void): void {\n    ++this.#notificationDepth;\n    try {\n      notification.call(this);\n    } finally {\n      --this.#notificationDepth;\n    }\n  }\n\n  wasShown(): void {\n  }\n\n  willHide(): void {\n  }\n\n  wasHidden(): void {\n  }\n\n  onResize(): void {\n  }\n\n  onLayout(): void {\n  }\n\n  onDetach(): void {\n  }\n\n  async ownerViewDisposed(): Promise<void> {\n  }\n\n  show(parentElement: Element, insertBefore?: Node|null, suppressOrphanWidgetError = false): void {\n    assert(parentElement, 'Attempt to attach widget with no parent element');\n\n    if (!this.#isRoot) {\n      // Update widget hierarchy.\n      let currentParent: Element|null = parentElement;\n      let currentWidget = undefined;\n      while (!currentWidget) {\n        if (!currentParent) {\n          if (suppressOrphanWidgetError) {\n            this.#isRoot = true;\n            this.show(parentElement, insertBefore);\n            return;\n          }\n          throw new Error('Attempt to attach widget to orphan node');\n        }\n        currentWidget = widgetMap.get(currentParent);\n        currentParent = currentParent.parentElementOrShadowHost();\n      }\n      this.attach(currentWidget);\n    }\n    this.#showWidget(parentElement, insertBefore);\n  }\n\n  private attach(parentWidget: Widget): void {\n    if (parentWidget === this.#parentWidget) {\n      return;\n    }\n    if (this.#parentWidget) {\n      this.detach();\n    }\n    this.#parentWidget = parentWidget;\n    this.#parentWidget.#children.push(this);\n    this.#isRoot = false;\n  }\n\n  showWidget(): void {\n    if (this.#visible) {\n      return;\n    }\n    if (!this.element.parentElement) {\n      throw new Error('Attempt to show widget that is not hidden using hideWidget().');\n    }\n    this.#showWidget(this.element.parentElement, this.element.nextSibling);\n  }\n\n  #showWidget(parentElement: Element, insertBefore?: Node|null): void {\n    let currentParent: Element|null = parentElement;\n    while (currentParent && !widgetMap.get(currentParent)) {\n      currentParent = currentParent.parentElementOrShadowHost();\n    }\n\n    if (this.#isRoot) {\n      assert(!currentParent, 'Attempt to show root widget under another widget');\n    } else {\n      assert(\n          currentParent && widgetMap.get(currentParent) === this.#parentWidget,\n          'Attempt to show under node belonging to alien widget');\n    }\n\n    const wasVisible = this.#visible;\n    if (wasVisible && this.element.parentElement === parentElement) {\n      return;\n    }\n\n    this.#visible = true;\n\n    if (!wasVisible && this.parentIsShowing()) {\n      this.processWillShow();\n    }\n\n    this.element.classList.remove('hidden');\n\n    // Reparent\n    if (this.element.parentElement !== parentElement) {\n      if (!this.#externallyManaged) {\n        incrementWidgetCounter(parentElement, this.element);\n      }\n      if (insertBefore) {\n        originalInsertBefore.call(parentElement, this.element, insertBefore);\n      } else {\n        originalAppendChild.call(parentElement, this.element);\n      }\n    }\n    const focusedElementsCount = this.#parentWidget?.getDefaultFocusedElements?.()?.length ?? 0;\n    if (this.element.hasAttribute('autofocus') && focusedElementsCount > 1) {\n      this.element.removeAttribute('autofocus');\n    }\n\n    if (!wasVisible && this.parentIsShowing()) {\n      this.processWasShown();\n    }\n\n    if (this.#parentWidget && this.hasNonZeroConstraints()) {\n      this.#parentWidget.invalidateConstraints();\n    } else {\n      this.processOnResize();\n    }\n  }\n\n  hideWidget(): void {\n    if (!this.#visible) {\n      return;\n    }\n    this.#hideWidget(false);\n  }\n\n  #hideWidget(removeFromDOM: boolean): void {\n    this.#visible = false;\n    const {parentElement} = this.element;\n\n    if (this.parentIsShowing()) {\n      this.processWillHide();\n    }\n\n    if (removeFromDOM) {\n      if (parentElement) {\n        // Force legal removal\n        decrementWidgetCounter(parentElement, this.element);\n        originalRemoveChild.call(parentElement, this.element);\n      }\n      this.onDetach();\n    } else {\n      this.element.classList.add('hidden');\n    }\n\n    if (this.parentIsShowing()) {\n      this.processWasHidden();\n    }\n    if (this.#parentWidget && this.hasNonZeroConstraints()) {\n      this.#parentWidget.invalidateConstraints();\n    }\n  }\n\n  detach(overrideHideOnDetach?: boolean): void {\n    if (!this.#parentWidget && !this.#isRoot) {\n      return;\n    }\n\n    cancelUpdate(this);\n\n    // hideOnDetach means that we should never remove element from dom - content\n    // has iframes and detaching it will hurt.\n    //\n    // overrideHideOnDetach will override hideOnDetach and the client takes\n    // responsibility for the consequences.\n    const removeFromDOM = overrideHideOnDetach || !this.shouldHideOnDetach();\n    if (this.#visible) {\n      this.#hideWidget(removeFromDOM);\n    } else if (removeFromDOM) {\n      const {parentElement} = this.element;\n      if (parentElement) {\n        // Force kick out from DOM.\n        decrementWidgetCounter(parentElement, this.element);\n        originalRemoveChild.call(parentElement, this.element);\n      }\n    }\n\n    // Update widget hierarchy.\n    if (this.#parentWidget) {\n      const childIndex = this.#parentWidget.#children.indexOf(this);\n      assert(childIndex >= 0, 'Attempt to remove non-child widget');\n      this.#parentWidget.#children.splice(childIndex, 1);\n      this.#parentWidget.childWasDetached(this);\n      this.#parentWidget = null;\n    } else {\n      assert(this.#isRoot, 'Removing non-root widget from DOM');\n    }\n  }\n\n  detachChildWidgets(): void {\n    const children = this.#children.slice();\n    for (let i = 0; i < children.length; ++i) {\n      children[i].detach();\n    }\n  }\n\n  elementsToRestoreScrollPositionsFor(): Element[] {\n    return [this.element];\n  }\n\n  storeScrollPositions(): void {\n    const elements = this.elementsToRestoreScrollPositionsFor();\n    for (const container of elements) {\n      storedScrollPositions.set(container, {scrollLeft: container.scrollLeft, scrollTop: container.scrollTop});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    const elements = this.elementsToRestoreScrollPositionsFor();\n    for (const container of elements) {\n      const storedPositions = storedScrollPositions.get(container);\n      if (storedPositions) {\n        container.scrollLeft = storedPositions.scrollLeft;\n        container.scrollTop = storedPositions.scrollTop;\n      }\n    }\n  }\n\n  doResize(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    // No matter what notification we are in, dispatching onResize is not needed.\n    if (!this.inNotification()) {\n      this.callOnVisibleChildren(this.processOnResize);\n    }\n  }\n\n  doLayout(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    this.notify(this.onLayout);\n    this.doResize();\n  }\n\n  registerRequiredCSS(...cssFiles: Array<string&{_tag: 'CSS-in-JS'}>): void {\n    for (const cssFile of cssFiles) {\n      appendStyle(this.#shadowRoot ?? this.element, cssFile);\n    }\n  }\n\n  // Unused, but useful for debugging.\n  printWidgetHierarchy(): void {\n    const lines: string[] = [];\n    this.collectWidgetHierarchy('', lines);\n    console.log(lines.join('\\n'));  // eslint-disable-line no-console\n  }\n\n  private collectWidgetHierarchy(prefix: string, lines: string[]): void {\n    lines.push(prefix + '[' + this.element.className + ']' + (this.#children.length ? ' {' : ''));\n\n    for (let i = 0; i < this.#children.length; ++i) {\n      this.#children[i].collectWidgetHierarchy(prefix + '    ', lines);\n    }\n\n    if (this.#children.length) {\n      lines.push(prefix + '}');\n    }\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    const defaultFocusedElement = this.getDefaultFocusedElement();\n    if (defaultFocusedElement) {\n      defaultFocusedElement.removeAttribute('autofocus');\n    }\n    if (element) {\n      element.setAttribute('autofocus', '');\n    }\n  }\n\n  setDefaultFocusedChild(child: Widget): void {\n    assert(child.#parentWidget === this, 'Attempt to set non-child widget as default focused.');\n\n    const defaultFocusedElement = this.getDefaultFocusedElement();\n    if (defaultFocusedElement) {\n      defaultFocusedElement.removeAttribute('autofocus');\n    }\n    child.element.setAttribute('autofocus', '');\n  }\n\n  getDefaultFocusedElements(): HTMLElement[] {\n    const autofocusElements = [...this.contentElement.querySelectorAll<HTMLElement>('[autofocus]')];\n    if (this.contentElement !== this.element) {\n      if (this.contentElement.hasAttribute('autofocus')) {\n        autofocusElements.push(this.contentElement);\n      }\n      if (autofocusElements.length === 0) {\n        autofocusElements.push(...this.element.querySelectorAll<HTMLElement>('[autofocus]'));\n      }\n    }\n    return autofocusElements.filter(autofocusElement => {\n      let widgetElement: Element|null = autofocusElement;\n      while (widgetElement) {\n        const widget = Widget.get(widgetElement);\n        if (widget) {\n          if (widgetElement === autofocusElement && widget.#parentWidget === this && widget.#visible) {\n            return true;\n          }\n          return widget === this;\n        }\n        widgetElement = widgetElement.parentElementOrShadowHost();\n      }\n      return false;\n    });\n  }\n\n  getDefaultFocusedElement(): HTMLElement|null {\n    const elements = this.getDefaultFocusedElements();\n    if (elements.length > 1) {\n      console.error(\n          'Multiple autofocus elements found', this.constructor.name,\n          ...elements.map(e => Platform.StringUtilities.trimMiddle(e.outerHTML, 250)));\n    }\n    return elements[0] || null;\n  }\n\n  focus(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    const autofocusElement = this.getDefaultFocusedElement();\n    if (autofocusElement) {\n      const widget = Widget.get(autofocusElement);\n      if (widget && widget !== this) {\n        widget.focus();\n      } else {\n        autofocusElement.focus();\n      }\n      return;\n    }\n\n    for (const child of this.#children) {\n      if (child.#visible) {\n        child.focus();\n        return;\n      }\n    }\n\n    if (this.element === this.contentElement && this.element.hasAttribute('autofocus')) {\n      this.element.focus();\n    }\n  }\n\n  hasFocus(): boolean {\n    return this.element.hasFocus();\n  }\n\n  calculateConstraints(): Geometry.Constraints {\n    return new Geometry.Constraints();\n  }\n\n  constraints(): Geometry.Constraints {\n    if (typeof this.#constraints !== 'undefined') {\n      return this.#constraints;\n    }\n    if (typeof this.#cachedConstraints === 'undefined') {\n      this.#cachedConstraints = this.calculateConstraints();\n    }\n    return this.#cachedConstraints;\n  }\n\n  setMinimumAndPreferredSizes(width: number, height: number, preferredWidth: number, preferredHeight: number): void {\n    this.#constraints =\n        new Geometry.Constraints(new Geometry.Size(width, height), new Geometry.Size(preferredWidth, preferredHeight));\n    this.invalidateConstraints();\n  }\n\n  setMinimumSize(width: number, height: number): void {\n    this.minimumSize = new Geometry.Size(width, height);\n  }\n\n  set minimumSize(size: Geometry.Size) {\n    this.#constraints = new Geometry.Constraints(size);\n    this.invalidateConstraints();\n  }\n\n  private hasNonZeroConstraints(): boolean {\n    const constraints = this.constraints();\n    return Boolean(\n        constraints.minimum.width || constraints.minimum.height || constraints.preferred.width ||\n        constraints.preferred.height);\n  }\n\n  suspendInvalidations(): void {\n    ++this.#invalidationsSuspended;\n  }\n\n  resumeInvalidations(): void {\n    --this.#invalidationsSuspended;\n    if (!this.#invalidationsSuspended && this.#invalidationsRequested) {\n      this.invalidateConstraints();\n    }\n  }\n\n  invalidateConstraints(): void {\n    if (this.#invalidationsSuspended) {\n      this.#invalidationsRequested = true;\n      return;\n    }\n    this.#invalidationsRequested = false;\n    const cached = this.#cachedConstraints;\n    this.#cachedConstraints = undefined;\n    const actual = this.constraints();\n    if (!actual.isEqual(cached || null) && this.#parentWidget) {\n      this.#parentWidget.invalidateConstraints();\n    } else {\n      this.doLayout();\n    }\n  }\n\n  // Excludes the widget from being tracked by its parents/ancestors via\n  // widgetCounter because the widget is being handled by external code.\n  // Widgets marked as being externally managed are responsible for\n  // finishing out their own lifecycle (i.e. calling detach() before being\n  // removed from the DOM). This is e.g. used for CodeMirror.\n  //\n  // Also note that this must be called before the widget is shown so that\n  // so that its ancestor's widgetCounter is not incremented.\n  markAsExternallyManaged(): void {\n    assert(!this.#parentWidget, 'Attempt to mark widget as externally managed after insertion to the DOM');\n    this.#externallyManaged = true;\n  }\n\n  /**\n   * Override this method in derived classes to perform the actual view update.\n   *\n   * This is not meant to be called directly, but invoked (indirectly) through\n   * the `requestAnimationFrame` and executed with the animation frame. Instead,\n   * use the `requestUpdate()` method to schedule an asynchronous update.\n   *\n   * @returns can either return nothing or a promise; in that latter case, the\n   *          update logic will await the resolution of the returned promise\n   *          before proceeding.\n   */\n  performUpdate(): Promise<void>|void {\n  }\n\n  /**\n   * Schedules an asynchronous update for this widget.\n   *\n   * The update will be deduplicated and executed with the next animation\n   * frame.\n   */\n  requestUpdate(): void {\n    this.#updateComplete = enqueueWidgetUpdate(this);\n  }\n\n  /**\n   * The `updateComplete` promise resolves when the widget has finished updating.\n   *\n   * Use `updateComplete` to wait for an update:\n   * ```js\n   * await widget.updateComplete;\n   * // do stuff\n   * ```\n   *\n   * This method is primarily useful for unit tests, to wait for widgets to build\n   * their DOM. For example:\n   * ```js\n   * // Set up the test widget, and wait for the initial update cycle to complete.\n   * const widget = new SomeWidget(someData);\n   * widget.requestUpdate();\n   * await widget.updateComplete;\n   *\n   * // Assert state of the widget.\n   * assert.isTrue(widget.someDataLoaded);\n   * ```\n   *\n   * @returns a promise that resolves to a `boolean` when the widget has finished\n   *          updating, the value is `true` if there are no more pending updates,\n   *          and `false` if the update cycle triggered another update.\n   */\n  get updateComplete(): Promise<void> {\n    return this.#updateComplete;\n  }\n}\n\nconst storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class VBox extends Widget {\n  /**\n   * Constructs a new `VBox` with the given `options`.\n   *\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(options?: WidgetOptions);\n\n  /**\n   * Constructs a new `VBox` with the given `options` and attached to the\n   * given `element`.\n   *\n   * If `element` is `undefined`, a new `<div>` element will be created instead\n   * and the widget will be attached to that.\n   *\n   * @param element an (optional) `HTMLElement` to attach the `VBox` to.\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(element?: HTMLElement, options?: WidgetOptions);\n\n  constructor() {\n    super(...arguments);\n    this.contentElement.classList.add('vbox');\n  }\n\n  override calculateConstraints(): Geometry.Constraints {\n    let constraints: Geometry.Constraints = new Geometry.Constraints();\n\n    function updateForChild(this: Widget): void {\n      const child = this.constraints();\n      constraints = constraints.widthToMax(child);\n      constraints = constraints.addHeight(child);\n    }\n\n    this.callOnVisibleChildren(updateForChild);\n    return constraints;\n  }\n}\n\nexport class HBox extends Widget {\n  /**\n   * Constructs a new `HBox` with the given `options`.\n   *\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(options?: WidgetOptions);\n\n  /**\n   * Constructs a new `HBox` with the given `options` and attached to the\n   * given `element`.\n   *\n   * If `element` is `undefined`, a new `<div>` element will be created instead\n   * and the widget will be attached to that.\n   *\n   * @param element an (optional) `HTMLElement` to attach the `HBox` to.\n   * @param options optional settings to configure the behavior.\n   */\n  constructor(element?: HTMLElement, options?: WidgetOptions);\n\n  constructor() {\n    super(...arguments);\n    this.contentElement.classList.add('hbox');\n  }\n\n  override calculateConstraints(): Geometry.Constraints {\n    let constraints: Geometry.Constraints = new Geometry.Constraints();\n\n    function updateForChild(this: Widget): void {\n      const child = this.constraints();\n      constraints = constraints.addWidth(child);\n      constraints = constraints.heightToMax(child);\n    }\n\n    this.callOnVisibleChildren(updateForChild);\n    return constraints;\n  }\n}\n\nexport class VBoxWithResizeCallback extends VBox {\n  private readonly resizeCallback: () => void;\n  constructor(resizeCallback: () => void) {\n    super();\n    this.resizeCallback = resizeCallback;\n  }\n\n  override onResize(): void {\n    this.resizeCallback();\n  }\n}\n\nexport class WidgetFocusRestorer {\n  private widget: Widget|null;\n  private previous: HTMLElement|null;\n  constructor(widget: Widget) {\n    this.widget = widget;\n    this.previous = (deepActiveElement(widget.element.ownerDocument) as HTMLElement | null);\n    widget.focus();\n  }\n\n  restore(): void {\n    if (!this.widget) {\n      return;\n    }\n    if (this.widget.hasFocus() && this.previous) {\n      this.previous.focus();\n    }\n    this.previous = null;\n    this.widget = null;\n  }\n}\n\nfunction domOperationError(funcName: 'appendChild'|'insertBefore'|'removeChild'|'removeChildren'): Error {\n  return new Error(`Attempt to modify widget with native DOM method \\`${funcName}\\``);\n}\n\nElement.prototype.appendChild = function<T extends Node>(node: T): T {\n  if (widgetMap.get(node) && node.parentElement !== this) {\n    throw domOperationError('appendChild');\n  }\n  return originalAppendChild.call(this, node) as T;\n};\n\nElement.prototype.insertBefore = function<T extends Node>(node: T, child: Node|null): T {\n  if (widgetMap.get(node) && node.parentElement !== this) {\n    throw domOperationError('insertBefore');\n  }\n  return originalInsertBefore.call(this, node, child) as T;\n};\n\nElement.prototype.removeChild = function<T extends Node>(child: T): T {\n  if (widgetCounterMap.get(child) || widgetMap.get(child)) {\n    throw domOperationError('removeChild');\n  }\n  return originalRemoveChild.call(this, child) as T;\n};\n\nElement.prototype.removeChildren = function(): void {\n  if (widgetCounterMap.get(this)) {\n    throw domOperationError('removeChildren');\n  }\n  return originalRemoveChildren.call(this);\n};\n"]}