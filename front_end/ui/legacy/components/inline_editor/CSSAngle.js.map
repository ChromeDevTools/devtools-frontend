{"version":3,"file":"CSSAngle.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSAngle.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport './CSSAngleEditor.js';\nimport './CSSAngleSwatch.js';\n\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as Lit from '../../../lit/lit.js';\n\nimport cssAngleStyles from './cssAngle.css.js';\nimport {\n  type Angle,\n  AngleUnit,\n  convertAngleUnit,\n  getNewAngleFromEvent,\n  getNextUnit,\n  parseText,\n  roundAngleByUnit,\n} from './CSSAngleUtils.js';\nimport {ValueChangedEvent} from './InlineEditorUtils.js';\n\nconst {render, html} = Lit;\nconst styleMap = Lit.Directives.styleMap;\n\nexport class PopoverToggledEvent extends Event {\n  static readonly eventName = 'popovertoggled';\n  data: {open: boolean};\n\n  constructor(open: boolean) {\n    super(PopoverToggledEvent.eventName, {});\n    this.data = {open};\n  }\n}\n\nexport class UnitChangedEvent extends Event {\n  static readonly eventName = 'unitchanged';\n  data: {value: string};\n\n  constructor(value: string) {\n    super(UnitChangedEvent.eventName, {});\n    this.data = {value};\n  }\n}\n\ninterface EventTypes {\n  [PopoverToggledEvent.eventName]: PopoverToggledEvent;\n  [UnitChangedEvent.eventName]: UnitChangedEvent;\n  [ValueChangedEvent.eventName]: ValueChangedEvent;\n}\n\nexport interface CSSAngleData {\n  angleText: string;\n  containingPane: HTMLElement;\n}\n\nconst DefaultAngle = {\n  value: 0,\n  unit: AngleUnit.RAD,\n};\n\nexport class CSSAngle extends HTMLElement {\n  private angle: Angle = DefaultAngle;\n  private displayedAngle: Angle = DefaultAngle;\n  private propertyValue = '';\n  private containingPane?: HTMLElement;\n  private angleElement: HTMLElement|null = null;\n  private swatchElement: HTMLElement|null = null;\n  private popoverOpen = false;\n  private popoverStyleTop = '';\n  private popoverStyleLeft = '';\n  private onMinifyingAction = this.minify.bind(this);\n\n  set data(data: CSSAngleData) {\n    const parsedResult = parseText(data.angleText);\n    if (!parsedResult) {\n      return;\n    }\n    this.angle = parsedResult;\n    this.displayedAngle = {...parsedResult};\n    this.containingPane = data.containingPane;\n    this.render();\n  }\n\n  disconnectedCallback(): void {\n    this.unbindMinifyingAction();\n  }\n\n  // We bind and unbind mouse event listeners upon popping over and minifying,\n  // because we anticipate most of the time this widget is minified even when\n  // it's attached to the DOM tree.\n  popOver(): void {\n    if (!this.containingPane) {\n      return;\n    }\n\n    if (!this.angleElement) {\n      this.angleElement = this.querySelector<HTMLElement>('.css-angle');\n    }\n    if (!this.swatchElement) {\n      this.swatchElement = this.querySelector('devtools-css-angle-swatch');\n    }\n    if (!this.angleElement || !this.swatchElement) {\n      return;\n    }\n\n    this.dispatchEvent(new PopoverToggledEvent(true));\n    this.bindMinifyingAction();\n\n    const miniIconBottom = this.swatchElement.getBoundingClientRect().bottom;\n    const miniIconLeft = this.swatchElement.getBoundingClientRect().left;\n    if (miniIconBottom && miniIconLeft) {\n      // We offset mini icon's X and Y positions with the containing styles\n      // pane's positions because DevTools' root SplitWidget's\n      // sidebar slot, where most of the DevTools content lives,\n      // has an offset of positions, which makes all of its children's DOMRect\n      // positions to have this offset.\n      const offsetTop = this.containingPane.getBoundingClientRect().top;\n      const offsetLeft = this.containingPane.getBoundingClientRect().left;\n      this.popoverStyleTop = `${miniIconBottom - offsetTop}px`;\n      this.popoverStyleLeft = `${miniIconLeft - offsetLeft}px`;\n    }\n\n    this.popoverOpen = true;\n    this.render();\n    this.angleElement.focus();\n  }\n\n  override addEventListener<K extends keyof EventTypes>(\n      type: K, listener: (this: CSSAngle, ev: EventTypes[K]) => void,\n      options?: boolean|AddEventListenerOptions|undefined): void;\n  override addEventListener<K extends keyof HTMLElementEventMap>(\n      type: K, listener: (this: HTMLElement, ev: HTMLElementEventMap[K]) => void,\n      options?: boolean|AddEventListenerOptions|undefined): void;\n  override addEventListener(\n      type: string, listener: EventListenerOrEventListenerObject,\n      options?: boolean|AddEventListenerOptions|undefined): void {\n    super.addEventListener(type, listener, options);\n  }\n\n  minify(): void {\n    if (this.popoverOpen === false) {\n      return;\n    }\n\n    this.popoverOpen = false;\n    this.dispatchEvent(new PopoverToggledEvent(false));\n    this.unbindMinifyingAction();\n    this.render();\n  }\n\n  updateProperty(value: string): void {\n    this.propertyValue = value;\n    this.render();\n  }\n\n  updateAngle(angle: Angle): void {\n    this.displayedAngle = roundAngleByUnit(convertAngleUnit(angle, this.displayedAngle.unit));\n    this.angle = this.displayedAngle;\n    this.dispatchEvent(new ValueChangedEvent(`${this.angle.value}${this.angle.unit}`));\n    this.render();\n  }\n\n  private displayNextUnit(): void {\n    const nextUnit = getNextUnit(this.displayedAngle.unit);\n    this.displayedAngle = roundAngleByUnit(convertAngleUnit(this.angle, nextUnit));\n    this.dispatchEvent(new UnitChangedEvent(`${this.displayedAngle.value}${this.displayedAngle.unit}`));\n  }\n\n  private bindMinifyingAction(): void {\n    document.addEventListener('mousedown', this.onMinifyingAction);\n    if (this.containingPane) {\n      this.containingPane.addEventListener('scroll', this.onMinifyingAction);\n    }\n  }\n\n  private unbindMinifyingAction(): void {\n    document.removeEventListener('mousedown', this.onMinifyingAction);\n    if (this.containingPane) {\n      this.containingPane.removeEventListener('scroll', this.onMinifyingAction);\n    }\n  }\n\n  private onMiniIconClick(event: MouseEvent|KeyboardEvent): void {\n    event.stopPropagation();\n    if (event.shiftKey && !this.popoverOpen) {\n      this.displayNextUnit();\n      return;\n    }\n    this.popoverOpen ? this.minify() : this.popOver();\n  }\n\n  // Fix that the previous text will be selected when double-clicking the angle icon\n  private consume(event: MouseEvent): void {\n    event.stopPropagation();\n  }\n\n  private onKeydown(event: KeyboardEvent): void {\n    if (!this.popoverOpen) {\n      if (Platform.KeyboardUtilities.isEnterOrSpaceKey(event)) {\n        this.onMiniIconClick(event);\n        event.preventDefault();\n      }\n      return;\n    }\n\n    switch (event.key) {\n      case 'Escape':\n        event.stopPropagation();\n        this.minify();\n        this.blur();\n        break;\n      case 'ArrowUp':\n      case 'ArrowDown': {\n        const newAngle = getNewAngleFromEvent(this.angle, event);\n        if (newAngle) {\n          this.updateAngle(newAngle);\n        }\n        event.preventDefault();\n        break;\n      }\n    }\n  }\n\n  private render(): void {\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(html`\n      <style>${cssAngleStyles}</style>\n      <div class=\"css-angle\" @focusout=${this.minify} @keydown=${this.onKeydown} tabindex=\"-1\">\n        <div class=\"preview\">\n          <devtools-css-angle-swatch\n            @click=${this.onMiniIconClick}\n            @mousedown=${this.consume}\n            @dblclick=${this.consume}\n            .data=${{\n              angle: this.angle,\n            }}>\n          </devtools-css-angle-swatch>\n          <slot></slot>\n        </div>\n        ${this.popoverOpen ? this.renderPopover() : null}\n      </div>\n    `, this, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  private renderPopover(): Lit.TemplateResult {\n    let contextualBackground = '';\n    if (this.propertyValue && !this.propertyValue.match(/url\\(.*\\)/i)) {\n      contextualBackground = this.propertyValue;\n    }\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return html`\n      <devtools-css-angle-editor\n        class=\"popover popover-css-angle\"\n        style=${styleMap({top: this.popoverStyleTop, left: this.popoverStyleLeft})}\n        .data=${{\n          angle: this.angle,\n          onAngleUpdate: (angle: Angle):void => {\n            this.updateAngle(angle);\n          },\n          background: contextualBackground,\n        }}>\n      </devtools-css-angle-editor>`;\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-css-angle', CSSAngle);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-css-angle': CSSAngle;\n  }\n}\n"]}