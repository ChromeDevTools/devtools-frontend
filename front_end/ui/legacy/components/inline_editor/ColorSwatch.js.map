{"version":3,"file":"ColorSwatch.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/ColorSwatch.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-lit-render-outside-of-view */\n\nimport type * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as ColorPicker from '../../../legacy/components/color_picker/color_picker.js';\nimport * as Lit from '../../../lit/lit.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\n\nimport colorSwatchStyles from './colorSwatch.css.js';\n\nconst {html} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Icon element title in Color Swatch of the inline editor in the Styles tab\n   */\n  shiftclickToChangeColorFormat: 'Shift-click to change color format',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/inline_editor/ColorSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class ColorFormatChangedEvent extends Event {\n  static readonly eventName = 'colorformatchanged';\n\n  data: {color: Common.Color.Color};\n\n  constructor(color: Common.Color.Color) {\n    super(ColorFormatChangedEvent.eventName, {});\n    this.data = {color};\n  }\n}\n\nexport class ColorChangedEvent extends Event {\n  static readonly eventName = 'colorchanged';\n\n  data: {color: Common.Color.Color};\n\n  constructor(color: Common.Color.Color) {\n    super(ColorChangedEvent.eventName, {});\n    this.data = {color};\n  }\n}\n\nexport class ClickEvent extends Event {\n  static readonly eventName = 'swatchclick';\n\n  constructor() {\n    super(ClickEvent.eventName, {});\n  }\n}\n\nexport class ColorSwatch extends HTMLElement {\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private tooltip: string = i18nString(UIStrings.shiftclickToChangeColorFormat);\n  private color: Common.Color.Color|null = null;\n  private readonly = false;\n\n  constructor(tooltip?: string) {\n    super();\n    if (tooltip) {\n      this.tooltip = tooltip;\n    }\n    this.tabIndex = -1;\n    this.addEventListener('keydown', e => this.onActivate(e));\n  }\n\n  static isColorSwatch(element: Element): element is ColorSwatch {\n    return element.localName === 'devtools-color-swatch';\n  }\n\n  setReadonly(readonly: boolean): void {\n    if (this.readonly === readonly) {\n      return;\n    }\n\n    this.readonly = readonly;\n    if (this.color) {\n      this.renderColor(this.color);\n    }\n  }\n\n  getColor(): Common.Color.Color|null {\n    return this.color;\n  }\n\n  get anchorBox(): AnchorBox|null {\n    const swatch = this.shadow.querySelector('.color-swatch');\n    return swatch ? swatch.boxInWindow() : null;\n  }\n\n  getText(): string|undefined {\n    return this.color?.getAuthoredText() ?? this.color?.asString();\n  }\n\n  /**\n   * Render this swatch given a color object or text to be parsed as a color.\n   * @param color The color object or string to use for this swatch.\n   */\n  renderColor(color: Common.Color.Color): void {\n    this.color = color;\n\n    const colorSwatchClasses = Lit.Directives.classMap({\n      'color-swatch': true,\n      readonly: this.readonly,\n    });\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    // Note that we use a <slot> with a default value here to display the color text. Consumers of this component are\n    // free to append any content to replace what is being shown here.\n    // Note also that whitespace between nodes is removed on purpose to avoid pushing these elements apart. Do not\n    // re-format the HTML code.\n    Lit.render(\n      html`<style>${colorSwatchStyles}</style><span\n          class=${colorSwatchClasses}\n          title=${this.tooltip}><span\n            class=\"color-swatch-inner\"\n            style=\"background-color: ${color.asString()};\"\n            jslog=${VisualLogging.showStyleEditor('color').track({click: true})}\n            @click=${this.onActivate}\n            @mousedown=${this.consume}\n            @dblclick=${this.consume}></span></span>`,\n      this.shadow, {host: this});\n    // clang-format on\n  }\n\n  private onActivate(e: KeyboardEvent|MouseEvent): void {\n    if (this.readonly) {\n      return;\n    }\n\n    if ((e instanceof KeyboardEvent && e.key !== 'Enter' && e.key !== ' ') ||\n        (e instanceof MouseEvent && e.button > 1)) {\n      return;\n    }\n\n    if (e.shiftKey) {\n      e.stopPropagation();\n      this.showFormatPicker(e);\n      return;\n    }\n\n    this.dispatchEvent(new ClickEvent());\n    this.consume(e);\n  }\n\n  private consume(e: Event): void {\n    e.stopPropagation();\n  }\n\n  setColor(color: Common.Color.Color): void {\n    this.renderColor(color);\n    this.dispatchEvent(new ColorChangedEvent(color));\n  }\n\n  private showFormatPicker(e: Event): void {\n    if (!this.color) {\n      return;\n    }\n\n    const contextMenu = new ColorPicker.FormatPickerContextMenu.FormatPickerContextMenu(this.color);\n    void contextMenu.show(e, color => {\n      this.dispatchEvent(new ColorFormatChangedEvent(color));\n    });\n  }\n}\n\ncustomElements.define('devtools-color-swatch', ColorSwatch);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-color-swatch': ColorSwatch;\n  }\n\n  interface HTMLElementEventMap {\n    [ColorChangedEvent.eventName]: ColorChangedEvent;\n    [ColorFormatChangedEvent.eventName]: ColorFormatChangedEvent;\n    [ClickEvent.eventName]: Event;\n  }\n}\n"]}