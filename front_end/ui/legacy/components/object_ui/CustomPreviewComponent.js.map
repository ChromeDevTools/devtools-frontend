{"version":3,"file":"CustomPreviewComponent.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/object_ui/CustomPreviewComponent.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAC7B,oDAAoD;AAEpD,OAAO,KAAK,MAAM,MAAM,mCAAmC,CAAC;AAC5D,OAAO,KAAK,IAAI,MAAM,+BAA+B,CAAC;AAGtD,OAAO,KAAK,UAAU,MAAM,gDAAgD,CAAC;AAC7E,OAAO,KAAK,EAAE,MAAM,iBAAiB,CAAC;AAEtC,OAAO,4BAA4B,MAAM,iCAAiC,CAAC;AAC3E,OAAO,EACL,uBAAuB,EACvB,mCAAmC,EACnC,yBAAyB,EACzB,UAAU,GACX,MAAM,8BAA8B,CAAC;AAEtC,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,sBAAsB,EAAE,2BAA2B;CAC3C,CAAC;AACX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,0DAA0D,EAAE,SAAS,CAAC,CAAC;AAChH,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AAEtE,MAAM,OAAO,oBAAoB;IACd,cAAc,CAAkB;IAChC,MAAM,CAAgC;IAC/C,QAAQ,CAAU;IAClB,aAAa,CAAY;IAChB,MAAM,CAAiB;IACvB,UAAU,CAAiC;IAC5D,YAAY,MAAqC;QAC/C,IAAI,CAAC,cAAc,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACrD,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAC;QAC/D,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,MAAM,aAAa,GAAG,MAAM,CAAC,aAAa,EAAE,CAAC;QAE7C,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,OAAO;QACT,CAAC;QAED,IAAI,UAAU,CAAC;QACf,IAAI,CAAC;YACH,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAChD,CAAC;QAAC,OAAO,CAAC,EAAE,CAAC;YACX,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,2CAA2C,GAAG,CAAC,CAAC,CAAC;YACzF,OAAO;QACT,CAAC;QACD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;QAC/C,IAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,KAAK,IAAI,CAAC,SAAS,EAAE,CAAC;YAC5C,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,qDAAqD,CAAC,CAAC;YAC/F,OAAO;QACT,CAAC;QAED,IAAI,aAAa,CAAC,YAAY,EAAE,CAAC;YAC/B,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,EAAE,CAAC;gBACnC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,kCAAkC,CAAC,CAAC;YAChE,CAAC;YACD,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;YACtE,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,oBAAoB,CAAC,CAAC;YACjF,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACpE,CAAC;QAED,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/C,CAAC;IAED,OAAO;QACL,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IAEO,eAAe,CAAC,MAAe;QACrC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;YAC3B,OAAO,QAAQ,CAAC,cAAc,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;QACjD,CAAC;QAED,OAAO,MAAM,CAAC,CAAC,CAAC,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;IAC5F,CAAC;IAED,oEAAoE;IACpE,8DAA8D;IACtD,aAAa,CAAC,MAAa;QACjC,MAAM,OAAO,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;QAC/B,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;YACpC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,4BAA4B,GAAG,OAAO,GAAG,kBAAkB,CAAC,CAAC;YACrG,OAAO,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QACxC,CAAC;QACD,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAE,OAAkB,CAAC,CAAC;QAC5D,IAAI,CAAC,OAAO,MAAM,CAAC,CAAC,CAAC,KAAK,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACjE,MAAM,UAAU,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;YAClC,KAAK,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;gBAC7B,MAAM,KAAK,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;gBAC9B,IAAI,CAAC,GAAG,KAAK,OAAO,CAAC,IAAI,CAAC,OAAO,KAAK,KAAK,QAAQ,CAAC,EAAE,CAAC;oBACrD,SAAS;gBACX,CAAC;gBAED,OAAO,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;YACnC,CAAC;QACH,CAAC;QAED,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;QACvC,OAAO,OAAO,CAAC;IACjB,CAAC;IAEO,eAAe,CAAC,SAAoB;QAC1C,SAAS,CAAC,KAAK,EAAE,CAAC;QAClB,MAAM,UAAU,GAAG,SAAS,CAAC,KAAK,EAAE,CAAC;QACrC,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,CAAC,kBAAkB,CAAE,UAA4C,CAAC,CAAC;QAClH,IAAI,YAAY,CAAC,aAAa,EAAE,EAAE,CAAC;YACjC,OAAO,CAAC,IAAI,oBAAoB,CAAC,YAAY,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC;QAC5D,CAAC;QAED,MAAM,cAAc,GAAG,uBAAuB,CAAC,yBAAyB,CAAC,YAAY,CAAC,CAAC;QACvF,cAAc,CAAC,SAAS,CAAC,MAAM,CAAC,4CAA4C,EAAE,YAAY,CAAC,WAAW,CAAC,CAAC;QACxG,OAAO,cAAc,CAAC;IACxB,CAAC;IAEO,gBAAgB,CAAC,aAAmB,EAAE,UAAqB;QACjE,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC;YAC3C,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACjE,CAAC;IACH,CAAC;IAEO,OAAO,CAAC,KAAY;QAC1B,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACpB,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;aAAM,CAAC;YACN,KAAK,IAAI,CAAC,QAAQ,EAAE,CAAC;QACvB,CAAC;IACH,CAAC;IAEO,YAAY;QAClB,IAAI,CAAC,QAAQ,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,IAAI,CAAC,MAAM,YAAY,OAAO,EAAE,CAAC;YACnC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC1D,CAAC;QACD,IAAI,IAAI,CAAC,aAAa,YAAY,OAAO,EAAE,CAAC;YAC1C,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAChE,CAAC;QACD,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBAClB,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,eAAe,CAAC;YACzC,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,gBAAgB,CAAC;YAC1C,CAAC;QACH,CAAC;IACH,CAAC;IACO,sBAAsB,CAAgD;IAE9E,KAAK,CAAC,QAAQ;QACZ,MAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;QAElD,IAAI,CAAC,aAAa,EAAE,CAAC;YACnB,OAAO;QACT,CAAC;QAED,IAAI,aAAa,CAAC,YAAY,EAAE,CAAC;YAC/B,MAAM,UAAU,GACZ,MAAM,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,UAAU,CAAC,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,EAAC,QAAQ,EAAE,aAAa,CAAC,YAAY,EAAC,CAAC,CAAC,CAAC;YAC7G,IAAI,UAAU,KAAK,IAAI,EAAE,CAAC;gBACxB,oHAAoH;gBACpH,gGAAgG;gBAChG,IAAI,CAAC,sBAAsB,GAAG,IAAI,mCAAmC,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC;gBACxF,IAAI,CAAC,sBAAsB,CAAC,+BAA+B,CAAC,UAAU,CAAC,IAAI,EAAE,qBAAqB,CAAC,KAAK,CAAC,CAAC;gBAC1G,IAAI,CAAC,sBAAsB,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,wCAAwC,CAAC,CAAC;gBAC5F,KAAK,yBAAyB,CAAC,QAAQ,CACnC,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,EAAE,IAAI,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;gBAE1F,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,sBAAsB,CAAC,OAAO,CAAC;YAC3D,CAAC;iBAAM,CAAC;gBACN,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;YACxD,CAAC;YAED,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACpD,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;IACH,CAAC;CACF;AAED,MAAM,YAAY,GAAG,CAAC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAEtE,MAAM,OAAO,sBAAsB;IAChB,MAAM,CAAgC;IAC/C,oBAAoB,CAA4B;IACxD,OAAO,CAAkB;IACzB,YAAY,MAAqC;QAC/C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAAC,MAAM,CAAC,CAAC;QAC7D,IAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC9C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;QAC1C,MAAM,UAAU,GAAG,EAAE,CAAC,OAAO,CAAC,8BAA8B,CAAC,IAAI,CAAC,OAAO,EAAE,EAAC,OAAO,EAAE,4BAA4B,EAAC,CAAC,CAAC;QACpH,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,aAAa,EAAE,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,KAAK,CAAC,CAAC;QAC3F,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC,OAAO,EAAE,CAAC,CAAC;IAC9D,CAAC;IAED,gBAAgB;QACd,MAAM,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;QAClD,IAAI,aAAa,IAAI,aAAa,CAAC,YAAY,IAAI,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC7E,KAAK,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC;QAC5C,CAAC;IACH,CAAC;IAEO,qBAAqB,CAAC,KAAY;QACxC,MAAM,WAAW,GAAG,IAAI,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC1D,IAAI,IAAI,CAAC,oBAAoB,EAAE,CAAC;YAC9B,WAAW,CAAC,aAAa,EAAE,CAAC,UAAU,CAClC,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAAC,EAAE,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,EACzE,EAAC,YAAY,EAAE,2BAA2B,EAAC,CAAC,CAAC;QACnD,CAAC;QACD,WAAW,CAAC,qBAAqB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC/C,KAAK,WAAW,CAAC,IAAI,EAAE,CAAC;IAC1B,CAAC;IAEO,WAAW;QACjB,IAAI,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;YAC5B,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,GAAG,EAAE,CAAC;YACzC,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;YACjC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,WAAW,CAAC,uBAAuB,CAAC,yBAAyB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;QACtG,CAAC;IACH,CAAC;CACF","sourcesContent":["// Copyright 2014 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as IconButton from '../../../components/icon_button/icon_button.js';\nimport * as UI from '../../legacy.js';\n\nimport customPreviewComponentStyles from './customPreviewComponent.css.js';\nimport {\n  ObjectPropertiesSection,\n  ObjectPropertiesSectionsTreeOutline,\n  ObjectPropertyTreeElement,\n  ObjectTree,\n} from './ObjectPropertiesSection.js';\n\nconst UIStrings = {\n  /**\n   * @description A context menu item in the Custom Preview Component\n   */\n  showAsJavascriptObject: 'Show as JavaScript object',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/object_ui/CustomPreviewComponent.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class CustomPreviewSection {\n  private readonly sectionElement: HTMLSpanElement;\n  private readonly object: SDK.RemoteObject.RemoteObject;\n  private expanded: boolean;\n  private cachedContent: Node|null;\n  private readonly header: Node|undefined;\n  private readonly expandIcon: IconButton.Icon.Icon|undefined;\n  constructor(object: SDK.RemoteObject.RemoteObject) {\n    this.sectionElement = document.createElement('span');\n    this.sectionElement.classList.add('custom-expandable-section');\n    this.object = object;\n    this.expanded = false;\n    this.cachedContent = null;\n    const customPreview = object.customPreview();\n\n    if (!customPreview) {\n      return;\n    }\n\n    let headerJSON;\n    try {\n      headerJSON = JSON.parse(customPreview.header);\n    } catch (e) {\n      Common.Console.Console.instance().error('Broken formatter: header is invalid json ' + e);\n      return;\n    }\n    this.header = this.renderJSONMLTag(headerJSON);\n    if (this.header.nodeType === Node.TEXT_NODE) {\n      Common.Console.Console.instance().error('Broken formatter: header should be an element node.');\n      return;\n    }\n\n    if (customPreview.bodyGetterId) {\n      if (this.header instanceof Element) {\n        this.header.classList.add('custom-expandable-section-header');\n      }\n      this.header.addEventListener('click', this.onClick.bind(this), false);\n      this.expandIcon = IconButton.Icon.create('triangle-right', 'custom-expand-icon');\n      this.header.insertBefore(this.expandIcon, this.header.firstChild);\n    }\n\n    this.sectionElement.appendChild(this.header);\n  }\n\n  element(): Element {\n    return this.sectionElement;\n  }\n\n  private renderJSONMLTag(jsonML: unknown): Node {\n    if (!Array.isArray(jsonML)) {\n      return document.createTextNode(String(jsonML));\n    }\n\n    return jsonML[0] === 'object' ? this.layoutObjectTag(jsonML) : this.renderElement(jsonML);\n  }\n\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private renderElement(object: any[]): Node {\n    const tagName = object.shift();\n    if (!ALLOWED_TAGS.includes(tagName)) {\n      Common.Console.Console.instance().error('Broken formatter: element ' + tagName + ' is not allowed!');\n      return document.createElement('span');\n    }\n    const element = document.createElement((tagName as string));\n    if ((typeof object[0] === 'object') && !Array.isArray(object[0])) {\n      const attributes = object.shift();\n      for (const key in attributes) {\n        const value = attributes[key];\n        if ((key !== 'style') || (typeof value !== 'string')) {\n          continue;\n        }\n\n        element.setAttribute(key, value);\n      }\n    }\n\n    this.appendJsonMLTags(element, object);\n    return element;\n  }\n\n  private layoutObjectTag(objectTag: unknown[]): Node {\n    objectTag.shift();\n    const attributes = objectTag.shift();\n    const remoteObject = this.object.runtimeModel().createRemoteObject((attributes as Protocol.Runtime.RemoteObject));\n    if (remoteObject.customPreview()) {\n      return (new CustomPreviewSection(remoteObject)).element();\n    }\n\n    const sectionElement = ObjectPropertiesSection.defaultObjectPresentation(remoteObject);\n    sectionElement.classList.toggle('custom-expandable-section-standard-section', remoteObject.hasChildren);\n    return sectionElement;\n  }\n\n  private appendJsonMLTags(parentElement: Node, jsonMLTags: unknown[]): void {\n    for (let i = 0; i < jsonMLTags.length; ++i) {\n      parentElement.appendChild(this.renderJSONMLTag(jsonMLTags[i]));\n    }\n  }\n\n  private onClick(event: Event): void {\n    event.consume(true);\n    if (this.cachedContent) {\n      this.toggleExpand();\n    } else {\n      void this.loadBody();\n    }\n  }\n\n  private toggleExpand(): void {\n    this.expanded = !this.expanded;\n    if (this.header instanceof Element) {\n      this.header.classList.toggle('expanded', this.expanded);\n    }\n    if (this.cachedContent instanceof Element) {\n      this.cachedContent.classList.toggle('hidden', !this.expanded);\n    }\n    if (this.expandIcon) {\n      if (this.expanded) {\n        this.expandIcon.name = 'triangle-down';\n      } else {\n        this.expandIcon.name = 'triangle-right';\n      }\n    }\n  }\n  private defaultBodyTreeOutline: ObjectPropertiesSectionsTreeOutline|undefined;\n\n  async loadBody(): Promise<void> {\n    const customPreview = this.object.customPreview();\n\n    if (!customPreview) {\n      return;\n    }\n\n    if (customPreview.bodyGetterId) {\n      const bodyJsonML =\n          await this.object.callFunctionJSON(bodyGetter => bodyGetter(), [{objectId: customPreview.bodyGetterId}]);\n      if (bodyJsonML === null) {\n        // Per https://firefox-source-docs.mozilla.org/devtools-user/custom_formatters/index.html#custom-formatter-structure\n        // we are supposed to fall back to the default format when the `body()` callback returns `null`.\n        this.defaultBodyTreeOutline = new ObjectPropertiesSectionsTreeOutline({readOnly: true});\n        this.defaultBodyTreeOutline.setShowSelectionOnKeyboardFocus(/* show */ true, /* preventTabOrder */ false);\n        this.defaultBodyTreeOutline.element.classList.add('custom-expandable-section-default-body');\n        void ObjectPropertyTreeElement.populate(\n            this.defaultBodyTreeOutline.rootElement(), new ObjectTree(this.object), false, false);\n\n        this.cachedContent = this.defaultBodyTreeOutline.element;\n      } else {\n        this.cachedContent = this.renderJSONMLTag(bodyJsonML);\n      }\n\n      this.sectionElement.appendChild(this.cachedContent);\n      this.toggleExpand();\n    }\n  }\n}\n\nconst ALLOWED_TAGS = ['span', 'div', 'ol', 'li', 'table', 'tr', 'td'];\n\nexport class CustomPreviewComponent {\n  private readonly object: SDK.RemoteObject.RemoteObject;\n  private customPreviewSection: CustomPreviewSection|null;\n  element: HTMLSpanElement;\n  constructor(object: SDK.RemoteObject.RemoteObject) {\n    this.object = object;\n    this.customPreviewSection = new CustomPreviewSection(object);\n    this.element = document.createElement('span');\n    this.element.classList.add('source-code');\n    const shadowRoot = UI.UIUtils.createShadowRootWithCoreStyles(this.element, {cssFile: customPreviewComponentStyles});\n    this.element.addEventListener('contextmenu', this.contextMenuEventFired.bind(this), false);\n    shadowRoot.appendChild(this.customPreviewSection.element());\n  }\n\n  expandIfPossible(): void {\n    const customPreview = this.object.customPreview();\n    if (customPreview && customPreview.bodyGetterId && this.customPreviewSection) {\n      void this.customPreviewSection.loadBody();\n    }\n  }\n\n  private contextMenuEventFired(event: Event): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    if (this.customPreviewSection) {\n      contextMenu.revealSection().appendItem(\n          i18nString(UIStrings.showAsJavascriptObject), this.disassemble.bind(this),\n          {jslogContext: 'show-as-javascript-object'});\n    }\n    contextMenu.appendApplicableItems(this.object);\n    void contextMenu.show();\n  }\n\n  private disassemble(): void {\n    if (this.element.shadowRoot) {\n      this.element.shadowRoot.textContent = '';\n      this.customPreviewSection = null;\n      this.element.shadowRoot.appendChild(ObjectPropertiesSection.defaultObjectPresentation(this.object));\n    }\n  }\n}\n"]}