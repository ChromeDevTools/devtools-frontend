{"version":3,"file":"FontView.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/source_frame/FontView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\n/*\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as TextUtils from '../../../../models/text_utils/text_utils.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport fontViewStyles from './fontView.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Text that appears on a button for the font resource type filter.\n   */\n  font: 'Font',\n  /**\n   * @description Aria accessible name in Font View of the Sources panel\n   * @example {https://example.com} PH1\n   */\n  previewOfFontFromS: 'Preview of font from {PH1}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/source_frame/FontView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class FontView extends UI.View.SimpleView {\n  private readonly url: Platform.DevToolsPath.UrlString;\n  private readonly contentProvider: TextUtils.ContentProvider.ContentProvider;\n  private readonly mimeTypeLabel: UI.Toolbar.ToolbarText;\n  fontPreviewElement!: HTMLElement|null;\n  private dummyElement!: HTMLElement|null;\n  fontStyleElement!: HTMLStyleElement|null;\n  private inResize!: boolean|null;\n  constructor(mimeType: string, contentProvider: TextUtils.ContentProvider.ContentProvider) {\n    super({\n      title: i18nString(UIStrings.font),\n      viewId: 'font',\n      jslog: `${VisualLogging.pane('font-view')}`,\n    });\n    this.registerRequiredCSS(fontViewStyles);\n    this.element.classList.add('font-view');\n    this.url = contentProvider.contentURL();\n    UI.ARIAUtils.setLabel(this.element, i18nString(UIStrings.previewOfFontFromS, {PH1: this.url}));\n    this.contentProvider = contentProvider;\n    this.mimeTypeLabel = new UI.Toolbar.ToolbarText(mimeType);\n  }\n\n  override async toolbarItems(): Promise<UI.Toolbar.ToolbarItem[]> {\n    return [this.mimeTypeLabel];\n  }\n\n  private onFontContentLoaded(uniqueFontName: string, contentData: TextUtils.ContentData.ContentDataOrError): void {\n    const url = TextUtils.ContentData.ContentData.isError(contentData) ? this.url : contentData.asDataUrl();\n    if (!this.fontStyleElement) {\n      return;\n    }\n    this.fontStyleElement.textContent =\n        Platform.StringUtilities.sprintf('@font-face { font-family: \"%s\"; src: url(%s); }', uniqueFontName, url);\n    this.updateFontPreviewSize();\n  }\n\n  private createContentIfNeeded(): void {\n    if (this.fontPreviewElement) {\n      return;\n    }\n\n    const uniqueFontName = `WebInspectorFontPreview${++fontId}`;\n    this.fontStyleElement = document.createElement('style');\n    void this.contentProvider.requestContentData().then(contentData => {\n      this.onFontContentLoaded(uniqueFontName, contentData);\n    });\n    this.element.appendChild(this.fontStyleElement);\n\n    const fontPreview = document.createElement('div');\n    for (let i = 0; i < FONT_PREVIEW_LINES.length; ++i) {\n      if (i > 0) {\n        fontPreview.createChild('br');\n      }\n      UI.UIUtils.createTextChild(fontPreview, FONT_PREVIEW_LINES[i]);\n    }\n    this.fontPreviewElement = (fontPreview.cloneNode(true) as HTMLDivElement);\n    if (!this.fontPreviewElement) {\n      return;\n    }\n    UI.ARIAUtils.setHidden(this.fontPreviewElement, true);\n    this.fontPreviewElement.style.overflow = 'hidden';\n    this.fontPreviewElement.style.setProperty('font-family', uniqueFontName);\n    this.fontPreviewElement.style.setProperty('visibility', 'hidden');\n\n    this.dummyElement = fontPreview;\n    this.dummyElement.style.visibility = 'hidden';\n    this.dummyElement.style.zIndex = '-1';\n    this.dummyElement.style.display = 'inline';\n    this.dummyElement.style.position = 'absolute';\n    this.dummyElement.style.setProperty('font-family', uniqueFontName);\n    this.dummyElement.style.setProperty('font-size', MEASUURE_FONT_SIZE + 'px');\n\n    this.element.appendChild(this.fontPreviewElement);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.createContentIfNeeded();\n\n    this.updateFontPreviewSize();\n  }\n\n  override onResize(): void {\n    if (this.inResize) {\n      return;\n    }\n\n    this.inResize = true;\n    try {\n      this.updateFontPreviewSize();\n    } finally {\n      this.inResize = null;\n    }\n  }\n\n  private measureElement(): {\n    width: number,\n    height: number,\n  } {\n    if (!this.dummyElement) {\n      throw new Error('No font preview loaded');\n    }\n    this.element.appendChild(this.dummyElement);\n    const result = {width: this.dummyElement.offsetWidth, height: this.dummyElement.offsetHeight};\n    this.element.removeChild(this.dummyElement);\n\n    return result;\n  }\n\n  updateFontPreviewSize(): void {\n    if (!this.fontPreviewElement || !this.isShowing()) {\n      return;\n    }\n\n    this.fontPreviewElement.style.removeProperty('visibility');\n    const dimension = this.measureElement();\n\n    const height = dimension.height;\n    const width = dimension.width;\n\n    // Subtract some padding. This should match the paddings in the CSS plus room for the scrollbar.\n    const containerWidth = this.element.offsetWidth - 50;\n    const containerHeight = this.element.offsetHeight - 30;\n\n    if (!height || !width || !containerWidth || !containerHeight) {\n      this.fontPreviewElement.style.removeProperty('font-size');\n      return;\n    }\n\n    const widthRatio = containerWidth / width;\n    const heightRatio = containerHeight / height;\n    const finalFontSize = Math.floor(MEASUURE_FONT_SIZE * Math.min(widthRatio, heightRatio)) - 2;\n\n    this.fontPreviewElement.style.setProperty('font-size', finalFontSize + 'px', undefined);\n  }\n}\n\nlet fontId = 0;\nconst FONT_PREVIEW_LINES = ['ABCDEFGHIJKLM', 'NOPQRSTUVWXYZ', 'abcdefghijklm', 'nopqrstuvwxyz', '1234567890'];\nconst MEASUURE_FONT_SIZE = 50;\n"]}