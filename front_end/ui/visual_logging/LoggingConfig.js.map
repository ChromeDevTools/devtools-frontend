{"version":3,"file":"LoggingConfig.js","sourceRoot":"","sources":["../../../../../../front_end/ui/visual_logging/LoggingConfig.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as Root from '../../core/root/root.js';\n\nimport {DebugLoggingFormat} from './Debugging.js';\nimport {knownContextValues} from './KnownContextValues.js';\n\nconst LOGGING_ATTRIBUTE = 'jslog';\n\ninterface TrackConfig {\n  click?: boolean;\n  dblclick?: boolean;\n  hover?: boolean;\n  drag?: boolean;\n  change?: boolean;\n  keydown?: boolean|string;\n  resize?: boolean;\n}\n\nexport interface LoggingConfig {\n  ve: number;\n  track?: TrackConfig;\n  context?: string;\n  parent?: string;\n}\n\nexport function needsLogging(element: Element): boolean {\n  return element.hasAttribute(LOGGING_ATTRIBUTE);\n}\n\nexport function getLoggingConfig(element: Element): LoggingConfig {\n  return parseJsLog(element.getAttribute(LOGGING_ATTRIBUTE) || '');\n}\n\nexport enum VisualElements {\n  /* eslint-disable @typescript-eslint/naming-convention -- Indexed access. */\n  TreeItem = 1,\n  Close = 2,\n  Counter = 3,\n  Drawer = 4,\n  Resizer = 5,\n  Toggle = 6,\n  Tree = 7,\n  TextField = 8,\n  AnimationClip = 9,\n  Section = 10,\n  SectionHeader = 11,\n  Timeline = 12,\n  CSSRuleHeader = 13,\n  Expand = 14,\n  ToggleSubpane = 15,\n  ControlPoint = 16,\n  Toolbar = 17,\n  Popover = 18,\n  BreakpointMarker = 19,\n  DropDown = 20,\n  Adorner = 21,\n  Gutter = 22,\n  MetricsBox = 23,\n  MetricsBoxPart = 24,\n  Badge = 25,\n  DOMBreakpoint = 26,\n  /* 27 used to be ElementPropertiesPane, but free to grab now */\n  /* 28 used to be EventListenersPane, but free to grab now */\n  Action = 29,\n  FilterDropdown = 30,\n  Dialog = 31,\n  BezierCurveEditor = 32,\n  /* 33 used to be BezierEditor, but free to grab now */\n  BezierPresetCategory = 34,\n  Preview = 35,\n  Canvas = 36,\n  ColorEyeDropper = 37,\n  /* 38 used to be ColorPicker, but free to grab now */\n  /* 39 used to be CopyColor, but free to grab now */\n  /* 40 used to be CssAngleEditor, but free to grab now */\n  /* 41 used to be CssFlexboxEditor, but free to grab now */\n  /* 42 used to be CssGridEditor, but free to grab now */\n  /* 43 used to be CssShadowEditor, but free to grab now */\n  Link = 44,\n  /* 45 used to be Next, but free to grab now */\n  Item = 46,\n  PaletteColorShades = 47,\n  Panel = 48,\n  /* 49 used to be Previous, but free to grab now */\n  ShowStyleEditor = 50,\n  Slider = 51,\n  CssColorMix = 52,\n  Value = 53,\n  Key = 54,\n  /* 55 used to be GridSettings, but free to grab now */\n  /* 56 used to be FlexboxOverlays, but free to grab now */\n  /* 57 used to be GridOverlays, but free to grab now */\n  /* 58 used to be JumpToElement, but free to grab now */\n  PieChart = 59,\n  PieChartSlice = 60,\n  PieChartTotal = 61,\n  ElementsBreadcrumbs = 62,\n  /* 63 used to be FullAccessibilityTree, but free to grab now */\n  /* 64 used to be ToggleDeviceMode, but free to grab now */\n  /* 65 used to be ToggleElementSearch, but free to grab now */\n  PanelTabHeader = 66,\n  Menu = 67,\n  TableRow = 68,\n  TableHeader = 69,\n  TableCell = 70,\n  /* 71 used to be StylesComputedPane, but free to grab now */\n  Pane = 72,\n  ResponsivePresets = 73,\n  DeviceModeRuler = 74,\n  MediaInspectorView = 75,\n  /* eslint-enable @typescript-eslint/naming-convention */\n}\n\nexport type VisualElementName = keyof typeof VisualElements;\n\nfunction resolveVe(ve: string): number {\n  return VisualElements[ve as VisualElementName] ?? 0;\n}\n\nconst reportedUnknownVeContext = new Set<string>();\n\nfunction checkContextValue(context: string|number|undefined): void {\n  if (typeof context !== 'string' || !context.length || knownContextValues.has(context) ||\n      reportedUnknownVeContext.has(context)) {\n    return;\n  }\n  if (Root.Runtime.Runtime.queryParam('debugFrontend') || Host.InspectorFrontendHost.isUnderTest() ||\n      localStorage.getItem('veDebugLoggingEnabled') === DebugLoggingFormat.TEST) {\n    const stack = (new Error().stack || '').split('\\n').slice(3).join('\\n');\n    console.error(`Unknown VE context: ${context}${stack}`);\n  }\n  reportedUnknownVeContext.add(context);\n}\n\nexport function parseJsLog(jslog: string): LoggingConfig {\n  const components = jslog.replace(/ /g, '').split(';');\n  const getComponent = (name: string): string|undefined =>\n      components.find(c => c.startsWith(name))?.substr(name.length);\n  const ve = resolveVe(components[0]);\n  if (ve === 0) {\n    throw new Error('Unkown VE: ' + jslog);\n  }\n  const config: LoggingConfig = {ve};\n  const context = getComponent('context:');\n  if (context?.trim().length) {\n    checkContextValue(context);\n    config.context = context;\n  }\n\n  const parent = getComponent('parent:');\n  if (parent) {\n    config.parent = parent;\n  }\n\n  const trackString = getComponent('track:');\n  if (trackString) {\n    config.track = {};\n    for (const track of trackString.split(',')) {\n      if (track.startsWith('keydown:')) {\n        config.track.keydown = track.substr('keydown:'.length);\n      } else {\n        config.track[track as keyof TrackConfig] = true;\n      }\n    }\n  }\n\n  return config;\n}\n\nexport interface ConfigStringBuilder {\n  /**\n   * Specifies an optional context for the visual element. For string contexts\n   * the convention is to use kebap case (e.g. `foo-bar`).\n   *\n   * @param value Optional context, which can be either a string or a number.\n   * @returns The builder itself.\n   */\n  context: (value: string|number|undefined) => ConfigStringBuilder;\n\n  /**\n   * Speficies the name of a `ParentProvider` used to lookup the parent visual element.\n   *\n   * @param value The name of a previously registered `ParentProvider`.\n   * @returns The builder itself.\n   */\n  parent: (value: string) => ConfigStringBuilder;\n\n  /**\n   * Specifies which DOM events to track for this visual element.\n   *\n   * @param options The set of DOM events to track.\n   * @returns The builder itself.\n   */\n  track: (options: TrackConfig) => ConfigStringBuilder;\n\n  /**\n   * Serializes the configuration into a `jslog` string.\n   *\n   * @returns The serialized string value to put on a DOM element via the `jslog` attribute.\n   */\n  toString: () => string;\n}\n\nexport function makeConfigStringBuilder(veName: VisualElementName, context?: string): ConfigStringBuilder {\n  const components: string[] = [veName];\n  if (typeof context === 'string' && context.trim().length) {\n    components.push(`context: ${context}`);\n    checkContextValue(context);\n  }\n  return {\n    context: function(value: string|number|undefined): ConfigStringBuilder {\n      if (typeof value === 'number' || typeof value === 'string' && value.length) {\n        components.push(`context: ${value}`);\n      }\n      checkContextValue(context);\n      return this;\n    },\n    parent: function(value: string): ConfigStringBuilder {\n      components.push(`parent: ${value}`);\n      return this;\n    },\n    track: function(options: TrackConfig): ConfigStringBuilder {\n      components.push(`track: ${\n          Object.entries(options).map(([key, value]) => value !== true ? `${key}: ${value}` : key).join(', ')}`);\n      return this;\n    },\n    toString: function(): string {\n      return components.join('; ');\n    },\n  };\n}\n"]}