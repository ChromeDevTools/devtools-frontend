{"version":3,"file":"highlight_scroll_snap.js","sourceRoot":"","sources":["../../../../inspector_overlay/highlight_scroll_snap.ts"],"names":[],"mappings":"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","sourcesContent":["\n// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type {Bounds, PathCommands, Position} from './common.js';\nimport {drawPath, emptyBounds, type LineStyle, type PathBounds} from './highlight_common.js';\n\ntype SnapAlignment = 'none'|'start'|'end'|'center';\nexport interface ScrollSnapHighlight {\n  snapport: PathCommands;\n  paddingBox: PathCommands;\n  snapAreas: Array<{\n    path: PathCommands,\n    borderBox: PathCommands,\n    alignBlock?: SnapAlignment,\n    alignInline?: SnapAlignment,\n  }>;\n  snapportBorder: LineStyle;\n  snapAreaBorder: LineStyle;\n  scrollMarginColor: string;\n  scrollPaddingColor: string;\n}\n\nfunction getSnapAlignBlockPoint(bounds: Bounds, align: SnapAlignment): Position|undefined {\n  if (align === 'start') {\n    return {\n      x: (bounds.minX + bounds.maxX) / 2,\n      y: bounds.minY,\n    };\n  }\n  if (align === 'center') {\n    return {\n      x: (bounds.minX + bounds.maxX) / 2,\n      y: (bounds.minY + bounds.maxY) / 2,\n    };\n  }\n  if (align === 'end') {\n    return {\n      x: (bounds.minX + bounds.maxX) / 2,\n      y: bounds.maxY,\n    };\n  }\n  return;\n}\n\nfunction getSnapAlignInlinePoint(bounds: Bounds, align: SnapAlignment): Position|undefined {\n  if (align === 'start') {\n    return {\n      x: bounds.minX,\n      y: (bounds.minY + bounds.maxY) / 2,\n    };\n  }\n  if (align === 'center') {\n    return {\n      x: (bounds.minX + bounds.maxX) / 2,\n      y: (bounds.minY + bounds.maxY) / 2,\n    };\n  }\n  if (align === 'end') {\n    return {\n      x: bounds.maxX,\n      y: (bounds.minY + bounds.maxY) / 2,\n    };\n  }\n  return;\n}\n\nconst ALIGNMENT_POINT_STROKE_WIDTH = 5;\nconst ALIGNMENT_POINT_STROKE_COLOR = 'white';\nconst ALIGNMENT_POINT_OUTER_RADIUS = 6;\nconst ALIGNMENT_POINT_FILL_COLOR = '#4585f6';\nconst ALIGNMENT_POINT_INNER_RADIUS = 4;\n\nfunction drawAlignment(context: CanvasRenderingContext2D, point: Position, bounds: Bounds): void {\n  let startAngle = 0;\n  let renderFullCircle = true;\n  if (point.x === bounds.minX) {\n    startAngle = -0.5 * Math.PI;\n    renderFullCircle = false;\n  } else if (point.x === bounds.maxX) {\n    startAngle = 0.5 * Math.PI;\n    renderFullCircle = false;\n  } else if (point.y === bounds.minY) {\n    startAngle = 0;\n    renderFullCircle = false;\n  } else if (point.y === bounds.maxY) {\n    startAngle = Math.PI;\n    renderFullCircle = false;\n  }\n  const endAngle = startAngle + (renderFullCircle ? 2 * Math.PI : Math.PI);\n  context.save();\n  context.beginPath();\n  context.lineWidth = ALIGNMENT_POINT_STROKE_WIDTH;\n  context.strokeStyle = ALIGNMENT_POINT_STROKE_COLOR;\n  context.arc(point.x, point.y, ALIGNMENT_POINT_OUTER_RADIUS, startAngle, endAngle);\n  context.stroke();\n  context.fillStyle = ALIGNMENT_POINT_FILL_COLOR;\n  context.arc(point.x, point.y, ALIGNMENT_POINT_INNER_RADIUS, startAngle, endAngle);\n  context.fill();\n  context.restore();\n}\n\nfunction drawScrollPadding(\n    highlight: ScrollSnapHighlight, context: CanvasRenderingContext2D, emulationScaleFactor: number) {\n  drawPath(\n      context, highlight.paddingBox, highlight.scrollPaddingColor, undefined, undefined, emptyBounds(),\n      emulationScaleFactor);\n\n  // Clear the area so that previously rendered paddings remain.\n  context.save();\n  context.globalCompositeOperation = 'destination-out';\n  drawPath(context, highlight.snapport, 'white', undefined, undefined, emptyBounds(), emulationScaleFactor);\n  context.restore();\n}\n\nfunction drawSnapAreas(\n    highlight: ScrollSnapHighlight, context: CanvasRenderingContext2D, emulationScaleFactor: number): PathBounds[] {\n  const bounds = [];\n  for (const area of highlight.snapAreas) {\n    const areaBounds = emptyBounds();\n    drawPath(\n        context, area.path, highlight.scrollMarginColor, highlight.snapAreaBorder.color,\n        highlight.snapAreaBorder.pattern, areaBounds, emulationScaleFactor);\n\n    // Clear the area so that previously rendered margins remain.\n    context.save();\n    context.globalCompositeOperation = 'destination-out';\n    drawPath(context, area.borderBox, 'white', undefined, undefined, emptyBounds(), emulationScaleFactor);\n    context.restore();\n\n    bounds.push(areaBounds);\n  }\n  return bounds;\n}\n\nfunction drawAlignmentPoints(\n    areaBounds: PathBounds[], highlight: ScrollSnapHighlight, context: CanvasRenderingContext2D) {\n  for (let i = 0; i < highlight.snapAreas.length; i++) {\n    const area = highlight.snapAreas[i];\n    const inlinePoint = area.alignInline ? getSnapAlignInlinePoint(areaBounds[i], area.alignInline) : null;\n    const blockPoint = area.alignBlock ? getSnapAlignBlockPoint(areaBounds[i], area.alignBlock) : null;\n    if (inlinePoint) {\n      drawAlignment(context, inlinePoint, areaBounds[i]);\n    }\n    if (blockPoint) {\n      drawAlignment(context, blockPoint, areaBounds[i]);\n    }\n  }\n}\n\nfunction drawSnapportBorder(\n    highlight: ScrollSnapHighlight, context: CanvasRenderingContext2D, emulationScaleFactor: number) {\n  drawPath(\n      context, highlight.snapport, undefined, highlight.snapportBorder.color, undefined, emptyBounds(),\n      emulationScaleFactor);\n}\n\nexport function drawScrollSnapHighlight(\n    highlight: ScrollSnapHighlight, context: CanvasRenderingContext2D, emulationScaleFactor: number) {\n  // The order of the following draw calls is important, change it carefully.\n  drawScrollPadding(highlight, context, emulationScaleFactor);\n  const areaBounds = drawSnapAreas(highlight, context, emulationScaleFactor);\n  drawSnapportBorder(highlight, context, emulationScaleFactor);\n  drawAlignmentPoints(areaBounds, highlight, context);\n}\n"]}