{"version":3,"file":"matchDescription.cjs","names":["_iterateJsdoc","_interopRequireDefault","require","e","__esModule","default","matchDescriptionDefault","stringOrDefault","value","userDefault","_default","exports","iterateJsdoc","jsdoc","report","context","utils","mainDescription","matchDescription","message","nonemptyTags","tags","options","validateDescription","desc","tag","mainDescriptionMatch","errorMessage","match","Object","prototype","hasOwnProperty","call","tagValue","tagName","regex","getRegexFromString","test","line","source","number","description","getDescription","hasNoTag","forEachPreferredTag","matchingJsdocTag","targetTagName","name","getTagDescription","trim","keys","length","hasOptionTag","Boolean","whitelistedTags","filterTags","tagsWithNames","tagsWithoutNames","getTagsByType","some","replace","contextDefaults","meta","docs","url","schema","additionalProperties","properties","contexts","items","anyOf","type","comment","oneOf","format","patternProperties","enum","module"],"sources":["../../src/rules/matchDescription.js"],"sourcesContent":["import iterateJsdoc from '../iterateJsdoc.js';\n\n// If supporting Node >= 10, we could loosen the default to this for the\n//   initial letter: \\\\p{Upper}\nconst matchDescriptionDefault = '^\\n?([A-Z`\\\\d_][\\\\s\\\\S]*[.?!`]\\\\s*)?$';\n\n/**\n * @param {string} value\n * @param {string} userDefault\n * @returns {string}\n */\nconst stringOrDefault = (value, userDefault) => {\n  return typeof value === 'string' ?\n    value :\n    userDefault || matchDescriptionDefault;\n};\n\nexport default iterateJsdoc(({\n  jsdoc,\n  report,\n  context,\n  utils,\n}) => {\n  const {\n    mainDescription,\n    matchDescription,\n    message,\n    nonemptyTags = true,\n    tags = {},\n  } = context.options[0] || {};\n\n  /**\n   * @param {string} desc\n   * @param {import('comment-parser').Spec} [tag]\n   * @returns {void}\n   */\n  const validateDescription = (desc, tag) => {\n    let mainDescriptionMatch = mainDescription;\n    let errorMessage = message;\n    if (typeof mainDescription === 'object') {\n      mainDescriptionMatch = mainDescription.match;\n      errorMessage = mainDescription.message;\n    }\n\n    if (mainDescriptionMatch === false && (\n      !tag || !Object.prototype.hasOwnProperty.call(tags, tag.tag))\n    ) {\n      return;\n    }\n\n    let tagValue = mainDescriptionMatch;\n    if (tag) {\n      const tagName = tag.tag;\n      if (typeof tags[tagName] === 'object') {\n        tagValue = tags[tagName].match;\n        errorMessage = tags[tagName].message;\n      } else {\n        tagValue = tags[tagName];\n      }\n    }\n\n    const regex = utils.getRegexFromString(\n      stringOrDefault(tagValue, matchDescription),\n    );\n\n    if (!regex.test(desc)) {\n      report(\n        errorMessage || 'JSDoc description does not satisfy the regex pattern.',\n        null,\n        tag || {\n          // Add one as description would typically be into block\n          line: jsdoc.source[0].number + 1,\n        },\n      );\n    }\n  };\n\n  const {\n    description,\n  } = utils.getDescription();\n  if (description) {\n    validateDescription(description);\n  }\n\n  /**\n   * @param {string} tagName\n   * @returns {boolean}\n   */\n  const hasNoTag = (tagName) => {\n    return !tags[tagName];\n  };\n\n  for (const tag of [\n    'description',\n    'summary',\n    'file',\n    'classdesc',\n  ]) {\n    utils.forEachPreferredTag(tag, (matchingJsdocTag, targetTagName) => {\n      const desc = (matchingJsdocTag.name + ' ' + utils.getTagDescription(matchingJsdocTag)).trim();\n      if (hasNoTag(targetTagName)) {\n        validateDescription(desc, matchingJsdocTag);\n      }\n    }, true);\n  }\n\n  if (nonemptyTags) {\n    for (const tag of [\n      'copyright',\n      'example',\n      'see',\n      'todo',\n    ]) {\n      utils.forEachPreferredTag(tag, (matchingJsdocTag, targetTagName) => {\n        const desc = (matchingJsdocTag.name + ' ' + utils.getTagDescription(matchingJsdocTag)).trim();\n\n        if (hasNoTag(targetTagName) && !(/.+/u).test(desc)) {\n          report(\n            'JSDoc description must not be empty.',\n            null,\n            matchingJsdocTag,\n          );\n        }\n      });\n    }\n  }\n\n  if (!Object.keys(tags).length) {\n    return;\n  }\n\n  /**\n   * @param {string} tagName\n   * @returns {boolean}\n   */\n  const hasOptionTag = (tagName) => {\n    return Boolean(tags[tagName]);\n  };\n\n  const whitelistedTags = utils.filterTags(({\n    tag: tagName,\n  }) => {\n    return hasOptionTag(tagName);\n  });\n  const {\n    tagsWithNames,\n    tagsWithoutNames,\n  } = utils.getTagsByType(whitelistedTags);\n\n  tagsWithNames.some((tag) => {\n    const desc = /** @type {string} */ (\n      utils.getTagDescription(tag)\n    ).replace(/^[- ]*/u, '')\n      .trim();\n\n    return validateDescription(desc, tag);\n  });\n\n  tagsWithoutNames.some((tag) => {\n    const desc = (tag.name + ' ' + utils.getTagDescription(tag)).trim();\n\n    return validateDescription(desc, tag);\n  });\n}, {\n  contextDefaults: true,\n  meta: {\n    docs: {\n      description: 'Enforces a regular expression pattern on descriptions.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc/blob/main/docs/rules/match-description.md#repos-sticky-header',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          contexts: {\n            items: {\n              anyOf: [\n                {\n                  type: 'string',\n                },\n                {\n                  additionalProperties: false,\n                  properties: {\n                    comment: {\n                      type: 'string',\n                    },\n                    context: {\n                      type: 'string',\n                    },\n                  },\n                  type: 'object',\n                },\n              ],\n            },\n            type: 'array',\n          },\n          mainDescription: {\n            oneOf: [\n              {\n                format: 'regex',\n                type: 'string',\n              },\n              {\n                type: 'boolean',\n              },\n              {\n                additionalProperties: false,\n                properties: {\n                  match: {\n                    oneOf: [\n                      {\n                        format: 'regex',\n                        type: 'string',\n                      },\n                      {\n                        type: 'boolean',\n                      },\n                    ],\n                  },\n                  message: {\n                    type: 'string',\n                  },\n                },\n                type: 'object',\n              },\n            ],\n          },\n          matchDescription: {\n            format: 'regex',\n            type: 'string',\n          },\n          message: {\n            type: 'string',\n          },\n          nonemptyTags: {\n            type: 'boolean',\n          },\n          tags: {\n            patternProperties: {\n              '.*': {\n                oneOf: [\n                  {\n                    format: 'regex',\n                    type: 'string',\n                  },\n                  {\n                    enum: [\n                      true,\n                    ],\n                    type: 'boolean',\n                  },\n                  {\n                    additionalProperties: false,\n                    properties: {\n                      match: {\n                        oneOf: [\n                          {\n                            format: 'regex',\n                            type: 'string',\n                          },\n                          {\n                            enum: [\n                              true,\n                            ],\n                            type: 'boolean',\n                          },\n                        ],\n                      },\n                      message: {\n                        type: 'string',\n                      },\n                    },\n                    type: 'object',\n                  },\n                ],\n              },\n            },\n            type: 'object',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"mappings":"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","ignoreList":[]}