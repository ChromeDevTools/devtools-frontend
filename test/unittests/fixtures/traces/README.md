# Traces

This folder contains traces saved by the DevTools Performance Panel that can be used in tests.

To add a trace, copy the `*.json.gz` file into this folder, and add it to the `BUILD.gn`. You can also add the unzipped `*.json` file, but these are git-ignored. However, it's useful when working with a trace file to have it extracted and inspectable!

There are two helpers you can use to load a trace file into a test, depending on which model you are working with:

## OPP "legacy" model

Use `loadTraceEventsLegacyEventPayload`. This loads the file and assumes it returns a list of `SDK.TracingManager.EventPayload` events.

### Insights model

The Insights model supports trace files in two forms:

1. An array of events.
2. An object, with an array of `traceEvents` and associated `metadata`

You can use `loadEventsFromTraceFile` to return all the events in a trace file. If you want to load the entire file, you can use `loadTraceFile`.

If you have created an example website to generate a trace, consider contributing it to the [Performance Stories repository](https://github.com/ChromeDevTools/performance-stories).

# Trace descriptions

**If you add a trace, please update this file with a description of the file and how it was generated**.

## basic

Contains a navigation to about:blank first and then to another URL. Includes data from about:blank to ensure a track for that URL is rendered.

## basic

A very barebones trace; contains info on browser processes and threads but very little else.

## slow-interaction-button-click

Generated from the [long-interaction story](https://github.com/ChromeDevTools/performance-stories/tree/main/long-interaction). Contains one slow interaction which is the user clicking on a button.

## slow-interaction-keydown

Generated from the [long-interaction story](https://github.com/ChromeDevTools/performance-stories/tree/main/long-interaction). Contains one slow interaction which is the user typing into the input field. There is also another interaction representing the user clicking into the text field to focus it, but this is not a long interaction.

## Example trace files

### basic

A barebones trace file with the main details about processes and threads but
little else.

### reload-and-trace-page

This trace is a trace of example.com which was recorded via the OPP's "Start profiling and reload the page" button.

### web-dev

A trace of web.dev being loaded.

### web-dev-with-commit

The web-dev trace is old (recorded in 2021) and since its recording the events relating to frames have changed. In particular CompositeLayers was replaced by Commit, and frameSeqId was added to more events. This is a more recent (Nov 2023) trace that has the newer frame-related events in it. This was used when migrating the TimelineFrameModel to the new engine.

### multiple-top-level-renderers

A trace containing multiple top level renderers.

### missing-process-data

A trace missing the renderer process.

### threejs-gpu

A trace containing a lot of GPU activity.

### forced-layouts-and-no-gpu

A trace that contains a button that, when clicked, will iterate over 30 paragraphs and increment their width to the width of a div. This causes a forced layout event for each one. Additionally this trace contains no GPU thread.

### multiple-navigations

This is a trace that includes multiple navigations:

* Starts on google.com
* Navigates to Google Images search (google.com/imghp)
* Search for "dogs" (https://www.google.com/search?q=dogs&...)

### user-timings

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/user-timings

### lcp-web-font

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/lcp-web-font

### lcp-images

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/lcp-large-image

### recursive-blocking-js

A trace that contains 3 invocations of a JS function, spaced 1 second apart,
which recurses 10 times, and blocks for one second in total with performance.now.

### recursive-counting-js

A trace that contains 3 invocations of a JS function, spaced 1 second apart,
which recurses 3 times, and blocks for one second in total by summing over all
integers until 1_000_000_000.

### multiple-navigations-with-iframes.json

This trace loads `index.html`, with an iframe to load `example.com`. It then
loads `page2.html`, which also loads `example.com` in an iFrame. This trace is
used to make sure we filter out events in iFrames (such as MarkDOMContent).

### animation.json

Generated by https://github.com/ChromeDevTools/performance-stories/tree/main/animation.

### many-requests

Generated by https://github.com/ChromeDevTools/performance-stories/tree/main/lots-of-network-requests. Loads 20 images from the placeholder API and an extra script and stylesheet. Trace was recorded on 3G throttling, so some of the requests have not even finished.


### idle-callback
A trace with an idle callback that exceeds its allotted time.

### large-layout-small-recalc

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/forced-layout-main-thread. Has a large layout event (126ms) and a smaller recalc style event (4.07ms).

### large-recalc-style

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/forced-layout-main-thread. Has a large recalc style event that isn't forced by JS.

### two-workers

Generated from https://github.com/ChromeDevTools/performance-stories/tree/main/two-workers. Runs two workers that both calculcate fibonnaci numbers.

### timer-initiators

Contains a `setTimeout`, `requestAnimationFrame` and `requestIdleCallback` call.

### nested-initiators

Contains a `setTimeout` triggered by a prior `setTimeout`, so there is a larger initiator chain.

### multiple-navigations-same-id

Contains a trace with two identical navigation events with matching IDs. See crbug.com/1503982 for the context and comments in MetaHandler.ts for the fix. This trace is included to avoid a regression.

### web-dev-initial-url

This is a trace where we loaded web.dev/inp, but the initial URL reported by the TraceStartedInBrowser event states google.com (the previous page). In this situation the MetaHandler would produce google.com as the mainFrameURL which is incorrect. This trace was used to write a test to ensure in this instance if we can we try to calculate the actual domain by looking at the first navigation.
